import{a5 as ai,q as W,h as M,a6 as ii,a7 as oi,a8 as rn,a9 as li,aa as fr,d as Q,f as ci,t as ui,g as di,ab as Ht,ac as an,c as G,o as S,w as A,r as se,H as B,b as _,m as ve,P as Kt,ad as ge,$ as Ue,p as Ke,ae as Te,af as fi,ag as hr,G as R,F as N,I as fe,L as w,_ as me,e as Ye,A as mr,M as pr,N as gr,ah as hi,ai as mi,B as Ft,C as yr,z as pi,aj as gi,ak as us,al as yi,am as _i,n as ds,j as fs,k as ie,an as xe,Q as Se,K as Me,ao as zt,ap as At,V as Jt,aq as bi,a0 as vi,J as Lt,ar as on,as as Tn,at as Nn,a3 as _r,au as wi}from"./index-XUaeqkGE.js";import{u as xi}from"./useFormControl-DaChkIWc.js";import{c as Si,s as Ci,_ as Pn}from"./Select-Dy0zWcrM.js";import{_ as $i,a as Mn,b as Ai,s as br}from"./speechSynthesis-D2MKAfQl.js";import{_ as Ii,a as Ei,b as Ri,c as hs,d as ms,e as Oi,f as ki,g as Ti,h as vr}from"./Modal-NVl2eP3O.js";import{_ as Fn}from"./Separator-CwXQYk-i.js";import{_ as wr,a as xr,b as Ni,c as Pi,u as Mi}from"./LexicalUnitCard.vue_vue_type_script_setup_true_lang-CHFLNikL.js";import{_ as Sr}from"./Card-LQgMLmHj.js";import{_ as Fi}from"./VoiceSettings.vue_vue_type_script_setup_true_lang-BNElrR2x.js";import{_ as Li}from"./Input-CPhLJoau.js";import{_ as Ui,u as Di,s as Bi}from"./shuffleArray-DobQMSAu.js";import"./utils-YpMqY30z.js";function qi(s){const e=ai({locale:W("en")});return M(()=>{var t;return(s==null?void 0:s.value)||((t=e.locale)==null?void 0:t.value)||"en"})}let ln=new Map,bn=!1;try{bn=new Intl.NumberFormat("de-DE",{signDisplay:"exceptZero"}).resolvedOptions().signDisplay==="exceptZero"}catch{}let Ut=!1;try{Ut=new Intl.NumberFormat("de-DE",{style:"unit",unit:"degree"}).resolvedOptions().style==="unit"}catch{}const Cr={degree:{narrow:{default:"°","ja-JP":" 度","zh-TW":"度","sl-SI":" °"}}};class $r{format(e){let t="";if(!bn&&this.options.signDisplay!=null?t=Vi(this.numberFormatter,this.options.signDisplay,e):t=this.numberFormatter.format(e),this.options.style==="unit"&&!Ut){var n;let{unit:r,unitDisplay:a="short",locale:i}=this.resolvedOptions();if(!r)return t;let o=(n=Cr[r])===null||n===void 0?void 0:n[a];t+=o[i]||o.default}return t}formatToParts(e){return this.numberFormatter.formatToParts(e)}formatRange(e,t){if(typeof this.numberFormatter.formatRange=="function")return this.numberFormatter.formatRange(e,t);if(t<e)throw new RangeError("End date must be >= start date");return`${this.format(e)} – ${this.format(t)}`}formatRangeToParts(e,t){if(typeof this.numberFormatter.formatRangeToParts=="function")return this.numberFormatter.formatRangeToParts(e,t);if(t<e)throw new RangeError("End date must be >= start date");let n=this.numberFormatter.formatToParts(e),r=this.numberFormatter.formatToParts(t);return[...n.map(a=>({...a,source:"startRange"})),{type:"literal",value:" – ",source:"shared"},...r.map(a=>({...a,source:"endRange"}))]}resolvedOptions(){let e=this.numberFormatter.resolvedOptions();return!bn&&this.options.signDisplay!=null&&(e={...e,signDisplay:this.options.signDisplay}),!Ut&&this.options.style==="unit"&&(e={...e,style:"unit",unit:this.options.unit,unitDisplay:this.options.unitDisplay}),e}constructor(e,t={}){this.numberFormatter=ji(e,t),this.options=t}}function ji(s,e={}){let{numberingSystem:t}=e;if(t&&s.includes("-nu-")&&(s.includes("-u-")||(s+="-u-"),s+=`-nu-${t}`),e.style==="unit"&&!Ut){var n;let{unit:i,unitDisplay:o="short"}=e;if(!i)throw new Error('unit option must be provided with style: "unit"');if(!(!((n=Cr[i])===null||n===void 0)&&n[o]))throw new Error(`Unsupported unit ${i} with unitDisplay = ${o}`);e={...e,style:"decimal"}}let r=s+(e?Object.entries(e).sort((i,o)=>i[0]<o[0]?-1:1).join():"");if(ln.has(r))return ln.get(r);let a=new Intl.NumberFormat(s,e);return ln.set(r,a),a}function Vi(s,e,t){if(e==="auto")return s.format(t);if(e==="never")return s.format(Math.abs(t));{let n=!1;if(e==="always"?n=t>0||Object.is(t,0):e==="exceptZero"&&(Object.is(t,-0)||Object.is(t,0)?t=Math.abs(t):n=t>0),n){let r=s.format(-t),a=s.format(t),i=r.replace(a,"").replace(/\u200e|\u061C/,"");return[...i].length!==1&&console.warn("@react-aria/i18n polyfill for NumberFormat signDisplay: Unsupported case"),r.replace(a,"!!!").replace(i,"+").replace("!!!",a)}else return s.format(t)}}const Gi=new RegExp("^.*\\(.*\\).*$"),Wi=["latn","arab","hanidec","deva","beng"];class Ar{parse(e){return cn(this.locale,this.options,e).parse(e)}isValidPartialNumber(e,t,n){return cn(this.locale,this.options,e).isValidPartialNumber(e,t,n)}getNumberingSystem(e){return cn(this.locale,this.options,e).options.numberingSystem}constructor(e,t={}){this.locale=e,this.options=t}}const ps=new Map;function cn(s,e,t){let n=gs(s,e);if(!s.includes("-nu-")&&!n.isValidPartialNumber(t)){for(let r of Wi)if(r!==n.options.numberingSystem){let a=gs(s+(s.includes("-u-")?"-nu-":"-u-nu-")+r,e);if(a.isValidPartialNumber(t))return a}}return n}function gs(s,e){let t=s+(e?Object.entries(e).sort((r,a)=>r[0]<a[0]?-1:1).join():""),n=ps.get(t);return n||(n=new Hi(s,e),ps.set(t,n)),n}class Hi{parse(e){let t=this.sanitize(e);if(this.symbols.group&&(t=Je(t,this.symbols.group,"")),this.symbols.decimal&&(t=t.replace(this.symbols.decimal,".")),this.symbols.minusSign&&(t=t.replace(this.symbols.minusSign,"-")),t=t.replace(this.symbols.numeral,this.symbols.index),this.options.style==="percent"){let i=t.indexOf("-");t=t.replace("-","");let o=t.indexOf(".");o===-1&&(o=t.length),t=t.replace(".",""),o-2===0?t=`0.${t}`:o-2===-1?t=`0.0${t}`:o-2===-2?t="0.00":t=`${t.slice(0,o-2)}.${t.slice(o-2)}`,i>-1&&(t=`-${t}`)}let n=t?+t:NaN;if(isNaN(n))return NaN;if(this.options.style==="percent"){var r,a;let i={...this.options,style:"decimal",minimumFractionDigits:Math.min(((r=this.options.minimumFractionDigits)!==null&&r!==void 0?r:0)+2,20),maximumFractionDigits:Math.min(((a=this.options.maximumFractionDigits)!==null&&a!==void 0?a:0)+2,20)};return new Ar(this.locale,i).parse(new $r(this.locale,i).format(n))}return this.options.currencySign==="accounting"&&Gi.test(e)&&(n=-1*n),n}sanitize(e){return e=e.replace(this.symbols.literals,""),this.symbols.minusSign&&(e=e.replace("-",this.symbols.minusSign)),this.options.numberingSystem==="arab"&&(this.symbols.decimal&&(e=e.replace(",",this.symbols.decimal),e=e.replace("،",this.symbols.decimal)),this.symbols.group&&(e=Je(e,".",this.symbols.group))),this.options.locale==="fr-FR"&&this.symbols.group&&(e=Je(e," ",this.symbols.group),e=Je(e,/\u00A0/g,this.symbols.group)),e}isValidPartialNumber(e,t=-1/0,n=1/0){return e=this.sanitize(e),this.symbols.minusSign&&e.startsWith(this.symbols.minusSign)&&t<0?e=e.slice(this.symbols.minusSign.length):this.symbols.plusSign&&e.startsWith(this.symbols.plusSign)&&n>0&&(e=e.slice(this.symbols.plusSign.length)),this.symbols.group&&e.startsWith(this.symbols.group)||this.symbols.decimal&&e.indexOf(this.symbols.decimal)>-1&&this.options.maximumFractionDigits===0?!1:(this.symbols.group&&(e=Je(e,this.symbols.group,"")),e=e.replace(this.symbols.numeral,""),this.symbols.decimal&&(e=e.replace(this.symbols.decimal,"")),e.length===0)}constructor(e,t={}){this.locale=e,t.roundingIncrement!==1&&t.roundingIncrement!=null&&(t.maximumFractionDigits==null&&t.minimumFractionDigits==null?(t.maximumFractionDigits=0,t.minimumFractionDigits=0):t.maximumFractionDigits==null?t.maximumFractionDigits=t.minimumFractionDigits:t.minimumFractionDigits==null&&(t.minimumFractionDigits=t.maximumFractionDigits)),this.formatter=new Intl.NumberFormat(e,t),this.options=this.formatter.resolvedOptions(),this.symbols=zi(e,this.formatter,this.options,t);var n,r;this.options.style==="percent"&&(((n=this.options.minimumFractionDigits)!==null&&n!==void 0?n:0)>18||((r=this.options.maximumFractionDigits)!==null&&r!==void 0?r:0)>18)&&console.warn("NumberParser cannot handle percentages with greater than 18 decimal places, please reduce the number in your options.")}}const ys=new Set(["decimal","fraction","integer","minusSign","plusSign","group"]),Ki=[0,4,2,1,11,20,3,7,100,21,.1,1.1];function zi(s,e,t,n){var r,a,i,o;let l=new Intl.NumberFormat(s,{...t,minimumSignificantDigits:1,maximumSignificantDigits:21,roundingIncrement:1,roundingPriority:"auto",roundingMode:"halfExpand"}),c=l.formatToParts(-10000.111),f=l.formatToParts(10000.111),d=Ki.map(C=>l.formatToParts(C));var h;let u=(h=(r=c.find(C=>C.type==="minusSign"))===null||r===void 0?void 0:r.value)!==null&&h!==void 0?h:"-",m=(a=f.find(C=>C.type==="plusSign"))===null||a===void 0?void 0:a.value;!m&&((n==null?void 0:n.signDisplay)==="exceptZero"||(n==null?void 0:n.signDisplay)==="always")&&(m="+");let v=(i=new Intl.NumberFormat(s,{...t,minimumFractionDigits:2,maximumFractionDigits:2}).formatToParts(.001).find(C=>C.type==="decimal"))===null||i===void 0?void 0:i.value,k=(o=c.find(C=>C.type==="group"))===null||o===void 0?void 0:o.value,x=c.filter(C=>!ys.has(C.type)).map(C=>_s(C.value)),b=d.flatMap(C=>C.filter(F=>!ys.has(F.type)).map(F=>_s(F.value))),y=[...new Set([...x,...b])].sort((C,F)=>F.length-C.length),E=y.length===0?new RegExp("[\\p{White_Space}]","gu"):new RegExp(`${y.join("|")}|[\\p{White_Space}]`,"gu"),O=[...new Intl.NumberFormat(t.locale,{useGrouping:!1}).format(9876543210)].reverse(),I=new Map(O.map((C,F)=>[C,F])),q=new RegExp(`[${O.join("")}]`,"g");return{minusSign:u,plusSign:m,decimal:v,group:k,literals:E,numeral:q,index:C=>String(I.get(C))}}function Je(s,e,t){return s.replaceAll?s.replaceAll(e,t):s.split(e).join(t)}function _s(s){return s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Ir(s){const{disabled:e}=s,t=W(),n=li(),r=()=>window.clearTimeout(t.value),a=h=>{r(),!e.value&&(n.trigger(),t.value=window.setTimeout(()=>{a(60)},h))},i=()=>{a(400)},o=()=>{r()},l=W(!1),c=M(()=>ii(s.target)),f=h=>{h.button!==0||l.value||(h.preventDefault(),l.value=!0,i())},d=()=>{l.value=!1,o()};return oi&&(rn(c||window,"pointerdown",f),rn(window,"pointerup",d),rn(window,"pointercancel",d)),{isPressed:l,onTrigger:n.on}}function bs(s,e=W({})){return fr(()=>new $r(s.value,e.value))}function Ji(s,e=W({})){return fr(()=>new Ar(s.value,e.value))}function vs(s,e,t){let n=s==="+"?e+t:e-t;if(e%1!==0||t%1!==0){const r=e.toString().split("."),a=t.toString().split("."),i=r[1]&&r[1].length||0,o=a[1]&&a[1].length||0,l=10**Math.max(i,o);e=Math.round(e*l),t=Math.round(t*l),n=s==="+"?e+t:e-t,n/=l}return n}const[Ln,Xi]=ci("NumberFieldRoot"),Yi=Q({inheritAttrs:!1,__name:"NumberFieldRoot",props:{defaultValue:{default:void 0},modelValue:{},min:{},max:{},step:{default:1},stepSnapping:{type:Boolean,default:!0},formatOptions:{},locale:{},disabled:{type:Boolean},disableWheelChange:{type:Boolean},invertWheelChange:{type:Boolean},id:{},asChild:{type:Boolean},as:{default:"div"},name:{},required:{type:Boolean}},emits:["update:modelValue"],setup(s,{emit:e}){const t=s,n=e,{disabled:r,disableWheelChange:a,invertWheelChange:i,min:o,max:l,step:c,stepSnapping:f,formatOptions:d,id:h,locale:u}=ui(t),m=di(t,"modelValue",n,{defaultValue:t.defaultValue,passive:t.modelValue===void 0}),{primitiveElement:g,currentElement:v}=Ht(),k=qi(u),x=xi(v),b=W(),y=M(()=>!an(m.value)&&(ye(m.value)===o.value||o.value&&!isNaN(m.value)?vs("-",m.value,c.value)<o.value:!1)),E=M(()=>!an(m.value)&&(ye(m.value)===l.value||l.value&&!isNaN(m.value)?vs("+",m.value,c.value)>l.value:!1));function O(V,te=1){var ls,cs;(ls=b.value)==null||ls.focus();const sn=F.parse(((cs=b.value)==null?void 0:cs.value)??"");t.disabled||(isNaN(sn)?m.value=o.value??0:V==="increase"?m.value=ye(sn+(c.value??1)*te):m.value=ye(sn-(c.value??1)*te))}function I(V=1){O("increase",V)}function q(V=1){O("decrease",V)}function T(V){V==="min"&&o.value!==void 0?m.value=ye(o.value):V==="max"&&l.value!==void 0&&(m.value=ye(l.value))}const C=bs(k,d),F=Ji(k,d),oe=M(()=>C.resolvedOptions().maximumFractionDigits>0?"decimal":"numeric"),H=bs(k,d),Ie=M(()=>an(m.value)||isNaN(m.value)?"":H.format(m.value));function X(V){return F.isValidPartialNumber(V,o.value,l.value)}function Ce(V){b.value&&(b.value.value=V)}function ye(V){let te;return c.value===void 0||isNaN(c.value)||!f.value?te=Si(V,o.value,l.value):te=Ci(V,o.value,l.value,c.value),te=F.parse(C.format(te)),te}function _t(V){const te=F.parse(V);return m.value=isNaN(te)?void 0:ye(te),V.length?(isNaN(te),Ce(Ie.value)):Ce(V)}return Xi({modelValue:m,handleDecrease:q,handleIncrease:I,handleMinMaxValue:T,inputMode:oe,inputEl:b,onInputElement:V=>b.value=V,textValue:Ie,validate:X,applyInputValue:_t,disabled:r,disableWheelChange:a,invertWheelChange:i,max:l,min:o,isDecreaseDisabled:y,isIncreaseDisabled:E,id:h}),(V,te)=>(S(),G(_(Kt),ve(V.$attrs,{ref_key:"primitiveElement",ref:g,role:"group",as:V.as,"as-child":V.asChild,"data-disabled":_(r)?"":void 0}),{default:A(()=>[se(V.$slots,"default",{modelValue:_(m),textValue:Ie.value}),_(x)&&V.name?(S(),G(_($i),{key:0,type:"text",value:_(m),name:V.name,disabled:_(r),required:V.required},null,8,["value","name","disabled","required"])):B("",!0)]),_:3},16,["as","as-child","data-disabled"]))}}),Qi=Q({__name:"NumberFieldDecrement",props:{disabled:{type:Boolean},asChild:{type:Boolean},as:{default:"button"}},setup(s){const e=s,t=Ln(),n=M(()=>{var l;return((l=t.disabled)==null?void 0:l.value)||e.disabled||t.isDecreaseDisabled.value}),{primitiveElement:r,currentElement:a}=Ht(),{isPressed:i,onTrigger:o}=Ir({target:a,disabled:n});return o(()=>{t.handleDecrease()}),(l,c)=>(S(),G(_(Kt),ve(e,{ref_key:"primitiveElement",ref:r,tabindex:"-1","aria-label":"Decrease",type:l.as==="button"?"button":void 0,style:{userSelect:_(i)?"none":void 0},disabled:n.value?"":void 0,"data-disabled":n.value?"":void 0,"data-pressed":_(i)?"true":void 0,onContextmenu:c[0]||(c[0]=ge(()=>{},["prevent"]))}),{default:A(()=>[se(l.$slots,"default")]),_:3},16,["type","style","disabled","data-disabled","data-pressed"]))}}),Zi=Q({__name:"NumberFieldIncrement",props:{disabled:{type:Boolean},asChild:{type:Boolean},as:{default:"button"}},setup(s){const e=s,t=Ln(),n=M(()=>{var l;return((l=t.disabled)==null?void 0:l.value)||e.disabled||t.isIncreaseDisabled.value}),{primitiveElement:r,currentElement:a}=Ht(),{isPressed:i,onTrigger:o}=Ir({target:a,disabled:n});return o(()=>{t.handleIncrease()}),(l,c)=>(S(),G(_(Kt),ve(e,{ref_key:"primitiveElement",ref:r,tabindex:"-1","aria-label":"Increase",type:l.as==="button"?"button":void 0,style:{userSelect:_(i)?"none":void 0},disabled:n.value?"":void 0,"data-disabled":n.value?"":void 0,"data-pressed":_(i)?"true":void 0,onContextmenu:c[0]||(c[0]=ge(()=>{},["prevent"]))}),{default:A(()=>[se(l.$slots,"default")]),_:3},16,["type","style","disabled","data-disabled","data-pressed"]))}}),eo=Q({__name:"NumberFieldInput",props:{asChild:{type:Boolean},as:{default:"input"}},setup(s){const e=s,{primitiveElement:t,currentElement:n}=Ht(),r=Ln();function a(l){r.disableWheelChange.value||l.target===fi()&&(Math.abs(l.deltaY)<=Math.abs(l.deltaX)||(l.preventDefault(),l.deltaY>0?r.invertWheelChange.value?r.handleDecrease():r.handleIncrease():l.deltaY<0&&(r.invertWheelChange.value?r.handleIncrease():r.handleDecrease())))}Ue(()=>{r.onInputElement(n.value)});const i=W(r.textValue.value);Ke(()=>r.textValue.value,()=>{i.value=r.textValue.value},{immediate:!0,deep:!0});function o(){requestAnimationFrame(()=>{i.value=r.textValue.value})}return(l,c)=>(S(),G(_(Kt),ve(e,{id:_(r).id.value,ref_key:"primitiveElement",ref:t,value:i.value,role:"spinbutton",type:"text",tabindex:"0",inputmode:_(r).inputMode.value,disabled:_(r).disabled.value?"":void 0,"data-disabled":_(r).disabled.value?"":void 0,autocomplete:"off",autocorrect:"off",spellcheck:"false","aria-roledescription":"Number field","aria-valuenow":_(r).modelValue.value,"aria-valuemin":_(r).min.value,"aria-valuemax":_(r).max.value,onKeydown:[c[0]||(c[0]=Te(ge(f=>_(r).handleIncrease(),["prevent"]),["up"])),c[1]||(c[1]=Te(ge(f=>_(r).handleDecrease(),["prevent"]),["down"])),c[2]||(c[2]=Te(ge(f=>_(r).handleIncrease(10),["prevent"]),["page-up"])),c[3]||(c[3]=Te(ge(f=>_(r).handleDecrease(10),["prevent"]),["page-down"])),c[4]||(c[4]=Te(ge(f=>_(r).handleMinMaxValue("min"),["prevent"]),["home"])),c[5]||(c[5]=Te(ge(f=>_(r).handleMinMaxValue("max"),["prevent"]),["end"])),c[8]||(c[8]=Te(f=>{var d;return _(r).applyInputValue((d=f.target)==null?void 0:d.value)},["enter"]))],onWheel:a,onBeforeinput:c[6]||(c[6]=f=>{const d=f.target;let h=d.value.slice(0,d.selectionStart??void 0)+(f.data??"")+d.value.slice(d.selectionEnd??void 0);_(r).validate(h)||f.preventDefault()}),onInput:c[7]||(c[7]=f=>{const d=f.target;i.value=d.value}),onChange:o,onBlur:c[9]||(c[9]=f=>{var d;return _(r).applyInputValue((d=f.target)==null?void 0:d.value)})}),{default:A(()=>[se(l.$slots,"default")]),_:3},16,["id","value","inputmode","disabled","data-disabled","aria-valuenow","aria-valuemin","aria-valuemax"]))}}),Un=hr("textMaterials",{state:()=>({currentMaterial:null,isLoading:!1}),actions:{async loadMaterialFromFile(s){this.isLoading=!0,this.currentMaterial=null;try{const e=await s.text();let t;if(s.name.endsWith(".json")){const n=JSON.parse(e);if(typeof n=="object"&&!Array.isArray(n)&&n.content){const r=n;t={info:{title:r.title||s.name,description:r.description,imageUrl:r.img},text:r.content,note:r.note}}else if(Array.isArray(n))t={info:{title:s.name},text:n};else throw new Error('Invalid JSON structure. Expected an object with a "content" key or an array of segments.')}else if(s.name.endsWith(".txt")){const r=e.split(`
`).filter(a=>a.trim()!=="").map(a=>({text:a}));t={info:{title:s.name},text:r}}else throw new Error("Unsupported file type. Please use .json or .txt");this.currentMaterial=t}catch(e){console.error("Failed to load text material:",e),this.currentMaterial=null}finally{this.isLoading=!1}},clearMaterial(){this.currentMaterial=null}},getters:{isMaterialLoaded(){return this.currentMaterial!==null}}}),to={class:"w-full max-w-2xl mx-auto text-center"},no={key:0,class:"mt-4"},so=Q({__name:"TextMaterialLoader",setup(s){const e=Un(),t=W(!1),n=W(null);async function r(l){l&&await e.loadMaterialFromFile(l)}function a(){var l;(l=n.value)==null||l.click()}async function i(l){const c=l.target;c.files&&c.files.length>0&&(await r(c.files[0]),c.value="")}async function o(l){if(t.value=!1,l.dataTransfer&&l.dataTransfer.files&&l.dataTransfer.files.length>0){const c=l.dataTransfer.files[0];await r(c)}}return(l,c)=>{const f=me;return S(),R("div",to,[N("input",{ref_key:"fileInput",ref:n,type:"file",onChange:i,accept:".json,.txt",class:"hidden"},null,544),N("div",{onDragover:c[0]||(c[0]=ge(d=>t.value=!0,["prevent"])),onDragleave:c[1]||(c[1]=ge(d=>t.value=!1,["prevent"])),onDrop:ge(o,["prevent"]),class:fe(["border-2 border-dashed rounded-lg p-10 cursor-pointer transition-colors",{"border-primary-500 dark:border-primary-400 bg-primary-50 dark:bg-primary-900/10":t.value,"border-gray-300 dark:border-gray-600 hover:border-gray-400 dark:hover:border-gray-500":!t.value}])},[c[3]||(c[3]=N("p",{class:"text-gray-500 dark:text-gray-400"},"Drag & Drop your Text file here",-1)),c[4]||(c[4]=N("p",{class:"mt-2 text-sm text-gray-400 dark:text-gray-500"},"(.txt or .json)",-1)),c[5]||(c[5]=N("p",{class:"mt-2 text-sm text-gray-400 dark:text-gray-500"},"or",-1)),w(f,{onClick:a,class:"mt-2"},{default:A(()=>c[2]||(c[2]=[Ye("Select File")])),_:1,__:[2]})],34),_(e).isLoading?(S(),R("div",no,c[6]||(c[6]=[N("p",{class:"text-lg animate-pulse text-gray-700 dark:text-gray-300"},"Loading Text...",-1)]))):B("",!0)])}}}),ro={slots:{root:"relative inline-flex items-center",base:["w-full rounded-md border-0 placeholder:text-dimmed focus:outline-none disabled:cursor-not-allowed disabled:opacity-75","transition-colors"],increment:"absolute flex items-center",decrement:"absolute flex items-center"},variants:{buttonGroup:{horizontal:{root:"group has-focus-visible:z-[1]",base:"group-not-only:group-first:rounded-e-none group-not-only:group-last:rounded-s-none group-not-last:group-not-first:rounded-none"},vertical:{root:"group has-focus-visible:z-[1]",base:"group-not-only:group-first:rounded-b-none group-not-only:group-last:rounded-t-none group-not-last:group-not-first:rounded-none"}},color:{primary:"",secondary:"",success:"",info:"",warning:"",error:"",neutral:""},size:{xs:"px-2 py-1 text-xs gap-1",sm:"px-2.5 py-1.5 text-xs gap-1.5",md:"px-2.5 py-1.5 text-sm gap-1.5",lg:"px-3 py-2 text-sm gap-2",xl:"px-3 py-2 text-base gap-2"},variant:{outline:"text-highlighted bg-default ring ring-inset ring-accented",soft:"text-highlighted bg-elevated/50 hover:bg-elevated focus:bg-elevated disabled:bg-elevated/50",subtle:"text-highlighted bg-elevated ring ring-inset ring-accented",ghost:"text-highlighted bg-transparent hover:bg-elevated focus:bg-elevated disabled:bg-transparent dark:disabled:bg-transparent",none:"text-highlighted bg-transparent"},disabled:{true:{increment:"opacity-75 cursor-not-allowed",decrement:"opacity-75 cursor-not-allowed"}},orientation:{horizontal:{base:"text-center",increment:"inset-y-0 end-0 pe-1",decrement:"inset-y-0 start-0 ps-1"},vertical:{increment:"top-0 end-0 pe-1 [&>button]:py-0 scale-80",decrement:"bottom-0 end-0 pe-1 [&>button]:py-0 scale-80"}},highlight:{true:""}},compoundVariants:[{color:"primary",variant:["outline","subtle"],class:"focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-primary"},{color:"secondary",variant:["outline","subtle"],class:"focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-secondary"},{color:"success",variant:["outline","subtle"],class:"focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-success"},{color:"info",variant:["outline","subtle"],class:"focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-info"},{color:"warning",variant:["outline","subtle"],class:"focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-warning"},{color:"error",variant:["outline","subtle"],class:"focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-error"},{color:"primary",highlight:!0,class:"ring ring-inset ring-primary"},{color:"secondary",highlight:!0,class:"ring ring-inset ring-secondary"},{color:"success",highlight:!0,class:"ring ring-inset ring-success"},{color:"info",highlight:!0,class:"ring ring-inset ring-info"},{color:"warning",highlight:!0,class:"ring ring-inset ring-warning"},{color:"error",highlight:!0,class:"ring ring-inset ring-error"},{color:"neutral",variant:["outline","subtle"],class:"focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-inverted"},{color:"neutral",highlight:!0,class:"ring ring-inset ring-inverted"},{orientation:"horizontal",size:"xs",class:"px-7"},{orientation:"horizontal",size:"sm",class:"px-8"},{orientation:"horizontal",size:"md",class:"px-9"},{orientation:"horizontal",size:"lg",class:"px-10"},{orientation:"horizontal",size:"xl",class:"px-11"},{orientation:"vertical",size:"xs",class:"pe-7"},{orientation:"vertical",size:"sm",class:"pe-8"},{orientation:"vertical",size:"md",class:"pe-9"},{orientation:"vertical",size:"lg",class:"pe-10"},{orientation:"vertical",size:"xl",class:"pe-11"}],defaultVariants:{size:"md",color:"primary",variant:"outline"}},Er=Object.assign({inheritAttrs:!1},{__name:"InputNumber",props:{as:{type:null,required:!1},placeholder:{type:String,required:!1},color:{type:null,required:!1},variant:{type:null,required:!1},size:{type:null,required:!1},highlight:{type:Boolean,required:!1},orientation:{type:String,required:!1,default:"horizontal"},increment:{type:Object,required:!1},incrementIcon:{type:String,required:!1},incrementDisabled:{type:Boolean,required:!1},decrement:{type:Object,required:!1},decrementIcon:{type:String,required:!1},decrementDisabled:{type:Boolean,required:!1},autofocus:{type:Boolean,required:!1},autofocusDelay:{type:Number,required:!1},locale:{type:String,required:!1},class:{type:null,required:!1},ui:{type:null,required:!1},modelValue:{type:[Number,null],required:!1},defaultValue:{type:Number,required:!1},min:{type:Number,required:!1},max:{type:Number,required:!1},step:{type:Number,required:!1},stepSnapping:{type:Boolean,required:!1},disabled:{type:Boolean,required:!1},required:{type:Boolean,required:!1},id:{type:String,required:!1},name:{type:String,required:!1},formatOptions:{type:null,required:!1},disableWheelChange:{type:Boolean,required:!1}},emits:["update:modelValue","blur","change"],setup(s,{expose:e,emit:t}){const n=s,r=t,{t:a,code:i}=mr(),o=yr(),l=pr(gr(n,"as","modelValue","defaultValue","min","max","step","stepSnapping","formatOptions","disableWheelChange"),r),{emitFormBlur:c,emitFormFocus:f,emitFormChange:d,emitFormInput:h,id:u,color:m,size:g,name:v,highlight:k,disabled:x,ariaAttrs:b}=hi(n),{orientation:y,size:E}=mi(n),O=M(()=>n.locale||i.value),I=M(()=>E.value||g.value),q=M(()=>{var X;return Ft({extend:Ft(ro),...((X=o.ui)==null?void 0:X.inputNumber)||{}})({color:m.value,variant:n.variant,size:I.value,highlight:k.value,orientation:n.orientation,buttonGroup:y.value})}),T=M(()=>n.incrementIcon||(n.orientation==="horizontal"?o.ui.icons.plus:o.ui.icons.chevronUp)),C=M(()=>n.decrementIcon||(n.orientation==="horizontal"?o.ui.icons.minus:o.ui.icons.chevronDown)),F=W(null);function oe(X){const Ce=new Event("change",{target:{value:X}});r("change",Ce),d(),h()}function H(X){c(),r("blur",X)}function Ie(){var X,Ce;n.autofocus&&((Ce=(X=F.value)==null?void 0:X.$el)==null||Ce.focus())}return Ue(()=>{setTimeout(()=>{Ie()},n.autofocusDelay)}),e({inputRef:F}),(X,Ce)=>{var ye;return S(),G(_(Yi),ve(_(l),{id:_(u),class:q.value.root({class:[(ye=n.ui)==null?void 0:ye.root,n.class]}),name:_(v),disabled:_(x),locale:O.value,"onUpdate:modelValue":oe}),{default:A(()=>{var _t,V,te;return[w(_(eo),ve({...X.$attrs,..._(b)},{ref_key:"inputRef",ref:F,placeholder:s.placeholder,required:s.required,class:q.value.base({class:(_t=n.ui)==null?void 0:_t.base}),onBlur:H,onFocus:_(f)}),null,16,["placeholder","required","class","onFocus"]),N("div",{class:fe(q.value.increment({class:(V=n.ui)==null?void 0:V.increment}))},[w(_(Zi),{"as-child":"",disabled:_(x)||s.incrementDisabled},{default:A(()=>[se(X.$slots,"increment",{},()=>[w(me,ve({icon:T.value,color:_(m),size:s.size,variant:"link","aria-label":_(a)("inputNumber.increment")},typeof s.increment=="object"?s.increment:void 0),null,16,["icon","color","size","aria-label"])])]),_:3},8,["disabled"])],2),N("div",{class:fe(q.value.decrement({class:(te=n.ui)==null?void 0:te.decrement}))},[w(_(Qi),{"as-child":"",disabled:_(x)||s.decrementDisabled},{default:A(()=>[se(X.$slots,"decrement",{},()=>[w(me,ve({icon:C.value,color:_(m),size:s.size,variant:"link","aria-label":_(a)("inputNumber.decrement")},typeof s.decrement=="object"?s.decrement:void 0),null,16,["icon","color","size","aria-label"])])]),_:3},8,["disabled"])],2)]}),_:3},16,["id","class","name","disabled","locale"])}}}),ao={slots:{overlay:"fixed inset-0 bg-elevated/75",content:"fixed bg-default divide-y divide-default sm:ring ring-default sm:shadow-lg flex flex-col focus:outline-none",header:"flex items-center gap-1.5 p-4 sm:px-6 min-h-16",wrapper:"",body:"flex-1 overflow-y-auto p-4 sm:p-6",footer:"flex items-center gap-1.5 p-4 sm:px-6",title:"text-highlighted font-semibold",description:"mt-1 text-muted text-sm",close:"absolute top-4 end-4"},variants:{side:{top:{content:"inset-x-0 top-0 max-h-full"},right:{content:"right-0 inset-y-0 w-full max-w-md"},bottom:{content:"inset-x-0 bottom-0 max-h-full"},left:{content:"left-0 inset-y-0 w-full max-w-md"}},transition:{true:{overlay:"data-[state=open]:animate-[fade-in_200ms_ease-out] data-[state=closed]:animate-[fade-out_200ms_ease-in]"}}},compoundVariants:[{transition:!0,side:"top",class:{content:"data-[state=open]:animate-[slide-in-from-top_200ms_ease-in-out] data-[state=closed]:animate-[slide-out-to-top_200ms_ease-in-out]"}},{transition:!0,side:"right",class:{content:"data-[state=open]:animate-[slide-in-from-right_200ms_ease-in-out] data-[state=closed]:animate-[slide-out-to-right_200ms_ease-in-out]"}},{transition:!0,side:"bottom",class:{content:"data-[state=open]:animate-[slide-in-from-bottom_200ms_ease-in-out] data-[state=closed]:animate-[slide-out-to-bottom_200ms_ease-in-out]"}},{transition:!0,side:"left",class:{content:"data-[state=open]:animate-[slide-in-from-left_200ms_ease-in-out] data-[state=closed]:animate-[slide-out-to-left_200ms_ease-in-out]"}}]},io={__name:"Slideover",props:{title:{type:String,required:!1},description:{type:String,required:!1},content:{type:Object,required:!1},overlay:{type:Boolean,required:!1,default:!0},transition:{type:Boolean,required:!1,default:!0},side:{type:null,required:!1,default:"right"},portal:{type:[Boolean,String],required:!1,skipCheck:!0,default:!0},close:{type:[Boolean,Object],required:!1,default:!0},closeIcon:{type:String,required:!1},dismissible:{type:Boolean,required:!1,default:!0},class:{type:null,required:!1},ui:{type:null,required:!1},open:{type:Boolean,required:!1},defaultOpen:{type:Boolean,required:!1},modal:{type:Boolean,required:!1,default:!0}},emits:["after:leave","after:enter","close:prevent","update:open"],setup(s,{emit:e}){const t=s,n=e,r=pi(),{t:a}=mr(),i=yr(),o=pr(gr(t,"open","defaultOpen","modal"),n),l=gi(us(()=>t.portal)),c=us(()=>t.content),f=M(()=>{const h={closeAutoFocus:u=>u.preventDefault()};return t.dismissible?h:["pointerDownOutside","interactOutside","escapeKeyDown","closeAutoFocus"].reduce((m,g)=>(m[g]=v=>{v.preventDefault(),n("close:prevent")},m),{})}),d=M(()=>{var h;return Ft({extend:Ft(ao),...((h=i.ui)==null?void 0:h.slideover)||{}})({transition:t.transition,side:t.side})});return(h,u)=>(S(),G(_(ki),ds(fs(_(o))),{default:A(({open:m})=>[r.default?(S(),G(_(Ii),{key:0,"as-child":"",class:fe(t.class)},{default:A(()=>[se(h.$slots,"default",{open:m})]),_:2},1032,["class"])):B("",!0),w(_(Oi),ds(fs(_(l))),{default:A(()=>{var g,v;return[s.overlay?(S(),G(_(Ei),{key:0,class:fe(d.value.overlay({class:(g=t.ui)==null?void 0:g.overlay}))},null,8,["class"])):B("",!0),w(_(Ri),ve({"data-side":s.side,class:d.value.content({class:[!r.default&&t.class,(v=t.ui)==null?void 0:v.content]})},c.value,{onAfterEnter:u[0]||(u[0]=k=>n("after:enter")),onAfterLeave:u[1]||(u[1]=k=>n("after:leave"))},yi(f.value)),{default:A(()=>[r.content&&(s.title||r.title||s.description||r.description)?(S(),G(_(_i),{key:0},{default:A(()=>[s.title||r.title?(S(),G(_(hs),{key:0},{default:A(()=>[se(h.$slots,"title",{},()=>[Ye(ie(s.title),1)])]),_:3})):B("",!0),s.description||r.description?(S(),G(_(ms),{key:1},{default:A(()=>[se(h.$slots,"description",{},()=>[Ye(ie(s.description),1)])]),_:3})):B("",!0)]),_:3})):B("",!0),se(h.$slots,"content",{},()=>{var k,x,b;return[r.header||s.title||r.title||s.description||r.description||s.close||r.close?(S(),R("div",{key:0,class:fe(d.value.header({class:(k=t.ui)==null?void 0:k.header}))},[se(h.$slots,"header",{},()=>{var y,E,O;return[N("div",{class:fe(d.value.wrapper({class:(y=t.ui)==null?void 0:y.wrapper}))},[s.title||r.title?(S(),G(_(hs),{key:0,class:fe(d.value.title({class:(E=t.ui)==null?void 0:E.title}))},{default:A(()=>[se(h.$slots,"title",{},()=>[Ye(ie(s.title),1)])]),_:3},8,["class"])):B("",!0),s.description||r.description?(S(),G(_(ms),{key:1,class:fe(d.value.description({class:(O=t.ui)==null?void 0:O.description}))},{default:A(()=>[se(h.$slots,"description",{},()=>[Ye(ie(s.description),1)])]),_:3},8,["class"])):B("",!0)],2),s.close||r.close?(S(),G(_(Ti),{key:0,"as-child":""},{default:A(()=>[se(h.$slots,"close",{ui:d.value},()=>{var I;return[s.close?(S(),G(me,ve({key:0,icon:s.closeIcon||_(i).ui.icons.close,size:"md",color:"neutral",variant:"ghost","aria-label":_(a)("slideover.close")},typeof s.close=="object"?s.close:{},{class:d.value.close({class:(I=t.ui)==null?void 0:I.close})}),null,16,["icon","aria-label","class"])):B("",!0)]})]),_:3})):B("",!0)]})],2)):B("",!0),N("div",{class:fe(d.value.body({class:(x=t.ui)==null?void 0:x.body}))},[se(h.$slots,"body")],2),r.footer?(S(),R("div",{key:1,class:fe(d.value.footer({class:(b=t.ui)==null?void 0:b.footer}))},[se(h.$slots,"footer")],2)):B("",!0)]})]),_:3},16,["data-side","class"])]}),_:3},16)]),_:3},16))}},oo={class:"space-y-4"},lo={key:0},co={key:0,class:"mt-3"},uo={key:1,class:"mt-3 text-sm text-gray-500 dark:text-gray-400"},fo={key:2,class:"mt-3 text-sm text-red-600 dark:text-red-400"},ho={key:1},mo={key:0,class:"mt-3"},po={key:1,class:"mt-3 text-sm text-gray-500 dark:text-gray-400"},go={key:2,class:"mt-3 text-sm text-red-600 dark:text-red-400"},yo={key:1,class:"text-sm text-gray-500 dark:text-gray-400"},_o={key:2,class:"text-sm text-yellow-600 dark:text-yellow-400"},bo={key:3,class:"text-sm text-gray-500 dark:text-gray-400"},vo={key:4,class:"text-sm text-gray-500 dark:text-gray-400"},Rr=Q({__name:"TranslationServiceSettings",setup(s){const e=xe(),t=Se(),n=M({get:()=>e.settings.translationServices.generateNote,set:u=>e.setGenerateNote(u)}),r=M({get:()=>e.settings.translationServices.chosenServiceName,set:u=>e.setChosenTranslationServiceName(u)}),a=M(()=>e.settings.translationServices.services.map(u=>({label:u.name,value:u.name}))),i=M(()=>{const u=e.settings.translationServices.chosenServiceName;return u&&e.settings.translationServices.services.find(m=>m.name===u)||null}),o=M(()=>i.value&&i.value.serviceType==="ai"&&i.value.models?i.value.models.map(u=>({label:u,value:u})):[]),l=M({get:()=>{var u;return((u=i.value)==null?void 0:u.chosenModel)||""},set:u=>{i.value&&e.setServiceModel(i.value.name,u)}}),c=M(()=>t.availableGeminiApiKeys?t.availableGeminiApiKeys.map((u,m)=>({label:`API KEY ${m+1}`,value:u})):[]),f=M(()=>t.availableOpenRouterApiKeys?t.availableOpenRouterApiKeys.map((u,m)=>({label:`API KEY ${m+1}`,value:u})):[]),d=M({get:()=>t.selectedGeminiApiKey,set:u=>{t.setSelectedGeminiApiKey(u)}}),h=M({get:()=>t.selectedOpenRouterApiKey,set:u=>{t.setSelectedOpenRouterApiKey(u)}});return(u,m)=>{const g=Pn,v=Mn,k=wr,x=Sr;return S(),G(x,{ui:{header:{padding:"px-0 py-3"},body:{padding:"px-0 py-0"}}},{header:A(()=>m[5]||(m[5]=[N("h4",{class:"font-medium text-gray-900 dark:text-white"},"Translation Services",-1)])),default:A(()=>[N("div",oo,[w(v,{label:"Active Translation Service",ui:{label:{base:"font-medium"}}},{default:A(()=>[w(g,{modelValue:r.value,"onUpdate:modelValue":m[0]||(m[0]=b=>r.value=b),items:a.value,"option-attribute":"label","value-attribute":"value",placeholder:"Select a service"},null,8,["modelValue","items"])]),_:1}),i.value&&i.value.serviceType==="ai"&&i.value.models&&i.value.models.length>0?(S(),R(Me,{key:0},[w(v,{label:`Model for ${i.value.name}`,ui:{label:{base:"font-medium"}}},{default:A(()=>[w(g,{modelValue:l.value,"onUpdate:modelValue":m[1]||(m[1]=b=>l.value=b),items:o.value,"option-attribute":"label","value-attribute":"value"},null,8,["modelValue","items"])]),_:1},8,["label"]),i.value.name==="Gemini"?(S(),R("div",lo,[_(t).availableGeminiApiKeys&&_(t).availableGeminiApiKeys.length>1?(S(),R("div",co,[w(v,{label:"Active Gemini API Key",ui:{label:{base:"font-medium"}}},{default:A(()=>[w(g,{modelValue:d.value,"onUpdate:modelValue":m[2]||(m[2]=b=>d.value=b),items:c.value,"option-attribute":"label","value-attribute":"value"},null,8,["modelValue","items"])]),_:1})])):_(t).availableGeminiApiKeys&&_(t).availableGeminiApiKeys.length===1?(S(),R("div",uo," Using API Key 1 (auto-selected for Gemini). ")):(S(),R("div",fo," API keys for Gemini are not set. Please configure them "))])):B("",!0),i.value.name==="OpenRouter"?(S(),R("div",ho,[_(t).availableOpenRouterApiKeys&&_(t).availableOpenRouterApiKeys.length>1?(S(),R("div",mo,[w(v,{label:"Active OpenRouter API Key",ui:{label:{base:"font-medium"}}},{default:A(()=>[w(g,{modelValue:h.value,"onUpdate:modelValue":m[3]||(m[3]=b=>h.value=b),items:f.value,"option-attribute":"label","value-attribute":"value"},null,8,["modelValue","items"])]),_:1})])):_(t).availableOpenRouterApiKeys&&_(t).availableOpenRouterApiKeys.length===1?(S(),R("div",po," Using API Key 1 (auto-selected for OpenRouter). ")):(S(),R("div",go," API keys for OpenRouter are not set. Please configure them "))])):B("",!0),i.value&&i.value.serviceType==="ai"?(S(),G(v,{key:2,label:"Generate Note",ui:{container:"flex items-center justify-between",label:{base:"font-medium"}}},{default:A(()=>[w(k,{modelValue:n.value,"onUpdate:modelValue":m[4]||(m[4]=b=>n.value=b)},null,8,["modelValue"])]),_:1})):B("",!0)],64)):i.value&&i.value.serviceType==="standard"?(S(),R("p",yo," Using standard translation for "+ie(i.value.name)+". ",1)):!i.value&&_(e).settings.translationServices.chosenServiceName?(S(),R("p",_o," Warning: Active service '"+ie(_(e).settings.translationServices.chosenServiceName)+"' is not found in configured services. ",1)):_(e).settings.translationServices.services.length===0?(S(),R("p",bo," No translation services configured. ")):!_(e).settings.translationServices.chosenServiceName&&_(e).settings.translationServices.services.length>0?(S(),R("p",vo," No translation service selected. ")):B("",!0)])]),_:1})}}}),wo={class:"space-y-6"},xo={class:"space-y-3"},So={class:"space-y-3"},Co={class:"flex justify-end pt-2 border-gray-200 dark:border-gray-700"},$o={class:"pt-4 space-y-4"},Ao={class:"space-y-4 flex flex-col items-center"},Io={class:"space-y-4 flex flex-col items-center"},ws="_UNKNOWN_WORDS_",Eo=Q({__name:"TextRendererSettings",setup(s){const e=xe(),t=Se(),n=zt(),r=[{label:"Left",value:"left"},{label:"Center",value:"center"},{label:"Right",value:"right"}],a=W(null),i=W(null),o=W(null),l=W(!1),c=W(!1),f=M(()=>a.value?At.filter(b=>b.value!==a.value):[]);Ke(a,()=>{i.value=null});const d=M({get:()=>e.settings.fontSize,set:b=>e.updateSettings({fontSize:Number(b)||e.settings.fontSize})}),h=M({get:()=>e.settings.alignment,set:b=>e.updateSettings({alignment:b})}),u=M({get:()=>e.settings.pagination.pageSize,set:b=>e.updatePaginationSettings({pageSize:Number(b)||e.settings.pagination.pageSize})}),m=M({get:()=>e.settings.note.height,set:b=>e.updateNoteSettings({height:Number(b)||e.settings.note.height})});M({get:()=>e.settings.pagination.show,set:b=>e.updatePaginationSettings({show:b})});const g=M({get:()=>e.settings.note.show,set:b=>e.updateNoteSettings({show:b})});M({get:()=>e.settings.note.isSticky,set:b=>e.updateNoteSettings({isSticky:b})});const v=async()=>{const b=a.value,y=i.value;if(!b||!y){n.add({title:"Selection Required",description:"Please select both a source and a target status.",color:"warning",icon:"i-heroicons-exclamation-triangle"});return}const E=new Set;e.processedLines.forEach(I=>{I.tokens.forEach(q=>{q.isWord&&q.lexicalUnit&&q.status===b&&E.add(q.lexicalUnit.id)})});const O=Array.from(E);if(O.length===0){n.add({title:"No Units to Update",description:`No units with status '${b}' found in the current text.`,color:"info",icon:"i-heroicons-information-circle"});return}l.value=!0;try{await t.bulkUpdateStatusForIds(O,y),n.add({title:"Status Updated",description:`${O.length} unit(s) in this text updated from '${b}' to '${y}'.`,color:"success",icon:"i-heroicons-check-circle"}),a.value=null,i.value=null}catch(I){console.error("Failed to bulk update LU status:",I),n.add({title:"Update Failed",description:"Could not update statuses. See console for details.",color:"error",icon:"i-heroicons-x-circle"})}finally{l.value=!1}},k=M(()=>[...At,{label:"Unknown Words",value:ws}]),x=async()=>{var y;const b=o.value;if(!b){n.add({title:"Selection Required",description:"Please select a status or type to copy.",color:"warning",icon:"i-heroicons-exclamation-triangle"});return}c.value=!0,await new Promise(E=>setTimeout(E,0));try{const E=new Set;let O="";b===ws?(O="Unknown word(s)",e.processedLines.forEach(T=>{T.tokens.forEach(C=>{C.isWord&&!C.lexicalUnit&&E.add(C.text.toLowerCase())})})):(O=`word(s) with status '${b}'`,e.processedLines.forEach(T=>{T.tokens.forEach(C=>{C.isWord&&C.status===b&&E.add(C.text.toLowerCase())})}));const I=Array.from(E);if(I.length===0){const T=((y=k.value.find(C=>C.value===b))==null?void 0:y.label)||"items";n.add({title:"No Items Found",description:`No '${T.toLowerCase()}' were found in the current text.`,color:"info",icon:"i-heroicons-information-circle"});return}const q=JSON.stringify(I);await navigator.clipboard.writeText(q),n.add({title:"Copied to Clipboard",description:`${I.length} unique ${O} copied as a JSON array.`,color:"success",icon:"i-heroicons-check-circle"})}catch(E){console.error("Failed to copy items:",E),n.add({title:"Copy Failed",description:"Could not copy items to clipboard. See console for details.",color:"error",icon:"i-heroicons-x-circle"})}finally{c.value=!1}};return(b,y)=>{const E=Er,O=Mn,I=Ai,q=Sr,T=wr,C=me,F=Fn,oe=Pn;return S(),R("div",wo,[w(O,{label:"Font Size (px)",ui:{label:{base:"font-medium"}}},{default:A(()=>[w(E,{modelValue:d.value,"onUpdate:modelValue":y[0]||(y[0]=H=>d.value=H),placeholder:"e.g., 16"},null,8,["modelValue"])]),_:1}),w(O,{label:"Text Alignment",ui:{label:{base:"font-medium"}}},{default:A(()=>[w(I,{modelValue:h.value,"onUpdate:modelValue":y[1]||(y[1]=H=>h.value=H),items:r},null,8,["modelValue"])]),_:1}),w(q,{ui:{header:{padding:"px-0 py-3"},body:{padding:"px-0 py-0"}}},{header:A(()=>y[9]||(y[9]=[N("h4",{class:"font-medium text-gray-900 dark:text-white"},"Pagination",-1)])),default:A(()=>[N("div",xo,[_(e).settings.pagination.show?(S(),G(O,{key:0,label:"Lines Per Page",ui:{label:{base:"font-normal"}}},{default:A(()=>[w(E,{modelValue:u.value,"onUpdate:modelValue":y[2]||(y[2]=H=>u.value=H),placeholder:"e.g., 20"},null,8,["modelValue"])]),_:1})):B("",!0)])]),_:1}),w(q,{ui:{header:{padding:"px-0 py-3"},body:{padding:"px-0 py-0"}}},{header:A(()=>y[10]||(y[10]=[N("h4",{class:"font-medium text-gray-900 dark:text-white"},"Note Display",-1)])),default:A(()=>[N("div",So,[w(O,{label:"Show Note",ui:{container:"flex items-center justify-between",label:{base:"font-normal"}}},{default:A(()=>[w(T,{modelValue:g.value,"onUpdate:modelValue":y[3]||(y[3]=H=>g.value=H)},null,8,["modelValue"])]),_:1}),_(e).settings.note.show?(S(),G(O,{key:0,label:"Note Height (px)",ui:{label:{base:"font-normal"}}},{default:A(()=>[w(E,{modelValue:m.value,"onUpdate:modelValue":y[4]||(y[4]=H=>m.value=H),placeholder:"e.g., 200",min:10,step:10},null,8,["modelValue"])]),_:1})):B("",!0)])]),_:1}),N("div",Co,[w(C,{label:"Reset to Defaults",color:"gray",variant:"outline",onClick:y[5]||(y[5]=H=>_(e).resetSettings()),icon:"i-heroicons-arrow-uturn-left"})]),w(F),N("div",$o,[w(q,{ui:{header:{padding:"px-0 py-3"},body:{padding:"px-4 py-4 sm:p-6"}}},{header:A(()=>y[11]||(y[11]=[N("h4",{class:"font-medium text-gray-900 dark:text-white"},"Bulk Status Update",-1)])),default:A(()=>[N("div",Ao,[w(O,{label:"From Status",class:"w-full max-w-sm"},{default:A(()=>[w(oe,{modelValue:a.value,"onUpdate:modelValue":y[6]||(y[6]=H=>a.value=H),items:_(At),"option-attribute":"label","value-attribute":"value",placeholder:"Select source status",class:"w-full"},null,8,["modelValue","items"])]),_:1}),w(O,{label:"To Status",class:"w-full max-w-sm"},{default:A(()=>[w(oe,{modelValue:i.value,"onUpdate:modelValue":y[7]||(y[7]=H=>i.value=H),items:f.value,"option-attribute":"label","value-attribute":"value",placeholder:"Select target status",class:"w-full",disabled:!a.value},null,8,["modelValue","items","disabled"])]),_:1}),w(C,{label:"Update Statuses",color:"teal",variant:"solid",onClick:v,icon:"i-heroicons-arrow-path-rounded-square",class:"w-full max-w-sm cursor-pointer",loading:l.value,disabled:!a.value||!i.value||l.value},null,8,["loading","disabled"])])]),_:1}),w(q,{ui:{header:{padding:"px-0 py-3"},body:{padding:"px-4 py-4 sm:p-6"}}},{header:A(()=>y[12]||(y[12]=[N("h4",{class:"font-medium text-gray-900 dark:text-white"},"Copy Words by Status",-1)])),default:A(()=>[N("div",Io,[w(O,{label:"Select Status",class:"w-full max-w-sm"},{default:A(()=>[w(oe,{modelValue:o.value,"onUpdate:modelValue":y[8]||(y[8]=H=>o.value=H),items:k.value,"option-attribute":"label","value-attribute":"value",placeholder:"Select status to copy",class:"w-full"},null,8,["modelValue","items"])]),_:1}),w(C,{label:"Copy Words",color:"cyan",variant:"solid",onClick:x,icon:"i-heroicons-clipboard-document-list",class:"w-full max-w-sm cursor-pointer",loading:c.value,disabled:!o.value||c.value},null,8,["loading","disabled"])])]),_:1})]),w(Rr),w(F),w(Fi)])}}}),Ro={class:"flex justify-center items-center"},Oo={class:"text-xl font-bold text-center text-gray-800 dark:text-gray-200"},Or=Q({__name:"PopoverTerm",props:{term:{}},setup(s){const e=s,t=async()=>{try{await br(e.term,"target")}catch(n){console.error(`Failed to speak "${e.term}" with target voice:`,n)}};return(n,r)=>{const a=Jt,i=me;return S(),R("div",Ro,[N("p",Oo,ie(n.term),1),w(i,{variant:"primary",class:"cursor-pointer",onClick:t},{default:A(()=>[w(a,{name:"i-heroicons-speaker-wave",class:"size-4"})]),_:1})])}}});var xs;(function(s){s.STRING="string",s.NUMBER="number",s.INTEGER="integer",s.BOOLEAN="boolean",s.ARRAY="array",s.OBJECT="object"})(xs||(xs={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ss;(function(s){s.LANGUAGE_UNSPECIFIED="language_unspecified",s.PYTHON="python"})(Ss||(Ss={}));var Cs;(function(s){s.OUTCOME_UNSPECIFIED="outcome_unspecified",s.OUTCOME_OK="outcome_ok",s.OUTCOME_FAILED="outcome_failed",s.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(Cs||(Cs={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $s=["user","model","function","system"];var As;(function(s){s.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",s.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",s.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",s.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",s.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",s.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(As||(As={}));var Is;(function(s){s.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",s.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",s.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",s.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",s.BLOCK_NONE="BLOCK_NONE"})(Is||(Is={}));var Es;(function(s){s.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",s.NEGLIGIBLE="NEGLIGIBLE",s.LOW="LOW",s.MEDIUM="MEDIUM",s.HIGH="HIGH"})(Es||(Es={}));var Rs;(function(s){s.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",s.SAFETY="SAFETY",s.OTHER="OTHER"})(Rs||(Rs={}));var it;(function(s){s.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",s.STOP="STOP",s.MAX_TOKENS="MAX_TOKENS",s.SAFETY="SAFETY",s.RECITATION="RECITATION",s.LANGUAGE="LANGUAGE",s.BLOCKLIST="BLOCKLIST",s.PROHIBITED_CONTENT="PROHIBITED_CONTENT",s.SPII="SPII",s.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",s.OTHER="OTHER"})(it||(it={}));var Os;(function(s){s.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",s.RETRIEVAL_QUERY="RETRIEVAL_QUERY",s.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",s.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",s.CLASSIFICATION="CLASSIFICATION",s.CLUSTERING="CLUSTERING"})(Os||(Os={}));var ks;(function(s){s.MODE_UNSPECIFIED="MODE_UNSPECIFIED",s.AUTO="AUTO",s.ANY="ANY",s.NONE="NONE"})(ks||(ks={}));var Ts;(function(s){s.MODE_UNSPECIFIED="MODE_UNSPECIFIED",s.MODE_DYNAMIC="MODE_DYNAMIC"})(Ts||(Ts={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class re extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class qe extends re{constructor(e,t){super(e),this.response=t}}class kr extends re{constructor(e,t,n,r){super(e),this.status=t,this.statusText=n,this.errorDetails=r}}class ke extends re{}class Tr extends re{}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ko="https://generativelanguage.googleapis.com",To="v1beta",No="0.24.1",Po="genai-js";var De;(function(s){s.GENERATE_CONTENT="generateContent",s.STREAM_GENERATE_CONTENT="streamGenerateContent",s.COUNT_TOKENS="countTokens",s.EMBED_CONTENT="embedContent",s.BATCH_EMBED_CONTENTS="batchEmbedContents"})(De||(De={}));class Mo{constructor(e,t,n,r,a){this.model=e,this.task=t,this.apiKey=n,this.stream=r,this.requestOptions=a}toString(){var e,t;const n=((e=this.requestOptions)===null||e===void 0?void 0:e.apiVersion)||To;let a=`${((t=this.requestOptions)===null||t===void 0?void 0:t.baseUrl)||ko}/${n}/${this.model}:${this.task}`;return this.stream&&(a+="?alt=sse"),a}}function Fo(s){const e=[];return s!=null&&s.apiClient&&e.push(s.apiClient),e.push(`${Po}/${No}`),e.join(" ")}async function Lo(s){var e;const t=new Headers;t.append("Content-Type","application/json"),t.append("x-goog-api-client",Fo(s.requestOptions)),t.append("x-goog-api-key",s.apiKey);let n=(e=s.requestOptions)===null||e===void 0?void 0:e.customHeaders;if(n){if(!(n instanceof Headers))try{n=new Headers(n)}catch(r){throw new ke(`unable to convert customHeaders value ${JSON.stringify(n)} to Headers: ${r.message}`)}for(const[r,a]of n.entries()){if(r==="x-goog-api-key")throw new ke(`Cannot set reserved header name ${r}`);if(r==="x-goog-api-client")throw new ke(`Header name ${r} can only be set using the apiClient field`);t.append(r,a)}}return t}async function Uo(s,e,t,n,r,a){const i=new Mo(s,e,t,n,a);return{url:i.toString(),fetchOptions:Object.assign(Object.assign({},jo(a)),{method:"POST",headers:await Lo(i),body:r})}}async function ht(s,e,t,n,r,a={},i=fetch){const{url:o,fetchOptions:l}=await Uo(s,e,t,n,r,a);return Do(o,l,i)}async function Do(s,e,t=fetch){let n;try{n=await t(s,e)}catch(r){Bo(r,s)}return n.ok||await qo(n,s),n}function Bo(s,e){let t=s;throw t.name==="AbortError"?(t=new Tr(`Request aborted when fetching ${e.toString()}: ${s.message}`),t.stack=s.stack):s instanceof kr||s instanceof ke||(t=new re(`Error fetching from ${e.toString()}: ${s.message}`),t.stack=s.stack),t}async function qo(s,e){let t="",n;try{const r=await s.json();t=r.error.message,r.error.details&&(t+=` ${JSON.stringify(r.error.details)}`,n=r.error.details)}catch{}throw new kr(`Error fetching from ${e.toString()}: [${s.status} ${s.statusText}] ${t}`,s.status,s.statusText,n)}function jo(s){const e={};if((s==null?void 0:s.signal)!==void 0||(s==null?void 0:s.timeout)>=0){const t=new AbortController;(s==null?void 0:s.timeout)>=0&&setTimeout(()=>t.abort(),s.timeout),s!=null&&s.signal&&s.signal.addEventListener("abort",()=>{t.abort()}),e.signal=t.signal}return e}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dn(s){return s.text=()=>{if(s.candidates&&s.candidates.length>0){if(s.candidates.length>1&&console.warn(`This response had ${s.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),It(s.candidates[0]))throw new qe(`${Oe(s)}`,s);return Vo(s)}else if(s.promptFeedback)throw new qe(`Text not available. ${Oe(s)}`,s);return""},s.functionCall=()=>{if(s.candidates&&s.candidates.length>0){if(s.candidates.length>1&&console.warn(`This response had ${s.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),It(s.candidates[0]))throw new qe(`${Oe(s)}`,s);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),Ns(s)[0]}else if(s.promptFeedback)throw new qe(`Function call not available. ${Oe(s)}`,s)},s.functionCalls=()=>{if(s.candidates&&s.candidates.length>0){if(s.candidates.length>1&&console.warn(`This response had ${s.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),It(s.candidates[0]))throw new qe(`${Oe(s)}`,s);return Ns(s)}else if(s.promptFeedback)throw new qe(`Function call not available. ${Oe(s)}`,s)},s}function Vo(s){var e,t,n,r;const a=[];if(!((t=(e=s.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0)&&t.parts)for(const i of(r=(n=s.candidates)===null||n===void 0?void 0:n[0].content)===null||r===void 0?void 0:r.parts)i.text&&a.push(i.text),i.executableCode&&a.push("\n```"+i.executableCode.language+`
`+i.executableCode.code+"\n```\n"),i.codeExecutionResult&&a.push("\n```\n"+i.codeExecutionResult.output+"\n```\n");return a.length>0?a.join(""):""}function Ns(s){var e,t,n,r;const a=[];if(!((t=(e=s.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0)&&t.parts)for(const i of(r=(n=s.candidates)===null||n===void 0?void 0:n[0].content)===null||r===void 0?void 0:r.parts)i.functionCall&&a.push(i.functionCall);if(a.length>0)return a}const Go=[it.RECITATION,it.SAFETY,it.LANGUAGE];function It(s){return!!s.finishReason&&Go.includes(s.finishReason)}function Oe(s){var e,t,n;let r="";if((!s.candidates||s.candidates.length===0)&&s.promptFeedback)r+="Response was blocked",!((e=s.promptFeedback)===null||e===void 0)&&e.blockReason&&(r+=` due to ${s.promptFeedback.blockReason}`),!((t=s.promptFeedback)===null||t===void 0)&&t.blockReasonMessage&&(r+=`: ${s.promptFeedback.blockReasonMessage}`);else if(!((n=s.candidates)===null||n===void 0)&&n[0]){const a=s.candidates[0];It(a)&&(r+=`Candidate was blocked due to ${a.finishReason}`,a.finishMessage&&(r+=`: ${a.finishMessage}`))}return r}function ut(s){return this instanceof ut?(this.v=s,this):new ut(s)}function Wo(s,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(s,e||[]),r,a=[];return r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r;function i(h){n[h]&&(r[h]=function(u){return new Promise(function(m,g){a.push([h,u,m,g])>1||o(h,u)})})}function o(h,u){try{l(n[h](u))}catch(m){d(a[0][3],m)}}function l(h){h.value instanceof ut?Promise.resolve(h.value.v).then(c,f):d(a[0][2],h)}function c(h){o("next",h)}function f(h){o("throw",h)}function d(h,u){h(u),a.shift(),a.length&&o(a[0][0],a[0][1])}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ps=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function Ho(s){const e=s.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),t=Jo(e),[n,r]=t.tee();return{stream:zo(n),response:Ko(r)}}async function Ko(s){const e=[],t=s.getReader();for(;;){const{done:n,value:r}=await t.read();if(n)return Dn(Xo(e));e.push(r)}}function zo(s){return Wo(this,arguments,function*(){const t=s.getReader();for(;;){const{value:n,done:r}=yield ut(t.read());if(r)break;yield yield ut(Dn(n))}})}function Jo(s){const e=s.getReader();return new ReadableStream({start(n){let r="";return a();function a(){return e.read().then(({value:i,done:o})=>{if(o){if(r.trim()){n.error(new re("Failed to parse stream"));return}n.close();return}r+=i;let l=r.match(Ps),c;for(;l;){try{c=JSON.parse(l[1])}catch{n.error(new re(`Error parsing JSON response: "${l[1]}"`));return}n.enqueue(c),r=r.substring(l[0].length),l=r.match(Ps)}return a()}).catch(i=>{let o=i;throw o.stack=i.stack,o.name==="AbortError"?o=new Tr("Request aborted when reading from the stream"):o=new re("Error reading from the stream"),o})}}})}function Xo(s){const e=s[s.length-1],t={promptFeedback:e==null?void 0:e.promptFeedback};for(const n of s){if(n.candidates){let r=0;for(const a of n.candidates)if(t.candidates||(t.candidates=[]),t.candidates[r]||(t.candidates[r]={index:r}),t.candidates[r].citationMetadata=a.citationMetadata,t.candidates[r].groundingMetadata=a.groundingMetadata,t.candidates[r].finishReason=a.finishReason,t.candidates[r].finishMessage=a.finishMessage,t.candidates[r].safetyRatings=a.safetyRatings,a.content&&a.content.parts){t.candidates[r].content||(t.candidates[r].content={role:a.content.role||"user",parts:[]});const i={};for(const o of a.content.parts)o.text&&(i.text=o.text),o.functionCall&&(i.functionCall=o.functionCall),o.executableCode&&(i.executableCode=o.executableCode),o.codeExecutionResult&&(i.codeExecutionResult=o.codeExecutionResult),Object.keys(i).length===0&&(i.text=""),t.candidates[r].content.parts.push(i)}r++}n.usageMetadata&&(t.usageMetadata=n.usageMetadata)}return t}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Nr(s,e,t,n){const r=await ht(e,De.STREAM_GENERATE_CONTENT,s,!0,JSON.stringify(t),n);return Ho(r)}async function Pr(s,e,t,n){const a=await(await ht(e,De.GENERATE_CONTENT,s,!1,JSON.stringify(t),n)).json();return{response:Dn(a)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mr(s){if(s!=null){if(typeof s=="string")return{role:"system",parts:[{text:s}]};if(s.text)return{role:"system",parts:[s]};if(s.parts)return s.role?s:{role:"system",parts:s.parts}}}function dt(s){let e=[];if(typeof s=="string")e=[{text:s}];else for(const t of s)typeof t=="string"?e.push({text:t}):e.push(t);return Yo(e)}function Yo(s){const e={role:"user",parts:[]},t={role:"function",parts:[]};let n=!1,r=!1;for(const a of s)"functionResponse"in a?(t.parts.push(a),r=!0):(e.parts.push(a),n=!0);if(n&&r)throw new re("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!n&&!r)throw new re("No content is provided for sending chat message.");return n?e:t}function Qo(s,e){var t;let n={model:e==null?void 0:e.model,generationConfig:e==null?void 0:e.generationConfig,safetySettings:e==null?void 0:e.safetySettings,tools:e==null?void 0:e.tools,toolConfig:e==null?void 0:e.toolConfig,systemInstruction:e==null?void 0:e.systemInstruction,cachedContent:(t=e==null?void 0:e.cachedContent)===null||t===void 0?void 0:t.name,contents:[]};const r=s.generateContentRequest!=null;if(s.contents){if(r)throw new ke("CountTokensRequest must have one of contents or generateContentRequest, not both.");n.contents=s.contents}else if(r)n=Object.assign(Object.assign({},n),s.generateContentRequest);else{const a=dt(s);n.contents=[a]}return{generateContentRequest:n}}function Ms(s){let e;return s.contents?e=s:e={contents:[dt(s)]},s.systemInstruction&&(e.systemInstruction=Mr(s.systemInstruction)),e}function Zo(s){return typeof s=="string"||Array.isArray(s)?{content:dt(s)}:s}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fs=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],el={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function tl(s){let e=!1;for(const t of s){const{role:n,parts:r}=t;if(!e&&n!=="user")throw new re(`First content should be with role 'user', got ${n}`);if(!$s.includes(n))throw new re(`Each item should include role field. Got ${n} but valid roles are: ${JSON.stringify($s)}`);if(!Array.isArray(r))throw new re("Content should have 'parts' property with an array of Parts");if(r.length===0)throw new re("Each Content should have at least one part");const a={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const o of r)for(const l of Fs)l in o&&(a[l]+=1);const i=el[n];for(const o of Fs)if(!i.includes(o)&&a[o]>0)throw new re(`Content with role '${n}' can't contain '${o}' part`);e=!0}}function Ls(s){var e;if(s.candidates===void 0||s.candidates.length===0)return!1;const t=(e=s.candidates[0])===null||e===void 0?void 0:e.content;if(t===void 0||t.parts===void 0||t.parts.length===0)return!1;for(const n of t.parts)if(n===void 0||Object.keys(n).length===0||n.text!==void 0&&n.text==="")return!1;return!0}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Us="SILENT_ERROR";class nl{constructor(e,t,n,r={}){this.model=t,this.params=n,this._requestOptions=r,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,n!=null&&n.history&&(tl(n.history),this._history=n.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e,t={}){var n,r,a,i,o,l;await this._sendPromise;const c=dt(e),f={safetySettings:(n=this.params)===null||n===void 0?void 0:n.safetySettings,generationConfig:(r=this.params)===null||r===void 0?void 0:r.generationConfig,tools:(a=this.params)===null||a===void 0?void 0:a.tools,toolConfig:(i=this.params)===null||i===void 0?void 0:i.toolConfig,systemInstruction:(o=this.params)===null||o===void 0?void 0:o.systemInstruction,cachedContent:(l=this.params)===null||l===void 0?void 0:l.cachedContent,contents:[...this._history,c]},d=Object.assign(Object.assign({},this._requestOptions),t);let h;return this._sendPromise=this._sendPromise.then(()=>Pr(this._apiKey,this.model,f,d)).then(u=>{var m;if(Ls(u.response)){this._history.push(c);const g=Object.assign({parts:[],role:"model"},(m=u.response.candidates)===null||m===void 0?void 0:m[0].content);this._history.push(g)}else{const g=Oe(u.response);g&&console.warn(`sendMessage() was unsuccessful. ${g}. Inspect response object for details.`)}h=u}).catch(u=>{throw this._sendPromise=Promise.resolve(),u}),await this._sendPromise,h}async sendMessageStream(e,t={}){var n,r,a,i,o,l;await this._sendPromise;const c=dt(e),f={safetySettings:(n=this.params)===null||n===void 0?void 0:n.safetySettings,generationConfig:(r=this.params)===null||r===void 0?void 0:r.generationConfig,tools:(a=this.params)===null||a===void 0?void 0:a.tools,toolConfig:(i=this.params)===null||i===void 0?void 0:i.toolConfig,systemInstruction:(o=this.params)===null||o===void 0?void 0:o.systemInstruction,cachedContent:(l=this.params)===null||l===void 0?void 0:l.cachedContent,contents:[...this._history,c]},d=Object.assign(Object.assign({},this._requestOptions),t),h=Nr(this._apiKey,this.model,f,d);return this._sendPromise=this._sendPromise.then(()=>h).catch(u=>{throw new Error(Us)}).then(u=>u.response).then(u=>{if(Ls(u)){this._history.push(c);const m=Object.assign({},u.candidates[0].content);m.role||(m.role="model"),this._history.push(m)}else{const m=Oe(u);m&&console.warn(`sendMessageStream() was unsuccessful. ${m}. Inspect response object for details.`)}}).catch(u=>{u.message!==Us&&console.error(u)}),h}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sl(s,e,t,n){return(await ht(e,De.COUNT_TOKENS,s,!1,JSON.stringify(t),n)).json()}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rl(s,e,t,n){return(await ht(e,De.EMBED_CONTENT,s,!1,JSON.stringify(t),n)).json()}async function al(s,e,t,n){const r=t.requests.map(i=>Object.assign(Object.assign({},i),{model:e}));return(await ht(e,De.BATCH_EMBED_CONTENTS,s,!1,JSON.stringify({requests:r}),n)).json()}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ds{constructor(e,t,n={}){this.apiKey=e,this._requestOptions=n,t.model.includes("/")?this.model=t.model:this.model=`models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.tools=t.tools,this.toolConfig=t.toolConfig,this.systemInstruction=Mr(t.systemInstruction),this.cachedContent=t.cachedContent}async generateContent(e,t={}){var n;const r=Ms(e),a=Object.assign(Object.assign({},this._requestOptions),t);return Pr(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(n=this.cachedContent)===null||n===void 0?void 0:n.name},r),a)}async generateContentStream(e,t={}){var n;const r=Ms(e),a=Object.assign(Object.assign({},this._requestOptions),t);return Nr(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(n=this.cachedContent)===null||n===void 0?void 0:n.name},r),a)}startChat(e){var t;return new nl(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(t=this.cachedContent)===null||t===void 0?void 0:t.name},e),this._requestOptions)}async countTokens(e,t={}){const n=Qo(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),r=Object.assign(Object.assign({},this._requestOptions),t);return sl(this.apiKey,this.model,n,r)}async embedContent(e,t={}){const n=Zo(e),r=Object.assign(Object.assign({},this._requestOptions),t);return rl(this.apiKey,this.model,n,r)}async batchEmbedContents(e,t={}){const n=Object.assign(Object.assign({},this._requestOptions),t);return al(this.apiKey,this.model,e,n)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class il{constructor(e){this.apiKey=e}getGenerativeModel(e,t){if(!e.model)throw new re("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new Ds(this.apiKey,e,t)}getGenerativeModelFromCachedContent(e,t,n){if(!e.name)throw new ke("Cached content must contain a `name` field.");if(!e.model)throw new ke("Cached content must contain a `model` field.");const r=["model","systemInstruction"];for(const i of r)if(t!=null&&t[i]&&e[i]&&(t==null?void 0:t[i])!==e[i]){if(i==="model"){const o=t.model.startsWith("models/")?t.model.replace("models/",""):t.model,l=e.model.startsWith("models/")?e.model.replace("models/",""):e.model;if(o===l)continue}throw new ke(`Different value for "${i}" specified in modelParams (${t[i]}) and cachedContent (${e[i]})`)}const a=Object.assign(Object.assign({},t),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new Ds(this.apiKey,a,n)}}async function ol(s,e,t,n){var v,k,x,b,y;const r=Se(),a=xe(),i=r.selectedGeminiApiKey,o=a.settings.translationServices.services.find(E=>E.name==="Gemini"&&E.serviceType==="ai");if(!i)return console.error("Gemini API Key is not selected or available."),null;if(!o)return console.error("Gemini service configuration not found in text render settings."),null;const l=o.chosenModel;if(!l)return console.error("No Gemini model selected in settings."),null;const c=r.info,f=(v=r.settings)==null?void 0:v.aiPrompt;if(!c)return console.error("Study pack info not loaded."),null;if(!f)return console.error("AI prompt settings not loaded from study pack settings.json."),null;const d=c.languages.targetLanguage,h=c.languages.sourceLanguage;let u,m;e==="term"?(u=(k=f.term)==null?void 0:k.translation,m=(x=f.term)==null?void 0:x.note):(u=(b=f.line)==null?void 0:b.translation,m=(y=f.line)==null?void 0:y.note),u||(console.warn(`AI prompt setting for ${e} translation instruction is missing.`),(e="term")?u=`Provide the most accurate and common translation for the term from ${d} to ${h}. The translation should consist of the most popular translations of the given text (no more than five) and be separated by commas.`:u=`Translate the sentence(s) from ${d} to ${h}. The translation must be grammatically correct and sound natural, while preserving the original tone and meaning.`),m||(console.warn(`AI prompt setting for ${e} note instruction is missing, but note generation was requested. Note will not be generated.`),(e="term")?m=`Briefly explain the choice of translation. If there are other common alternative translations for this term, mention them. The note should be written in ${h}.`:m=`In one or two sentences, explain any interesting cultural nuances, idioms, or non-obvious translation choices. If the translation is straightforward, state that. The note should be written in ${d}.`);const g=`
Context: You are an expert translator.

Text to translate: "${s}"

Instructions:
1. Translate the text according to this rule: ${u}.
${t?`2. Generate a concise note based on this rule: ${m}.`:""}

Your response must be a valid JSON object.
It must contain a "translation" key with the translated text as a string.
${t?'It must also contain a "note" key with the generated note as a string.':'It must not contain a "note" key.'}

${n?`Here's another extra prompt for you: ${n}`:""}
`;console.log("Sending prompt to Gemini:",g);try{const q=(await new il(i).getGenerativeModel({model:l,generationConfig:{responseMimeType:"application/json"}}).generateContent(g)).response.text();console.log("Received raw response from Gemini:",q);let T;try{const C=q.match(/\{[\s\S]*\}/);if(!C)throw new Error("No valid JSON object found in the response.");T=JSON.parse(C[0])}catch(C){return console.error("Failed to parse Gemini response as JSON:",C.message),console.error("Raw response text:",q),null}return typeof T!="object"||T===null?(console.error("Gemini response is not a valid JSON object."),null):typeof T.translation!="string"?(console.error('Gemini response JSON is missing the required "translation" string.'),null):(t&&typeof T.note!="string"?(console.warn('Gemini response JSON is missing the required "note" string, but note generation was requested.'),delete T.note):!t&&T.note!==void 0&&delete T.note,T)}catch(E){return console.error("Error calling Gemini API:",E),E.response&&E.response.candidates?console.error("Gemini API Error Details:",JSON.stringify(E.response.candidates,null,2)):E.message&&console.error("Gemini API Error Message:",E.message),null}}const ll=hr("translationStorage",{state:()=>({translations:new Map}),actions:{addTranslation(s,e){this.translations.set(s,e)},getTranslation(s){return this.translations.get(s)},hasTranslation(s){return this.translations.has(s)},clearTranslations(){this.translations.clear()}},getters:{}});async function cl(s,e,t){if(e===t&&e!=="auto")return{translation:s};const n=`https://clients5.google.com/translate_a/t?client=dict-chrome-ex&sl=${e}&tl=${t}&q=${encodeURIComponent(s)}`;try{const r=await fetch(n);if(!r.ok)return console.error(`Google Mirror API error: ${r.status} ${r.statusText}`),null;const a=await r.text();try{const i=JSON.parse(a);if(Array.isArray(i)&&i.length>0&&typeof i[0]=="string")return{translation:i[0]}}catch{if(a&&!a.trim().startsWith("<"))return{translation:a}}return console.warn("Google Mirror: Failed to parse or understand the response:",a),null}catch(r){return console.error("Error during Google Mirror translation request:",r.message),null}}async function ul(s,e,t){var a,i;if(e===t&&e!=="auto")return{translation:s};const n=s.replace(/(\r\n|\r|\n)/g," "),r=`https://translate.googleapis.com/translate_a/single?client=gtx&dt=t&sl=${e}&tl=${t}&q=${encodeURIComponent(n)}`;try{const o=await fetch(r);if(!o.ok)return console.error(`Google Mirror 2 API error: ${o.status} ${o.statusText}`),null;const l=await o.json(),c=(i=(a=l==null?void 0:l[0])==null?void 0:a[0])==null?void 0:i[0];return typeof c=="string"&&c?{translation:c}:(console.warn("Google Mirror 2: Translation not found or API response format changed:",l),null)}catch(o){return console.error("Error during Google Mirror 2 translation request:",o.message),null}}async function dl(s,e,t){var r,a,i;if(e===t&&e!=="auto")return{translation:s};const n=`https://api.mymemory.translated.net/get?q=${encodeURIComponent(s)}&langpair=${e}|${t}`;try{const o=await fetch(n);if(!o.ok)return console.error(`MyMemory API error: ${o.status} ${o.statusText}`),null;const l=await o.json(),c=((r=l==null?void 0:l.responseData)==null?void 0:r.translatedText)||((i=(a=l==null?void 0:l.matches)==null?void 0:a[0])==null?void 0:i.translation);return typeof c=="string"&&c?{translation:c}:(console.warn("MyMemory: Translation not found or API response format changed:",l),null)}catch(o){return console.error("Error during MyMemory translation request:",o.message),null}}function U(s,e,t,n,r){if(typeof e=="function"?s!==e||!0:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(s,t),t}function p(s,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(s):n?n.value:e.get(s)}let Fr=function(){const{crypto:s}=globalThis;if(s!=null&&s.randomUUID)return Fr=s.randomUUID.bind(s),s.randomUUID();const e=new Uint8Array(1),t=s?()=>s.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,n=>(+n^t()&15>>+n/4).toString(16))};function vn(s){return typeof s=="object"&&s!==null&&("name"in s&&s.name==="AbortError"||"message"in s&&String(s.message).includes("FetchRequestCanceledException"))}const wn=s=>{if(s instanceof Error)return s;if(typeof s=="object"&&s!==null){try{if(Object.prototype.toString.call(s)==="[object Error]"){const e=new Error(s.message,s.cause?{cause:s.cause}:{});return s.stack&&(e.stack=s.stack),s.cause&&!e.cause&&(e.cause=s.cause),s.name&&(e.name=s.name),e}}catch{}try{return new Error(JSON.stringify(s))}catch{}}return new Error(s)};class L extends Error{}class ee extends L{constructor(e,t,n,r){super(`${ee.makeMessage(e,t,n)}`),this.status=e,this.headers=r,this.requestID=r==null?void 0:r.get("x-request-id"),this.error=t;const a=t;this.code=a==null?void 0:a.code,this.param=a==null?void 0:a.param,this.type=a==null?void 0:a.type}static makeMessage(e,t,n){const r=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||"(no status code or body)"}static generate(e,t,n,r){if(!e||!r)return new Xt({message:n,cause:wn(t)});const a=t==null?void 0:t.error;return e===400?new Lr(e,a,n,r):e===401?new Ur(e,a,n,r):e===403?new Dr(e,a,n,r):e===404?new Br(e,a,n,r):e===409?new qr(e,a,n,r):e===422?new jr(e,a,n,r):e===429?new Vr(e,a,n,r):e>=500?new Gr(e,a,n,r):new ee(e,a,n,r)}}class he extends ee{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class Xt extends ee{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class Bn extends Xt{constructor({message:e}={}){super({message:e??"Request timed out."})}}class Lr extends ee{}class Ur extends ee{}class Dr extends ee{}class Br extends ee{}class qr extends ee{}class jr extends ee{}class Vr extends ee{}class Gr extends ee{}class Wr extends L{constructor(){super("Could not parse response content as the length limit was reached")}}class Hr extends L{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}const fl=/^[a-z][a-z0-9+.-]*:/i,hl=s=>fl.test(s);let le=s=>(le=Array.isArray,le(s)),Bs=le;function ml(s){return typeof s!="object"?{}:s??{}}function pl(s){if(!s)return!0;for(const e in s)return!1;return!0}function gl(s,e){return Object.prototype.hasOwnProperty.call(s,e)}function un(s){return s!=null&&typeof s=="object"&&!Array.isArray(s)}const yl=(s,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new L(`${s} must be an integer`);if(e<0)throw new L(`${s} must be a positive integer`);return e},_l=s=>{try{return JSON.parse(s)}catch{return}},mt=s=>new Promise(e=>setTimeout(e,s)),Ge="5.5.1",bl=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";function vl(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const wl=()=>{var t;const s=vl();if(s==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ge,"X-Stainless-OS":js(Deno.build.os),"X-Stainless-Arch":qs(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((t=Deno.version)==null?void 0:t.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ge,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(s==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ge,"X-Stainless-OS":js(globalThis.process.platform??"unknown"),"X-Stainless-Arch":qs(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};const e=xl();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ge,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ge,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function xl(){if(typeof navigator>"u"||!navigator)return null;const s=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of s){const n=t.exec(navigator.userAgent);if(n){const r=n[1]||0,a=n[2]||0,i=n[3]||0;return{browser:e,version:`${r}.${a}.${i}`}}}return null}const qs=s=>s==="x32"?"x32":s==="x86_64"||s==="x64"?"x64":s==="arm"?"arm":s==="aarch64"||s==="arm64"?"arm64":s?`other:${s}`:"unknown",js=s=>(s=s.toLowerCase(),s.includes("ios")?"iOS":s==="android"?"Android":s==="darwin"?"MacOS":s==="win32"?"Windows":s==="freebsd"?"FreeBSD":s==="openbsd"?"OpenBSD":s==="linux"?"Linux":s?`Other:${s}`:"Unknown");let Vs;const Sl=()=>Vs??(Vs=wl());function Cl(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function Kr(...s){const e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...s)}function zr(s){let e=Symbol.asyncIterator in s?s[Symbol.asyncIterator]():s[Symbol.iterator]();return Kr({start(){},async pull(t){const{done:n,value:r}=await e.next();n?t.close():t.enqueue(r)},async cancel(){var t;await((t=e.return)==null?void 0:t.call(e))}})}function Jr(s){if(s[Symbol.asyncIterator])return s;const e=s.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function $l(s){var n,r;if(s===null||typeof s!="object")return;if(s[Symbol.asyncIterator]){await((r=(n=s[Symbol.asyncIterator]()).return)==null?void 0:r.call(n));return}const e=s.getReader(),t=e.cancel();e.releaseLock(),await t}const Al=({headers:s,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)}),Xr="RFC3986",Yr=s=>String(s),Gs={RFC1738:s=>String(s).replace(/%20/g,"+"),RFC3986:Yr},Il="RFC1738";let xn=(s,e)=>(xn=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty),xn(s,e));const _e=(()=>{const s=[];for(let e=0;e<256;++e)s.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return s})(),dn=1024,El=(s,e,t,n,r)=>{if(s.length===0)return s;let a=s;if(typeof s=="symbol"?a=Symbol.prototype.toString.call(s):typeof s!="string"&&(a=String(s)),t==="iso-8859-1")return escape(a).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let i="";for(let o=0;o<a.length;o+=dn){const l=a.length>=dn?a.slice(o,o+dn):a,c=[];for(let f=0;f<l.length;++f){let d=l.charCodeAt(f);if(d===45||d===46||d===95||d===126||d>=48&&d<=57||d>=65&&d<=90||d>=97&&d<=122||r===Il&&(d===40||d===41)){c[c.length]=l.charAt(f);continue}if(d<128){c[c.length]=_e[d];continue}if(d<2048){c[c.length]=_e[192|d>>6]+_e[128|d&63];continue}if(d<55296||d>=57344){c[c.length]=_e[224|d>>12]+_e[128|d>>6&63]+_e[128|d&63];continue}f+=1,d=65536+((d&1023)<<10|l.charCodeAt(f)&1023),c[c.length]=_e[240|d>>18]+_e[128|d>>12&63]+_e[128|d>>6&63]+_e[128|d&63]}i+=c.join("")}return i};function Rl(s){return!s||typeof s!="object"?!1:!!(s.constructor&&s.constructor.isBuffer&&s.constructor.isBuffer(s))}function Ws(s,e){if(le(s)){const t=[];for(let n=0;n<s.length;n+=1)t.push(e(s[n]));return t}return e(s)}const Qr={brackets(s){return String(s)+"[]"},comma:"comma",indices(s,e){return String(s)+"["+e+"]"},repeat(s){return String(s)}},Zr=function(s,e){Array.prototype.push.apply(s,le(e)?e:[e])};let Hs;const J={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:El,encodeValuesOnly:!1,format:Xr,formatter:Yr,indices:!1,serializeDate(s){return(Hs??(Hs=Function.prototype.call.bind(Date.prototype.toISOString)))(s)},skipNulls:!1,strictNullHandling:!1};function Ol(s){return typeof s=="string"||typeof s=="number"||typeof s=="boolean"||typeof s=="symbol"||typeof s=="bigint"}const fn={};function ea(s,e,t,n,r,a,i,o,l,c,f,d,h,u,m,g,v,k){let x=s,b=k,y=0,E=!1;for(;(b=b.get(fn))!==void 0&&!E;){const C=b.get(s);if(y+=1,typeof C<"u"){if(C===y)throw new RangeError("Cyclic object value");E=!0}typeof b.get(fn)>"u"&&(y=0)}if(typeof c=="function"?x=c(e,x):x instanceof Date?x=h==null?void 0:h(x):t==="comma"&&le(x)&&(x=Ws(x,function(C){return C instanceof Date?h==null?void 0:h(C):C})),x===null){if(a)return l&&!g?l(e,J.encoder,v,"key",u):e;x=""}if(Ol(x)||Rl(x)){if(l){const C=g?e:l(e,J.encoder,v,"key",u);return[(m==null?void 0:m(C))+"="+(m==null?void 0:m(l(x,J.encoder,v,"value",u)))]}return[(m==null?void 0:m(e))+"="+(m==null?void 0:m(String(x)))]}const O=[];if(typeof x>"u")return O;let I;if(t==="comma"&&le(x))g&&l&&(x=Ws(x,l)),I=[{value:x.length>0?x.join(",")||null:void 0}];else if(le(c))I=c;else{const C=Object.keys(x);I=f?C.sort(f):C}const q=o?String(e).replace(/\./g,"%2E"):String(e),T=n&&le(x)&&x.length===1?q+"[]":q;if(r&&le(x)&&x.length===0)return T+"[]";for(let C=0;C<I.length;++C){const F=I[C],oe=typeof F=="object"&&typeof F.value<"u"?F.value:x[F];if(i&&oe===null)continue;const H=d&&o?F.replace(/\./g,"%2E"):F,Ie=le(x)?typeof t=="function"?t(T,H):T:T+(d?"."+H:"["+H+"]");k.set(s,y);const X=new WeakMap;X.set(fn,k),Zr(O,ea(oe,Ie,t,n,r,a,i,o,t==="comma"&&g&&le(x)?null:l,c,f,d,h,u,m,g,v,X))}return O}function kl(s=J){if(typeof s.allowEmptyArrays<"u"&&typeof s.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof s.encodeDotInKeys<"u"&&typeof s.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(s.encoder!==null&&typeof s.encoder<"u"&&typeof s.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=s.charset||J.charset;if(typeof s.charset<"u"&&s.charset!=="utf-8"&&s.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=Xr;if(typeof s.format<"u"){if(!xn(Gs,s.format))throw new TypeError("Unknown format option provided.");t=s.format}const n=Gs[t];let r=J.filter;(typeof s.filter=="function"||le(s.filter))&&(r=s.filter);let a;if(s.arrayFormat&&s.arrayFormat in Qr?a=s.arrayFormat:"indices"in s?a=s.indices?"indices":"repeat":a=J.arrayFormat,"commaRoundTrip"in s&&typeof s.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const i=typeof s.allowDots>"u"?s.encodeDotInKeys?!0:J.allowDots:!!s.allowDots;return{addQueryPrefix:typeof s.addQueryPrefix=="boolean"?s.addQueryPrefix:J.addQueryPrefix,allowDots:i,allowEmptyArrays:typeof s.allowEmptyArrays=="boolean"?!!s.allowEmptyArrays:J.allowEmptyArrays,arrayFormat:a,charset:e,charsetSentinel:typeof s.charsetSentinel=="boolean"?s.charsetSentinel:J.charsetSentinel,commaRoundTrip:!!s.commaRoundTrip,delimiter:typeof s.delimiter>"u"?J.delimiter:s.delimiter,encode:typeof s.encode=="boolean"?s.encode:J.encode,encodeDotInKeys:typeof s.encodeDotInKeys=="boolean"?s.encodeDotInKeys:J.encodeDotInKeys,encoder:typeof s.encoder=="function"?s.encoder:J.encoder,encodeValuesOnly:typeof s.encodeValuesOnly=="boolean"?s.encodeValuesOnly:J.encodeValuesOnly,filter:r,format:t,formatter:n,serializeDate:typeof s.serializeDate=="function"?s.serializeDate:J.serializeDate,skipNulls:typeof s.skipNulls=="boolean"?s.skipNulls:J.skipNulls,sort:typeof s.sort=="function"?s.sort:null,strictNullHandling:typeof s.strictNullHandling=="boolean"?s.strictNullHandling:J.strictNullHandling}}function Tl(s,e={}){let t=s;const n=kl(e);let r,a;typeof n.filter=="function"?(a=n.filter,t=a("",t)):le(n.filter)&&(a=n.filter,r=a);const i=[];if(typeof t!="object"||t===null)return"";const o=Qr[n.arrayFormat],l=o==="comma"&&n.commaRoundTrip;r||(r=Object.keys(t)),n.sort&&r.sort(n.sort);const c=new WeakMap;for(let h=0;h<r.length;++h){const u=r[h];n.skipNulls&&t[u]===null||Zr(i,ea(t[u],u,o,l,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,c))}const f=i.join(n.delimiter);let d=n.addQueryPrefix===!0?"?":"";return n.charsetSentinel&&(n.charset==="iso-8859-1"?d+="utf8=%26%2310003%3B&":d+="utf8=%E2%9C%93&"),f.length>0?d+f:""}function Nl(s){let e=0;for(const r of s)e+=r.length;const t=new Uint8Array(e);let n=0;for(const r of s)t.set(r,n),n+=r.length;return t}let Ks;function qn(s){let e;return(Ks??(e=new globalThis.TextEncoder,Ks=e.encode.bind(e)))(s)}let zs;function Js(s){let e;return(zs??(e=new globalThis.TextDecoder,zs=e.decode.bind(e)))(s)}var ce,ue;class Yt{constructor(){ce.set(this,void 0),ue.set(this,void 0),U(this,ce,new Uint8Array),U(this,ue,null)}decode(e){if(e==null)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?qn(e):e;U(this,ce,Nl([p(this,ce,"f"),t]));const n=[];let r;for(;(r=Pl(p(this,ce,"f"),p(this,ue,"f")))!=null;){if(r.carriage&&p(this,ue,"f")==null){U(this,ue,r.index);continue}if(p(this,ue,"f")!=null&&(r.index!==p(this,ue,"f")+1||r.carriage)){n.push(Js(p(this,ce,"f").subarray(0,p(this,ue,"f")-1))),U(this,ce,p(this,ce,"f").subarray(p(this,ue,"f"))),U(this,ue,null);continue}const a=p(this,ue,"f")!==null?r.preceding-1:r.preceding,i=Js(p(this,ce,"f").subarray(0,a));n.push(i),U(this,ce,p(this,ce,"f").subarray(r.index)),U(this,ue,null)}return n}flush(){return p(this,ce,"f").length?this.decode(`
`):[]}}ce=new WeakMap,ue=new WeakMap;Yt.NEWLINE_CHARS=new Set([`
`,"\r"]);Yt.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function Pl(s,e){for(let r=e??0;r<s.length;r++){if(s[r]===10)return{preceding:r,index:r+1,carriage:!1};if(s[r]===13)return{preceding:r,index:r+1,carriage:!0}}return null}function Ml(s){for(let n=0;n<s.length-1;n++){if(s[n]===10&&s[n+1]===10||s[n]===13&&s[n+1]===13)return n+2;if(s[n]===13&&s[n+1]===10&&n+3<s.length&&s[n+2]===13&&s[n+3]===10)return n+4}return-1}class we{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let n=!1;async function*r(){if(n)throw new L("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let a=!1;try{for await(const i of Fl(e,t))if(!a){if(i.data.startsWith("[DONE]")){a=!0;continue}if(i.event===null||i.event.startsWith("response.")||i.event.startsWith("transcript.")){let o;try{o=JSON.parse(i.data)}catch(l){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),l}if(o&&o.error)throw new ee(void 0,o.error,void 0,e.headers);yield o}else{let o;try{o=JSON.parse(i.data)}catch(l){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),l}if(i.event=="error")throw new ee(void 0,o.error,o.message,void 0);yield{event:i.event,data:o}}}a=!0}catch(i){if(vn(i))return;throw i}finally{a||t.abort()}}return new we(r,t)}static fromReadableStream(e,t){let n=!1;async function*r(){const i=new Yt,o=Jr(e);for await(const l of o)for(const c of i.decode(l))yield c;for(const l of i.flush())yield l}async function*a(){if(n)throw new L("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let i=!1;try{for await(const o of r())i||o&&(yield JSON.parse(o));i=!0}catch(o){if(vn(o))return;throw o}finally{i||t.abort()}}return new we(a,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),r=a=>({next:()=>{if(a.length===0){const i=n.next();e.push(i),t.push(i)}return a.shift()}});return[new we(()=>r(e),this.controller),new we(()=>r(t),this.controller)]}toReadableStream(){const e=this;let t;return Kr({async start(){t=e[Symbol.asyncIterator]()},async pull(n){try{const{value:r,done:a}=await t.next();if(a)return n.close();const i=qn(JSON.stringify(r)+`
`);n.enqueue(i)}catch(r){n.error(r)}},async cancel(){var n;await((n=t.return)==null?void 0:n.call(t))}})}}async function*Fl(s,e){if(!s.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new L("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new L("Attempted to iterate over a response with no body");const t=new Ul,n=new Yt,r=Jr(s.body);for await(const a of Ll(r))for(const i of n.decode(a)){const o=t.decode(i);o&&(yield o)}for(const a of n.flush()){const i=t.decode(a);i&&(yield i)}}async function*Ll(s){let e=new Uint8Array;for await(const t of s){if(t==null)continue;const n=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?qn(t):t;let r=new Uint8Array(e.length+n.length);r.set(e),r.set(n,e.length),e=r;let a;for(;(a=Ml(e))!==-1;)yield e.slice(0,a),e=e.slice(a)}e.length>0&&(yield e)}class Ul{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const a={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,r]=Dl(e,":");return r.startsWith(" ")&&(r=r.substring(1)),t==="event"?this.event=r:t==="data"&&this.data.push(r),null}}function Dl(s,e){const t=s.indexOf(e);return t!==-1?[s.substring(0,t),e,s.substring(t+e.length)]:[s,"",""]}const Dt={off:0,error:200,warn:300,info:400,debug:500},Xs=(s,e,t)=>{if(s){if(gl(Dt,s))return s;ne(t).warn(`${e} was set to ${JSON.stringify(s)}, expected one of ${JSON.stringify(Object.keys(Dt))}`)}};function Qe(){}function bt(s,e,t){return!e||Dt[s]>Dt[t]?Qe:e[s].bind(e)}const Bl={error:Qe,warn:Qe,info:Qe,debug:Qe};let Ys=new WeakMap;function ne(s){const e=s.logger,t=s.logLevel??"off";if(!e)return Bl;const n=Ys.get(e);if(n&&n[0]===t)return n[1];const r={error:bt("error",e,t),warn:bt("warn",e,t),info:bt("info",e,t),debug:bt("debug",e,t)};return Ys.set(e,[t,r]),r}const Ne=s=>(s.options&&(s.options={...s.options},delete s.options.headers),s.headers&&(s.headers=Object.fromEntries((s.headers instanceof Headers?[...s.headers]:Object.entries(s.headers)).map(([e,t])=>[e,e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t]))),"retryOfRequestLogID"in s&&(s.retryOfRequestLogID&&(s.retryOf=s.retryOfRequestLogID),delete s.retryOfRequestLogID),s);async function ta(s,e){const{response:t,requestLogID:n,retryOfRequestLogID:r,startTime:a}=e,i=await(async()=>{var d;if(e.options.stream)return ne(s).debug("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller):we.fromSSEResponse(t,e.controller);if(t.status===204)return null;if(e.options.__binaryResponse)return t;const o=t.headers.get("content-type"),l=(d=o==null?void 0:o.split(";")[0])==null?void 0:d.trim();if((l==null?void 0:l.includes("application/json"))||(l==null?void 0:l.endsWith("+json"))){const h=await t.json();return na(h,t)}return await t.text()})();return ne(s).debug(`[${n}] response parsed`,Ne({retryOfRequestLogID:r,url:t.url,status:t.status,body:i,durationMs:Date.now()-a})),i}function na(s,e){return!s||typeof s!="object"||Array.isArray(s)?s:Object.defineProperty(s,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}var Ze;class Qt extends Promise{constructor(e,t,n=ta){super(r=>{r(null)}),this.responsePromise=t,this.parseResponse=n,Ze.set(this,void 0),U(this,Ze,e)}_thenUnwrap(e){return new Qt(p(this,Ze,"f"),this.responsePromise,async(t,n)=>na(e(await this.parseResponse(t,n),n),n.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(p(this,Ze,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}Ze=new WeakMap;var vt;class sa{constructor(e,t,n,r){vt.set(this,void 0),U(this,vt,e),this.options=r,this.response=t,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageRequestOptions()!=null:!1}async getNextPage(){const e=this.nextPageRequestOptions();if(!e)throw new L("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await p(this,vt,"f").requestAPIList(this.constructor,e)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(vt=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class ql extends Qt{constructor(e,t,n){super(e,t,async(r,a)=>new n(r,a.response,await ta(r,a),a.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}class Zt extends sa{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}}class K extends sa{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.has_more=n.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){var n;const e=this.getPaginatedItems(),t=(n=e[e.length-1])==null?void 0:n.id;return t?{...this.options,query:{...ml(this.options.query),after:t}}:null}}const ra=()=>{var s;if(typeof File>"u"){const{process:e}=globalThis,t=typeof((s=e==null?void 0:e.versions)==null?void 0:s.node)=="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function ot(s,e,t){return ra(),new File(s,e??"unknown_file",t)}function Et(s){return(typeof s=="object"&&s!==null&&("name"in s&&s.name&&String(s.name)||"url"in s&&s.url&&String(s.url)||"filename"in s&&s.filename&&String(s.filename)||"path"in s&&s.path&&String(s.path))||"").split(/[\\/]/).pop()||void 0}const aa=s=>s!=null&&typeof s=="object"&&typeof s[Symbol.asyncIterator]=="function",Be=async(s,e)=>({...s,body:await Vl(s.body,e)}),Qs=new WeakMap;function jl(s){const e=typeof s=="function"?s:s.fetch,t=Qs.get(e);if(t)return t;const n=(async()=>{try{const r="Response"in e?e.Response:(await e("data:,")).constructor,a=new FormData;return a.toString()!==await new r(a).text()}catch{return!0}})();return Qs.set(e,n),n}const Vl=async(s,e)=>{if(!await jl(e))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");const t=new FormData;return await Promise.all(Object.entries(s||{}).map(([n,r])=>Sn(t,n,r))),t},Gl=s=>s instanceof Blob&&"name"in s,Sn=async(s,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")s.append(e,String(t));else if(t instanceof Response)s.append(e,ot([await t.blob()],Et(t)));else if(aa(t))s.append(e,ot([await new Response(zr(t)).blob()],Et(t)));else if(Gl(t))s.append(e,t,Et(t));else if(Array.isArray(t))await Promise.all(t.map(n=>Sn(s,e+"[]",n)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([n,r])=>Sn(s,`${e}[${n}]`,r)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}},ia=s=>s!=null&&typeof s=="object"&&typeof s.size=="number"&&typeof s.type=="string"&&typeof s.text=="function"&&typeof s.slice=="function"&&typeof s.arrayBuffer=="function",Wl=s=>s!=null&&typeof s=="object"&&typeof s.name=="string"&&typeof s.lastModified=="number"&&ia(s),Hl=s=>s!=null&&typeof s=="object"&&typeof s.url=="string"&&typeof s.blob=="function";async function Kl(s,e,t){if(ra(),s=await s,Wl(s))return s instanceof File?s:ot([await s.arrayBuffer()],s.name);if(Hl(s)){const r=await s.blob();return e||(e=new URL(s.url).pathname.split(/[\\/]/).pop()),ot(await Cn(r),e,t)}const n=await Cn(s);if(e||(e=Et(s)),!(t!=null&&t.type)){const r=n.find(a=>typeof a=="object"&&"type"in a&&a.type);typeof r=="string"&&(t={...t,type:r})}return ot(n,e,t)}async function Cn(s){var t;let e=[];if(typeof s=="string"||ArrayBuffer.isView(s)||s instanceof ArrayBuffer)e.push(s);else if(ia(s))e.push(s instanceof Blob?s:await s.arrayBuffer());else if(aa(s))for await(const n of s)e.push(...await Cn(n));else{const n=(t=s==null?void 0:s.constructor)==null?void 0:t.name;throw new Error(`Unexpected data type: ${typeof s}${n?`; constructor: ${n}`:""}${zl(s)}`)}return e}function zl(s){return typeof s!="object"||s===null?"":`; props: [${Object.getOwnPropertyNames(s).map(t=>`"${t}"`).join(", ")}]`}class D{constructor(e){this._client=e}}function oa(s){return s.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const Jl=(s=oa)=>function(t,...n){if(t.length===1)return t[0];let r=!1;const a=t.reduce((f,d,h)=>(/[?#]/.test(d)&&(r=!0),f+d+(h===n.length?"":(r?encodeURIComponent:s)(String(n[h])))),""),i=a.split(/[?#]/,1)[0],o=[],l=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let c;for(;(c=l.exec(i))!==null;)o.push({start:c.index,length:c[0].length});if(o.length>0){let f=0;const d=o.reduce((h,u)=>{const m=" ".repeat(u.start-f),g="^".repeat(u.length);return f=u.start+u.length,h+m+g},"");throw new L(`Path parameters result in path with invalid segments:
${a}
${d}`)}return a},$=Jl(oa);let la=class extends D{list(e,t={},n){return this._client.getAPIList($`/chat/completions/${e}/messages`,K,{query:t,...n})}};function Xl(s){return typeof s.parse=="function"}const Bt=s=>(s==null?void 0:s.role)==="assistant",ca=s=>(s==null?void 0:s.role)==="tool";var $n,Rt,Ot,et,tt,kt,nt,Ae,st,qt,jt,We,ua;class jn{constructor(){$n.add(this),this.controller=new AbortController,Rt.set(this,void 0),Ot.set(this,()=>{}),et.set(this,()=>{}),tt.set(this,void 0),kt.set(this,()=>{}),nt.set(this,()=>{}),Ae.set(this,{}),st.set(this,!1),qt.set(this,!1),jt.set(this,!1),We.set(this,!1),U(this,Rt,new Promise((e,t)=>{U(this,Ot,e,"f"),U(this,et,t,"f")})),U(this,tt,new Promise((e,t)=>{U(this,kt,e,"f"),U(this,nt,t,"f")})),p(this,Rt,"f").catch(()=>{}),p(this,tt,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},p(this,$n,"m",ua).bind(this))},0)}_connected(){this.ended||(p(this,Ot,"f").call(this),this._emit("connect"))}get ended(){return p(this,st,"f")}get errored(){return p(this,qt,"f")}get aborted(){return p(this,jt,"f")}abort(){this.controller.abort()}on(e,t){return(p(this,Ae,"f")[e]||(p(this,Ae,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=p(this,Ae,"f")[e];if(!n)return this;const r=n.findIndex(a=>a.listener===t);return r>=0&&n.splice(r,1),this}once(e,t){return(p(this,Ae,"f")[e]||(p(this,Ae,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{U(this,We,!0),e!=="error"&&this.once("error",n),this.once(e,t)})}async done(){U(this,We,!0),await p(this,tt,"f")}_emit(e,...t){if(p(this,st,"f"))return;e==="end"&&(U(this,st,!0),p(this,kt,"f").call(this));const n=p(this,Ae,"f")[e];if(n&&(p(this,Ae,"f")[e]=n.filter(r=>!r.once),n.forEach(({listener:r})=>r(...t))),e==="abort"){const r=t[0];!p(this,We,"f")&&!(n!=null&&n.length)&&Promise.reject(r),p(this,et,"f").call(this,r),p(this,nt,"f").call(this,r),this._emit("end");return}if(e==="error"){const r=t[0];!p(this,We,"f")&&!(n!=null&&n.length)&&Promise.reject(r),p(this,et,"f").call(this,r),p(this,nt,"f").call(this,r),this._emit("end")}}_emitFinal(){}}Rt=new WeakMap,Ot=new WeakMap,et=new WeakMap,tt=new WeakMap,kt=new WeakMap,nt=new WeakMap,Ae=new WeakMap,st=new WeakMap,qt=new WeakMap,jt=new WeakMap,We=new WeakMap,$n=new WeakSet,ua=function(e){if(U(this,qt,!0),e instanceof Error&&e.name==="AbortError"&&(e=new he),e instanceof he)return U(this,jt,!0),this._emit("abort",e);if(e instanceof L)return this._emit("error",e);if(e instanceof Error){const t=new L(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new L(String(e)))};function Vn(s){return(s==null?void 0:s.$brand)==="auto-parseable-response-format"}function pt(s){return(s==null?void 0:s.$brand)==="auto-parseable-tool"}function Yl(s,e){return!e||!da(e)?{...s,choices:s.choices.map(t=>({...t,message:{...t.message,parsed:null,...t.message.tool_calls?{tool_calls:t.message.tool_calls}:void 0}}))}:Gn(s,e)}function Gn(s,e){const t=s.choices.map(n=>{var r;if(n.finish_reason==="length")throw new Wr;if(n.finish_reason==="content_filter")throw new Hr;return{...n,message:{...n.message,...n.message.tool_calls?{tool_calls:((r=n.message.tool_calls)==null?void 0:r.map(a=>Zl(e,a)))??void 0}:void 0,parsed:n.message.content&&!n.message.refusal?Ql(e,n.message.content):null}}});return{...s,choices:t}}function Ql(s,e){var t,n;return((t=s.response_format)==null?void 0:t.type)!=="json_schema"?null:((n=s.response_format)==null?void 0:n.type)==="json_schema"?"$parseRaw"in s.response_format?s.response_format.$parseRaw(e):JSON.parse(e):null}function Zl(s,e){var n;const t=(n=s.tools)==null?void 0:n.find(r=>{var a;return((a=r.function)==null?void 0:a.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:pt(t)?t.$parseRaw(e.function.arguments):t!=null&&t.function.strict?JSON.parse(e.function.arguments):null}}}function ec(s,e){var n;if(!s)return!1;const t=(n=s.tools)==null?void 0:n.find(r=>{var a;return((a=r.function)==null?void 0:a.name)===e.function.name});return pt(t)||(t==null?void 0:t.function.strict)||!1}function da(s){var e;return Vn(s.response_format)?!0:((e=s.tools)==null?void 0:e.some(t=>pt(t)||t.type==="function"&&t.function.strict===!0))??!1}function tc(s){for(const e of s??[]){if(e.type!=="function")throw new L(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new L(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var ae,An,Vt,In,En,Rn,fa,ha;const nc=10;class ma extends jn{constructor(){super(...arguments),ae.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var n;this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=(n=e.choices[0])==null?void 0:n.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),ca(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(Bt(e)&&e.tool_calls)for(const n of e.tool_calls)n.type==="function"&&this._emit("functionToolCall",n.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new L("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),p(this,ae,"m",An).call(this)}async finalMessage(){return await this.done(),p(this,ae,"m",Vt).call(this)}async finalFunctionToolCall(){return await this.done(),p(this,ae,"m",In).call(this)}async finalFunctionToolCallResult(){return await this.done(),p(this,ae,"m",En).call(this)}async totalUsage(){return await this.done(),p(this,ae,"m",Rn).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=p(this,ae,"m",Vt).call(this);t&&this._emit("finalMessage",t);const n=p(this,ae,"m",An).call(this);n&&this._emit("finalContent",n);const r=p(this,ae,"m",In).call(this);r&&this._emit("finalFunctionToolCall",r);const a=p(this,ae,"m",En).call(this);a!=null&&this._emit("finalFunctionToolCallResult",a),this._chatCompletions.some(i=>i.usage)&&this._emit("totalUsage",p(this,ae,"m",Rn).call(this))}async _createChatCompletion(e,t,n){const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),p(this,ae,"m",fa).call(this,t);const a=await e.chat.completions.create({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(Gn(a,t))}async _runChatCompletion(e,t,n){for(const r of t.messages)this._addMessage(r,!1);return await this._createChatCompletion(e,t,n)}async _runTools(e,t,n){var u,m,g;const r="tool",{tool_choice:a="auto",stream:i,...o}=t,l=typeof a!="string"&&((u=a==null?void 0:a.function)==null?void 0:u.name),{maxChatCompletions:c=nc}=n||{},f=t.tools.map(v=>{if(pt(v)){if(!v.$callback)throw new L("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:v.$callback,name:v.function.name,description:v.function.description||"",parameters:v.function.parameters,parse:v.$parseRaw,strict:!0}}}return v}),d={};for(const v of f)v.type==="function"&&(d[v.function.name||v.function.function.name]=v.function);const h="tools"in t?f.map(v=>v.type==="function"?{type:"function",function:{name:v.function.name||v.function.function.name,parameters:v.function.parameters,description:v.function.description,strict:v.function.strict}}:v):void 0;for(const v of t.messages)this._addMessage(v,!1);for(let v=0;v<c;++v){const x=(m=(await this._createChatCompletion(e,{...o,tool_choice:a,tools:h,messages:[...this.messages]},n)).choices[0])==null?void 0:m.message;if(!x)throw new L("missing message in ChatCompletion response");if(!((g=x.tool_calls)!=null&&g.length))return;for(const b of x.tool_calls){if(b.type!=="function")continue;const y=b.id,{name:E,arguments:O}=b.function,I=d[E];if(I){if(l&&l!==E){const F=`Invalid tool_call: ${JSON.stringify(E)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:r,tool_call_id:y,content:F});continue}}else{const F=`Invalid tool_call: ${JSON.stringify(E)}. Available options are: ${Object.keys(d).map(oe=>JSON.stringify(oe)).join(", ")}. Please try again`;this._addMessage({role:r,tool_call_id:y,content:F});continue}let q;try{q=Xl(I)?await I.parse(O):O}catch(F){const oe=F instanceof Error?F.message:String(F);this._addMessage({role:r,tool_call_id:y,content:oe});continue}const T=await I.function(q,this),C=p(this,ae,"m",ha).call(this,T);if(this._addMessage({role:r,tool_call_id:y,content:C}),l)return}}}}ae=new WeakSet,An=function(){return p(this,ae,"m",Vt).call(this).content??null},Vt=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(Bt(t))return{...t,content:t.content??null,refusal:t.refusal??null}}throw new L("stream ended without producing a ChatCompletionMessage with role=assistant")},In=function(){var e,t;for(let n=this.messages.length-1;n>=0;n--){const r=this.messages[n];if(Bt(r)&&((e=r==null?void 0:r.tool_calls)!=null&&e.length))return(t=r.tool_calls.at(-1))==null?void 0:t.function}},En=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(ca(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(n=>{var r;return n.role==="assistant"&&((r=n.tool_calls)==null?void 0:r.some(a=>a.type==="function"&&a.id===t.tool_call_id))}))return t.content}},Rn=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},fa=function(e){if(e.n!=null&&e.n>1)throw new L("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},ha=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class Wn extends ma{static runTools(e,t,n){const r=new Wn,a={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(e,t,a)),r}_addMessage(e,t=!0){super._addMessage(e,t),Bt(e)&&e.content&&this._emit("content",e.content)}}const pa=1,ga=2,ya=4,_a=8,ba=16,va=32,wa=64,xa=128,Sa=256,Ca=xa|Sa,$a=ba|va|Ca|wa,Aa=pa|ga|$a,Ia=ya|_a,sc=Aa|Ia,Y={STR:pa,NUM:ga,ARR:ya,OBJ:_a,NULL:ba,BOOL:va,NAN:wa,INFINITY:xa,MINUS_INFINITY:Sa,INF:Ca,SPECIAL:$a,ATOM:Aa,COLLECTION:Ia,ALL:sc};class rc extends Error{}class ac extends Error{}function ic(s,e=Y.ALL){if(typeof s!="string")throw new TypeError(`expecting str, got ${typeof s}`);if(!s.trim())throw new Error(`${s} is empty`);return oc(s.trim(),e)}const oc=(s,e)=>{const t=s.length;let n=0;const r=h=>{throw new rc(`${h} at position ${n}`)},a=h=>{throw new ac(`${h} at position ${n}`)},i=()=>(d(),n>=t&&r("Unexpected end of input"),s[n]==='"'?o():s[n]==="{"?l():s[n]==="["?c():s.substring(n,n+4)==="null"||Y.NULL&e&&t-n<4&&"null".startsWith(s.substring(n))?(n+=4,null):s.substring(n,n+4)==="true"||Y.BOOL&e&&t-n<4&&"true".startsWith(s.substring(n))?(n+=4,!0):s.substring(n,n+5)==="false"||Y.BOOL&e&&t-n<5&&"false".startsWith(s.substring(n))?(n+=5,!1):s.substring(n,n+8)==="Infinity"||Y.INFINITY&e&&t-n<8&&"Infinity".startsWith(s.substring(n))?(n+=8,1/0):s.substring(n,n+9)==="-Infinity"||Y.MINUS_INFINITY&e&&1<t-n&&t-n<9&&"-Infinity".startsWith(s.substring(n))?(n+=9,-1/0):s.substring(n,n+3)==="NaN"||Y.NAN&e&&t-n<3&&"NaN".startsWith(s.substring(n))?(n+=3,NaN):f()),o=()=>{const h=n;let u=!1;for(n++;n<t&&(s[n]!=='"'||u&&s[n-1]==="\\");)u=s[n]==="\\"?!u:!1,n++;if(s.charAt(n)=='"')try{return JSON.parse(s.substring(h,++n-Number(u)))}catch(m){a(String(m))}else if(Y.STR&e)try{return JSON.parse(s.substring(h,n-Number(u))+'"')}catch{return JSON.parse(s.substring(h,s.lastIndexOf("\\"))+'"')}r("Unterminated string literal")},l=()=>{n++,d();const h={};try{for(;s[n]!=="}";){if(d(),n>=t&&Y.OBJ&e)return h;const u=o();d(),n++;try{const m=i();Object.defineProperty(h,u,{value:m,writable:!0,enumerable:!0,configurable:!0})}catch(m){if(Y.OBJ&e)return h;throw m}d(),s[n]===","&&n++}}catch{if(Y.OBJ&e)return h;r("Expected '}' at end of object")}return n++,h},c=()=>{n++;const h=[];try{for(;s[n]!=="]";)h.push(i()),d(),s[n]===","&&n++}catch{if(Y.ARR&e)return h;r("Expected ']' at end of array")}return n++,h},f=()=>{if(n===0){s==="-"&&Y.NUM&e&&r("Not sure what '-' is");try{return JSON.parse(s)}catch(u){if(Y.NUM&e)try{return s[s.length-1]==="."?JSON.parse(s.substring(0,s.lastIndexOf("."))):JSON.parse(s.substring(0,s.lastIndexOf("e")))}catch{}a(String(u))}}const h=n;for(s[n]==="-"&&n++;s[n]&&!",]}".includes(s[n]);)n++;n==t&&!(Y.NUM&e)&&r("Unterminated number literal");try{return JSON.parse(s.substring(h,n))}catch{s.substring(h,n)==="-"&&Y.NUM&e&&r("Not sure what '-' is");try{return JSON.parse(s.substring(h,s.lastIndexOf("e")))}catch(m){a(String(m))}}},d=()=>{for(;n<t&&` 
\r	`.includes(s[n]);)n++};return i()},Zs=s=>ic(s,Y.ALL^Y.NUM);var z,$e,je,Ee,hn,wt,mn,pn,gn,xt,yn,er;class ft extends ma{constructor(e){super(),z.add(this),$e.set(this,void 0),je.set(this,void 0),Ee.set(this,void 0),U(this,$e,e),U(this,je,[])}get currentChatCompletionSnapshot(){return p(this,Ee,"f")}static fromReadableStream(e){const t=new ft(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,n){const r=new ft(t);return r._run(()=>r._runChatCompletion(e,{...t,stream:!0},{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createChatCompletion(e,t,n){var i;super._createChatCompletion;const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),p(this,z,"m",hn).call(this);const a=await e.chat.completions.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const o of a)p(this,z,"m",mn).call(this,o);if((i=a.controller.signal)!=null&&i.aborted)throw new he;return this._addChatCompletion(p(this,z,"m",xt).call(this))}async _fromReadableStream(e,t){var i;const n=t==null?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),p(this,z,"m",hn).call(this),this._connected();const r=we.fromReadableStream(e,this.controller);let a;for await(const o of r)a&&a!==o.id&&this._addChatCompletion(p(this,z,"m",xt).call(this)),p(this,z,"m",mn).call(this,o),a=o.id;if((i=r.controller.signal)!=null&&i.aborted)throw new he;return this._addChatCompletion(p(this,z,"m",xt).call(this))}[($e=new WeakMap,je=new WeakMap,Ee=new WeakMap,z=new WeakSet,hn=function(){this.ended||U(this,Ee,void 0)},wt=function(t){let n=p(this,je,"f")[t.index];return n||(n={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},p(this,je,"f")[t.index]=n,n)},mn=function(t){var r,a,i,o,l,c,f,d,h,u,m,g,v,k,x;if(this.ended)return;const n=p(this,z,"m",er).call(this,t);this._emit("chunk",t,n);for(const b of t.choices){const y=n.choices[b.index];b.delta.content!=null&&((r=y.message)==null?void 0:r.role)==="assistant"&&((a=y.message)!=null&&a.content)&&(this._emit("content",b.delta.content,y.message.content),this._emit("content.delta",{delta:b.delta.content,snapshot:y.message.content,parsed:y.message.parsed})),b.delta.refusal!=null&&((i=y.message)==null?void 0:i.role)==="assistant"&&((o=y.message)!=null&&o.refusal)&&this._emit("refusal.delta",{delta:b.delta.refusal,snapshot:y.message.refusal}),((l=b.logprobs)==null?void 0:l.content)!=null&&((c=y.message)==null?void 0:c.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(f=b.logprobs)==null?void 0:f.content,snapshot:((d=y.logprobs)==null?void 0:d.content)??[]}),((h=b.logprobs)==null?void 0:h.refusal)!=null&&((u=y.message)==null?void 0:u.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(m=b.logprobs)==null?void 0:m.refusal,snapshot:((g=y.logprobs)==null?void 0:g.refusal)??[]});const E=p(this,z,"m",wt).call(this,y);y.finish_reason&&(p(this,z,"m",gn).call(this,y),E.current_tool_call_index!=null&&p(this,z,"m",pn).call(this,y,E.current_tool_call_index));for(const O of b.delta.tool_calls??[])E.current_tool_call_index!==O.index&&(p(this,z,"m",gn).call(this,y),E.current_tool_call_index!=null&&p(this,z,"m",pn).call(this,y,E.current_tool_call_index)),E.current_tool_call_index=O.index;for(const O of b.delta.tool_calls??[]){const I=(v=y.message.tool_calls)==null?void 0:v[O.index];I!=null&&I.type&&((I==null?void 0:I.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(k=I.function)==null?void 0:k.name,index:O.index,arguments:I.function.arguments,parsed_arguments:I.function.parsed_arguments,arguments_delta:((x=O.function)==null?void 0:x.arguments)??""}):(I==null||I.type,void 0))}}},pn=function(t,n){var i,o,l;if(p(this,z,"m",wt).call(this,t).done_tool_calls.has(n))return;const a=(i=t.message.tool_calls)==null?void 0:i[n];if(!a)throw new Error("no tool call snapshot");if(!a.type)throw new Error("tool call snapshot missing `type`");if(a.type==="function"){const c=(l=(o=p(this,$e,"f"))==null?void 0:o.tools)==null?void 0:l.find(f=>f.type==="function"&&f.function.name===a.function.name);this._emit("tool_calls.function.arguments.done",{name:a.function.name,index:n,arguments:a.function.arguments,parsed_arguments:pt(c)?c.$parseRaw(a.function.arguments):c!=null&&c.function.strict?JSON.parse(a.function.arguments):null})}else a.type},gn=function(t){var r,a;const n=p(this,z,"m",wt).call(this,t);if(t.message.content&&!n.content_done){n.content_done=!0;const i=p(this,z,"m",yn).call(this);this._emit("content.done",{content:t.message.content,parsed:i?i.$parseRaw(t.message.content):null})}t.message.refusal&&!n.refusal_done&&(n.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),(r=t.logprobs)!=null&&r.content&&!n.logprobs_content_done&&(n.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),(a=t.logprobs)!=null&&a.refusal&&!n.logprobs_refusal_done&&(n.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},xt=function(){if(this.ended)throw new L("stream has ended, this shouldn't happen");const t=p(this,Ee,"f");if(!t)throw new L("request ended without sending any chunks");return U(this,Ee,void 0),U(this,je,[]),lc(t,p(this,$e,"f"))},yn=function(){var n;const t=(n=p(this,$e,"f"))==null?void 0:n.response_format;return Vn(t)?t:null},er=function(t){var n,r,a,i;let o=p(this,Ee,"f");const{choices:l,...c}=t;o?Object.assign(o,c):o=U(this,Ee,{...c,choices:[]});for(const{delta:f,finish_reason:d,index:h,logprobs:u=null,...m}of t.choices){let g=o.choices[h];if(g||(g=o.choices[h]={finish_reason:d,index:h,message:{},logprobs:u,...m}),u)if(!g.logprobs)g.logprobs=Object.assign({},u);else{const{content:O,refusal:I,...q}=u;Object.assign(g.logprobs,q),O&&((n=g.logprobs).content??(n.content=[]),g.logprobs.content.push(...O)),I&&((r=g.logprobs).refusal??(r.refusal=[]),g.logprobs.refusal.push(...I))}if(d&&(g.finish_reason=d,p(this,$e,"f")&&da(p(this,$e,"f")))){if(d==="length")throw new Wr;if(d==="content_filter")throw new Hr}if(Object.assign(g,m),!f)continue;const{content:v,refusal:k,function_call:x,role:b,tool_calls:y,...E}=f;if(Object.assign(g.message,E),k&&(g.message.refusal=(g.message.refusal||"")+k),b&&(g.message.role=b),x&&(g.message.function_call?(x.name&&(g.message.function_call.name=x.name),x.arguments&&((a=g.message.function_call).arguments??(a.arguments=""),g.message.function_call.arguments+=x.arguments)):g.message.function_call=x),v&&(g.message.content=(g.message.content||"")+v,!g.message.refusal&&p(this,z,"m",yn).call(this)&&(g.message.parsed=Zs(g.message.content))),y){g.message.tool_calls||(g.message.tool_calls=[]);for(const{index:O,id:I,type:q,function:T,...C}of y){const F=(i=g.message.tool_calls)[O]??(i[O]={});Object.assign(F,C),I&&(F.id=I),q&&(F.type=q),T&&(F.function??(F.function={name:T.name??"",arguments:""})),T!=null&&T.name&&(F.function.name=T.name),T!=null&&T.arguments&&(F.function.arguments+=T.arguments,ec(p(this,$e,"f"),F)&&(F.function.parsed_arguments=Zs(F.function.arguments)))}}}return o},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("chunk",r=>{const a=t.shift();a?a.resolve(r):e.push(r)}),this.on("end",()=>{n=!0;for(const r of t)r.resolve(void 0);t.length=0}),this.on("abort",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),this.on("error",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new we(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function lc(s,e){const{id:t,choices:n,created:r,model:a,system_fingerprint:i,...o}=s,l={...o,id:t,choices:n.map(({message:c,finish_reason:f,index:d,logprobs:h,...u})=>{if(!f)throw new L(`missing finish_reason for choice ${d}`);const{content:m=null,function_call:g,tool_calls:v,...k}=c,x=c.role;if(!x)throw new L(`missing role for choice ${d}`);if(g){const{arguments:b,name:y}=g;if(b==null)throw new L(`missing function_call.arguments for choice ${d}`);if(!y)throw new L(`missing function_call.name for choice ${d}`);return{...u,message:{content:m,function_call:{arguments:b,name:y},role:x,refusal:c.refusal??null},finish_reason:f,index:d,logprobs:h}}return v?{...u,index:d,finish_reason:f,logprobs:h,message:{...k,role:x,content:m,refusal:c.refusal??null,tool_calls:v.map((b,y)=>{const{function:E,type:O,id:I,...q}=b,{arguments:T,name:C,...F}=E||{};if(I==null)throw new L(`missing choices[${d}].tool_calls[${y}].id
${St(s)}`);if(O==null)throw new L(`missing choices[${d}].tool_calls[${y}].type
${St(s)}`);if(C==null)throw new L(`missing choices[${d}].tool_calls[${y}].function.name
${St(s)}`);if(T==null)throw new L(`missing choices[${d}].tool_calls[${y}].function.arguments
${St(s)}`);return{...q,id:I,type:O,function:{...F,name:C,arguments:T}}})}}:{...u,message:{...k,content:m,role:x,refusal:c.refusal??null},finish_reason:f,index:d,logprobs:h}}),created:r,model:a,object:"chat.completion",...i?{system_fingerprint:i}:{}};return Yl(l,e)}function St(s){return JSON.stringify(s)}class Gt extends ft{static fromReadableStream(e){const t=new Gt(null);return t._run(()=>t._fromReadableStream(e)),t}static runTools(e,t,n){const r=new Gt(t),a={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(e,t,a)),r}}let Hn=class extends D{constructor(){super(...arguments),this.messages=new la(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get($`/chat/completions/${e}`,t)}update(e,t,n){return this._client.post($`/chat/completions/${e}`,{body:t,...n})}list(e={},t){return this._client.getAPIList("/chat/completions",K,{query:e,...t})}delete(e,t){return this._client.delete($`/chat/completions/${e}`,t)}parse(e,t){return tc(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t==null?void 0:t.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(n=>Gn(n,e))}runTools(e,t){return e.stream?Gt.runTools(this._client,e,t):Wn.runTools(this._client,e,t)}stream(e,t){return ft.createChatCompletion(this._client,e,t)}};Hn.Messages=la;class Kn extends D{constructor(){super(...arguments),this.completions=new Hn(this._client)}}Kn.Completions=Hn;const Ea=Symbol("brand.privateNullableHeaders");function*cc(s){if(!s)return;if(Ea in s){const{values:n,nulls:r}=s;yield*n.entries();for(const a of r)yield[a,null];return}let e=!1,t;s instanceof Headers?t=s.entries():Bs(s)?t=s:(e=!0,t=Object.entries(s??{}));for(let n of t){const r=n[0];if(typeof r!="string")throw new TypeError("expected header name to be a string");const a=Bs(n[1])?n[1]:[n[1]];let i=!1;for(const o of a)o!==void 0&&(e&&!i&&(i=!0,yield[r,null]),yield[r,o])}}const P=s=>{const e=new Headers,t=new Set;for(const n of s){const r=new Set;for(const[a,i]of cc(n)){const o=a.toLowerCase();r.has(o)||(e.delete(a),r.add(o)),i===null?(e.delete(a),t.add(o)):(e.append(a,i),t.delete(o))}}return{[Ea]:!0,values:e,nulls:t}};class Ra extends D{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:P([{Accept:"application/octet-stream"},t==null?void 0:t.headers]),__binaryResponse:!0})}}class Oa extends D{create(e,t){return this._client.post("/audio/transcriptions",Be({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}}class ka extends D{create(e,t){return this._client.post("/audio/translations",Be({body:e,...t,__metadata:{model:e.model}},this._client))}}class gt extends D{constructor(){super(...arguments),this.transcriptions=new Oa(this._client),this.translations=new ka(this._client),this.speech=new Ra(this._client)}}gt.Transcriptions=Oa;gt.Translations=ka;gt.Speech=Ra;class Ta extends D{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get($`/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/batches",K,{query:e,...t})}cancel(e,t){return this._client.post($`/batches/${e}/cancel`,t)}}class Na extends D{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:P([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}retrieve(e,t){return this._client.get($`/assistants/${e}`,{...t,headers:P([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}update(e,t,n){return this._client.post($`/assistants/${e}`,{body:t,...n,headers:P([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}list(e={},t){return this._client.getAPIList("/assistants",K,{query:e,...t,headers:P([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}delete(e,t){return this._client.delete($`/assistants/${e}`,{...t,headers:P([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}}class Pa extends D{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:P([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}}class Ma extends D{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:P([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}}class en extends D{constructor(){super(...arguments),this.sessions=new Pa(this._client),this.transcriptionSessions=new Ma(this._client)}}en.Sessions=Pa;en.TranscriptionSessions=Ma;class Fa extends D{create(e,t,n){return this._client.post($`/threads/${e}/messages`,{body:t,...n,headers:P([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}retrieve(e,t,n){const{thread_id:r}=t;return this._client.get($`/threads/${r}/messages/${e}`,{...n,headers:P([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}update(e,t,n){const{thread_id:r,...a}=t;return this._client.post($`/threads/${r}/messages/${e}`,{body:a,...n,headers:P([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}list(e,t={},n){return this._client.getAPIList($`/threads/${e}/messages`,K,{query:t,...n,headers:P([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}delete(e,t,n){const{thread_id:r}=t;return this._client.delete($`/threads/${r}/messages/${e}`,{...n,headers:P([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}}class La extends D{retrieve(e,t,n){const{thread_id:r,run_id:a,...i}=t;return this._client.get($`/threads/${r}/runs/${a}/steps/${e}`,{query:i,...n,headers:P([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}list(e,t,n){const{thread_id:r,...a}=t;return this._client.getAPIList($`/threads/${r}/runs/${e}/steps`,K,{query:a,...n,headers:P([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}}const uc=s=>{if(typeof Buffer<"u"){const e=Buffer.from(s,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{const e=atob(s),t=e.length,n=new Uint8Array(t);for(let r=0;r<t;r++)n[r]=e.charCodeAt(r);return Array.from(new Float32Array(n.buffer))}};var _n={};const Xe=s=>{var e,t,n,r;if(typeof globalThis.process<"u")return((e=_n==null?void 0:_n[s])==null?void 0:e.trim())??void 0;if(typeof globalThis.Deno<"u")return(r=(n=(t=globalThis.Deno.env)==null?void 0:t.get)==null?void 0:n.call(t,s))==null?void 0:r.trim()};var Z,Fe,On,be,Tt,pe,Le,He,Pe,Wt,de,Nt,Pt,lt,rt,at,tr,nr,sr,rr,ar,ir,or;class ct extends jn{constructor(){super(...arguments),Z.add(this),On.set(this,[]),be.set(this,{}),Tt.set(this,{}),pe.set(this,void 0),Le.set(this,void 0),He.set(this,void 0),Pe.set(this,void 0),Wt.set(this,void 0),de.set(this,void 0),Nt.set(this,void 0),Pt.set(this,void 0),lt.set(this,void 0)}[(On=new WeakMap,be=new WeakMap,Tt=new WeakMap,pe=new WeakMap,Le=new WeakMap,He=new WeakMap,Pe=new WeakMap,Wt=new WeakMap,de=new WeakMap,Nt=new WeakMap,Pt=new WeakMap,lt=new WeakMap,Z=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",r=>{const a=t.shift();a?a.resolve(r):e.push(r)}),this.on("end",()=>{n=!0;for(const r of t)r.resolve(void 0);t.length=0}),this.on("abort",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),this.on("error",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new Fe;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){var a;const n=t==null?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();const r=we.fromReadableStream(e,this.controller);for await(const i of r)p(this,Z,"m",rt).call(this,i);if((a=r.controller.signal)!=null&&a.aborted)throw new he;return this._addRun(p(this,Z,"m",at).call(this))}toReadableStream(){return new we(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,r){const a=new Fe;return a._run(()=>a._runToolAssistantStream(e,t,n,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createToolAssistantStream(e,t,n,r){var l;const a=r==null?void 0:r.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const i={...n,stream:!0},o=await e.submitToolOutputs(t,i,{...r,signal:this.controller.signal});this._connected();for await(const c of o)p(this,Z,"m",rt).call(this,c);if((l=o.controller.signal)!=null&&l.aborted)throw new he;return this._addRun(p(this,Z,"m",at).call(this))}static createThreadAssistantStream(e,t,n){const r=new Fe;return r._run(()=>r._threadAssistantStream(e,t,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),r}static createAssistantStream(e,t,n,r){const a=new Fe;return a._run(()=>a._runAssistantStream(e,t,n,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),a}currentEvent(){return p(this,Nt,"f")}currentRun(){return p(this,Pt,"f")}currentMessageSnapshot(){return p(this,pe,"f")}currentRunStepSnapshot(){return p(this,lt,"f")}async finalRunSteps(){return await this.done(),Object.values(p(this,be,"f"))}async finalMessages(){return await this.done(),Object.values(p(this,Tt,"f"))}async finalRun(){if(await this.done(),!p(this,Le,"f"))throw Error("Final run was not received.");return p(this,Le,"f")}async _createThreadAssistantStream(e,t,n){var o;const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));const a={...t,stream:!0},i=await e.createAndRun(a,{...n,signal:this.controller.signal});this._connected();for await(const l of i)p(this,Z,"m",rt).call(this,l);if((o=i.controller.signal)!=null&&o.aborted)throw new he;return this._addRun(p(this,Z,"m",at).call(this))}async _createAssistantStream(e,t,n,r){var l;const a=r==null?void 0:r.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const i={...n,stream:!0},o=await e.create(t,i,{...r,signal:this.controller.signal});this._connected();for await(const c of o)p(this,Z,"m",rt).call(this,c);if((l=o.controller.signal)!=null&&l.aborted)throw new he;return this._addRun(p(this,Z,"m",at).call(this))}static accumulateDelta(e,t){for(const[n,r]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=r;continue}let a=e[n];if(a==null){e[n]=r;continue}if(n==="index"||n==="type"){e[n]=r;continue}if(typeof a=="string"&&typeof r=="string")a+=r;else if(typeof a=="number"&&typeof r=="number")a+=r;else if(un(a)&&un(r))a=this.accumulateDelta(a,r);else if(Array.isArray(a)&&Array.isArray(r)){if(a.every(i=>typeof i=="string"||typeof i=="number")){a.push(...r);continue}for(const i of r){if(!un(i))throw new Error(`Expected array delta entry to be an object but got: ${i}`);const o=i.index;if(o==null)throw console.error(i),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);const l=a[o];l==null?a.push(i):a[o]=this.accumulateDelta(l,i)}continue}else throw Error(`Unhandled record type: ${n}, deltaValue: ${r}, accValue: ${a}`);e[n]=a}return e}_addRun(e){return e}async _threadAssistantStream(e,t,n){return await this._createThreadAssistantStream(t,e,n)}async _runAssistantStream(e,t,n,r){return await this._createAssistantStream(t,e,n,r)}async _runToolAssistantStream(e,t,n,r){return await this._createToolAssistantStream(t,e,n,r)}}Fe=ct,rt=function(e){if(!this.ended)switch(U(this,Nt,e),p(this,Z,"m",sr).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":p(this,Z,"m",or).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":p(this,Z,"m",nr).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":p(this,Z,"m",tr).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},at=function(){if(this.ended)throw new L("stream has ended, this shouldn't happen");if(!p(this,Le,"f"))throw Error("Final run has not been received");return p(this,Le,"f")},tr=function(e){const[t,n]=p(this,Z,"m",ar).call(this,e,p(this,pe,"f"));U(this,pe,t),p(this,Tt,"f")[t.id]=t;for(const r of n){const a=t.content[r.index];(a==null?void 0:a.type)=="text"&&this._emit("textCreated",a.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const r of e.data.delta.content){if(r.type=="text"&&r.text){let a=r.text,i=t.content[r.index];if(i&&i.type=="text")this._emit("textDelta",a,i.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(r.index!=p(this,He,"f")){if(p(this,Pe,"f"))switch(p(this,Pe,"f").type){case"text":this._emit("textDone",p(this,Pe,"f").text,p(this,pe,"f"));break;case"image_file":this._emit("imageFileDone",p(this,Pe,"f").image_file,p(this,pe,"f"));break}U(this,He,r.index)}U(this,Pe,t.content[r.index])}break;case"thread.message.completed":case"thread.message.incomplete":if(p(this,He,"f")!==void 0){const r=e.data.content[p(this,He,"f")];if(r)switch(r.type){case"image_file":this._emit("imageFileDone",r.image_file,p(this,pe,"f"));break;case"text":this._emit("textDone",r.text,p(this,pe,"f"));break}}p(this,pe,"f")&&this._emit("messageDone",e.data),U(this,pe,void 0)}},nr=function(e){const t=p(this,Z,"m",rr).call(this,e);switch(U(this,lt,t),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const n=e.data.delta;if(n.step_details&&n.step_details.type=="tool_calls"&&n.step_details.tool_calls&&t.step_details.type=="tool_calls")for(const a of n.step_details.tool_calls)a.index==p(this,Wt,"f")?this._emit("toolCallDelta",a,t.step_details.tool_calls[a.index]):(p(this,de,"f")&&this._emit("toolCallDone",p(this,de,"f")),U(this,Wt,a.index),U(this,de,t.step_details.tool_calls[a.index]),p(this,de,"f")&&this._emit("toolCallCreated",p(this,de,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":U(this,lt,void 0),e.data.step_details.type=="tool_calls"&&p(this,de,"f")&&(this._emit("toolCallDone",p(this,de,"f")),U(this,de,void 0)),this._emit("runStepDone",e.data,t);break}},sr=function(e){p(this,On,"f").push(e),this._emit("event",e)},rr=function(e){switch(e.event){case"thread.run.step.created":return p(this,be,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=p(this,be,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){const r=Fe.accumulateDelta(t,n.delta);p(this,be,"f")[e.data.id]=r}return p(this,be,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":p(this,be,"f")[e.data.id]=e.data;break}if(p(this,be,"f")[e.data.id])return p(this,be,"f")[e.data.id];throw new Error("No snapshot available")},ar=function(e,t){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let r=e.data;if(r.delta.content)for(const a of r.delta.content)if(a.index in t.content){let i=t.content[a.index];t.content[a.index]=p(this,Z,"m",ir).call(this,a,i)}else t.content[a.index]=a,n.push(a);return[t,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},ir=function(e,t){return Fe.accumulateDelta(t,e)},or=function(e){switch(U(this,Pt,e.data),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":U(this,Le,e.data),p(this,de,"f")&&(this._emit("toolCallDone",p(this,de,"f")),U(this,de,void 0));break}};let zn=class extends D{constructor(){super(...arguments),this.steps=new La(this._client)}create(e,t,n){const{include:r,...a}=t;return this._client.post($`/threads/${e}/runs`,{query:{include:r},body:a,...n,headers:P([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers]),stream:t.stream??!1})}retrieve(e,t,n){const{thread_id:r}=t;return this._client.get($`/threads/${r}/runs/${e}`,{...n,headers:P([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}update(e,t,n){const{thread_id:r,...a}=t;return this._client.post($`/threads/${r}/runs/${e}`,{body:a,...n,headers:P([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}list(e,t={},n){return this._client.getAPIList($`/threads/${e}/runs`,K,{query:t,...n,headers:P([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}cancel(e,t,n){const{thread_id:r}=t;return this._client.post($`/threads/${r}/runs/${e}/cancel`,{...n,headers:P([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}async createAndPoll(e,t,n){const r=await this.create(e,t,n);return await this.poll(r.id,{thread_id:e},n)}createAndStream(e,t,n){return ct.createAssistantStream(e,this._client.beta.threads.runs,t,n)}async poll(e,t,n){var a;const r=P([n==null?void 0:n.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":((a=n==null?void 0:n.pollIntervalMs)==null?void 0:a.toString())??void 0}]);for(;;){const{data:i,response:o}=await this.retrieve(e,t,{...n,headers:{...n==null?void 0:n.headers,...r}}).withResponse();switch(i.status){case"queued":case"in_progress":case"cancelling":let l=5e3;if(n!=null&&n.pollIntervalMs)l=n.pollIntervalMs;else{const c=o.headers.get("openai-poll-after-ms");if(c){const f=parseInt(c);isNaN(f)||(l=f)}}await mt(l);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return i}}}stream(e,t,n){return ct.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n){const{thread_id:r,...a}=t;return this._client.post($`/threads/${r}/runs/${e}/submit_tool_outputs`,{body:a,...n,headers:P([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers]),stream:t.stream??!1})}async submitToolOutputsAndPoll(e,t,n){const r=await this.submitToolOutputs(e,t,n);return await this.poll(r.id,t,n)}submitToolOutputsStream(e,t,n){return ct.createToolAssistantStream(e,this._client.beta.threads.runs,t,n)}};zn.Steps=La;class tn extends D{constructor(){super(...arguments),this.runs=new zn(this._client),this.messages=new Fa(this._client)}create(e={},t){return this._client.post("/threads",{body:e,...t,headers:P([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}retrieve(e,t){return this._client.get($`/threads/${e}`,{...t,headers:P([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}update(e,t,n){return this._client.post($`/threads/${e}`,{body:t,...n,headers:P([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}delete(e,t){return this._client.delete($`/threads/${e}`,{...t,headers:P([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:P([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers]),stream:e.stream??!1})}async createAndRunPoll(e,t){const n=await this.createAndRun(e,t);return await this.runs.poll(n.id,{thread_id:n.thread_id},t)}createAndRunStream(e,t){return ct.createThreadAssistantStream(e,this._client.beta.threads,t)}}tn.Runs=zn;tn.Messages=Fa;class yt extends D{constructor(){super(...arguments),this.realtime=new en(this._client),this.assistants=new Na(this._client),this.threads=new tn(this._client)}}yt.Realtime=en;yt.Assistants=Na;yt.Threads=tn;class Ua extends D{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class Da extends D{retrieve(e,t,n){const{container_id:r}=t;return this._client.get($`/containers/${r}/files/${e}/content`,{...n,headers:P([{Accept:"application/binary"},n==null?void 0:n.headers]),__binaryResponse:!0})}}let Jn=class extends D{constructor(){super(...arguments),this.content=new Da(this._client)}create(e,t,n){return this._client.post($`/containers/${e}/files`,Be({body:t,...n},this._client))}retrieve(e,t,n){const{container_id:r}=t;return this._client.get($`/containers/${r}/files/${e}`,n)}list(e,t={},n){return this._client.getAPIList($`/containers/${e}/files`,K,{query:t,...n})}delete(e,t,n){const{container_id:r}=t;return this._client.delete($`/containers/${r}/files/${e}`,{...n,headers:P([{Accept:"*/*"},n==null?void 0:n.headers])})}};Jn.Content=Da;class Xn extends D{constructor(){super(...arguments),this.files=new Jn(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get($`/containers/${e}`,t)}list(e={},t){return this._client.getAPIList("/containers",K,{query:e,...t})}delete(e,t){return this._client.delete($`/containers/${e}`,{...t,headers:P([{Accept:"*/*"},t==null?void 0:t.headers])})}}Xn.Files=Jn;class Ba extends D{create(e,t){const n=!!e.encoding_format;let r=n?e.encoding_format:"base64";n&&ne(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);const a=this._client.post("/embeddings",{body:{...e,encoding_format:r},...t});return n?a:(ne(this._client).debug("embeddings/decoding base64 embeddings from base64"),a._thenUnwrap(i=>(i&&i.data&&i.data.forEach(o=>{const l=o.embedding;o.embedding=uc(l)}),i)))}}class qa extends D{retrieve(e,t,n){const{eval_id:r,run_id:a}=t;return this._client.get($`/evals/${r}/runs/${a}/output_items/${e}`,n)}list(e,t,n){const{eval_id:r,...a}=t;return this._client.getAPIList($`/evals/${r}/runs/${e}/output_items`,K,{query:a,...n})}}class Yn extends D{constructor(){super(...arguments),this.outputItems=new qa(this._client)}create(e,t,n){return this._client.post($`/evals/${e}/runs`,{body:t,...n})}retrieve(e,t,n){const{eval_id:r}=t;return this._client.get($`/evals/${r}/runs/${e}`,n)}list(e,t={},n){return this._client.getAPIList($`/evals/${e}/runs`,K,{query:t,...n})}delete(e,t,n){const{eval_id:r}=t;return this._client.delete($`/evals/${r}/runs/${e}`,n)}cancel(e,t,n){const{eval_id:r}=t;return this._client.post($`/evals/${r}/runs/${e}`,n)}}Yn.OutputItems=qa;class Qn extends D{constructor(){super(...arguments),this.runs=new Yn(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get($`/evals/${e}`,t)}update(e,t,n){return this._client.post($`/evals/${e}`,{body:t,...n})}list(e={},t){return this._client.getAPIList("/evals",K,{query:e,...t})}delete(e,t){return this._client.delete($`/evals/${e}`,t)}}Qn.Runs=Yn;let ja=class extends D{create(e,t){return this._client.post("/files",Be({body:e,...t},this._client))}retrieve(e,t){return this._client.get($`/files/${e}`,t)}list(e={},t){return this._client.getAPIList("/files",K,{query:e,...t})}delete(e,t){return this._client.delete($`/files/${e}`,t)}content(e,t){return this._client.get($`/files/${e}/content`,{...t,headers:P([{Accept:"application/binary"},t==null?void 0:t.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:n=30*60*1e3}={}){const r=new Set(["processed","error","deleted"]),a=Date.now();let i=await this.retrieve(e);for(;!i.status||!r.has(i.status);)if(await mt(t),i=await this.retrieve(e),Date.now()-a>n)throw new Bn({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return i}};class Va extends D{}let Ga=class extends D{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}};class Zn extends D{constructor(){super(...arguments),this.graders=new Ga(this._client)}}Zn.Graders=Ga;class Wa extends D{create(e,t,n){return this._client.getAPIList($`/fine_tuning/checkpoints/${e}/permissions`,Zt,{body:t,method:"post",...n})}retrieve(e,t={},n){return this._client.getAPIList($`/fine_tuning/checkpoints/${e}/permissions`,K,{query:t,...n})}delete(e,t,n){const{fine_tuned_model_checkpoint:r}=t;return this._client.delete($`/fine_tuning/checkpoints/${r}/permissions/${e}`,n)}}let es=class extends D{constructor(){super(...arguments),this.permissions=new Wa(this._client)}};es.Permissions=Wa;class Ha extends D{list(e,t={},n){return this._client.getAPIList($`/fine_tuning/jobs/${e}/checkpoints`,K,{query:t,...n})}}class ts extends D{constructor(){super(...arguments),this.checkpoints=new Ha(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get($`/fine_tuning/jobs/${e}`,t)}list(e={},t){return this._client.getAPIList("/fine_tuning/jobs",K,{query:e,...t})}cancel(e,t){return this._client.post($`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return this._client.getAPIList($`/fine_tuning/jobs/${e}/events`,K,{query:t,...n})}pause(e,t){return this._client.post($`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post($`/fine_tuning/jobs/${e}/resume`,t)}}ts.Checkpoints=Ha;class ze extends D{constructor(){super(...arguments),this.methods=new Va(this._client),this.jobs=new ts(this._client),this.checkpoints=new es(this._client),this.alpha=new Zn(this._client)}}ze.Methods=Va;ze.Jobs=ts;ze.Checkpoints=es;ze.Alpha=Zn;class Ka extends D{}class ns extends D{constructor(){super(...arguments),this.graderModels=new Ka(this._client)}}ns.GraderModels=Ka;class za extends D{createVariation(e,t){return this._client.post("/images/variations",Be({body:e,...t},this._client))}edit(e,t){return this._client.post("/images/edits",Be({body:e,...t},this._client))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}class Ja extends D{retrieve(e,t){return this._client.get($`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",Zt,e)}delete(e,t){return this._client.delete($`/models/${e}`,t)}}class Xa extends D{create(e,t){return this._client.post("/moderations",{body:e,...t})}}function dc(s,e){return!e||!hc(e)?{...s,output_parsed:null,output:s.output.map(t=>t.type==="function_call"?{...t,parsed_arguments:null}:t.type==="message"?{...t,content:t.content.map(n=>({...n,parsed:null}))}:t)}:Ya(s,e)}function Ya(s,e){const t=s.output.map(r=>{if(r.type==="function_call")return{...r,parsed_arguments:gc(e,r)};if(r.type==="message"){const a=r.content.map(i=>i.type==="output_text"?{...i,parsed:fc(e,i.text)}:i);return{...r,content:a}}return r}),n=Object.assign({},s,{output:t});return Object.getOwnPropertyDescriptor(s,"output_text")||Qa(n),Object.defineProperty(n,"output_parsed",{enumerable:!0,get(){for(const r of n.output)if(r.type==="message"){for(const a of r.content)if(a.type==="output_text"&&a.parsed!==null)return a.parsed}return null}}),n}function fc(s,e){var t,n,r,a;return((n=(t=s.text)==null?void 0:t.format)==null?void 0:n.type)!=="json_schema"?null:"$parseRaw"in((r=s.text)==null?void 0:r.format)?((a=s.text)==null?void 0:a.format).$parseRaw(e):JSON.parse(e)}function hc(s){var e;return!!Vn((e=s.text)==null?void 0:e.format)}function mc(s){return(s==null?void 0:s.$brand)==="auto-parseable-tool"}function pc(s,e){return s.find(t=>t.type==="function"&&t.name===e)}function gc(s,e){const t=pc(s.tools??[],e.name);return{...e,...e,parsed_arguments:mc(t)?t.$parseRaw(e.arguments):t!=null&&t.strict?JSON.parse(e.arguments):null}}function Qa(s){const e=[];for(const t of s.output)if(t.type==="message")for(const n of t.content)n.type==="output_text"&&e.push(n.text);s.output_text=e.join("")}var Ve,Ct,Re,$t,lr,cr,ur,dr;class ss extends jn{constructor(e){super(),Ve.add(this),Ct.set(this,void 0),Re.set(this,void 0),$t.set(this,void 0),U(this,Ct,e)}static createResponse(e,t,n){const r=new ss(t);return r._run(()=>r._createOrRetrieveResponse(e,t,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createOrRetrieveResponse(e,t,n){var o;const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),p(this,Ve,"m",lr).call(this);let a,i=null;"response_id"in t?(a=await e.responses.retrieve(t.response_id,{stream:!0},{...n,signal:this.controller.signal,stream:!0}),i=t.starting_after??null):a=await e.responses.create({...t,stream:!0},{...n,signal:this.controller.signal}),this._connected();for await(const l of a)p(this,Ve,"m",cr).call(this,l,i);if((o=a.controller.signal)!=null&&o.aborted)throw new he;return p(this,Ve,"m",ur).call(this)}[(Ct=new WeakMap,Re=new WeakMap,$t=new WeakMap,Ve=new WeakSet,lr=function(){this.ended||U(this,Re,void 0)},cr=function(t,n){if(this.ended)return;const r=(i,o)=>{(n==null||o.sequence_number>n)&&this._emit(i,o)},a=p(this,Ve,"m",dr).call(this,t);switch(r("event",t),t.type){case"response.output_text.delta":{const i=a.output[t.output_index];if(!i)throw new L(`missing output at index ${t.output_index}`);if(i.type==="message"){const o=i.content[t.content_index];if(!o)throw new L(`missing content at index ${t.content_index}`);if(o.type!=="output_text")throw new L(`expected content to be 'output_text', got ${o.type}`);r("response.output_text.delta",{...t,snapshot:o.text})}break}case"response.function_call_arguments.delta":{const i=a.output[t.output_index];if(!i)throw new L(`missing output at index ${t.output_index}`);i.type==="function_call"&&r("response.function_call_arguments.delta",{...t,snapshot:i.arguments});break}default:r(t.type,t);break}},ur=function(){if(this.ended)throw new L("stream has ended, this shouldn't happen");const t=p(this,Re,"f");if(!t)throw new L("request ended without sending any events");U(this,Re,void 0);const n=yc(t,p(this,Ct,"f"));return U(this,$t,n),n},dr=function(t){let n=p(this,Re,"f");if(!n){if(t.type!=="response.created")throw new L(`When snapshot hasn't been set yet, expected 'response.created' event, got ${t.type}`);return n=U(this,Re,t.response),n}switch(t.type){case"response.output_item.added":{n.output.push(t.item);break}case"response.content_part.added":{const r=n.output[t.output_index];if(!r)throw new L(`missing output at index ${t.output_index}`);r.type==="message"&&r.content.push(t.part);break}case"response.output_text.delta":{const r=n.output[t.output_index];if(!r)throw new L(`missing output at index ${t.output_index}`);if(r.type==="message"){const a=r.content[t.content_index];if(!a)throw new L(`missing content at index ${t.content_index}`);if(a.type!=="output_text")throw new L(`expected content to be 'output_text', got ${a.type}`);a.text+=t.delta}break}case"response.function_call_arguments.delta":{const r=n.output[t.output_index];if(!r)throw new L(`missing output at index ${t.output_index}`);r.type==="function_call"&&(r.arguments+=t.delta);break}case"response.completed":{U(this,Re,t.response);break}}return n},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",r=>{const a=t.shift();a?a.resolve(r):e.push(r)}),this.on("end",()=>{n=!0;for(const r of t)r.resolve(void 0);t.length=0}),this.on("abort",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),this.on("error",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const e=p(this,$t,"f");if(!e)throw new L("stream ended without producing a ChatCompletion");return e}}function yc(s,e){return dc(s,e)}class Za extends D{list(e,t={},n){return this._client.getAPIList($`/responses/${e}/input_items`,K,{query:t,...n})}}class rs extends D{constructor(){super(...arguments),this.inputItems=new Za(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(n=>("object"in n&&n.object==="response"&&Qa(n),n))}retrieve(e,t={},n){return this._client.get($`/responses/${e}`,{query:t,...n,stream:(t==null?void 0:t.stream)??!1})}delete(e,t){return this._client.delete($`/responses/${e}`,{...t,headers:P([{Accept:"*/*"},t==null?void 0:t.headers])})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(n=>Ya(n,e))}stream(e,t){return ss.createResponse(this._client,e,t)}cancel(e,t){return this._client.post($`/responses/${e}/cancel`,t)}}rs.InputItems=Za;class ei extends D{create(e,t,n){return this._client.post($`/uploads/${e}/parts`,Be({body:t,...n},this._client))}}class as extends D{constructor(){super(...arguments),this.parts=new ei(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post($`/uploads/${e}/cancel`,t)}complete(e,t,n){return this._client.post($`/uploads/${e}/complete`,{body:t,...n})}}as.Parts=ei;const _c=async s=>{const e=await Promise.allSettled(s),t=e.filter(r=>r.status==="rejected");if(t.length){for(const r of t)console.error(r.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}const n=[];for(const r of e)r.status==="fulfilled"&&n.push(r.value);return n};class ti extends D{create(e,t,n){return this._client.post($`/vector_stores/${e}/file_batches`,{body:t,...n,headers:P([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}retrieve(e,t,n){const{vector_store_id:r}=t;return this._client.get($`/vector_stores/${r}/file_batches/${e}`,{...n,headers:P([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}cancel(e,t,n){const{vector_store_id:r}=t;return this._client.post($`/vector_stores/${r}/file_batches/${e}/cancel`,{...n,headers:P([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}async createAndPoll(e,t,n){const r=await this.create(e,t);return await this.poll(e,r.id,n)}listFiles(e,t,n){const{vector_store_id:r,...a}=t;return this._client.getAPIList($`/vector_stores/${r}/file_batches/${e}/files`,K,{query:a,...n,headers:P([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}async poll(e,t,n){var a;const r=P([n==null?void 0:n.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":((a=n==null?void 0:n.pollIntervalMs)==null?void 0:a.toString())??void 0}]);for(;;){const{data:i,response:o}=await this.retrieve(t,{vector_store_id:e},{...n,headers:r}).withResponse();switch(i.status){case"in_progress":let l=5e3;if(n!=null&&n.pollIntervalMs)l=n.pollIntervalMs;else{const c=o.headers.get("openai-poll-after-ms");if(c){const f=parseInt(c);isNaN(f)||(l=f)}}await mt(l);break;case"failed":case"cancelled":case"completed":return i}}}async uploadAndPoll(e,{files:t,fileIds:n=[]},r){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const a=(r==null?void 0:r.maxConcurrency)??5,i=Math.min(a,t.length),o=this._client,l=t.values(),c=[...n];async function f(h){for(let u of h){const m=await o.files.create({file:u,purpose:"assistants"},r);c.push(m.id)}}const d=Array(i).fill(l).map(f);return await _c(d),await this.createAndPoll(e,{file_ids:c})}}class ni extends D{create(e,t,n){return this._client.post($`/vector_stores/${e}/files`,{body:t,...n,headers:P([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}retrieve(e,t,n){const{vector_store_id:r}=t;return this._client.get($`/vector_stores/${r}/files/${e}`,{...n,headers:P([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}update(e,t,n){const{vector_store_id:r,...a}=t;return this._client.post($`/vector_stores/${r}/files/${e}`,{body:a,...n,headers:P([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}list(e,t={},n){return this._client.getAPIList($`/vector_stores/${e}/files`,K,{query:t,...n,headers:P([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}delete(e,t,n){const{vector_store_id:r}=t;return this._client.delete($`/vector_stores/${r}/files/${e}`,{...n,headers:P([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}async createAndPoll(e,t,n){const r=await this.create(e,t,n);return await this.poll(e,r.id,n)}async poll(e,t,n){var a;const r=P([n==null?void 0:n.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":((a=n==null?void 0:n.pollIntervalMs)==null?void 0:a.toString())??void 0}]);for(;;){const i=await this.retrieve(t,{vector_store_id:e},{...n,headers:r}).withResponse(),o=i.data;switch(o.status){case"in_progress":let l=5e3;if(n!=null&&n.pollIntervalMs)l=n.pollIntervalMs;else{const c=i.response.headers.get("openai-poll-after-ms");if(c){const f=parseInt(c);isNaN(f)||(l=f)}}await mt(l);break;case"failed":case"completed":return o}}}async upload(e,t,n){const r=await this._client.files.create({file:t,purpose:"assistants"},n);return this.create(e,{file_id:r.id},n)}async uploadAndPoll(e,t,n){const r=await this.upload(e,t,n);return await this.poll(e,r.id,n)}content(e,t,n){const{vector_store_id:r}=t;return this._client.getAPIList($`/vector_stores/${r}/files/${e}/content`,Zt,{...n,headers:P([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}}class nn extends D{constructor(){super(...arguments),this.files=new ni(this._client),this.fileBatches=new ti(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:P([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}retrieve(e,t){return this._client.get($`/vector_stores/${e}`,{...t,headers:P([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}update(e,t,n){return this._client.post($`/vector_stores/${e}`,{body:t,...n,headers:P([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}list(e={},t){return this._client.getAPIList("/vector_stores",K,{query:e,...t,headers:P([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}delete(e,t){return this._client.delete($`/vector_stores/${e}`,{...t,headers:P([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}search(e,t,n){return this._client.getAPIList($`/vector_stores/${e}/search`,Zt,{body:t,method:"post",...n,headers:P([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}}nn.Files=ni;nn.FileBatches=ti;var kn,is,Mt,si;class j{constructor({baseURL:e=Xe("OPENAI_BASE_URL"),apiKey:t=Xe("OPENAI_API_KEY"),organization:n=Xe("OPENAI_ORG_ID")??null,project:r=Xe("OPENAI_PROJECT_ID")??null,...a}={}){if(kn.add(this),Mt.set(this,void 0),this.completions=new Ua(this),this.chat=new Kn(this),this.embeddings=new Ba(this),this.files=new ja(this),this.images=new za(this),this.audio=new gt(this),this.moderations=new Xa(this),this.models=new Ja(this),this.fineTuning=new ze(this),this.graders=new ns(this),this.vectorStores=new nn(this),this.beta=new yt(this),this.batches=new Ta(this),this.uploads=new as(this),this.responses=new rs(this),this.evals=new Qn(this),this.containers=new Xn(this),t===void 0)throw new L("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const i={apiKey:t,organization:n,project:r,...a,baseURL:e||"https://api.openai.com/v1"};if(!i.dangerouslyAllowBrowser&&bl())throw new L(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);this.baseURL=i.baseURL,this.timeout=i.timeout??is.DEFAULT_TIMEOUT,this.logger=i.logger??console;const o="warn";this.logLevel=o,this.logLevel=Xs(i.logLevel,"ClientOptions.logLevel",this)??Xs(Xe("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??o,this.fetchOptions=i.fetchOptions,this.maxRetries=i.maxRetries??2,this.fetch=i.fetch??Cl(),U(this,Mt,Al),this._options=i,this.apiKey=t,this.organization=n,this.project=r}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){}authHeaders(e){return P([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return Tl(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${Ge}`}defaultIdempotencyKey(){return`stainless-node-retry-${Fr()}`}makeStatusError(e,t,n,r){return ee.generate(e,t,n,r)}buildURL(e,t,n){const r=!p(this,kn,"m",si).call(this)&&n||this.baseURL,a=hl(e)?new URL(e):new URL(r+(r.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),i=this.defaultQuery();return pl(i)||(t={...i,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(a.search=this.stringifyQuery(t)),a.toString()}async prepareOptions(e){}async prepareRequest(e,{url:t,options:n}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(r=>({method:e,path:t,...r})))}request(e,t=null){return new Qt(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,n){var k,x;const r=await e,a=r.maxRetries??this.maxRetries;t==null&&(t=a),await this.prepareOptions(r);const{req:i,url:o,timeout:l}=this.buildRequest(r,{retryCount:a-t});await this.prepareRequest(i,{url:o,options:r});const c="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),f=n===void 0?"":`, retryOf: ${n}`,d=Date.now();if(ne(this).debug(`[${c}] sending request`,Ne({retryOfRequestLogID:n,method:r.method,url:o,options:r,headers:i.headers})),(k=r.signal)!=null&&k.aborted)throw new he;const h=new AbortController,u=await this.fetchWithTimeout(o,i,l,h).catch(wn),m=Date.now();if(u instanceof Error){const b=`retrying, ${t} attempts remaining`;if((x=r.signal)!=null&&x.aborted)throw new he;const y=vn(u)||/timed? ?out/i.test(String(u)+("cause"in u?String(u.cause):""));if(t)return ne(this).info(`[${c}] connection ${y?"timed out":"failed"} - ${b}`),ne(this).debug(`[${c}] connection ${y?"timed out":"failed"} (${b})`,Ne({retryOfRequestLogID:n,url:o,durationMs:m-d,message:u.message})),this.retryRequest(r,t,n??c);throw ne(this).info(`[${c}] connection ${y?"timed out":"failed"} - error; no more retries left`),ne(this).debug(`[${c}] connection ${y?"timed out":"failed"} (error; no more retries left)`,Ne({retryOfRequestLogID:n,url:o,durationMs:m-d,message:u.message})),y?new Bn:new Xt({cause:u})}const g=[...u.headers.entries()].filter(([b])=>b==="x-request-id").map(([b,y])=>", "+b+": "+JSON.stringify(y)).join(""),v=`[${c}${f}${g}] ${i.method} ${o} ${u.ok?"succeeded":"failed"} with status ${u.status} in ${m-d}ms`;if(!u.ok){const b=this.shouldRetry(u);if(t&&b){const T=`retrying, ${t} attempts remaining`;return await $l(u.body),ne(this).info(`${v} - ${T}`),ne(this).debug(`[${c}] response error (${T})`,Ne({retryOfRequestLogID:n,url:u.url,status:u.status,headers:u.headers,durationMs:m-d})),this.retryRequest(r,t,n??c,u.headers)}const y=b?"error; no more retries left":"error; not retryable";ne(this).info(`${v} - ${y}`);const E=await u.text().catch(T=>wn(T).message),O=_l(E),I=O?void 0:E;throw ne(this).debug(`[${c}] response error (${y})`,Ne({retryOfRequestLogID:n,url:u.url,status:u.status,headers:u.headers,message:I,durationMs:Date.now()-d})),this.makeStatusError(u.status,O,I,u.headers)}return ne(this).info(v),ne(this).debug(`[${c}] response start`,Ne({retryOfRequestLogID:n,url:u.url,status:u.status,headers:u.headers,durationMs:m-d})),{response:u,options:r,controller:h,requestLogID:c,retryOfRequestLogID:n,startTime:d}}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}requestAPIList(e,t){const n=this.makeRequest(t,null,void 0);return new ql(this,n,e)}async fetchWithTimeout(e,t,n,r){const{signal:a,method:i,...o}=t||{};a&&a.addEventListener("abort",()=>r.abort());const l=setTimeout(()=>r.abort(),n),c=globalThis.ReadableStream&&o.body instanceof globalThis.ReadableStream||typeof o.body=="object"&&o.body!==null&&Symbol.asyncIterator in o.body,f={signal:r.signal,...c?{duplex:"half"}:{},method:"GET",...o};i&&(f.method=i.toUpperCase());try{return await this.fetch.call(void 0,e,f)}finally{clearTimeout(l)}}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n,r){let a;const i=r==null?void 0:r.get("retry-after-ms");if(i){const l=parseFloat(i);Number.isNaN(l)||(a=l)}const o=r==null?void 0:r.get("retry-after");if(o&&!a){const l=parseFloat(o);Number.isNaN(l)?a=Date.parse(o)-Date.now():a=l*1e3}if(!(a&&0<=a&&a<60*1e3)){const l=e.maxRetries??this.maxRetries;a=this.calculateDefaultRetryTimeoutMillis(t,l)}return await mt(a),this.makeRequest(e,t-1,n)}calculateDefaultRetryTimeoutMillis(e,t){const a=t-e,i=Math.min(.5*Math.pow(2,a),8),o=1-Math.random()*.25;return i*o*1e3}buildRequest(e,{retryCount:t=0}={}){const n={...e},{method:r,path:a,query:i,defaultBaseURL:o}=n,l=this.buildURL(a,i,o);"timeout"in n&&yl("timeout",n.timeout),n.timeout=n.timeout??this.timeout;const{bodyHeaders:c,body:f}=this.buildBody({options:n}),d=this.buildHeaders({options:e,method:r,bodyHeaders:c,retryCount:t});return{req:{method:r,headers:d,...n.signal&&{signal:n.signal},...globalThis.ReadableStream&&f instanceof globalThis.ReadableStream&&{duplex:"half"},...f&&{body:f},...this.fetchOptions??{},...n.fetchOptions??{}},url:l,timeout:n.timeout}}buildHeaders({options:e,method:t,bodyHeaders:n,retryCount:r}){let a={};this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);const i=P([a,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(r),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...Sl(),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},this.authHeaders(e),this._options.defaultHeaders,n,e.headers]);return this.validateHeaders(i),i.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};const n=P([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&n.values.has("content-type")||e instanceof Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:zr(e)}:p(this,Mt,"f").call(this,{body:e,headers:n})}}is=j,Mt=new WeakMap,kn=new WeakSet,si=function(){return this.baseURL!=="https://api.openai.com/v1"};j.OpenAI=is;j.DEFAULT_TIMEOUT=6e5;j.OpenAIError=L;j.APIError=ee;j.APIConnectionError=Xt;j.APIConnectionTimeoutError=Bn;j.APIUserAbortError=he;j.NotFoundError=Br;j.ConflictError=qr;j.RateLimitError=Vr;j.BadRequestError=Lr;j.AuthenticationError=Ur;j.InternalServerError=Gr;j.PermissionDeniedError=Dr;j.UnprocessableEntityError=jr;j.toFile=Kl;j.Completions=Ua;j.Chat=Kn;j.Embeddings=Ba;j.Files=ja;j.Images=za;j.Audio=gt;j.Moderations=Xa;j.Models=Ja;j.FineTuning=ze;j.Graders=ns;j.VectorStores=nn;j.Beta=yt;j.Batches=Ta;j.Uploads=as;j.Responses=rs;j.Evals=Qn;j.Containers=Xn;async function bc(s,e,t,n){var v,k,x,b,y,E,O;const r=Se(),a=xe(),i=r.selectedOpenRouterApiKey,o=a.settings.translationServices.services.find(I=>I.name==="OpenRouter"&&I.serviceType==="ai");if(!i)return console.error("OpenRouter API Key is not selected or available."),null;if(!o)return console.error("OpenRouter service configuration not found in text render settings."),null;const l=o.chosenModel;if(!l)return console.error("No OpenRouter model selected in settings."),null;const c=r.info,f=(v=r.settings)==null?void 0:v.aiPrompt;if(!c)return console.error("Study pack info not loaded."),null;if(!f)return console.error("AI prompt settings not loaded from study pack settings.json."),null;const d=c.languages.targetLanguage,h=c.languages.sourceLanguage;let u,m;e==="term"?(u=(k=f.term)==null?void 0:k.translation,m=(x=f.term)==null?void 0:x.note):(u=(b=f.line)==null?void 0:b.translation,m=(y=f.line)==null?void 0:y.note),u||(console.warn(`AI prompt setting for ${e} translation instruction is missing. Using default.`),u=e==="term"?`Provide the most accurate and common translation for the term from ${d} to ${h}. The translation should consist of the most popular translations of the given text (no more than five) and be separated by commas.`:`Translate the sentence(s) from ${d} to ${h}. The translation must be grammatically correct and sound natural, while preserving the original tone and meaning.`),t&&!m&&(console.warn(`AI prompt setting for ${e} note instruction is missing, but note generation was requested. Using default.`),m=e==="term"?`Briefly explain the choice of translation. If there are other common alternative translations for this term, mention them. The note should be written in ${h}.`:`In one or two sentences, explain any interesting cultural nuances, idioms, or non-obvious translation choices. If the translation is straightforward, state that. The note should be written in ${d}.`);const g=`
Context: You are an expert translator.

Text to translate: "${s}"

Instructions:
1. Translate the text according to this rule: ${u}.
${t&&m?`2. Generate a concise note based on this rule: ${m}.`:""}

Your response must be a valid JSON object.
It must contain a "translation" key with the translated text as a string.
${t?'It must also contain a "note" key with the generated note as a string.':'It must not contain a "note" key.'}

${n?`Here's another extra prompt for you: ${n}`:""}
`;console.log("Sending prompt to OpenRouter:",g);try{const T=(O=(E=(await new j({baseURL:"https://openrouter.ai/api/v1",apiKey:i,dangerouslyAllowBrowser:!0}).chat.completions.create({model:l,messages:[{role:"user",content:g}],response_format:{type:"json_object"}})).choices[0])==null?void 0:E.message)==null?void 0:O.content;if(!T)return console.error("OpenRouter API returned an empty or invalid response content."),null;console.log("Received raw response from OpenRouter:",T);let C;try{C=JSON.parse(T)}catch(F){return console.error("Failed to parse OpenRouter response as JSON:",F.message),console.error("Raw response text:",T),null}return typeof C!="object"||C===null?(console.error("OpenRouter response is not a valid JSON object."),null):typeof C.translation!="string"?(console.error('OpenRouter response JSON is missing the required "translation" string.'),null):(t&&typeof C.note!="string"?(console.warn('OpenRouter response JSON is missing the required "note" string, but note generation was requested.'),delete C.note):!t&&C.note!==void 0&&delete C.note,C)}catch(I){return console.error("Error calling OpenRouter API:",I.message||I),I.response&&console.error("OpenRouter API Error Details:",JSON.stringify(I.response.data,null,2)),null}}function vc(){const s=xe(),e=Se(),t=zt(),n=ll(),r=bi({status:"idle",result:null,error:null}),a=M(()=>{const f=s.settings.translationServices.chosenServiceName;return f&&s.settings.translationServices.services.find(d=>d.name===f)||null}),i=M(()=>{const f=a.value;return(f==null?void 0:f.serviceType)==="ai"&&s.settings.translationServices.generateNote});return{state:r,activeTranslationService:a,generateNote:i,checkCache:f=>{const d=n.getTranslation(f);return d?(r.status="success",r.result=d,r.error=null,!0):!1},translate:async(f,d,h)=>{var m,g,v,k,x,b;const u=a.value;if(!u){t.add({title:"Service Not Found",description:"No active translation service selected.",color:"error"});return}r.status="loading",r.result=null,r.error=null;try{let y=null;if(u.name==="Gemini"){if(!e.selectedGeminiApiKey)throw new Error("Gemini API key is not selected.");if(!u.chosenModel)throw new Error(`Model for ${u.name} is not selected.`);y=await ol(f,d,i.value??!1,h)}else if(u.name==="OpenRouter"){if(!e.selectedOpenRouterApiKey)throw new Error("OpenRouter API key is not selected.");if(!u.chosenModel)throw new Error(`Model for ${u.name} is not selected.`);y=await bc(f,d,i.value??!1,h)}else if(u.name==="Google Mirror 1")y=await cl(f,(m=e.info)==null?void 0:m.languages.targetLanguage,(g=e.info)==null?void 0:g.languages.sourceLanguage);else if(u.name==="Google Mirror 2")y=await ul(f,(v=e.info)==null?void 0:v.languages.targetLanguage,(k=e.info)==null?void 0:k.languages.sourceLanguage);else if(u.name==="MyMemory")y=await dl(f,(x=e.info)==null?void 0:x.languages.targetLanguage,(b=e.info)==null?void 0:b.languages.sourceLanguage);else{if(console.warn(`Service ${u.name} is simulated.`),await new Promise(E=>setTimeout(E,1e3)),f.toLowerCase().includes("error"))throw new Error("Simulated API error");y={translation:`Simulated translation for "${f.substring(0,30)}..."`,note:u.serviceType==="ai"&&i.value?`Simulated note for ${d}...`:void 0}}if(!y)throw new Error("Translation service returned no result.");r.result=y,r.status="success",n.addTranslation(f,y)}catch(y){console.error("Translation failed:",y),r.error=y.message||"An unknown error occurred during translation.",r.status="error",t.add({title:"Translation Error",description:`${r.error}`,color:"error",icon:"i-heroicons-x-circle"})}},reset:()=>{r.status="idle",r.result=null,r.error=null}}}const wc={class:"translation-and-note space-y-4"},xc={class:"translation-section"},Sc={class:"flex items-center gap-2 mb-2"},Cc=["innerHTML"],$c={key:0,class:"note-section"},Ac={class:"flex items-center gap-2 mb-2"},Ic=["innerHTML"],ri=Q({__name:"TranslationAndNote",props:{translation:{},note:{}},setup(s){const e=s;return(t,n)=>{const r=Jt;return S(),R("div",wc,[N("div",xc,[N("div",Sc,[w(r,{name:"i-heroicons-language",class:"w-5 h-5 text-primary-500"}),n[0]||(n[0]=N("h3",{class:"text-lg font-medium text-gray-900 dark:text-white"},"Translation",-1))]),N("p",{class:"pl-7 text-gray-700 dark:text-gray-300",innerHTML:e.translation},null,8,Cc)]),e.note&&e.translation?(S(),R("div",$c,[N("div",Ac,[w(r,{name:"i-heroicons-pencil-square",class:"w-5 h-5 text-primary-500"}),n[1]||(n[1]=N("h3",{class:"text-lg font-medium text-gray-900 dark:text-white"},"Note",-1))]),N("div",{class:"pl-7 prose dark:prose-invert max-w-none",innerHTML:e.note},null,8,Ic)])):B("",!0)])}}}),Ec={class:"space-y-4"},Rc={key:0},Oc={key:1,class:"text-center"},kc={key:3,class:"mt-4 text-sm text-red-500 dark:text-red-400 text-center"},Tc={key:4,class:"mt-4 text-sm text-gray-500 dark:text-gray-400 text-center"},os=Q({__name:"TranslationPanel",props:{textToTranslate:{},translationType:{},autoFetch:{type:Boolean},additionalPrompt:{}},setup(s){const e=s,{state:t,translate:n,checkCache:r,reset:a,activeTranslationService:i}=vc(),o=W(!1),l=M(()=>!e.textToTranslate||!i.value),c=M(()=>t.result?"Retry Translation":"Request Translation");async function f(){l.value||(o.value=!0,await n(e.textToTranslate,e.translationType,e.additionalPrompt))}return Ke(()=>e.textToTranslate,d=>{o.value=!1,d&&r(d)||a()},{immediate:!0}),Ue(()=>{var d;e.autoFetch&&!((d=t==null?void 0:t.result)!=null&&d.translation)&&f()}),(d,h)=>{var m,g,v,k;const u=me;return S(),R("div",Ec,[_(i)?B("",!0):(S(),R("div",Rc,h[0]||(h[0]=[N("p",{class:"text-sm text-yellow-500 dark:text-yellow-400"}," No translation service selected. Please select one in settings. ",-1)]))),w(u,{label:c.value,onClick:f,loading:_(t).status==="loading",disabled:l.value,icon:"i-heroicons-language-20-solid",class:"w-full justify-center cursor-pointer"},null,8,["label","loading","disabled"]),_(t).status==="loading"?(S(),R("div",Oc,h[1]||(h[1]=[N("p",{class:"text-sm animate-pulse text-gray-700 dark:text-gray-300"},"Translating...",-1)]))):B("",!0),_(t).status!=="loading"?(S(),G(ri,{key:2,translation:((g=(m=_(t))==null?void 0:m.result)==null?void 0:g.translation)??"",note:(k=(v=_(t))==null?void 0:v.result)==null?void 0:k.note},null,8,["translation","note"])):B("",!0),_(t).status==="error"?(S(),R("div",kc,ie(_(t).error),1)):B("",!0),_(t).status==="idle"&&o.value?(S(),R("div",Tc," No translation available. ")):B("",!0)])}}});function Nc(s,e={}){const{pageSize:t=10,delay:n=200}=e,r=W(null),a=W([]),i=W(!1),o=M(()=>a.value.length>=s.value.length),l=async()=>{if(!(i.value||o.value)){i.value=!0;try{n>0&&await new Promise(h=>setTimeout(h,n));const f=a.value.length,d=s.value.slice(f,f+t);a.value.push(...d)}finally{i.value=!1}}};Ke(s,f=>{a.value=f.slice(0,t)},{immediate:!0});let c=null;return Ue(()=>{c=new IntersectionObserver(f=>{f[0].isIntersecting&&l()},{root:null,threshold:.1}),r.value&&c.observe(r.value)}),vi(()=>{c&&c.disconnect()}),{visibleItems:a,trigger:r,isLoading:i,isFinished:o}}const Pc={class:"mt-0"},Mc={key:0},Fc={class:"font-semibold mb-2 text-gray-800 dark:text-gray-200"},Lc={class:"bg-gray-100 dark:bg-gray-800 rounded-md p-3 text-sm overflow-x-auto space-y-3"},Uc={key:0,class:"text-gray-500"},Dc={key:1,class:"text-gray-400 text-sm"},Bc={key:1},qc=Q({__name:"LexicalUnitMatcher",props:{unit:{}},setup(s){const e=s,t=Se(),n=c=>c.toLowerCase().replace(/[^\p{L}\p{N}\s-]/gu,"").trim(),r=M(()=>{const c=t.lexicalUnits;if(!c||!e.unit)return[];const f=[],d=new Set,h=n(e.unit.term);if(!h)return[];const u=(m,g)=>{d.has(m.id)||(f.push({...m,_matchPriority:g}),d.add(m.id))};for(const m of c){if(m.id===e.unit.id)continue;const g=n(m.term);if(!g)continue;if(g===h){u(m,1);continue}const v=3;let k="";for(let x=v;x<=Math.min(h.length,g.length)&&h.substring(0,x)===g.substring(0,x);x++)k=h.substring(0,x);if(k.length>=v){u(m,2);continue}if(h.startsWith(g)||g.startsWith(h)){u(m,3);continue}(h.includes(g)||g.includes(h))&&u(m,4)}return f.sort((m,g)=>m._matchPriority-g._matchPriority),f.map(({_matchPriority:m,...g})=>g)}),{visibleItems:a,trigger:i,isLoading:o,isFinished:l}=Nc(r,{pageSize:5});return(c,f)=>(S(),R("div",Pc,[r.value.length>0?(S(),R("div",Mc,[N("h3",Fc," Found "+ie(r.value.length)+" matching unit(s): ",1),N("div",Lc,[(S(!0),R(Me,null,Lt(_(a),d=>(S(),G(xr,{key:d.id,unit:d,"show-all":""},null,8,["unit"]))),128))]),N("div",{ref_key:"trigger",ref:i,class:"h-10 text-center pt-4"},[_(o)?(S(),R("p",Uc,"Loading more...")):B("",!0),_(l)&&!_(o)?(S(),R("p",Dc,"- End of results -")):B("",!0)],512)])):(S(),R("div",Bc,f[0]||(f[0]=[N("p",{class:"text-gray-500 dark:text-gray-400"},"No other matching units found.",-1)])))]))}}),jc={key:0,class:"p-2 min-w-[180px] max-w-[200px]"},Vc={key:0,class:"mb-1"},Gc=["src"],Wc=["src"],Hc={key:1,class:"p-0 m-0 text-center text-gray-600 dark:text-gray-400"},Kc={class:"p-0 m-0 mt-1 text-center max-h-20 overflow-auto"},zc={class:"flex justify-center pt-2"},Jc={class:"flex flex-row justify-between items-center mt-1"},Xc={key:1,class:"p-4 min-w-[200px]"},Yc=Q({__name:"LexicalUnitPopoverContent",props:{lexicalUnit:{}},emits:["statusChanged"],setup(s,{emit:e}){const t=s,n=e,r=M(()=>{var a;return(a=t.lexicalUnit)!=null&&a.img?Array.isArray(t.lexicalUnit.img)?t.lexicalUnit.img:[t.lexicalUnit.img]:[]});return(a,i)=>{const o=Ni,l=me,c=vr;return a.lexicalUnit?(S(),R("div",jc,[r.value.length>0?(S(),R("div",Vc,[r.value.length>1?(S(),G(o,{key:0,"auto-height":"",arrows:"",loop:"",items:r.value,ui:{container:"transition-[height]",controls:"absolute top-3 inset-x-10.5",dots:"-bottom-50",dot:"w-6 h-1"},class:"w-full max-w-xs mx-auto"},{default:A(({item:f})=>[N("img",{src:f,class:"rounded-lg shadow-md w-full h-30 object-contain mx-auto"},null,8,Gc)]),_:1},8,["items"])):(S(),R("img",{key:1,src:r.value[0],alt:"Lexical unit image",class:"rounded-lg shadow-md w-full h-30 object-contain mx-auto"},null,8,Wc))])):B("",!0),w(Or,{term:a.lexicalUnit.term},null,8,["term"]),a.lexicalUnit.transcription?(S(),R("p",Hc," /"+ie(a.lexicalUnit.transcription)+"/ ",1)):B("",!0),N("p",Kc,ie(a.lexicalUnit.translation),1),N("div",zc,[w(Pi,{"lexical-unit-id":a.lexicalUnit.id,onStatusChanged:i[0]||(i[0]=f=>n("statusChanged",f))},null,8,["lexical-unit-id"])]),N("div",Jc,[w(c,{description:"Find similiar terms"},{body:A(()=>[w(qc,{unit:a.lexicalUnit},null,8,["unit"])]),default:A(()=>[w(l,{variant:"secondary",size:"xl",icon:"i-heroicons-magnifying-glass",class:"cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700"})]),_:1}),w(c,{ui:{width:"sm:max-w-lg md:max-w-xl"},description:"Translation online"},{body:A(()=>[w(os,{"text-to-translate":a.lexicalUnit.term,"translation-type":"term","auto-fetch":!0},null,8,["text-to-translate"])]),default:A(()=>[w(l,{variant:"primary",size:"xl",icon:"i-heroicons-language",class:"cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 text-blue-500 font-bold"})]),_:1}),w(c,{description:"Lexical unit info"},{body:A(()=>[w(xr,{unit:a.lexicalUnit,"show-all":""},null,8,["unit"])]),default:A(()=>[w(l,{variant:"secondary",size:"xl",icon:"i-heroicons-information-circle",class:"cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700"})]),_:1})])])):(S(),R("div",Xc,i[1]||(i[1]=[N("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"No lexical unit data available.",-1)])))}}}),Qc={key:1,class:"p-2 min-w-[180px] max-w-[200px] max-h-[300px] overflow-auto"},Zc=Q({__name:"InteractiveToken",props:{token:{type:Object,required:!0}},setup(s){const e=s,t=xe(),n=Se(),r=W(!1),a=M(()=>{var l,c,f,d,h,u;const i=e.token,o=n.settings;return i.isWord?i.lexicalUnit?i.status&&((c=(l=o==null?void 0:o.statusStyles)==null?void 0:l[i.status])!=null&&c.reading)?(d=(f=o.statusStyles)==null?void 0:f[i.status])==null?void 0:d.reading:(u=(h=o==null?void 0:o.statusStyles)==null?void 0:h.new)!=null&&u.reading?o.statusStyles.new.reading:on:o!=null&&o.unknownUnit?o.unknownUnit:on:on});return(i,o)=>{const l=me,c=Tn;return S(),G(c,{mode:"click",arrow:"","open-delay":5,"close-delay":5,open:r.value,"onUpdate:open":o[1]||(o[1]=f=>r.value=f)},{content:A(()=>[s.token.lexicalUnit?(S(),G(Yc,{key:0,"lexical-unit":s.token.lexicalUnit,onStatusChanged:o[0]||(o[0]=f=>r.value=!1)},null,8,["lexical-unit"])):(S(),R("div",Qc,[w(Or,{term:s.token.text,class:"mb-1"},null,8,["term"]),w(os,{"text-to-translate":s.token.text,"translation-type":"term","auto-fetch":!0},null,8,["text-to-translate"])]))]),default:A(()=>[w(l,{variant:"primary",padded:!1,label:s.token.text,style:Nn({fontSize:`${_(t).settings.fontSize}px`}),class:fe([a.value,"text-left cursor-pointer"])},null,8,["label","style","class"])]),_:1},8,["open"])}}}),eu={class:"space-y-4"},tu={class:"max-h-30 overflow-y-auto space-y-1 border p-2 rounded-md bg-gray-50 dark:bg-gray-700/30"},nu=20,su=20,ru=Q({__name:"LineTranslation",props:{initialLineAbsoluteIndex:{}},setup(s){const e=s,t=xe(),n=W(new Set),r=W(null),a=W("");Ue(async()=>{e.initialLineAbsoluteIndex!==void 0&&n.value.add(e.initialLineAbsoluteIndex),await _r(),r.value&&r.value.scrollIntoView({block:"center",behavior:"auto"})});const i=M(()=>{const f=t.processedLines;if(!f.length)return[];const d=Math.max(0,e.initialLineAbsoluteIndex-nu),h=Math.min(f.length,e.initialLineAbsoluteIndex+su+1);return f.slice(d,h).map((u,m)=>{const g=d+m;return{originalIndex:g,text:u.originalText,isSelected:n.value.has(g),isInitial:g===e.initialLineAbsoluteIndex}})}),o=M(()=>Array.from(n.value).sort((d,h)=>d-h).map(d=>{var h;return((h=t.processedLines[d])==null?void 0:h.originalText)||""}).join(`
`));function l(f,d){return f.length<=d?f:f.substring(0,d)+"..."}function c(f,d){d?n.value.add(f):n.value.delete(f)}return Ke(()=>e.initialLineAbsoluteIndex,f=>{n.value.clear(),n.value.add(f)},{immediate:!0}),Ue(()=>{e.initialLineAbsoluteIndex!==void 0&&n.value.add(e.initialLineAbsoluteIndex)}),(f,d)=>{const h=Ui,u=Li,m=Fn;return S(),R("div",eu,[d[1]||(d[1]=N("h4",{class:"text-md font-medium text-gray-800 dark:text-gray-100"}," Select lines for translation: ",-1)),N("div",tu,[(S(!0),R(Me,null,Lt(i.value,g=>(S(),R("div",{key:g.originalIndex,class:"flex items-center",ref_for:!0,ref:v=>{g.isInitial&&v&&(r.value=v)}},[w(h,{modelValue:g.isSelected,"onUpdate:modelValue":[v=>g.isSelected=v,v=>c(g.originalIndex,v)],label:l(g.text,70),ui:{label:"text-sm truncate"},"container-class":g.isInitial?"font-semibold text-primary-500 dark:text-primary-400":""},null,8,["modelValue","onUpdate:modelValue","label","container-class"])]))),128))]),w(u,{class:"w-full",size:"xl",placeholder:"Additional prompt...",modelValue:a.value,"onUpdate:modelValue":d[0]||(d[0]=g=>a.value=g)},null,8,["modelValue"]),o.value?(S(),G(os,{key:0,"text-to-translate":o.value,"translation-type":"line","additional-prompt":a.value},null,8,["text-to-translate","additional-prompt"])):B("",!0),w(m),w(Rr)])}}}),au={class:"flex items-center"},iu={class:"flex flex-col"},ou={key:1},lu={key:0,class:"text-gray-500 dark:text-gray-400"},cu=Q({__name:"LineRenderer",props:{},setup(s){const e=W(!1),t=W(null),n=xe();Se();const r=c=>{const{currentPage:f,pageSize:d}=n.settings.pagination,h=(f-1)*d+c;h>=0&&h<n.processedLines.length?(t.value=h,e.value=!0):console.error("Calculated absolute index is out of bounds:",h)},a=M(()=>({fontSize:`${n.settings.fontSize}px`,margin:`${n.settings.fontSize*.7}px 0`,textAlign:n.settings.alignment})),i=zt(),o=c=>{navigator.clipboard.writeText(c).then(()=>{console.log("Line text copied to clipboard:",c),i.add({title:"Copied to Clipboard",description:"Line text copied successfully!",color:"success",duration:1e3,progress:!1,ui:{title:"text-success"}})}).catch(f=>{console.error("Failed to copy line text:",f),i.add({title:"Copy Failed",description:"Unable to copy line text to clipboard!",color:"error",duration:1e3,progress:!1,ui:{title:"text-error"}})})},l=async c=>{const f="target";try{await br(c,f),console.log(`Speaking line: "${c}"`)}catch(d){console.error("Failed to speak line:",d),i.add({title:"Speech Failed",description:"Unable to speak the line.",color:"error",duration:2e3})}};return(c,f)=>{const d=Jt,h=me,u=vr,m=Fn,g=Tn;return S(),R(Me,null,[(S(!0),R(Me,null,Lt(_(n).paginatedLines,(v,k)=>(S(),R("div",{key:v.id,class:"flex items-center"},[N("div",au,[w(g,{mode:"click",arrow:"",content:{align:"center",side:"top",sideOffset:0}},{content:A(()=>[N("div",iu,[w(h,{variant:"primary",size:"xl",icon:"i-heroicons-clipboard-document",class:"cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700",onClick:x=>o(v.originalText)},null,8,["onClick"]),w(h,{variant:"primary",size:"xl",icon:"i-heroicons-speaker-wave",class:"cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700",onClick:x=>l(v.originalText)},null,8,["onClick"]),v.translation||v.translation?(S(),G(u,{key:0,description:"Translation and note"},{body:A(()=>[w(ri,{note:v.note,translation:v.translation},null,8,["note","translation"])]),default:A(()=>[w(h,{variant:"secondary",size:"xl",icon:"i-heroicons-language",class:"cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700"})]),_:2},1024)):B("",!0),w(m),w(u,{modelValue:e.value,"onUpdate:modelValue":f[0]||(f[0]=x=>e.value=x),ui:{width:"sm:max-w-lg md:max-w-xl"},description:"Translation online"},{body:A(()=>[t.value!==null?(S(),G(ru,{key:0,"initial-line-absolute-index":t.value},null,8,["initial-line-absolute-index"])):B("",!0)]),default:A(()=>[w(h,{variant:"primary",size:"xl",icon:"i-heroicons-language",class:"cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 text-blue-500 font-bold",onClick:x=>r(k)},null,8,["onClick"])]),_:2},1032,["modelValue"])])]),default:A(()=>[w(h,{color:"gray","aria-label":"Line options",class:"cursor-pointer"},{default:A(()=>[w(d,{name:"i-heroicons-ellipsis-horizontal-circle",class:"size-8"})]),_:1})]),_:2},1024)]),N("p",{class:"flex-1 leading-relaxed pe-1",style:Nn(a.value)},[(S(!0),R(Me,null,Lt(v.tokens,(x,b)=>(S(),R(Me,{key:`token-${k}-${b}`},[x.isWord?(S(),G(Zc,{key:0,token:x},null,8,["token"])):(S(),R("span",ou,ie(x.text),1))],64))),128))],4)]))),128)),_(n).processedLines.length===0&&!_(n).isLoading?(S(),R("div",lu," No text content to display. ")):B("",!0)],64)}}}),uu={class:"flex flex-col items-center space-y-7"},du=Q({__name:"LexicalUnitsMiniFilter",setup(s){const e=Di(),t=Mi(),n=xe(),r=zt(),a=M(()=>{const c=new Set;return n.processedLines&&n.processedLines.forEach(f=>{f.tokens.forEach(d=>{d.isWord&&d.lexicalUnit&&c.add(d.lexicalUnit.id)})}),c}),i=()=>{e.resetFilterOptions()},o=async()=>{await e.applyFilters()},l=async()=>{await o();const c=e.filteredLexicalUnits.filter(f=>a.value.has(f.id));c.length<1?r.add({title:"No Cards Found",description:"No lexical units matching the selected filters were found in the current text.",color:"error",icon:"i-heroicons-information-circle"}):(t.endSession(),t.startSession(Bi(c)),wi.push({name:"flash_cards"}))};return Ue(()=>{i()}),(c,f)=>{const d=Pn,h=Mn,u=me;return S(),R("div",uu,[w(h,{label:"Select Statuses",ui:{label:"text-sm font-medium text-gray-700 dark:text-gray-300"},class:"mt-2"},{default:A(()=>[w(d,{modelValue:_(e).options.status.chosen,"onUpdate:modelValue":[f[0]||(f[0]=m=>_(e).options.status.chosen=m),f[1]||(f[1]=m=>_(e).updateStatusChosen(m))],items:_(At),multiple:"",placeholder:"Select statuses...","value-attribute":"value","option-attribute":"label",searchable:"",ui:{default:{option:{active:"bg-gray-100 dark:bg-gray-700"}}}},null,8,["modelValue","items"])]),_:1}),w(u,{onClick:l,label:"Start Flash Cards",size:"xl",icon:"i-heroicons-bolt-solid",color:"error",variant:"outline",ui:{rounded:"rounded-full",font:"font-bold"},class:"cursor-pointer animate-bounce"})])}}}),fu={class:"text-renderer space-y-2"},hu={class:"flex justify-between items-center"},mu={class:"flex items-center gap-x-2"},pu={key:0,class:"text-center py-5"},gu={key:1,class:"px-4 pt-2"},yu=["src","alt"],_u={key:1,class:"text-2xl font-bold mb-1 text-gray-900 dark:text-white"},bu={key:2,class:"text-md text-gray-700 dark:text-gray-300 mb-3"},vu=["innerHTML"],wu={key:3,class:"flex justify-between items-center p-4 z-20 space-x-2"},xu={class:"flex items-center space-x-1"},Su={class:"text-sm text-gray-500 dark:text-gray-400"},Cu=Q({__name:"TextRenderer",props:{material:{type:Object,required:!0}},setup(s){const e=s,t=Se(),n=xe(),r=W(!1),a=Un(),i=M(()=>e.material.text);M(()=>t.lexicalUnits?t.lexicalUnits.map(h=>({id:h.id,term:h.term})):[]),Ke([i,()=>t.lexicalUnits],([h],[u])=>{n.processText(h,t.lexicalUnits,t.status,t.settings),h!==u&&n.settings.pagination.currentPage!==1&&n.updatePaginationSettings({currentPage:1})},{immediate:!0,deep:!0});const o=M(()=>!n.settings.pagination.show||n.settings.pagination.pageSize<=0||n.processedLines.length===0?1:Math.ceil(n.processedLines.length/n.settings.pagination.pageSize)),l=(h,u=!0)=>{let m=Number(h);isNaN(m)&&(m=n.settings.pagination.currentPage);const g=o.value;m<1?m=1:m>g&&(m=g),m!==n.settings.pagination.currentPage&&(n.updatePaginationSettings({currentPage:m}),u&&_r(()=>{window.scrollTo({top:0,behavior:"smooth"})}))},c=()=>{const h=o.value;let u=n.settings.pagination.currentPage-1;u<1&&(u=h),l(u)},f=()=>{const h=o.value;let u=n.settings.pagination.currentPage+1;u>h&&(u=1),l(u)},d=M({get:()=>n.settings.pagination.currentPage,set:h=>{const u=Number(h);l(u,!1)}});return(h,u)=>{const m=Jt,g=me,v=Tn,k=io,x=Er;return S(),R("div",fu,[N("div",hu,[w(g,{onClick:u[0]||(u[0]=b=>_(a).clearMaterial()),color:"gray",class:"cursor-pointer"},{default:A(()=>[w(m,{name:"i-heroicons-arrow-left",class:"size-7"})]),_:1}),N("div",mu,[w(v,null,{content:A(()=>[w(du)]),default:A(()=>[w(g,{color:"gray","aria-label":"Open mini filter for flash cards",class:"cursor-pointer"},{default:A(()=>[w(m,{name:"i-heroicons-rectangle-stack",class:"size-7"})]),_:1})]),_:1}),w(k,{title:"Settings",open:r.value,"onUpdate:open":u[1]||(u[1]=b=>r.value=b)},{body:A(()=>[w(Eo)]),default:A(()=>[w(g,{color:"gray","aria-label":"Open settings",class:"cursor-pointer"},{default:A(()=>[w(m,{name:"i-heroicons-cog-6-tooth-20-solid",class:"size-7"})]),_:1})]),_:1},8,["open"])])]),_(n).isLoading?(S(),R("div",pu,u[4]||(u[4]=[N("p",{class:"text-gray-500 dark:text-gray-400"},"Processing text...",-1)]))):B("",!0),!_(n).isLoading&&e.material&&d.value===1?(S(),R("div",gu,[e.material.info.imageUrl?(S(),R("img",{key:0,src:e.material.info.imageUrl,alt:e.material.info.title||"Material image",class:"w-full h-auto object-cover rounded-md mb-4 max-h-72 max-w-[400px]",onError:u[2]||(u[2]=b=>b.target.style.display="none")},null,40,yu)):B("",!0),e.material.info.title?(S(),R("h1",_u,ie(e.material.info.title),1)):B("",!0),e.material.info.description?(S(),R("p",bu,ie(e.material.info.description),1)):B("",!0)])):B("",!0),e.material&&e.material.note&&_(n).settings.note.show?(S(),R("div",{key:2,class:fe(["w-full overflow-y-auto border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 p-3 z-10",_(n).settings.note.isSticky&&!r.value?"sticky top-0":""]),style:Nn({height:`${_(n).settings.note.height}px`}),innerHTML:e.material.note},null,14,vu)):B("",!0),w(cu),!_(n).isLoading&&_(n).settings.pagination.show&&o.value>1?(S(),R("div",wu,[w(g,{icon:"i-heroicons-chevron-left-20-solid",onClick:c,"aria-label":"Previous page",size:"xl",ui:{padding:{xl:"p-3 md:p-4"},icon:{size:{xl:"h-7 w-7 md:h-8 md:w-8"}}},class:"cursor-pointer"}),N("div",xu,[w(x,{modelValue:d.value,"onUpdate:modelValue":u[3]||(u[3]=b=>d.value=b),modelModifiers:{number:!0},size:"lg",min:1,max:o.value>0?o.value:1,class:"w-full",inputClass:"text-center","aria-label":"Current page number"},null,8,["modelValue","max"]),N("span",Su,"of "+ie(o.value),1)]),w(g,{icon:"i-heroicons-chevron-right-20-solid",onClick:f,"aria-label":"Next page",size:"xl",ui:{padding:{xl:"p-3 md:p-4"},icon:{size:{xl:"h-7 w-7 md:h-8 md:w-8"}}},class:"cursor-pointer"})])):B("",!0)])}}}),$u={class:"container mx-auto p-4 pt-0"},Au={key:0},Iu={key:1},Ku=Q({__name:"TextMaterialPage",setup(s){Se();const e=Un();return(t,n)=>(S(),R("div",$u,[N("div",null,[_(e).isMaterialLoaded?(S(),R("div",Iu,[w(Cu,{material:_(e).currentMaterial},null,8,["material"])])):(S(),R("div",Au,[n[0]||(n[0]=N("h2",{class:"text-2xl font-bold text-center mb-6 mt-3"},"Load a Text to Start Reading",-1)),w(so)]))])]))}});export{Ku as default};
