import{a5 as zt,q as M,h as C,a6 as Kt,a7 as Ht,a8 as Ie,a9 as Wt,aa as xt,d as V,f as Yt,t as Jt,g as Xt,ab as Se,ac as Ne,c as R,o as v,w as b,r as q,H as N,b as p,m as J,P as we,ad as W,$ as ie,p as ue,ae as se,af as Zt,ag as _t,G as S,F as w,I as K,L as h,_ as H,e as de,A as St,M as wt,N as Ct,ah as Qt,ai as en,B as be,C as Et,z as tn,aj as nn,ak as Be,al as sn,am as an,n as ze,j as Ke,k as B,an as Z,Q,K as ae,ao as Ce,ap as ve,V as Ee,aq as on,a0 as rn,J as xe,ar as Te,as as Oe,at as Me,a3 as $t,au as ln}from"./index-o-Ql71uG.js";import{u as un}from"./useFormControl-CuFmribr.js";import{c as cn,s as dn,_ as Ue}from"./Select-DvOsE8Bi.js";import{_ as mn,a as Fe,b as fn,s as It}from"./speechSynthesis-C6DToNi6.js";import{_ as pn,a as gn,b as hn,c as He,d as We,e as vn,f as yn,g as bn,h as Nt}from"./Modal-Ctbq4csM.js";import{_ as Pe}from"./Separator-CGNWvZxz.js";import{_ as Tt,a as kt,b as xn,c as _n,u as Sn}from"./LexicalUnitCard.vue_vue_type_script_setup_true_lang-dzvLg0gZ.js";import{_ as At}from"./Card-Bxc25-sb.js";import{_ as wn}from"./VoiceSettings.vue_vue_type_script_setup_true_lang-1aK7wNEz.js";import{_ as Cn}from"./Input-BYeRnMI1.js";import{_ as En,u as $n,s as In}from"./shuffleArray-BMSk6cvZ.js";import"./utils-D_kOh7ZV.js";function Nn(t){const e=zt({locale:M("en")});return C(()=>{var n;return(t==null?void 0:t.value)||((n=e.locale)==null?void 0:n.value)||"en"})}let ke=new Map,Re=!1;try{Re=new Intl.NumberFormat("de-DE",{signDisplay:"exceptZero"}).resolvedOptions().signDisplay==="exceptZero"}catch{}let _e=!1;try{_e=new Intl.NumberFormat("de-DE",{style:"unit",unit:"degree"}).resolvedOptions().style==="unit"}catch{}const Rt={degree:{narrow:{default:"°","ja-JP":" 度","zh-TW":"度","sl-SI":" °"}}};class Ot{format(e){let n="";if(!Re&&this.options.signDisplay!=null?n=kn(this.numberFormatter,this.options.signDisplay,e):n=this.numberFormatter.format(e),this.options.style==="unit"&&!_e){var s;let{unit:a,unitDisplay:i="short",locale:o}=this.resolvedOptions();if(!a)return n;let r=(s=Rt[a])===null||s===void 0?void 0:s[i];n+=r[o]||r.default}return n}formatToParts(e){return this.numberFormatter.formatToParts(e)}formatRange(e,n){if(typeof this.numberFormatter.formatRange=="function")return this.numberFormatter.formatRange(e,n);if(n<e)throw new RangeError("End date must be >= start date");return`${this.format(e)} – ${this.format(n)}`}formatRangeToParts(e,n){if(typeof this.numberFormatter.formatRangeToParts=="function")return this.numberFormatter.formatRangeToParts(e,n);if(n<e)throw new RangeError("End date must be >= start date");let s=this.numberFormatter.formatToParts(e),a=this.numberFormatter.formatToParts(n);return[...s.map(i=>({...i,source:"startRange"})),{type:"literal",value:" – ",source:"shared"},...a.map(i=>({...i,source:"endRange"}))]}resolvedOptions(){let e=this.numberFormatter.resolvedOptions();return!Re&&this.options.signDisplay!=null&&(e={...e,signDisplay:this.options.signDisplay}),!_e&&this.options.style==="unit"&&(e={...e,style:"unit",unit:this.options.unit,unitDisplay:this.options.unitDisplay}),e}constructor(e,n={}){this.numberFormatter=Tn(e,n),this.options=n}}function Tn(t,e={}){let{numberingSystem:n}=e;if(n&&t.includes("-nu-")&&(t.includes("-u-")||(t+="-u-"),t+=`-nu-${n}`),e.style==="unit"&&!_e){var s;let{unit:o,unitDisplay:r="short"}=e;if(!o)throw new Error('unit option must be provided with style: "unit"');if(!(!((s=Rt[o])===null||s===void 0)&&s[r]))throw new Error(`Unsupported unit ${o} with unitDisplay = ${r}`);e={...e,style:"decimal"}}let a=t+(e?Object.entries(e).sort((o,r)=>o[0]<r[0]?-1:1).join():"");if(ke.has(a))return ke.get(a);let i=new Intl.NumberFormat(t,e);return ke.set(a,i),i}function kn(t,e,n){if(e==="auto")return t.format(n);if(e==="never")return t.format(Math.abs(n));{let s=!1;if(e==="always"?s=n>0||Object.is(n,0):e==="exceptZero"&&(Object.is(n,-0)||Object.is(n,0)?n=Math.abs(n):s=n>0),s){let a=t.format(-n),i=t.format(n),o=a.replace(i,"").replace(/\u200e|\u061C/,"");return[...o].length!==1&&console.warn("@react-aria/i18n polyfill for NumberFormat signDisplay: Unsupported case"),a.replace(i,"!!!").replace(o,"+").replace("!!!",i)}else return t.format(n)}}const An=new RegExp("^.*\\(.*\\).*$"),Rn=["latn","arab","hanidec","deva","beng"];class Mt{parse(e){return Ae(this.locale,this.options,e).parse(e)}isValidPartialNumber(e,n,s){return Ae(this.locale,this.options,e).isValidPartialNumber(e,n,s)}getNumberingSystem(e){return Ae(this.locale,this.options,e).options.numberingSystem}constructor(e,n={}){this.locale=e,this.options=n}}const Ye=new Map;function Ae(t,e,n){let s=Je(t,e);if(!t.includes("-nu-")&&!s.isValidPartialNumber(n)){for(let a of Rn)if(a!==s.options.numberingSystem){let i=Je(t+(t.includes("-u-")?"-nu-":"-u-nu-")+a,e);if(i.isValidPartialNumber(n))return i}}return s}function Je(t,e){let n=t+(e?Object.entries(e).sort((a,i)=>a[0]<i[0]?-1:1).join():""),s=Ye.get(n);return s||(s=new On(t,e),Ye.set(n,s)),s}class On{parse(e){let n=this.sanitize(e);if(this.symbols.group&&(n=ce(n,this.symbols.group,"")),this.symbols.decimal&&(n=n.replace(this.symbols.decimal,".")),this.symbols.minusSign&&(n=n.replace(this.symbols.minusSign,"-")),n=n.replace(this.symbols.numeral,this.symbols.index),this.options.style==="percent"){let o=n.indexOf("-");n=n.replace("-","");let r=n.indexOf(".");r===-1&&(r=n.length),n=n.replace(".",""),r-2===0?n=`0.${n}`:r-2===-1?n=`0.0${n}`:r-2===-2?n="0.00":n=`${n.slice(0,r-2)}.${n.slice(r-2)}`,o>-1&&(n=`-${n}`)}let s=n?+n:NaN;if(isNaN(s))return NaN;if(this.options.style==="percent"){var a,i;let o={...this.options,style:"decimal",minimumFractionDigits:Math.min(((a=this.options.minimumFractionDigits)!==null&&a!==void 0?a:0)+2,20),maximumFractionDigits:Math.min(((i=this.options.maximumFractionDigits)!==null&&i!==void 0?i:0)+2,20)};return new Mt(this.locale,o).parse(new Ot(this.locale,o).format(s))}return this.options.currencySign==="accounting"&&An.test(e)&&(s=-1*s),s}sanitize(e){return e=e.replace(this.symbols.literals,""),this.symbols.minusSign&&(e=e.replace("-",this.symbols.minusSign)),this.options.numberingSystem==="arab"&&(this.symbols.decimal&&(e=e.replace(",",this.symbols.decimal),e=e.replace("،",this.symbols.decimal)),this.symbols.group&&(e=ce(e,".",this.symbols.group))),this.options.locale==="fr-FR"&&this.symbols.group&&(e=ce(e," ",this.symbols.group),e=ce(e,/\u00A0/g,this.symbols.group)),e}isValidPartialNumber(e,n=-1/0,s=1/0){return e=this.sanitize(e),this.symbols.minusSign&&e.startsWith(this.symbols.minusSign)&&n<0?e=e.slice(this.symbols.minusSign.length):this.symbols.plusSign&&e.startsWith(this.symbols.plusSign)&&s>0&&(e=e.slice(this.symbols.plusSign.length)),this.symbols.group&&e.startsWith(this.symbols.group)||this.symbols.decimal&&e.indexOf(this.symbols.decimal)>-1&&this.options.maximumFractionDigits===0?!1:(this.symbols.group&&(e=ce(e,this.symbols.group,"")),e=e.replace(this.symbols.numeral,""),this.symbols.decimal&&(e=e.replace(this.symbols.decimal,"")),e.length===0)}constructor(e,n={}){this.locale=e,n.roundingIncrement!==1&&n.roundingIncrement!=null&&(n.maximumFractionDigits==null&&n.minimumFractionDigits==null?(n.maximumFractionDigits=0,n.minimumFractionDigits=0):n.maximumFractionDigits==null?n.maximumFractionDigits=n.minimumFractionDigits:n.minimumFractionDigits==null&&(n.minimumFractionDigits=n.maximumFractionDigits)),this.formatter=new Intl.NumberFormat(e,n),this.options=this.formatter.resolvedOptions(),this.symbols=Un(e,this.formatter,this.options,n);var s,a;this.options.style==="percent"&&(((s=this.options.minimumFractionDigits)!==null&&s!==void 0?s:0)>18||((a=this.options.maximumFractionDigits)!==null&&a!==void 0?a:0)>18)&&console.warn("NumberParser cannot handle percentages with greater than 18 decimal places, please reduce the number in your options.")}}const Xe=new Set(["decimal","fraction","integer","minusSign","plusSign","group"]),Mn=[0,4,2,1,11,20,3,7,100,21,.1,1.1];function Un(t,e,n,s){var a,i,o,r;let u=new Intl.NumberFormat(t,{...n,minimumSignificantDigits:1,maximumSignificantDigits:21,roundingIncrement:1,roundingPriority:"auto",roundingMode:"halfExpand"}),l=u.formatToParts(-10000.111),m=u.formatToParts(10000.111),d=Mn.map(E=>u.formatToParts(E));var c;let g=(c=(a=l.find(E=>E.type==="minusSign"))===null||a===void 0?void 0:a.value)!==null&&c!==void 0?c:"-",f=(i=m.find(E=>E.type==="plusSign"))===null||i===void 0?void 0:i.value;!f&&((s==null?void 0:s.signDisplay)==="exceptZero"||(s==null?void 0:s.signDisplay)==="always")&&(f="+");let $=(o=new Intl.NumberFormat(t,{...n,minimumFractionDigits:2,maximumFractionDigits:2}).formatToParts(.001).find(E=>E.type==="decimal"))===null||o===void 0?void 0:o.value,I=(r=l.find(E=>E.type==="group"))===null||r===void 0?void 0:r.value,k=l.filter(E=>!Xe.has(E.type)).map(E=>Ze(E.value)),_=d.flatMap(E=>E.filter(D=>!Xe.has(D.type)).map(D=>Ze(D.value))),x=[...new Set([...k,..._])].sort((E,D)=>D.length-E.length),T=x.length===0?new RegExp("[\\p{White_Space}]","gu"):new RegExp(`${x.join("|")}|[\\p{White_Space}]`,"gu"),O=[...new Intl.NumberFormat(n.locale,{useGrouping:!1}).format(9876543210)].reverse(),L=new Map(O.map((E,D)=>[E,D])),U=new RegExp(`[${O.join("")}]`,"g");return{minusSign:g,plusSign:f,decimal:$,group:I,literals:T,numeral:U,index:E=>String(L.get(E))}}function ce(t,e,n){return t.replaceAll?t.replaceAll(e,n):t.split(e).join(n)}function Ze(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Ut(t){const{disabled:e}=t,n=M(),s=Wt(),a=()=>window.clearTimeout(n.value),i=c=>{a(),!e.value&&(s.trigger(),n.value=window.setTimeout(()=>{i(60)},c))},o=()=>{i(400)},r=()=>{a()},u=M(!1),l=C(()=>Kt(t.target)),m=c=>{c.button!==0||u.value||(c.preventDefault(),u.value=!0,o())},d=()=>{u.value=!1,r()};return Ht&&(Ie(l||window,"pointerdown",m),Ie(window,"pointerup",d),Ie(window,"pointercancel",d)),{isPressed:u,onTrigger:s.on}}function Qe(t,e=M({})){return xt(()=>new Ot(t.value,e.value))}function Fn(t,e=M({})){return xt(()=>new Mt(t.value,e.value))}function et(t,e,n){let s=t==="+"?e+n:e-n;if(e%1!==0||n%1!==0){const a=e.toString().split("."),i=n.toString().split("."),o=a[1]&&a[1].length||0,r=i[1]&&i[1].length||0,u=10**Math.max(o,r);e=Math.round(e*u),n=Math.round(n*u),s=t==="+"?e+n:e-n,s/=u}return s}const[Le,Pn]=Yt("NumberFieldRoot"),Ln=V({inheritAttrs:!1,__name:"NumberFieldRoot",props:{defaultValue:{default:void 0},modelValue:{},min:{},max:{},step:{default:1},stepSnapping:{type:Boolean,default:!0},formatOptions:{},locale:{},disabled:{type:Boolean},disableWheelChange:{type:Boolean},invertWheelChange:{type:Boolean},id:{},asChild:{type:Boolean},as:{default:"div"},name:{},required:{type:Boolean}},emits:["update:modelValue"],setup(t,{emit:e}){const n=t,s=e,{disabled:a,disableWheelChange:i,invertWheelChange:o,min:r,max:u,step:l,stepSnapping:m,formatOptions:d,id:c,locale:g}=Jt(n),f=Xt(n,"modelValue",s,{defaultValue:n.defaultValue,passive:n.modelValue===void 0}),{primitiveElement:y,currentElement:$}=Se(),I=Nn(g),k=un($),_=M(),x=C(()=>!Ne(f.value)&&(Y(f.value)===r.value||r.value&&!isNaN(f.value)?et("-",f.value,l.value)<r.value:!1)),T=C(()=>!Ne(f.value)&&(Y(f.value)===u.value||u.value&&!isNaN(f.value)?et("+",f.value,l.value)>u.value:!1));function O(A,G=1){var qe,je;(qe=_.value)==null||qe.focus();const $e=D.parse(((je=_.value)==null?void 0:je.value)??"");n.disabled||(isNaN($e)?f.value=r.value??0:A==="increase"?f.value=Y($e+(l.value??1)*G):f.value=Y($e-(l.value??1)*G))}function L(A=1){O("increase",A)}function U(A=1){O("decrease",A)}function F(A){A==="min"&&r.value!==void 0?f.value=Y(r.value):A==="max"&&u.value!==void 0&&(f.value=Y(u.value))}const E=Qe(I,d),D=Fn(I,d),ne=C(()=>E.resolvedOptions().maximumFractionDigits>0?"decimal":"numeric"),P=Qe(I,d),re=C(()=>Ne(f.value)||isNaN(f.value)?"":P.format(f.value));function z(A){return D.isValidPartialNumber(A,r.value,u.value)}function X(A){_.value&&(_.value.value=A)}function Y(A){let G;return l.value===void 0||isNaN(l.value)||!m.value?G=cn(A,r.value,u.value):G=dn(A,r.value,u.value,l.value),G=D.parse(E.format(G)),G}function he(A){const G=D.parse(A);return f.value=isNaN(G)?void 0:Y(G),A.length?(isNaN(G),X(re.value)):X(A)}return Pn({modelValue:f,handleDecrease:U,handleIncrease:L,handleMinMaxValue:F,inputMode:ne,inputEl:_,onInputElement:A=>_.value=A,textValue:re,validate:z,applyInputValue:he,disabled:a,disableWheelChange:i,invertWheelChange:o,max:u,min:r,isDecreaseDisabled:x,isIncreaseDisabled:T,id:c}),(A,G)=>(v(),R(p(we),J(A.$attrs,{ref_key:"primitiveElement",ref:y,role:"group",as:A.as,"as-child":A.asChild,"data-disabled":p(a)?"":void 0}),{default:b(()=>[q(A.$slots,"default",{modelValue:p(f),textValue:re.value}),p(k)&&A.name?(v(),R(p(mn),{key:0,type:"text",value:p(f),name:A.name,disabled:p(a),required:A.required},null,8,["value","name","disabled","required"])):N("",!0)]),_:3},16,["as","as-child","data-disabled"]))}}),Dn=V({__name:"NumberFieldDecrement",props:{disabled:{type:Boolean},asChild:{type:Boolean},as:{default:"button"}},setup(t){const e=t,n=Le(),s=C(()=>{var u;return((u=n.disabled)==null?void 0:u.value)||e.disabled||n.isDecreaseDisabled.value}),{primitiveElement:a,currentElement:i}=Se(),{isPressed:o,onTrigger:r}=Ut({target:i,disabled:s});return r(()=>{n.handleDecrease()}),(u,l)=>(v(),R(p(we),J(e,{ref_key:"primitiveElement",ref:a,tabindex:"-1","aria-label":"Decrease",type:u.as==="button"?"button":void 0,style:{userSelect:p(o)?"none":void 0},disabled:s.value?"":void 0,"data-disabled":s.value?"":void 0,"data-pressed":p(o)?"true":void 0,onContextmenu:l[0]||(l[0]=W(()=>{},["prevent"]))}),{default:b(()=>[q(u.$slots,"default")]),_:3},16,["type","style","disabled","data-disabled","data-pressed"]))}}),Vn=V({__name:"NumberFieldIncrement",props:{disabled:{type:Boolean},asChild:{type:Boolean},as:{default:"button"}},setup(t){const e=t,n=Le(),s=C(()=>{var u;return((u=n.disabled)==null?void 0:u.value)||e.disabled||n.isIncreaseDisabled.value}),{primitiveElement:a,currentElement:i}=Se(),{isPressed:o,onTrigger:r}=Ut({target:i,disabled:s});return r(()=>{n.handleIncrease()}),(u,l)=>(v(),R(p(we),J(e,{ref_key:"primitiveElement",ref:a,tabindex:"-1","aria-label":"Increase",type:u.as==="button"?"button":void 0,style:{userSelect:p(o)?"none":void 0},disabled:s.value?"":void 0,"data-disabled":s.value?"":void 0,"data-pressed":p(o)?"true":void 0,onContextmenu:l[0]||(l[0]=W(()=>{},["prevent"]))}),{default:b(()=>[q(u.$slots,"default")]),_:3},16,["type","style","disabled","data-disabled","data-pressed"]))}}),Gn=V({__name:"NumberFieldInput",props:{asChild:{type:Boolean},as:{default:"input"}},setup(t){const e=t,{primitiveElement:n,currentElement:s}=Se(),a=Le();function i(u){a.disableWheelChange.value||u.target===Zt()&&(Math.abs(u.deltaY)<=Math.abs(u.deltaX)||(u.preventDefault(),u.deltaY>0?a.invertWheelChange.value?a.handleDecrease():a.handleIncrease():u.deltaY<0&&(a.invertWheelChange.value?a.handleIncrease():a.handleDecrease())))}ie(()=>{a.onInputElement(s.value)});const o=M(a.textValue.value);ue(()=>a.textValue.value,()=>{o.value=a.textValue.value},{immediate:!0,deep:!0});function r(){requestAnimationFrame(()=>{o.value=a.textValue.value})}return(u,l)=>(v(),R(p(we),J(e,{id:p(a).id.value,ref_key:"primitiveElement",ref:n,value:o.value,role:"spinbutton",type:"text",tabindex:"0",inputmode:p(a).inputMode.value,disabled:p(a).disabled.value?"":void 0,"data-disabled":p(a).disabled.value?"":void 0,autocomplete:"off",autocorrect:"off",spellcheck:"false","aria-roledescription":"Number field","aria-valuenow":p(a).modelValue.value,"aria-valuemin":p(a).min.value,"aria-valuemax":p(a).max.value,onKeydown:[l[0]||(l[0]=se(W(m=>p(a).handleIncrease(),["prevent"]),["up"])),l[1]||(l[1]=se(W(m=>p(a).handleDecrease(),["prevent"]),["down"])),l[2]||(l[2]=se(W(m=>p(a).handleIncrease(10),["prevent"]),["page-up"])),l[3]||(l[3]=se(W(m=>p(a).handleDecrease(10),["prevent"]),["page-down"])),l[4]||(l[4]=se(W(m=>p(a).handleMinMaxValue("min"),["prevent"]),["home"])),l[5]||(l[5]=se(W(m=>p(a).handleMinMaxValue("max"),["prevent"]),["end"])),l[8]||(l[8]=se(m=>{var d;return p(a).applyInputValue((d=m.target)==null?void 0:d.value)},["enter"]))],onWheel:i,onBeforeinput:l[6]||(l[6]=m=>{const d=m.target;let c=d.value.slice(0,d.selectionStart??void 0)+(m.data??"")+d.value.slice(d.selectionEnd??void 0);p(a).validate(c)||m.preventDefault()}),onInput:l[7]||(l[7]=m=>{const d=m.target;o.value=d.value}),onChange:r,onBlur:l[9]||(l[9]=m=>{var d;return p(a).applyInputValue((d=m.target)==null?void 0:d.value)})}),{default:b(()=>[q(u.$slots,"default")]),_:3},16,["id","value","inputmode","disabled","data-disabled","aria-valuenow","aria-valuemin","aria-valuemax"]))}}),De=_t("textMaterials",{state:()=>({currentMaterial:null,isLoading:!1}),actions:{async loadMaterialFromFile(t){this.isLoading=!0,this.currentMaterial=null;try{const e=await t.text();let n;if(t.name.endsWith(".json")){const s=JSON.parse(e);if(typeof s=="object"&&!Array.isArray(s)&&s.content){const a=s;n={info:{title:a.title||t.name,description:a.description,imageUrl:a.img},text:a.content,note:a.note}}else if(Array.isArray(s))n={info:{title:t.name},text:s};else throw new Error('Invalid JSON structure. Expected an object with a "content" key or an array of segments.')}else if(t.name.endsWith(".txt")){const a=e.split(`
`).filter(i=>i.trim()!=="").map(i=>({text:i}));n={info:{title:t.name},text:a}}else throw new Error("Unsupported file type. Please use .json or .txt");this.currentMaterial=n}catch(e){console.error("Failed to load text material:",e),this.currentMaterial=null}finally{this.isLoading=!1}},clearMaterial(){this.currentMaterial=null}},getters:{isMaterialLoaded(){return this.currentMaterial!==null}}}),qn={class:"w-full max-w-2xl mx-auto text-center"},jn={key:0,class:"mt-4"},Bn=V({__name:"TextMaterialLoader",setup(t){const e=De(),n=M(!1),s=M(null);async function a(u){u&&await e.loadMaterialFromFile(u)}function i(){var u;(u=s.value)==null||u.click()}async function o(u){const l=u.target;l.files&&l.files.length>0&&(await a(l.files[0]),l.value="")}async function r(u){if(n.value=!1,u.dataTransfer&&u.dataTransfer.files&&u.dataTransfer.files.length>0){const l=u.dataTransfer.files[0];await a(l)}}return(u,l)=>{const m=H;return v(),S("div",qn,[w("input",{ref_key:"fileInput",ref:s,type:"file",onChange:o,accept:".json,.txt",class:"hidden"},null,544),w("div",{onDragover:l[0]||(l[0]=W(d=>n.value=!0,["prevent"])),onDragleave:l[1]||(l[1]=W(d=>n.value=!1,["prevent"])),onDrop:W(r,["prevent"]),class:K(["border-2 border-dashed rounded-lg p-10 cursor-pointer transition-colors",{"border-primary-500 dark:border-primary-400 bg-primary-50 dark:bg-primary-900/10":n.value,"border-gray-300 dark:border-gray-600 hover:border-gray-400 dark:hover:border-gray-500":!n.value}])},[l[3]||(l[3]=w("p",{class:"text-gray-500 dark:text-gray-400"},"Drag & Drop your Text file here",-1)),l[4]||(l[4]=w("p",{class:"mt-2 text-sm text-gray-400 dark:text-gray-500"},"(.txt or .json)",-1)),l[5]||(l[5]=w("p",{class:"mt-2 text-sm text-gray-400 dark:text-gray-500"},"or",-1)),h(m,{onClick:i,class:"mt-2"},{default:b(()=>l[2]||(l[2]=[de("Select File")])),_:1,__:[2]})],34),p(e).isLoading?(v(),S("div",jn,l[6]||(l[6]=[w("p",{class:"text-lg animate-pulse text-gray-700 dark:text-gray-300"},"Loading Text...",-1)]))):N("",!0)])}}}),zn={slots:{root:"relative inline-flex items-center",base:["w-full rounded-md border-0 placeholder:text-dimmed focus:outline-none disabled:cursor-not-allowed disabled:opacity-75","transition-colors"],increment:"absolute flex items-center",decrement:"absolute flex items-center"},variants:{buttonGroup:{horizontal:{root:"group has-focus-visible:z-[1]",base:"group-not-only:group-first:rounded-e-none group-not-only:group-last:rounded-s-none group-not-last:group-not-first:rounded-none"},vertical:{root:"group has-focus-visible:z-[1]",base:"group-not-only:group-first:rounded-b-none group-not-only:group-last:rounded-t-none group-not-last:group-not-first:rounded-none"}},color:{primary:"",secondary:"",success:"",info:"",warning:"",error:"",neutral:""},size:{xs:"px-2 py-1 text-xs gap-1",sm:"px-2.5 py-1.5 text-xs gap-1.5",md:"px-2.5 py-1.5 text-sm gap-1.5",lg:"px-3 py-2 text-sm gap-2",xl:"px-3 py-2 text-base gap-2"},variant:{outline:"text-highlighted bg-default ring ring-inset ring-accented",soft:"text-highlighted bg-elevated/50 hover:bg-elevated focus:bg-elevated disabled:bg-elevated/50",subtle:"text-highlighted bg-elevated ring ring-inset ring-accented",ghost:"text-highlighted bg-transparent hover:bg-elevated focus:bg-elevated disabled:bg-transparent dark:disabled:bg-transparent",none:"text-highlighted bg-transparent"},disabled:{true:{increment:"opacity-75 cursor-not-allowed",decrement:"opacity-75 cursor-not-allowed"}},orientation:{horizontal:{base:"text-center",increment:"inset-y-0 end-0 pe-1",decrement:"inset-y-0 start-0 ps-1"},vertical:{increment:"top-0 end-0 pe-1 [&>button]:py-0 scale-80",decrement:"bottom-0 end-0 pe-1 [&>button]:py-0 scale-80"}},highlight:{true:""}},compoundVariants:[{color:"primary",variant:["outline","subtle"],class:"focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-primary"},{color:"secondary",variant:["outline","subtle"],class:"focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-secondary"},{color:"success",variant:["outline","subtle"],class:"focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-success"},{color:"info",variant:["outline","subtle"],class:"focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-info"},{color:"warning",variant:["outline","subtle"],class:"focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-warning"},{color:"error",variant:["outline","subtle"],class:"focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-error"},{color:"primary",highlight:!0,class:"ring ring-inset ring-primary"},{color:"secondary",highlight:!0,class:"ring ring-inset ring-secondary"},{color:"success",highlight:!0,class:"ring ring-inset ring-success"},{color:"info",highlight:!0,class:"ring ring-inset ring-info"},{color:"warning",highlight:!0,class:"ring ring-inset ring-warning"},{color:"error",highlight:!0,class:"ring ring-inset ring-error"},{color:"neutral",variant:["outline","subtle"],class:"focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-inverted"},{color:"neutral",highlight:!0,class:"ring ring-inset ring-inverted"},{orientation:"horizontal",size:"xs",class:"px-7"},{orientation:"horizontal",size:"sm",class:"px-8"},{orientation:"horizontal",size:"md",class:"px-9"},{orientation:"horizontal",size:"lg",class:"px-10"},{orientation:"horizontal",size:"xl",class:"px-11"},{orientation:"vertical",size:"xs",class:"pe-7"},{orientation:"vertical",size:"sm",class:"pe-8"},{orientation:"vertical",size:"md",class:"pe-9"},{orientation:"vertical",size:"lg",class:"pe-10"},{orientation:"vertical",size:"xl",class:"pe-11"}],defaultVariants:{size:"md",color:"primary",variant:"outline"}},Ft=Object.assign({inheritAttrs:!1},{__name:"InputNumber",props:{as:{type:null,required:!1},placeholder:{type:String,required:!1},color:{type:null,required:!1},variant:{type:null,required:!1},size:{type:null,required:!1},highlight:{type:Boolean,required:!1},orientation:{type:String,required:!1,default:"horizontal"},increment:{type:Object,required:!1},incrementIcon:{type:String,required:!1},incrementDisabled:{type:Boolean,required:!1},decrement:{type:Object,required:!1},decrementIcon:{type:String,required:!1},decrementDisabled:{type:Boolean,required:!1},autofocus:{type:Boolean,required:!1},autofocusDelay:{type:Number,required:!1},locale:{type:String,required:!1},class:{type:null,required:!1},ui:{type:null,required:!1},modelValue:{type:[Number,null],required:!1},defaultValue:{type:Number,required:!1},min:{type:Number,required:!1},max:{type:Number,required:!1},step:{type:Number,required:!1},stepSnapping:{type:Boolean,required:!1},disabled:{type:Boolean,required:!1},required:{type:Boolean,required:!1},id:{type:String,required:!1},name:{type:String,required:!1},formatOptions:{type:null,required:!1},disableWheelChange:{type:Boolean,required:!1}},emits:["update:modelValue","blur","change"],setup(t,{expose:e,emit:n}){const s=t,a=n,{t:i,code:o}=St(),r=Et(),u=wt(Ct(s,"as","modelValue","defaultValue","min","max","step","stepSnapping","formatOptions","disableWheelChange"),a),{emitFormBlur:l,emitFormFocus:m,emitFormChange:d,emitFormInput:c,id:g,color:f,size:y,name:$,highlight:I,disabled:k,ariaAttrs:_}=Qt(s),{orientation:x,size:T}=en(s),O=C(()=>s.locale||o.value),L=C(()=>T.value||y.value),U=C(()=>{var z;return be({extend:be(zn),...((z=r.ui)==null?void 0:z.inputNumber)||{}})({color:f.value,variant:s.variant,size:L.value,highlight:I.value,orientation:s.orientation,buttonGroup:x.value})}),F=C(()=>s.incrementIcon||(s.orientation==="horizontal"?r.ui.icons.plus:r.ui.icons.chevronUp)),E=C(()=>s.decrementIcon||(s.orientation==="horizontal"?r.ui.icons.minus:r.ui.icons.chevronDown)),D=M(null);function ne(z){const X=new Event("change",{target:{value:z}});a("change",X),d(),c()}function P(z){l(),a("blur",z)}function re(){var z,X;s.autofocus&&((X=(z=D.value)==null?void 0:z.$el)==null||X.focus())}return ie(()=>{setTimeout(()=>{re()},s.autofocusDelay)}),e({inputRef:D}),(z,X)=>{var Y;return v(),R(p(Ln),J(p(u),{id:p(g),class:U.value.root({class:[(Y=s.ui)==null?void 0:Y.root,s.class]}),name:p($),disabled:p(k),locale:O.value,"onUpdate:modelValue":ne}),{default:b(()=>{var he,A,G;return[h(p(Gn),J({...z.$attrs,...p(_)},{ref_key:"inputRef",ref:D,placeholder:t.placeholder,required:t.required,class:U.value.base({class:(he=s.ui)==null?void 0:he.base}),onBlur:P,onFocus:p(m)}),null,16,["placeholder","required","class","onFocus"]),w("div",{class:K(U.value.increment({class:(A=s.ui)==null?void 0:A.increment}))},[h(p(Vn),{"as-child":"",disabled:p(k)||t.incrementDisabled},{default:b(()=>[q(z.$slots,"increment",{},()=>[h(H,J({icon:F.value,color:p(f),size:t.size,variant:"link","aria-label":p(i)("inputNumber.increment")},typeof t.increment=="object"?t.increment:void 0),null,16,["icon","color","size","aria-label"])])]),_:3},8,["disabled"])],2),w("div",{class:K(U.value.decrement({class:(G=s.ui)==null?void 0:G.decrement}))},[h(p(Dn),{"as-child":"",disabled:p(k)||t.decrementDisabled},{default:b(()=>[q(z.$slots,"decrement",{},()=>[h(H,J({icon:E.value,color:p(f),size:t.size,variant:"link","aria-label":p(i)("inputNumber.decrement")},typeof t.decrement=="object"?t.decrement:void 0),null,16,["icon","color","size","aria-label"])])]),_:3},8,["disabled"])],2)]}),_:3},16,["id","class","name","disabled","locale"])}}}),Kn={slots:{overlay:"fixed inset-0 bg-elevated/75",content:"fixed bg-default divide-y divide-default sm:ring ring-default sm:shadow-lg flex flex-col focus:outline-none",header:"flex items-center gap-1.5 p-4 sm:px-6 min-h-16",wrapper:"",body:"flex-1 overflow-y-auto p-4 sm:p-6",footer:"flex items-center gap-1.5 p-4 sm:px-6",title:"text-highlighted font-semibold",description:"mt-1 text-muted text-sm",close:"absolute top-4 end-4"},variants:{side:{top:{content:"inset-x-0 top-0 max-h-full"},right:{content:"right-0 inset-y-0 w-full max-w-md"},bottom:{content:"inset-x-0 bottom-0 max-h-full"},left:{content:"left-0 inset-y-0 w-full max-w-md"}},transition:{true:{overlay:"data-[state=open]:animate-[fade-in_200ms_ease-out] data-[state=closed]:animate-[fade-out_200ms_ease-in]"}}},compoundVariants:[{transition:!0,side:"top",class:{content:"data-[state=open]:animate-[slide-in-from-top_200ms_ease-in-out] data-[state=closed]:animate-[slide-out-to-top_200ms_ease-in-out]"}},{transition:!0,side:"right",class:{content:"data-[state=open]:animate-[slide-in-from-right_200ms_ease-in-out] data-[state=closed]:animate-[slide-out-to-right_200ms_ease-in-out]"}},{transition:!0,side:"bottom",class:{content:"data-[state=open]:animate-[slide-in-from-bottom_200ms_ease-in-out] data-[state=closed]:animate-[slide-out-to-bottom_200ms_ease-in-out]"}},{transition:!0,side:"left",class:{content:"data-[state=open]:animate-[slide-in-from-left_200ms_ease-in-out] data-[state=closed]:animate-[slide-out-to-left_200ms_ease-in-out]"}}]},Hn={__name:"Slideover",props:{title:{type:String,required:!1},description:{type:String,required:!1},content:{type:Object,required:!1},overlay:{type:Boolean,required:!1,default:!0},transition:{type:Boolean,required:!1,default:!0},side:{type:null,required:!1,default:"right"},portal:{type:[Boolean,String],required:!1,skipCheck:!0,default:!0},close:{type:[Boolean,Object],required:!1,default:!0},closeIcon:{type:String,required:!1},dismissible:{type:Boolean,required:!1,default:!0},class:{type:null,required:!1},ui:{type:null,required:!1},open:{type:Boolean,required:!1},defaultOpen:{type:Boolean,required:!1},modal:{type:Boolean,required:!1,default:!0}},emits:["after:leave","after:enter","close:prevent","update:open"],setup(t,{emit:e}){const n=t,s=e,a=tn(),{t:i}=St(),o=Et(),r=wt(Ct(n,"open","defaultOpen","modal"),s),u=nn(Be(()=>n.portal)),l=Be(()=>n.content),m=C(()=>{const c={closeAutoFocus:g=>g.preventDefault()};return n.dismissible?c:["pointerDownOutside","interactOutside","escapeKeyDown","closeAutoFocus"].reduce((f,y)=>(f[y]=$=>{$.preventDefault(),s("close:prevent")},f),{})}),d=C(()=>{var c;return be({extend:be(Kn),...((c=o.ui)==null?void 0:c.slideover)||{}})({transition:n.transition,side:n.side})});return(c,g)=>(v(),R(p(yn),ze(Ke(p(r))),{default:b(({open:f})=>[a.default?(v(),R(p(pn),{key:0,"as-child":"",class:K(n.class)},{default:b(()=>[q(c.$slots,"default",{open:f})]),_:2},1032,["class"])):N("",!0),h(p(vn),ze(Ke(p(u))),{default:b(()=>{var y,$;return[t.overlay?(v(),R(p(gn),{key:0,class:K(d.value.overlay({class:(y=n.ui)==null?void 0:y.overlay}))},null,8,["class"])):N("",!0),h(p(hn),J({"data-side":t.side,class:d.value.content({class:[!a.default&&n.class,($=n.ui)==null?void 0:$.content]})},l.value,{onAfterEnter:g[0]||(g[0]=I=>s("after:enter")),onAfterLeave:g[1]||(g[1]=I=>s("after:leave"))},sn(m.value)),{default:b(()=>[a.content&&(t.title||a.title||t.description||a.description)?(v(),R(p(an),{key:0},{default:b(()=>[t.title||a.title?(v(),R(p(He),{key:0},{default:b(()=>[q(c.$slots,"title",{},()=>[de(B(t.title),1)])]),_:3})):N("",!0),t.description||a.description?(v(),R(p(We),{key:1},{default:b(()=>[q(c.$slots,"description",{},()=>[de(B(t.description),1)])]),_:3})):N("",!0)]),_:3})):N("",!0),q(c.$slots,"content",{},()=>{var I,k,_;return[a.header||t.title||a.title||t.description||a.description||t.close||a.close?(v(),S("div",{key:0,class:K(d.value.header({class:(I=n.ui)==null?void 0:I.header}))},[q(c.$slots,"header",{},()=>{var x,T,O;return[w("div",{class:K(d.value.wrapper({class:(x=n.ui)==null?void 0:x.wrapper}))},[t.title||a.title?(v(),R(p(He),{key:0,class:K(d.value.title({class:(T=n.ui)==null?void 0:T.title}))},{default:b(()=>[q(c.$slots,"title",{},()=>[de(B(t.title),1)])]),_:3},8,["class"])):N("",!0),t.description||a.description?(v(),R(p(We),{key:1,class:K(d.value.description({class:(O=n.ui)==null?void 0:O.description}))},{default:b(()=>[q(c.$slots,"description",{},()=>[de(B(t.description),1)])]),_:3},8,["class"])):N("",!0)],2),t.close||a.close?(v(),R(p(bn),{key:0,"as-child":""},{default:b(()=>[q(c.$slots,"close",{ui:d.value},()=>{var L;return[t.close?(v(),R(H,J({key:0,icon:t.closeIcon||p(o).ui.icons.close,size:"md",color:"neutral",variant:"ghost","aria-label":p(i)("slideover.close")},typeof t.close=="object"?t.close:{},{class:d.value.close({class:(L=n.ui)==null?void 0:L.close})}),null,16,["icon","aria-label","class"])):N("",!0)]})]),_:3})):N("",!0)]})],2)):N("",!0),w("div",{class:K(d.value.body({class:(k=n.ui)==null?void 0:k.body}))},[q(c.$slots,"body")],2),a.footer?(v(),S("div",{key:1,class:K(d.value.footer({class:(_=n.ui)==null?void 0:_.footer}))},[q(c.$slots,"footer")],2)):N("",!0)]})]),_:3},16,["data-side","class"])]}),_:3},16)]),_:3},16))}},Wn={class:"space-y-4"},Yn={key:0},Jn={key:0,class:"mt-3"},Xn={key:1,class:"mt-3 text-sm text-gray-500 dark:text-gray-400"},Zn={key:2,class:"mt-3 text-sm text-red-600 dark:text-red-400"},Qn={key:1,class:"text-sm text-gray-500 dark:text-gray-400"},es={key:2,class:"text-sm text-yellow-600 dark:text-yellow-400"},ts={key:3,class:"text-sm text-gray-500 dark:text-gray-400"},ns={key:4,class:"text-sm text-gray-500 dark:text-gray-400"},Pt=V({__name:"TranslationServiceSettings",setup(t){const e=Z(),n=Q(),s=C({get:()=>e.settings.translationServices.generateNote,set:d=>e.setGenerateNote(d)}),a=C({get:()=>e.settings.translationServices.chosenServiceName,set:d=>e.setChosenTranslationServiceName(d)}),i=C(()=>e.settings.translationServices.services.map(d=>({label:d.name,value:d.name}))),o=C(()=>{const d=e.settings.translationServices.chosenServiceName;return d&&e.settings.translationServices.services.find(c=>c.name===d)||null}),r=C(()=>o.value&&o.value.serviceType==="ai"&&o.value.models?o.value.models.map(d=>({label:d,value:d})):[]),u=C({get:()=>{var d;return((d=o.value)==null?void 0:d.chosenModel)||""},set:d=>{o.value&&e.setServiceModel(o.value.name,d)}}),l=C(()=>n.availableGeminiApiKeys?n.availableGeminiApiKeys.map((d,c)=>({label:`API KEY ${c+1}`,value:d})):[]),m=C({get:()=>n.selectedGeminiApiKey,set:d=>{n.setSelectedGeminiApiKey(d)}});return(d,c)=>{const g=Ue,f=Fe,y=Tt,$=At;return v(),R($,{ui:{header:{padding:"px-0 py-3"},body:{padding:"px-0 py-0"}}},{header:b(()=>c[4]||(c[4]=[w("h4",{class:"font-medium text-gray-900 dark:text-white"},"Translation Services",-1)])),default:b(()=>[w("div",Wn,[h(f,{label:"Active Translation Service",ui:{label:{base:"font-medium"}}},{default:b(()=>[h(g,{modelValue:a.value,"onUpdate:modelValue":c[0]||(c[0]=I=>a.value=I),items:i.value,"option-attribute":"label","value-attribute":"value",placeholder:"Select a service"},null,8,["modelValue","items"])]),_:1}),o.value&&o.value.serviceType==="ai"&&o.value.models&&o.value.models.length>0?(v(),S(ae,{key:0},[h(f,{label:`Model for ${o.value.name}`,ui:{label:{base:"font-medium"}}},{default:b(()=>[h(g,{modelValue:u.value,"onUpdate:modelValue":c[1]||(c[1]=I=>u.value=I),items:r.value,"option-attribute":"label","value-attribute":"value"},null,8,["modelValue","items"])]),_:1},8,["label"]),o.value.name==="Gemini"?(v(),S("div",Yn,[p(n).availableGeminiApiKeys&&p(n).availableGeminiApiKeys.length>1?(v(),S("div",Jn,[h(f,{label:"Active Gemini API Key",ui:{label:{base:"font-medium"}}},{default:b(()=>[h(g,{modelValue:m.value,"onUpdate:modelValue":c[2]||(c[2]=I=>m.value=I),items:l.value,"option-attribute":"label","value-attribute":"value"},null,8,["modelValue","items"])]),_:1})])):p(n).availableGeminiApiKeys&&p(n).availableGeminiApiKeys.length===1?(v(),S("div",Xn," Using API Key 1 (auto-selected for Gemini). ")):(v(),S("div",Zn," API keys for Gemini are not set. Please configure them "))])):N("",!0),o.value&&o.value.serviceType==="ai"?(v(),R(f,{key:1,label:"Generate Note",ui:{container:"flex items-center justify-between",label:{base:"font-medium"}}},{default:b(()=>[h(y,{modelValue:s.value,"onUpdate:modelValue":c[3]||(c[3]=I=>s.value=I)},null,8,["modelValue"])]),_:1})):N("",!0)],64)):o.value&&o.value.serviceType==="standard"?(v(),S("p",Qn," Using standard translation for "+B(o.value.name)+". ",1)):!o.value&&p(e).settings.translationServices.chosenServiceName?(v(),S("p",es," Warning: Active service '"+B(p(e).settings.translationServices.chosenServiceName)+"' is not found in configured services. ",1)):p(e).settings.translationServices.services.length===0?(v(),S("p",ts," No translation services configured. ")):!p(e).settings.translationServices.chosenServiceName&&p(e).settings.translationServices.services.length>0?(v(),S("p",ns," No translation service selected. ")):N("",!0)])]),_:1})}}}),ss={class:"space-y-6"},as={class:"space-y-3"},is={class:"space-y-3"},os={class:"flex justify-end pt-2 border-gray-200 dark:border-gray-700"},rs={class:"pt-4 space-y-4"},ls={class:"space-y-4 flex flex-col items-center"},us={class:"space-y-4 flex flex-col items-center"},tt="_UNKNOWN_WORDS_",cs=V({__name:"TextRendererSettings",setup(t){const e=Z(),n=Q(),s=Ce(),a=[{label:"Left",value:"left"},{label:"Center",value:"center"},{label:"Right",value:"right"}],i=M(null),o=M(null),r=M(null),u=M(!1),l=M(!1),m=C(()=>i.value?ve.filter(_=>_.value!==i.value):[]);ue(i,()=>{o.value=null});const d=C({get:()=>e.settings.fontSize,set:_=>e.updateSettings({fontSize:Number(_)||e.settings.fontSize})}),c=C({get:()=>e.settings.alignment,set:_=>e.updateSettings({alignment:_})}),g=C({get:()=>e.settings.pagination.pageSize,set:_=>e.updatePaginationSettings({pageSize:Number(_)||e.settings.pagination.pageSize})}),f=C({get:()=>e.settings.note.height,set:_=>e.updateNoteSettings({height:Number(_)||e.settings.note.height})});C({get:()=>e.settings.pagination.show,set:_=>e.updatePaginationSettings({show:_})});const y=C({get:()=>e.settings.note.show,set:_=>e.updateNoteSettings({show:_})});C({get:()=>e.settings.note.isSticky,set:_=>e.updateNoteSettings({isSticky:_})});const $=async()=>{const _=i.value,x=o.value;if(!_||!x){s.add({title:"Selection Required",description:"Please select both a source and a target status.",color:"warning",icon:"i-heroicons-exclamation-triangle"});return}const T=new Set;e.processedLines.forEach(L=>{L.tokens.forEach(U=>{U.isWord&&U.lexicalUnit&&U.status===_&&T.add(U.lexicalUnit.id)})});const O=Array.from(T);if(O.length===0){s.add({title:"No Units to Update",description:`No units with status '${_}' found in the current text.`,color:"info",icon:"i-heroicons-information-circle"});return}u.value=!0;try{await n.bulkUpdateStatusForIds(O,x),s.add({title:"Status Updated",description:`${O.length} unit(s) in this text updated from '${_}' to '${x}'.`,color:"success",icon:"i-heroicons-check-circle"}),i.value=null,o.value=null}catch(L){console.error("Failed to bulk update LU status:",L),s.add({title:"Update Failed",description:"Could not update statuses. See console for details.",color:"error",icon:"i-heroicons-x-circle"})}finally{u.value=!1}},I=C(()=>[...ve,{label:"Unknown Words",value:tt}]),k=async()=>{var x;const _=r.value;if(!_){s.add({title:"Selection Required",description:"Please select a status or type to copy.",color:"warning",icon:"i-heroicons-exclamation-triangle"});return}l.value=!0,await new Promise(T=>setTimeout(T,0));try{const T=new Set;let O="";_===tt?(O="Unknown word(s)",e.processedLines.forEach(F=>{F.tokens.forEach(E=>{E.isWord&&!E.lexicalUnit&&T.add(E.text.toLowerCase())})})):(O=`word(s) with status '${_}'`,e.processedLines.forEach(F=>{F.tokens.forEach(E=>{E.isWord&&E.status===_&&T.add(E.text.toLowerCase())})}));const L=Array.from(T);if(L.length===0){const F=((x=I.value.find(E=>E.value===_))==null?void 0:x.label)||"items";s.add({title:"No Items Found",description:`No '${F.toLowerCase()}' were found in the current text.`,color:"info",icon:"i-heroicons-information-circle"});return}const U=JSON.stringify(L);await navigator.clipboard.writeText(U),s.add({title:"Copied to Clipboard",description:`${L.length} unique ${O} copied as a JSON array.`,color:"success",icon:"i-heroicons-check-circle"})}catch(T){console.error("Failed to copy items:",T),s.add({title:"Copy Failed",description:"Could not copy items to clipboard. See console for details.",color:"error",icon:"i-heroicons-x-circle"})}finally{l.value=!1}};return(_,x)=>{const T=Ft,O=Fe,L=fn,U=At,F=Tt,E=H,D=Pe,ne=Ue;return v(),S("div",ss,[h(O,{label:"Font Size (px)",ui:{label:{base:"font-medium"}}},{default:b(()=>[h(T,{modelValue:d.value,"onUpdate:modelValue":x[0]||(x[0]=P=>d.value=P),placeholder:"e.g., 16"},null,8,["modelValue"])]),_:1}),h(O,{label:"Text Alignment",ui:{label:{base:"font-medium"}}},{default:b(()=>[h(L,{modelValue:c.value,"onUpdate:modelValue":x[1]||(x[1]=P=>c.value=P),items:a},null,8,["modelValue"])]),_:1}),h(U,{ui:{header:{padding:"px-0 py-3"},body:{padding:"px-0 py-0"}}},{header:b(()=>x[9]||(x[9]=[w("h4",{class:"font-medium text-gray-900 dark:text-white"},"Pagination",-1)])),default:b(()=>[w("div",as,[p(e).settings.pagination.show?(v(),R(O,{key:0,label:"Lines Per Page",ui:{label:{base:"font-normal"}}},{default:b(()=>[h(T,{modelValue:g.value,"onUpdate:modelValue":x[2]||(x[2]=P=>g.value=P),placeholder:"e.g., 20"},null,8,["modelValue"])]),_:1})):N("",!0)])]),_:1}),h(U,{ui:{header:{padding:"px-0 py-3"},body:{padding:"px-0 py-0"}}},{header:b(()=>x[10]||(x[10]=[w("h4",{class:"font-medium text-gray-900 dark:text-white"},"Note Display",-1)])),default:b(()=>[w("div",is,[h(O,{label:"Show Note",ui:{container:"flex items-center justify-between",label:{base:"font-normal"}}},{default:b(()=>[h(F,{modelValue:y.value,"onUpdate:modelValue":x[3]||(x[3]=P=>y.value=P)},null,8,["modelValue"])]),_:1}),p(e).settings.note.show?(v(),R(O,{key:0,label:"Note Height (px)",ui:{label:{base:"font-normal"}}},{default:b(()=>[h(T,{modelValue:f.value,"onUpdate:modelValue":x[4]||(x[4]=P=>f.value=P),placeholder:"e.g., 200",min:10,step:10},null,8,["modelValue"])]),_:1})):N("",!0)])]),_:1}),w("div",os,[h(E,{label:"Reset to Defaults",color:"gray",variant:"outline",onClick:x[5]||(x[5]=P=>p(e).resetSettings()),icon:"i-heroicons-arrow-uturn-left"})]),h(D),w("div",rs,[h(U,{ui:{header:{padding:"px-0 py-3"},body:{padding:"px-4 py-4 sm:p-6"}}},{header:b(()=>x[11]||(x[11]=[w("h4",{class:"font-medium text-gray-900 dark:text-white"},"Bulk Status Update",-1)])),default:b(()=>[w("div",ls,[h(O,{label:"From Status",class:"w-full max-w-sm"},{default:b(()=>[h(ne,{modelValue:i.value,"onUpdate:modelValue":x[6]||(x[6]=P=>i.value=P),items:p(ve),"option-attribute":"label","value-attribute":"value",placeholder:"Select source status",class:"w-full"},null,8,["modelValue","items"])]),_:1}),h(O,{label:"To Status",class:"w-full max-w-sm"},{default:b(()=>[h(ne,{modelValue:o.value,"onUpdate:modelValue":x[7]||(x[7]=P=>o.value=P),items:m.value,"option-attribute":"label","value-attribute":"value",placeholder:"Select target status",class:"w-full",disabled:!i.value},null,8,["modelValue","items","disabled"])]),_:1}),h(E,{label:"Update Statuses",color:"teal",variant:"solid",onClick:$,icon:"i-heroicons-arrow-path-rounded-square",class:"w-full max-w-sm cursor-pointer",loading:u.value,disabled:!i.value||!o.value||u.value},null,8,["loading","disabled"])])]),_:1}),h(U,{ui:{header:{padding:"px-0 py-3"},body:{padding:"px-4 py-4 sm:p-6"}}},{header:b(()=>x[12]||(x[12]=[w("h4",{class:"font-medium text-gray-900 dark:text-white"},"Copy Words by Status",-1)])),default:b(()=>[w("div",us,[h(O,{label:"Select Status",class:"w-full max-w-sm"},{default:b(()=>[h(ne,{modelValue:r.value,"onUpdate:modelValue":x[8]||(x[8]=P=>r.value=P),items:I.value,"option-attribute":"label","value-attribute":"value",placeholder:"Select status to copy",class:"w-full"},null,8,["modelValue","items"])]),_:1}),h(E,{label:"Copy Words",color:"cyan",variant:"solid",onClick:k,icon:"i-heroicons-clipboard-document-list",class:"w-full max-w-sm cursor-pointer",loading:l.value,disabled:!r.value||l.value},null,8,["loading","disabled"])])]),_:1})]),h(Pt),h(D),h(wn)])}}}),ds={class:"flex justify-center items-center"},ms={class:"text-xl font-bold text-center text-gray-800 dark:text-gray-200"},Lt=V({__name:"PopoverTerm",props:{term:{}},setup(t){const e=t,n=async()=>{try{await It(e.term,"target")}catch(s){console.error(`Failed to speak "${e.term}" with target voice:`,s)}};return(s,a)=>{const i=Ee,o=H;return v(),S("div",ds,[w("p",ms,B(s.term),1),h(o,{variant:"primary",class:"cursor-pointer",onClick:n},{default:b(()=>[h(i,{name:"i-heroicons-speaker-wave",class:"size-4"})]),_:1})])}}});var nt;(function(t){t.STRING="string",t.NUMBER="number",t.INTEGER="integer",t.BOOLEAN="boolean",t.ARRAY="array",t.OBJECT="object"})(nt||(nt={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var st;(function(t){t.LANGUAGE_UNSPECIFIED="language_unspecified",t.PYTHON="python"})(st||(st={}));var at;(function(t){t.OUTCOME_UNSPECIFIED="outcome_unspecified",t.OUTCOME_OK="outcome_ok",t.OUTCOME_FAILED="outcome_failed",t.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(at||(at={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const it=["user","model","function","system"];var ot;(function(t){t.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",t.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",t.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",t.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",t.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(ot||(ot={}));var rt;(function(t){t.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE"})(rt||(rt={}));var lt;(function(t){t.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",t.NEGLIGIBLE="NEGLIGIBLE",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH"})(lt||(lt={}));var ut;(function(t){t.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",t.SAFETY="SAFETY",t.OTHER="OTHER"})(ut||(ut={}));var me;(function(t){t.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",t.STOP="STOP",t.MAX_TOKENS="MAX_TOKENS",t.SAFETY="SAFETY",t.RECITATION="RECITATION",t.LANGUAGE="LANGUAGE",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.SPII="SPII",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.OTHER="OTHER"})(me||(me={}));var ct;(function(t){t.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",t.RETRIEVAL_QUERY="RETRIEVAL_QUERY",t.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",t.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",t.CLASSIFICATION="CLASSIFICATION",t.CLUSTERING="CLUSTERING"})(ct||(ct={}));var dt;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.AUTO="AUTO",t.ANY="ANY",t.NONE="NONE"})(dt||(dt={}));var mt;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(mt||(mt={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class le extends j{constructor(e,n){super(e),this.response=n}}class Dt extends j{constructor(e,n,s,a){super(e),this.status=n,this.statusText=s,this.errorDetails=a}}class te extends j{}class Vt extends j{}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fs="https://generativelanguage.googleapis.com",ps="v1beta",gs="0.24.1",hs="genai-js";var oe;(function(t){t.GENERATE_CONTENT="generateContent",t.STREAM_GENERATE_CONTENT="streamGenerateContent",t.COUNT_TOKENS="countTokens",t.EMBED_CONTENT="embedContent",t.BATCH_EMBED_CONTENTS="batchEmbedContents"})(oe||(oe={}));class vs{constructor(e,n,s,a,i){this.model=e,this.task=n,this.apiKey=s,this.stream=a,this.requestOptions=i}toString(){var e,n;const s=((e=this.requestOptions)===null||e===void 0?void 0:e.apiVersion)||ps;let i=`${((n=this.requestOptions)===null||n===void 0?void 0:n.baseUrl)||fs}/${s}/${this.model}:${this.task}`;return this.stream&&(i+="?alt=sse"),i}}function ys(t){const e=[];return t!=null&&t.apiClient&&e.push(t.apiClient),e.push(`${hs}/${gs}`),e.join(" ")}async function bs(t){var e;const n=new Headers;n.append("Content-Type","application/json"),n.append("x-goog-api-client",ys(t.requestOptions)),n.append("x-goog-api-key",t.apiKey);let s=(e=t.requestOptions)===null||e===void 0?void 0:e.customHeaders;if(s){if(!(s instanceof Headers))try{s=new Headers(s)}catch(a){throw new te(`unable to convert customHeaders value ${JSON.stringify(s)} to Headers: ${a.message}`)}for(const[a,i]of s.entries()){if(a==="x-goog-api-key")throw new te(`Cannot set reserved header name ${a}`);if(a==="x-goog-api-client")throw new te(`Header name ${a} can only be set using the apiClient field`);n.append(a,i)}}return n}async function xs(t,e,n,s,a,i){const o=new vs(t,e,n,s,i);return{url:o.toString(),fetchOptions:Object.assign(Object.assign({},Cs(i)),{method:"POST",headers:await bs(o),body:a})}}async function ge(t,e,n,s,a,i={},o=fetch){const{url:r,fetchOptions:u}=await xs(t,e,n,s,a,i);return _s(r,u,o)}async function _s(t,e,n=fetch){let s;try{s=await n(t,e)}catch(a){Ss(a,t)}return s.ok||await ws(s,t),s}function Ss(t,e){let n=t;throw n.name==="AbortError"?(n=new Vt(`Request aborted when fetching ${e.toString()}: ${t.message}`),n.stack=t.stack):t instanceof Dt||t instanceof te||(n=new j(`Error fetching from ${e.toString()}: ${t.message}`),n.stack=t.stack),n}async function ws(t,e){let n="",s;try{const a=await t.json();n=a.error.message,a.error.details&&(n+=` ${JSON.stringify(a.error.details)}`,s=a.error.details)}catch{}throw new Dt(`Error fetching from ${e.toString()}: [${t.status} ${t.statusText}] ${n}`,t.status,t.statusText,s)}function Cs(t){const e={};if((t==null?void 0:t.signal)!==void 0||(t==null?void 0:t.timeout)>=0){const n=new AbortController;(t==null?void 0:t.timeout)>=0&&setTimeout(()=>n.abort(),t.timeout),t!=null&&t.signal&&t.signal.addEventListener("abort",()=>{n.abort()}),e.signal=n.signal}return e}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ve(t){return t.text=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),ye(t.candidates[0]))throw new le(`${ee(t)}`,t);return Es(t)}else if(t.promptFeedback)throw new le(`Text not available. ${ee(t)}`,t);return""},t.functionCall=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),ye(t.candidates[0]))throw new le(`${ee(t)}`,t);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),ft(t)[0]}else if(t.promptFeedback)throw new le(`Function call not available. ${ee(t)}`,t)},t.functionCalls=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),ye(t.candidates[0]))throw new le(`${ee(t)}`,t);return ft(t)}else if(t.promptFeedback)throw new le(`Function call not available. ${ee(t)}`,t)},t}function Es(t){var e,n,s,a;const i=[];if(!((n=(e=t.candidates)===null||e===void 0?void 0:e[0].content)===null||n===void 0)&&n.parts)for(const o of(a=(s=t.candidates)===null||s===void 0?void 0:s[0].content)===null||a===void 0?void 0:a.parts)o.text&&i.push(o.text),o.executableCode&&i.push("\n```"+o.executableCode.language+`
`+o.executableCode.code+"\n```\n"),o.codeExecutionResult&&i.push("\n```\n"+o.codeExecutionResult.output+"\n```\n");return i.length>0?i.join(""):""}function ft(t){var e,n,s,a;const i=[];if(!((n=(e=t.candidates)===null||e===void 0?void 0:e[0].content)===null||n===void 0)&&n.parts)for(const o of(a=(s=t.candidates)===null||s===void 0?void 0:s[0].content)===null||a===void 0?void 0:a.parts)o.functionCall&&i.push(o.functionCall);if(i.length>0)return i}const $s=[me.RECITATION,me.SAFETY,me.LANGUAGE];function ye(t){return!!t.finishReason&&$s.includes(t.finishReason)}function ee(t){var e,n,s;let a="";if((!t.candidates||t.candidates.length===0)&&t.promptFeedback)a+="Response was blocked",!((e=t.promptFeedback)===null||e===void 0)&&e.blockReason&&(a+=` due to ${t.promptFeedback.blockReason}`),!((n=t.promptFeedback)===null||n===void 0)&&n.blockReasonMessage&&(a+=`: ${t.promptFeedback.blockReasonMessage}`);else if(!((s=t.candidates)===null||s===void 0)&&s[0]){const i=t.candidates[0];ye(i)&&(a+=`Candidate was blocked due to ${i.finishReason}`,i.finishMessage&&(a+=`: ${i.finishMessage}`))}return a}function fe(t){return this instanceof fe?(this.v=t,this):new fe(t)}function Is(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=n.apply(t,e||[]),a,i=[];return a={},o("next"),o("throw"),o("return"),a[Symbol.asyncIterator]=function(){return this},a;function o(c){s[c]&&(a[c]=function(g){return new Promise(function(f,y){i.push([c,g,f,y])>1||r(c,g)})})}function r(c,g){try{u(s[c](g))}catch(f){d(i[0][3],f)}}function u(c){c.value instanceof fe?Promise.resolve(c.value.v).then(l,m):d(i[0][2],c)}function l(c){r("next",c)}function m(c){r("throw",c)}function d(c,g){c(g),i.shift(),i.length&&r(i[0][0],i[0][1])}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pt=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function Ns(t){const e=t.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),n=As(e),[s,a]=n.tee();return{stream:ks(s),response:Ts(a)}}async function Ts(t){const e=[],n=t.getReader();for(;;){const{done:s,value:a}=await n.read();if(s)return Ve(Rs(e));e.push(a)}}function ks(t){return Is(this,arguments,function*(){const n=t.getReader();for(;;){const{value:s,done:a}=yield fe(n.read());if(a)break;yield yield fe(Ve(s))}})}function As(t){const e=t.getReader();return new ReadableStream({start(s){let a="";return i();function i(){return e.read().then(({value:o,done:r})=>{if(r){if(a.trim()){s.error(new j("Failed to parse stream"));return}s.close();return}a+=o;let u=a.match(pt),l;for(;u;){try{l=JSON.parse(u[1])}catch{s.error(new j(`Error parsing JSON response: "${u[1]}"`));return}s.enqueue(l),a=a.substring(u[0].length),u=a.match(pt)}return i()}).catch(o=>{let r=o;throw r.stack=o.stack,r.name==="AbortError"?r=new Vt("Request aborted when reading from the stream"):r=new j("Error reading from the stream"),r})}}})}function Rs(t){const e=t[t.length-1],n={promptFeedback:e==null?void 0:e.promptFeedback};for(const s of t){if(s.candidates){let a=0;for(const i of s.candidates)if(n.candidates||(n.candidates=[]),n.candidates[a]||(n.candidates[a]={index:a}),n.candidates[a].citationMetadata=i.citationMetadata,n.candidates[a].groundingMetadata=i.groundingMetadata,n.candidates[a].finishReason=i.finishReason,n.candidates[a].finishMessage=i.finishMessage,n.candidates[a].safetyRatings=i.safetyRatings,i.content&&i.content.parts){n.candidates[a].content||(n.candidates[a].content={role:i.content.role||"user",parts:[]});const o={};for(const r of i.content.parts)r.text&&(o.text=r.text),r.functionCall&&(o.functionCall=r.functionCall),r.executableCode&&(o.executableCode=r.executableCode),r.codeExecutionResult&&(o.codeExecutionResult=r.codeExecutionResult),Object.keys(o).length===0&&(o.text=""),n.candidates[a].content.parts.push(o)}a++}s.usageMetadata&&(n.usageMetadata=s.usageMetadata)}return n}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Gt(t,e,n,s){const a=await ge(e,oe.STREAM_GENERATE_CONTENT,t,!0,JSON.stringify(n),s);return Ns(a)}async function qt(t,e,n,s){const i=await(await ge(e,oe.GENERATE_CONTENT,t,!1,JSON.stringify(n),s)).json();return{response:Ve(i)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jt(t){if(t!=null){if(typeof t=="string")return{role:"system",parts:[{text:t}]};if(t.text)return{role:"system",parts:[t]};if(t.parts)return t.role?t:{role:"system",parts:t.parts}}}function pe(t){let e=[];if(typeof t=="string")e=[{text:t}];else for(const n of t)typeof n=="string"?e.push({text:n}):e.push(n);return Os(e)}function Os(t){const e={role:"user",parts:[]},n={role:"function",parts:[]};let s=!1,a=!1;for(const i of t)"functionResponse"in i?(n.parts.push(i),a=!0):(e.parts.push(i),s=!0);if(s&&a)throw new j("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!s&&!a)throw new j("No content is provided for sending chat message.");return s?e:n}function Ms(t,e){var n;let s={model:e==null?void 0:e.model,generationConfig:e==null?void 0:e.generationConfig,safetySettings:e==null?void 0:e.safetySettings,tools:e==null?void 0:e.tools,toolConfig:e==null?void 0:e.toolConfig,systemInstruction:e==null?void 0:e.systemInstruction,cachedContent:(n=e==null?void 0:e.cachedContent)===null||n===void 0?void 0:n.name,contents:[]};const a=t.generateContentRequest!=null;if(t.contents){if(a)throw new te("CountTokensRequest must have one of contents or generateContentRequest, not both.");s.contents=t.contents}else if(a)s=Object.assign(Object.assign({},s),t.generateContentRequest);else{const i=pe(t);s.contents=[i]}return{generateContentRequest:s}}function gt(t){let e;return t.contents?e=t:e={contents:[pe(t)]},t.systemInstruction&&(e.systemInstruction=jt(t.systemInstruction)),e}function Us(t){return typeof t=="string"||Array.isArray(t)?{content:pe(t)}:t}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ht=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],Fs={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function Ps(t){let e=!1;for(const n of t){const{role:s,parts:a}=n;if(!e&&s!=="user")throw new j(`First content should be with role 'user', got ${s}`);if(!it.includes(s))throw new j(`Each item should include role field. Got ${s} but valid roles are: ${JSON.stringify(it)}`);if(!Array.isArray(a))throw new j("Content should have 'parts' property with an array of Parts");if(a.length===0)throw new j("Each Content should have at least one part");const i={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const r of a)for(const u of ht)u in r&&(i[u]+=1);const o=Fs[s];for(const r of ht)if(!o.includes(r)&&i[r]>0)throw new j(`Content with role '${s}' can't contain '${r}' part`);e=!0}}function vt(t){var e;if(t.candidates===void 0||t.candidates.length===0)return!1;const n=(e=t.candidates[0])===null||e===void 0?void 0:e.content;if(n===void 0||n.parts===void 0||n.parts.length===0)return!1;for(const s of n.parts)if(s===void 0||Object.keys(s).length===0||s.text!==void 0&&s.text==="")return!1;return!0}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yt="SILENT_ERROR";class Ls{constructor(e,n,s,a={}){this.model=n,this.params=s,this._requestOptions=a,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,s!=null&&s.history&&(Ps(s.history),this._history=s.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e,n={}){var s,a,i,o,r,u;await this._sendPromise;const l=pe(e),m={safetySettings:(s=this.params)===null||s===void 0?void 0:s.safetySettings,generationConfig:(a=this.params)===null||a===void 0?void 0:a.generationConfig,tools:(i=this.params)===null||i===void 0?void 0:i.tools,toolConfig:(o=this.params)===null||o===void 0?void 0:o.toolConfig,systemInstruction:(r=this.params)===null||r===void 0?void 0:r.systemInstruction,cachedContent:(u=this.params)===null||u===void 0?void 0:u.cachedContent,contents:[...this._history,l]},d=Object.assign(Object.assign({},this._requestOptions),n);let c;return this._sendPromise=this._sendPromise.then(()=>qt(this._apiKey,this.model,m,d)).then(g=>{var f;if(vt(g.response)){this._history.push(l);const y=Object.assign({parts:[],role:"model"},(f=g.response.candidates)===null||f===void 0?void 0:f[0].content);this._history.push(y)}else{const y=ee(g.response);y&&console.warn(`sendMessage() was unsuccessful. ${y}. Inspect response object for details.`)}c=g}).catch(g=>{throw this._sendPromise=Promise.resolve(),g}),await this._sendPromise,c}async sendMessageStream(e,n={}){var s,a,i,o,r,u;await this._sendPromise;const l=pe(e),m={safetySettings:(s=this.params)===null||s===void 0?void 0:s.safetySettings,generationConfig:(a=this.params)===null||a===void 0?void 0:a.generationConfig,tools:(i=this.params)===null||i===void 0?void 0:i.tools,toolConfig:(o=this.params)===null||o===void 0?void 0:o.toolConfig,systemInstruction:(r=this.params)===null||r===void 0?void 0:r.systemInstruction,cachedContent:(u=this.params)===null||u===void 0?void 0:u.cachedContent,contents:[...this._history,l]},d=Object.assign(Object.assign({},this._requestOptions),n),c=Gt(this._apiKey,this.model,m,d);return this._sendPromise=this._sendPromise.then(()=>c).catch(g=>{throw new Error(yt)}).then(g=>g.response).then(g=>{if(vt(g)){this._history.push(l);const f=Object.assign({},g.candidates[0].content);f.role||(f.role="model"),this._history.push(f)}else{const f=ee(g);f&&console.warn(`sendMessageStream() was unsuccessful. ${f}. Inspect response object for details.`)}}).catch(g=>{g.message!==yt&&console.error(g)}),c}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ds(t,e,n,s){return(await ge(e,oe.COUNT_TOKENS,t,!1,JSON.stringify(n),s)).json()}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vs(t,e,n,s){return(await ge(e,oe.EMBED_CONTENT,t,!1,JSON.stringify(n),s)).json()}async function Gs(t,e,n,s){const a=n.requests.map(o=>Object.assign(Object.assign({},o),{model:e}));return(await ge(e,oe.BATCH_EMBED_CONTENTS,t,!1,JSON.stringify({requests:a}),s)).json()}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bt{constructor(e,n,s={}){this.apiKey=e,this._requestOptions=s,n.model.includes("/")?this.model=n.model:this.model=`models/${n.model}`,this.generationConfig=n.generationConfig||{},this.safetySettings=n.safetySettings||[],this.tools=n.tools,this.toolConfig=n.toolConfig,this.systemInstruction=jt(n.systemInstruction),this.cachedContent=n.cachedContent}async generateContent(e,n={}){var s;const a=gt(e),i=Object.assign(Object.assign({},this._requestOptions),n);return qt(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(s=this.cachedContent)===null||s===void 0?void 0:s.name},a),i)}async generateContentStream(e,n={}){var s;const a=gt(e),i=Object.assign(Object.assign({},this._requestOptions),n);return Gt(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(s=this.cachedContent)===null||s===void 0?void 0:s.name},a),i)}startChat(e){var n;return new Ls(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(n=this.cachedContent)===null||n===void 0?void 0:n.name},e),this._requestOptions)}async countTokens(e,n={}){const s=Ms(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),a=Object.assign(Object.assign({},this._requestOptions),n);return Ds(this.apiKey,this.model,s,a)}async embedContent(e,n={}){const s=Us(e),a=Object.assign(Object.assign({},this._requestOptions),n);return Vs(this.apiKey,this.model,s,a)}async batchEmbedContents(e,n={}){const s=Object.assign(Object.assign({},this._requestOptions),n);return Gs(this.apiKey,this.model,e,s)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qs{constructor(e){this.apiKey=e}getGenerativeModel(e,n){if(!e.model)throw new j("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new bt(this.apiKey,e,n)}getGenerativeModelFromCachedContent(e,n,s){if(!e.name)throw new te("Cached content must contain a `name` field.");if(!e.model)throw new te("Cached content must contain a `model` field.");const a=["model","systemInstruction"];for(const o of a)if(n!=null&&n[o]&&e[o]&&(n==null?void 0:n[o])!==e[o]){if(o==="model"){const r=n.model.startsWith("models/")?n.model.replace("models/",""):n.model,u=e.model.startsWith("models/")?e.model.replace("models/",""):e.model;if(r===u)continue}throw new te(`Different value for "${o}" specified in modelParams (${n[o]}) and cachedContent (${e[o]})`)}const i=Object.assign(Object.assign({},n),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new bt(this.apiKey,i,s)}}async function js(t,e,n,s){var $,I,k,_,x;const a=Q(),i=Z(),o=a.selectedGeminiApiKey,r=i.settings.translationServices.services.find(T=>T.name==="Gemini"&&T.serviceType==="ai");if(!o)return console.error("Gemini API Key is not selected or available."),null;if(!r)return console.error("Gemini service configuration not found in text render settings."),null;const u=r.chosenModel;if(!u)return console.error("No Gemini model selected in settings."),null;const l=a.info,m=($=a.settings)==null?void 0:$.aiPrompt;if(!l)return console.error("Study pack info not loaded."),null;if(!m)return console.error("AI prompt settings not loaded from study pack settings.json."),null;const d=l.languages.targetLanguage,c=l.languages.sourceLanguage;let g,f;e==="term"?(g=(I=m.term)==null?void 0:I.translation,f=(k=m.term)==null?void 0:k.note):(g=(_=m.line)==null?void 0:_.translation,f=(x=m.line)==null?void 0:x.note),g||(console.warn(`AI prompt setting for ${e} translation instruction is missing.`),(e="term")?g=`Provide the most accurate and common translation for the term from ${d} to ${c}. The translation should consist of the most popular translations of the given text (no more than five) and be separated by commas.`:g=`Translate the sentence(s) from ${d} to ${c}. The translation must be grammatically correct and sound natural, while preserving the original tone and meaning.`),f||(console.warn(`AI prompt setting for ${e} note instruction is missing, but note generation was requested. Note will not be generated.`),(e="term")?f=`Briefly explain the choice of translation. If there are other common alternative translations for this term, mention them. The note should be written in ${c}.`:f=`In one or two sentences, explain any interesting cultural nuances, idioms, or non-obvious translation choices. If the translation is straightforward, state that. The note should be written in ${d}.`);const y=`
Context: You are an expert translator.

Text to translate: "${t}"

Instructions:
1. Translate the text according to this rule: ${g}.
${n?`2. Generate a concise note based on this rule: ${f}.`:""}

Your response must be a valid JSON object.
It must contain a "translation" key with the translated text as a string.
${n?'It must also contain a "note" key with the generated note as a string.':'It must not contain a "note" key.'}

${s?`Here's another extra prompt for you: ${s}`:""}
`;console.log("Sending prompt to Gemini:",y);try{const U=(await new qs(o).getGenerativeModel({model:u,generationConfig:{responseMimeType:"application/json"}}).generateContent(y)).response.text();console.log("Received raw response from Gemini:",U);let F;try{const E=U.match(/\{[\s\S]*\}/);if(!E)throw new Error("No valid JSON object found in the response.");F=JSON.parse(E[0])}catch(E){return console.error("Failed to parse Gemini response as JSON:",E.message),console.error("Raw response text:",U),null}return typeof F!="object"||F===null?(console.error("Gemini response is not a valid JSON object."),null):typeof F.translation!="string"?(console.error('Gemini response JSON is missing the required "translation" string.'),null):(n&&typeof F.note!="string"?(console.warn('Gemini response JSON is missing the required "note" string, but note generation was requested.'),delete F.note):!n&&F.note!==void 0&&delete F.note,F)}catch(T){return console.error("Error calling Gemini API:",T),T.response&&T.response.candidates?console.error("Gemini API Error Details:",JSON.stringify(T.response.candidates,null,2)):T.message&&console.error("Gemini API Error Message:",T.message),null}}const Bs=_t("translationStorage",{state:()=>({translations:new Map}),actions:{addTranslation(t,e){this.translations.set(t,e)},getTranslation(t){return this.translations.get(t)},hasTranslation(t){return this.translations.has(t)},clearTranslations(){this.translations.clear()}},getters:{}});async function zs(t,e,n){if(e===n&&e!=="auto")return{translation:t};const s=`https://clients5.google.com/translate_a/t?client=dict-chrome-ex&sl=${e}&tl=${n}&q=${encodeURIComponent(t)}`;try{const a=await fetch(s);if(!a.ok)return console.error(`Google Mirror API error: ${a.status} ${a.statusText}`),null;const i=await a.text();try{const o=JSON.parse(i);if(Array.isArray(o)&&o.length>0&&typeof o[0]=="string")return{translation:o[0]}}catch{if(i&&!i.trim().startsWith("<"))return{translation:i}}return console.warn("Google Mirror: Failed to parse or understand the response:",i),null}catch(a){return console.error("Error during Google Mirror translation request:",a.message),null}}async function Ks(t,e,n){var i,o;if(e===n&&e!=="auto")return{translation:t};const s=t.replace(/(\r\n|\r|\n)/g," "),a=`https://translate.googleapis.com/translate_a/single?client=gtx&dt=t&sl=${e}&tl=${n}&q=${encodeURIComponent(s)}`;try{const r=await fetch(a);if(!r.ok)return console.error(`Google Mirror 2 API error: ${r.status} ${r.statusText}`),null;const u=await r.json(),l=(o=(i=u==null?void 0:u[0])==null?void 0:i[0])==null?void 0:o[0];return typeof l=="string"&&l?{translation:l}:(console.warn("Google Mirror 2: Translation not found or API response format changed:",u),null)}catch(r){return console.error("Error during Google Mirror 2 translation request:",r.message),null}}async function Hs(t,e,n){var a,i,o;if(e===n&&e!=="auto")return{translation:t};const s=`https://api.mymemory.translated.net/get?q=${encodeURIComponent(t)}&langpair=${e}|${n}`;try{const r=await fetch(s);if(!r.ok)return console.error(`MyMemory API error: ${r.status} ${r.statusText}`),null;const u=await r.json(),l=((a=u==null?void 0:u.responseData)==null?void 0:a.translatedText)||((o=(i=u==null?void 0:u.matches)==null?void 0:i[0])==null?void 0:o.translation);return typeof l=="string"&&l?{translation:l}:(console.warn("MyMemory: Translation not found or API response format changed:",u),null)}catch(r){return console.error("Error during MyMemory translation request:",r.message),null}}function Ws(){const t=Z(),e=Q(),n=Ce(),s=Bs(),a=on({status:"idle",result:null,error:null}),i=C(()=>{const m=t.settings.translationServices.chosenServiceName;return m&&t.settings.translationServices.services.find(d=>d.name===m)||null}),o=C(()=>{const m=i.value;return(m==null?void 0:m.serviceType)==="ai"&&t.settings.translationServices.generateNote});return{state:a,activeTranslationService:i,generateNote:o,checkCache:m=>{const d=s.getTranslation(m);return d?(a.status="success",a.result=d,a.error=null,!0):!1},translate:async(m,d,c)=>{var f,y,$,I,k,_;const g=i.value;if(!g){n.add({title:"Service Not Found",description:"No active translation service selected.",color:"error"});return}a.status="loading",a.result=null,a.error=null;try{let x=null;if(g.name==="Gemini"){if(!e.selectedGeminiApiKey)throw new Error("Gemini API key is not selected.");if(!g.chosenModel)throw new Error(`Model for ${g.name} is not selected.`);x=await js(m,d,o.value??!1,c)}else if(g.name==="Google Mirror 1")x=await zs(m,(f=e.info)==null?void 0:f.languages.targetLanguage,(y=e.info)==null?void 0:y.languages.sourceLanguage);else if(g.name==="Google Mirror 2")x=await Ks(m,($=e.info)==null?void 0:$.languages.targetLanguage,(I=e.info)==null?void 0:I.languages.sourceLanguage);else if(g.name==="MyMemory")x=await Hs(m,(k=e.info)==null?void 0:k.languages.targetLanguage,(_=e.info)==null?void 0:_.languages.sourceLanguage);else{if(console.warn(`Service ${g.name} is simulated.`),await new Promise(T=>setTimeout(T,1e3)),m.toLowerCase().includes("error"))throw new Error("Simulated API error");x={translation:`Simulated translation for "${m.substring(0,30)}..."`,note:g.serviceType==="ai"&&o.value?`Simulated note for ${d}...`:void 0}}if(!x)throw new Error("Translation service returned no result.");a.result=x,a.status="success",s.addTranslation(m,x)}catch(x){console.error("Translation failed:",x),a.error=x.message||"An unknown error occurred during translation.",a.status="error",n.add({title:"Translation Error",description:`${a.error}`,color:"error",icon:"i-heroicons-x-circle"})}},reset:()=>{a.status="idle",a.result=null,a.error=null}}}const Ys={class:"translation-and-note space-y-4"},Js={class:"translation-section"},Xs={class:"flex items-center gap-2 mb-2"},Zs={class:"pl-7 text-gray-700 dark:text-gray-300"},Qs={key:0,class:"note-section"},ea={class:"flex items-center gap-2 mb-2"},ta=["innerHTML"],Bt=V({__name:"TranslationAndNote",props:{translation:{},note:{}},setup(t){const e=t;return(n,s)=>{const a=Ee;return v(),S("div",Ys,[w("div",Js,[w("div",Xs,[h(a,{name:"i-heroicons-language",class:"w-5 h-5 text-primary-500"}),s[0]||(s[0]=w("h3",{class:"text-lg font-medium text-gray-900 dark:text-white"},"Translation",-1))]),w("p",Zs,B(e.translation),1)]),e.note&&e.translation?(v(),S("div",Qs,[w("div",ea,[h(a,{name:"i-heroicons-pencil-square",class:"w-5 h-5 text-primary-500"}),s[1]||(s[1]=w("h3",{class:"text-lg font-medium text-gray-900 dark:text-white"},"Note",-1))]),w("div",{class:"pl-7 prose dark:prose-invert max-w-none",innerHTML:e.note},null,8,ta)])):N("",!0)])}}}),na={class:"space-y-4"},sa={key:0},aa={key:1,class:"text-center"},ia={key:3,class:"mt-4 text-sm text-red-500 dark:text-red-400 text-center"},oa={key:4,class:"mt-4 text-sm text-gray-500 dark:text-gray-400 text-center"},Ge=V({__name:"TranslationPanel",props:{textToTranslate:{},translationType:{},autoFetch:{type:Boolean},additionalPrompt:{}},setup(t){const e=t,{state:n,translate:s,checkCache:a,reset:i,activeTranslationService:o}=Ws(),r=M(!1),u=C(()=>!e.textToTranslate||!o.value),l=C(()=>n.result?"Retry Translation":"Request Translation");async function m(){u.value||(r.value=!0,await s(e.textToTranslate,e.translationType,e.additionalPrompt))}return ue(()=>e.textToTranslate,d=>{r.value=!1,d&&a(d)||i()},{immediate:!0}),ie(()=>{var d;e.autoFetch&&!((d=n==null?void 0:n.result)!=null&&d.translation)&&m()}),(d,c)=>{var f,y,$,I;const g=H;return v(),S("div",na,[p(o)?N("",!0):(v(),S("div",sa,c[0]||(c[0]=[w("p",{class:"text-sm text-yellow-500 dark:text-yellow-400"}," No translation service selected. Please select one in settings. ",-1)]))),h(g,{label:l.value,onClick:m,loading:p(n).status==="loading",disabled:u.value,icon:"i-heroicons-language-20-solid",class:"w-full justify-center cursor-pointer"},null,8,["label","loading","disabled"]),p(n).status==="loading"?(v(),S("div",aa,c[1]||(c[1]=[w("p",{class:"text-sm animate-pulse text-gray-700 dark:text-gray-300"},"Translating...",-1)]))):N("",!0),p(n).status!=="loading"?(v(),R(Bt,{key:2,translation:((y=(f=p(n))==null?void 0:f.result)==null?void 0:y.translation)??"",note:(I=($=p(n))==null?void 0:$.result)==null?void 0:I.note},null,8,["translation","note"])):N("",!0),p(n).status==="error"?(v(),S("div",ia,B(p(n).error),1)):N("",!0),p(n).status==="idle"&&r.value?(v(),S("div",oa," No translation available. ")):N("",!0)])}}});function ra(t,e={}){const{pageSize:n=10,delay:s=200}=e,a=M(null),i=M([]),o=M(!1),r=C(()=>i.value.length>=t.value.length),u=async()=>{if(!(o.value||r.value)){o.value=!0;try{s>0&&await new Promise(c=>setTimeout(c,s));const m=i.value.length,d=t.value.slice(m,m+n);i.value.push(...d)}finally{o.value=!1}}};ue(t,m=>{i.value=m.slice(0,n)},{immediate:!0});let l=null;return ie(()=>{l=new IntersectionObserver(m=>{m[0].isIntersecting&&u()},{root:null,threshold:.1}),a.value&&l.observe(a.value)}),rn(()=>{l&&l.disconnect()}),{visibleItems:i,trigger:a,isLoading:o,isFinished:r}}const la={class:"mt-0"},ua={key:0},ca={class:"font-semibold mb-2 text-gray-800 dark:text-gray-200"},da={class:"bg-gray-100 dark:bg-gray-800 rounded-md p-3 text-sm overflow-x-auto space-y-3"},ma={key:0,class:"text-gray-500"},fa={key:1,class:"text-gray-400 text-sm"},pa={key:1},ga=V({__name:"LexicalUnitMatcher",props:{unit:{}},setup(t){const e=t,n=Q(),s=l=>l.toLowerCase().replace(/[^\p{L}\p{N}\s-]/gu,"").trim(),a=C(()=>{const l=n.lexicalUnits;if(!l||!e.unit)return[];const m=[],d=new Set,c=s(e.unit.term);if(!c)return[];const g=(f,y)=>{d.has(f.id)||(m.push({...f,_matchPriority:y}),d.add(f.id))};for(const f of l){if(f.id===e.unit.id)continue;const y=s(f.term);if(!y)continue;if(y===c){g(f,1);continue}const $=3;let I="";for(let k=$;k<=Math.min(c.length,y.length)&&c.substring(0,k)===y.substring(0,k);k++)I=c.substring(0,k);if(I.length>=$){g(f,2);continue}if(c.startsWith(y)||y.startsWith(c)){g(f,3);continue}(c.includes(y)||y.includes(c))&&g(f,4)}return m.sort((f,y)=>f._matchPriority-y._matchPriority),m.map(({_matchPriority:f,...y})=>y)}),{visibleItems:i,trigger:o,isLoading:r,isFinished:u}=ra(a,{pageSize:5});return(l,m)=>(v(),S("div",la,[a.value.length>0?(v(),S("div",ua,[w("h3",ca," Found "+B(a.value.length)+" matching unit(s): ",1),w("div",da,[(v(!0),S(ae,null,xe(p(i),d=>(v(),R(kt,{key:d.id,unit:d,"show-all":""},null,8,["unit"]))),128))]),w("div",{ref_key:"trigger",ref:o,class:"h-10 text-center pt-4"},[p(r)?(v(),S("p",ma,"Loading more...")):N("",!0),p(u)&&!p(r)?(v(),S("p",fa,"- End of results -")):N("",!0)],512)])):(v(),S("div",pa,m[0]||(m[0]=[w("p",{class:"text-gray-500 dark:text-gray-400"},"No other matching units found.",-1)])))]))}}),ha={key:0,class:"p-2 min-w-[180px] max-w-[200px]"},va={key:0,class:"mb-1"},ya=["src"],ba=["src"],xa={key:1,class:"p-0 m-0 text-center text-gray-600 dark:text-gray-400"},_a={class:"p-0 m-0 mt-1 text-center max-h-20 overflow-auto"},Sa={class:"flex justify-center pt-2"},wa={class:"flex flex-row justify-between items-center mt-1"},Ca={key:1,class:"p-4 min-w-[200px]"},Ea=V({__name:"LexicalUnitPopoverContent",props:{lexicalUnit:{}},emits:["statusChanged"],setup(t,{emit:e}){const n=t,s=e,a=C(()=>{var i;return(i=n.lexicalUnit)!=null&&i.img?Array.isArray(n.lexicalUnit.img)?n.lexicalUnit.img:[n.lexicalUnit.img]:[]});return(i,o)=>{const r=xn,u=H,l=Nt;return i.lexicalUnit?(v(),S("div",ha,[a.value.length>0?(v(),S("div",va,[a.value.length>1?(v(),R(r,{key:0,"auto-height":"",arrows:"",loop:"",items:a.value,ui:{container:"transition-[height]",controls:"absolute top-3 inset-x-10.5",dots:"-bottom-50",dot:"w-6 h-1"},class:"w-full max-w-xs mx-auto"},{default:b(({item:m})=>[w("img",{src:m,class:"rounded-lg shadow-md w-full h-30 object-contain mx-auto"},null,8,ya)]),_:1},8,["items"])):(v(),S("img",{key:1,src:a.value[0],alt:"Lexical unit image",class:"rounded-lg shadow-md w-full h-30 object-contain mx-auto"},null,8,ba))])):N("",!0),h(Lt,{term:i.lexicalUnit.term},null,8,["term"]),i.lexicalUnit.transcription?(v(),S("p",xa," /"+B(i.lexicalUnit.transcription)+"/ ",1)):N("",!0),w("p",_a,B(i.lexicalUnit.translation),1),w("div",Sa,[h(_n,{"lexical-unit-id":i.lexicalUnit.id,onStatusChanged:o[0]||(o[0]=m=>s("statusChanged",m))},null,8,["lexical-unit-id"])]),w("div",wa,[h(l,{description:"Find similiar terms"},{body:b(()=>[h(ga,{unit:i.lexicalUnit},null,8,["unit"])]),default:b(()=>[h(u,{variant:"secondary",size:"xl",icon:"i-heroicons-magnifying-glass",class:"cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700"})]),_:1}),h(l,{ui:{width:"sm:max-w-lg md:max-w-xl"},description:"Translation online"},{body:b(()=>[h(Ge,{"text-to-translate":i.lexicalUnit.term,"translation-type":"term","auto-fetch":!0},null,8,["text-to-translate"])]),default:b(()=>[h(u,{variant:"primary",size:"xl",icon:"i-heroicons-language",class:"cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 text-blue-500 font-bold"})]),_:1}),h(l,{description:"Lexical unit info"},{body:b(()=>[h(kt,{unit:i.lexicalUnit,"show-all":""},null,8,["unit"])]),default:b(()=>[h(u,{variant:"secondary",size:"xl",icon:"i-heroicons-information-circle",class:"cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700"})]),_:1})])])):(v(),S("div",Ca,o[1]||(o[1]=[w("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"No lexical unit data available.",-1)])))}}}),$a={key:1,class:"p-2 min-w-[180px] max-w-[200px] max-h-[300px] overflow-auto"},Ia=V({__name:"InteractiveToken",props:{token:{type:Object,required:!0}},setup(t){const e=t,n=Z(),s=Q(),a=M(!1),i=C(()=>{var u,l,m,d,c,g;const o=e.token,r=s.settings;return o.isWord?o.lexicalUnit?o.status&&((l=(u=r==null?void 0:r.statusStyles)==null?void 0:u[o.status])!=null&&l.reading)?(d=(m=r.statusStyles)==null?void 0:m[o.status])==null?void 0:d.reading:(g=(c=r==null?void 0:r.statusStyles)==null?void 0:c.new)!=null&&g.reading?r.statusStyles.new.reading:Te:r!=null&&r.unknownUnit?r.unknownUnit:Te:Te});return(o,r)=>{const u=H,l=Oe;return v(),R(l,{mode:"click",arrow:"","open-delay":5,"close-delay":5,open:a.value,"onUpdate:open":r[1]||(r[1]=m=>a.value=m)},{content:b(()=>[t.token.lexicalUnit?(v(),R(Ea,{key:0,"lexical-unit":t.token.lexicalUnit,onStatusChanged:r[0]||(r[0]=m=>a.value=!1)},null,8,["lexical-unit"])):(v(),S("div",$a,[h(Lt,{term:t.token.text,class:"mb-1"},null,8,["term"]),h(Ge,{"text-to-translate":t.token.text,"translation-type":"term","auto-fetch":!0},null,8,["text-to-translate"])]))]),default:b(()=>[h(u,{variant:"primary",padded:!1,label:t.token.text,style:Me({fontSize:`${p(n).settings.fontSize}px`}),class:K([i.value,"text-left cursor-pointer"])},null,8,["label","style","class"])]),_:1},8,["open"])}}}),Na={class:"space-y-4"},Ta={class:"max-h-30 overflow-y-auto space-y-1 border p-2 rounded-md bg-gray-50 dark:bg-gray-700/30"},ka=20,Aa=20,Ra=V({__name:"LineTranslation",props:{initialLineAbsoluteIndex:{}},setup(t){const e=t,n=Z(),s=M(new Set),a=M(null),i=M("");ie(async()=>{e.initialLineAbsoluteIndex!==void 0&&s.value.add(e.initialLineAbsoluteIndex),await $t(),a.value&&a.value.scrollIntoView({block:"center",behavior:"auto"})});const o=C(()=>{const m=n.processedLines;if(!m.length)return[];const d=Math.max(0,e.initialLineAbsoluteIndex-ka),c=Math.min(m.length,e.initialLineAbsoluteIndex+Aa+1);return m.slice(d,c).map((g,f)=>{const y=d+f;return{originalIndex:y,text:g.originalText,isSelected:s.value.has(y),isInitial:y===e.initialLineAbsoluteIndex}})}),r=C(()=>Array.from(s.value).sort((d,c)=>d-c).map(d=>{var c;return((c=n.processedLines[d])==null?void 0:c.originalText)||""}).join(`
`));function u(m,d){return m.length<=d?m:m.substring(0,d)+"..."}function l(m,d){d?s.value.add(m):s.value.delete(m)}return ue(()=>e.initialLineAbsoluteIndex,m=>{s.value.clear(),s.value.add(m)},{immediate:!0}),ie(()=>{e.initialLineAbsoluteIndex!==void 0&&s.value.add(e.initialLineAbsoluteIndex)}),(m,d)=>{const c=En,g=Cn,f=Pe;return v(),S("div",Na,[d[1]||(d[1]=w("h4",{class:"text-md font-medium text-gray-800 dark:text-gray-100"}," Select lines for translation: ",-1)),w("div",Ta,[(v(!0),S(ae,null,xe(o.value,y=>(v(),S("div",{key:y.originalIndex,class:"flex items-center",ref_for:!0,ref:$=>{y.isInitial&&$&&(a.value=$)}},[h(c,{modelValue:y.isSelected,"onUpdate:modelValue":[$=>y.isSelected=$,$=>l(y.originalIndex,$)],label:u(y.text,70),ui:{label:"text-sm truncate"},"container-class":y.isInitial?"font-semibold text-primary-500 dark:text-primary-400":""},null,8,["modelValue","onUpdate:modelValue","label","container-class"])]))),128))]),h(g,{class:"w-full",size:"xl",placeholder:"Additional prompt...",modelValue:i.value,"onUpdate:modelValue":d[0]||(d[0]=y=>i.value=y)},null,8,["modelValue"]),r.value?(v(),R(Ge,{key:0,"text-to-translate":r.value,"translation-type":"line","additional-prompt":i.value},null,8,["text-to-translate","additional-prompt"])):N("",!0),h(f),h(Pt)])}}}),Oa={class:"flex items-center"},Ma={class:"flex flex-col"},Ua={key:1},Fa={key:0,class:"text-gray-500 dark:text-gray-400"},Pa=V({__name:"LineRenderer",props:{},setup(t){const e=M(!1),n=M(null),s=Z();Q();const a=l=>{const{currentPage:m,pageSize:d}=s.settings.pagination,c=(m-1)*d+l;c>=0&&c<s.processedLines.length?(n.value=c,e.value=!0):console.error("Calculated absolute index is out of bounds:",c)},i=C(()=>({fontSize:`${s.settings.fontSize}px`,margin:`${s.settings.fontSize*.7}px 0`,textAlign:s.settings.alignment})),o=Ce(),r=l=>{navigator.clipboard.writeText(l).then(()=>{console.log("Line text copied to clipboard:",l),o.add({title:"Copied to Clipboard",description:"Line text copied successfully!",color:"success",duration:1e3,progress:!1,ui:{title:"text-success"}})}).catch(m=>{console.error("Failed to copy line text:",m),o.add({title:"Copy Failed",description:"Unable to copy line text to clipboard!",color:"error",duration:1e3,progress:!1,ui:{title:"text-error"}})})},u=async l=>{const m="target";try{await It(l,m),console.log(`Speaking line: "${l}"`)}catch(d){console.error("Failed to speak line:",d),o.add({title:"Speech Failed",description:"Unable to speak the line.",color:"error",duration:2e3})}};return(l,m)=>{const d=Ee,c=H,g=Nt,f=Pe,y=Oe;return v(),S(ae,null,[(v(!0),S(ae,null,xe(p(s).paginatedLines,($,I)=>(v(),S("div",{key:$.id,class:"flex items-center"},[w("div",Oa,[h(y,{mode:"click",arrow:"",content:{align:"center",side:"top",sideOffset:0}},{content:b(()=>[w("div",Ma,[h(c,{variant:"primary",size:"xl",icon:"i-heroicons-clipboard-document",class:"cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700",onClick:k=>r($.originalText)},null,8,["onClick"]),h(c,{variant:"primary",size:"xl",icon:"i-heroicons-speaker-wave",class:"cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700",onClick:k=>u($.originalText)},null,8,["onClick"]),$.translation||$.translation?(v(),R(g,{key:0,description:"Translation and note"},{body:b(()=>[h(Bt,{note:$.note,translation:$.translation},null,8,["note","translation"])]),default:b(()=>[h(c,{variant:"secondary",size:"xl",icon:"i-heroicons-language",class:"cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700"})]),_:2},1024)):N("",!0),h(f),h(g,{modelValue:e.value,"onUpdate:modelValue":m[0]||(m[0]=k=>e.value=k),ui:{width:"sm:max-w-lg md:max-w-xl"},description:"Translation online"},{body:b(()=>[n.value!==null?(v(),R(Ra,{key:0,"initial-line-absolute-index":n.value},null,8,["initial-line-absolute-index"])):N("",!0)]),default:b(()=>[h(c,{variant:"primary",size:"xl",icon:"i-heroicons-language",class:"cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 text-blue-500 font-bold",onClick:k=>a(I)},null,8,["onClick"])]),_:2},1032,["modelValue"])])]),default:b(()=>[h(c,{color:"gray","aria-label":"Line options",class:"cursor-pointer"},{default:b(()=>[h(d,{name:"i-heroicons-ellipsis-horizontal-circle",class:"size-8"})]),_:1})]),_:2},1024)]),w("p",{class:"flex-1 leading-relaxed pe-1",style:Me(i.value)},[(v(!0),S(ae,null,xe($.tokens,(k,_)=>(v(),S(ae,{key:`token-${I}-${_}`},[k.isWord?(v(),R(Ia,{key:0,token:k},null,8,["token"])):(v(),S("span",Ua,B(k.text),1))],64))),128))],4)]))),128)),p(s).processedLines.length===0&&!p(s).isLoading?(v(),S("div",Fa," No text content to display. ")):N("",!0)],64)}}}),La={class:"flex flex-col items-center space-y-7"},Da=V({__name:"LexicalUnitsMiniFilter",setup(t){const e=$n(),n=Sn(),s=Z(),a=Ce(),i=C(()=>{const l=new Set;return s.processedLines&&s.processedLines.forEach(m=>{m.tokens.forEach(d=>{d.isWord&&d.lexicalUnit&&l.add(d.lexicalUnit.id)})}),l}),o=()=>{e.resetFilterOptions()},r=async()=>{await e.applyFilters()},u=async()=>{await r();const l=e.filteredLexicalUnits.filter(m=>i.value.has(m.id));l.length<1?a.add({title:"No Cards Found",description:"No lexical units matching the selected filters were found in the current text.",color:"error",icon:"i-heroicons-information-circle"}):(n.endSession(),n.startSession(In(l)),ln.push({name:"flash_cards"}))};return ie(()=>{o()}),(l,m)=>{const d=Ue,c=Fe,g=H;return v(),S("div",La,[h(c,{label:"Select Statuses",ui:{label:"text-sm font-medium text-gray-700 dark:text-gray-300"},class:"mt-2"},{default:b(()=>[h(d,{modelValue:p(e).options.status.chosen,"onUpdate:modelValue":[m[0]||(m[0]=f=>p(e).options.status.chosen=f),m[1]||(m[1]=f=>p(e).updateStatusChosen(f))],items:p(ve),multiple:"",placeholder:"Select statuses...","value-attribute":"value","option-attribute":"label",searchable:"",ui:{default:{option:{active:"bg-gray-100 dark:bg-gray-700"}}}},null,8,["modelValue","items"])]),_:1}),h(g,{onClick:u,label:"Start Flash Cards",size:"xl",icon:"i-heroicons-bolt-solid",color:"error",variant:"outline",ui:{rounded:"rounded-full",font:"font-bold"},class:"cursor-pointer animate-bounce"})])}}}),Va={class:"text-renderer space-y-2"},Ga={class:"flex justify-between items-center"},qa={class:"flex items-center gap-x-2"},ja={key:0,class:"text-center py-5"},Ba={key:1,class:"px-4 pt-2"},za=["src","alt"],Ka={key:1,class:"text-2xl font-bold mb-1 text-gray-900 dark:text-white"},Ha={key:2,class:"text-md text-gray-700 dark:text-gray-300 mb-3"},Wa=["innerHTML"],Ya={key:3,class:"flex justify-between items-center p-4 z-20 space-x-2"},Ja={class:"flex items-center space-x-1"},Xa={class:"text-sm text-gray-500 dark:text-gray-400"},Za=V({__name:"TextRenderer",props:{material:{type:Object,required:!0}},setup(t){const e=t,n=Q(),s=Z(),a=M(!1),i=De(),o=C(()=>e.material.text);C(()=>n.lexicalUnits?n.lexicalUnits.map(c=>({id:c.id,term:c.term})):[]),ue([o,()=>n.lexicalUnits],([c],[g])=>{s.processText(c,n.lexicalUnits,n.status,n.settings),c!==g&&s.settings.pagination.currentPage!==1&&s.updatePaginationSettings({currentPage:1})},{immediate:!0,deep:!0});const r=C(()=>!s.settings.pagination.show||s.settings.pagination.pageSize<=0||s.processedLines.length===0?1:Math.ceil(s.processedLines.length/s.settings.pagination.pageSize)),u=(c,g=!0)=>{let f=Number(c);isNaN(f)&&(f=s.settings.pagination.currentPage);const y=r.value;f<1?f=1:f>y&&(f=y),f!==s.settings.pagination.currentPage&&(s.updatePaginationSettings({currentPage:f}),g&&$t(()=>{window.scrollTo({top:0,behavior:"smooth"})}))},l=()=>{const c=r.value;let g=s.settings.pagination.currentPage-1;g<1&&(g=c),u(g)},m=()=>{const c=r.value;let g=s.settings.pagination.currentPage+1;g>c&&(g=1),u(g)},d=C({get:()=>s.settings.pagination.currentPage,set:c=>{const g=Number(c);u(g,!1)}});return(c,g)=>{const f=Ee,y=H,$=Oe,I=Hn,k=Ft;return v(),S("div",Va,[w("div",Ga,[h(y,{onClick:g[0]||(g[0]=_=>p(i).clearMaterial()),color:"gray",class:"cursor-pointer"},{default:b(()=>[h(f,{name:"i-heroicons-arrow-left",class:"size-7"})]),_:1}),w("div",qa,[h($,null,{content:b(()=>[h(Da)]),default:b(()=>[h(y,{color:"gray","aria-label":"Open mini filter for flash cards",class:"cursor-pointer"},{default:b(()=>[h(f,{name:"i-heroicons-rectangle-stack",class:"size-7"})]),_:1})]),_:1}),h(I,{title:"Settings",open:a.value,"onUpdate:open":g[1]||(g[1]=_=>a.value=_)},{body:b(()=>[h(cs)]),default:b(()=>[h(y,{color:"gray","aria-label":"Open settings",class:"cursor-pointer"},{default:b(()=>[h(f,{name:"i-heroicons-cog-6-tooth-20-solid",class:"size-7"})]),_:1})]),_:1},8,["open"])])]),p(s).isLoading?(v(),S("div",ja,g[4]||(g[4]=[w("p",{class:"text-gray-500 dark:text-gray-400"},"Processing text...",-1)]))):N("",!0),!p(s).isLoading&&e.material&&d.value===1?(v(),S("div",Ba,[e.material.info.imageUrl?(v(),S("img",{key:0,src:e.material.info.imageUrl,alt:e.material.info.title||"Material image",class:"w-full h-auto object-cover rounded-md mb-4 max-h-72 max-w-[400px]",onError:g[2]||(g[2]=_=>_.target.style.display="none")},null,40,za)):N("",!0),e.material.info.title?(v(),S("h1",Ka,B(e.material.info.title),1)):N("",!0),e.material.info.description?(v(),S("p",Ha,B(e.material.info.description),1)):N("",!0)])):N("",!0),e.material&&e.material.note&&p(s).settings.note.show?(v(),S("div",{key:2,class:K(["w-full overflow-y-auto border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 p-3 z-10",p(s).settings.note.isSticky&&!a.value?"sticky top-0":""]),style:Me({height:`${p(s).settings.note.height}px`}),innerHTML:e.material.note},null,14,Wa)):N("",!0),h(Pa),!p(s).isLoading&&p(s).settings.pagination.show&&r.value>1?(v(),S("div",Ya,[h(y,{icon:"i-heroicons-chevron-left-20-solid",onClick:l,"aria-label":"Previous page",size:"xl",ui:{padding:{xl:"p-3 md:p-4"},icon:{size:{xl:"h-7 w-7 md:h-8 md:w-8"}}},class:"cursor-pointer"}),w("div",Ja,[h(k,{modelValue:d.value,"onUpdate:modelValue":g[3]||(g[3]=_=>d.value=_),modelModifiers:{number:!0},size:"lg",min:1,max:r.value>0?r.value:1,class:"w-full",inputClass:"text-center","aria-label":"Current page number"},null,8,["modelValue","max"]),w("span",Xa,"of "+B(r.value),1)]),h(y,{icon:"i-heroicons-chevron-right-20-solid",onClick:m,"aria-label":"Next page",size:"xl",ui:{padding:{xl:"p-3 md:p-4"},icon:{size:{xl:"h-7 w-7 md:h-8 md:w-8"}}},class:"cursor-pointer"})])):N("",!0)])}}}),Qa={class:"container mx-auto p-4 pt-0"},ei={key:0},ti={key:1},pi=V({__name:"TextMaterialPage",setup(t){Q();const e=De();return(n,s)=>(v(),S("div",Qa,[w("div",null,[p(e).isMaterialLoaded?(v(),S("div",ti,[h(Za,{material:p(e).currentMaterial},null,8,["material"])])):(v(),S("div",ei,[s[0]||(s[0]=w("h2",{class:"text-2xl font-bold text-center mb-6 mt-3"},"Load a Text to Start Reading",-1)),h(Bn)]))])]))}});export{pi as default};
