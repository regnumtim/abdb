import{a5 as ii,q as J,h as F,a6 as oi,a7 as li,a8 as rn,a9 as ci,aa as hr,d as te,f as ui,t as di,g as fi,ab as Ht,ac as an,c as K,o as x,w as E,r as ie,H as q,b as y,m as Ce,P as Kt,ad as be,$ as Ue,p as Ke,ae as Te,af as hi,ag as mr,G as T,F as N,I as pe,L as b,_ as ye,e as Ye,A as pr,M as gr,N as yr,ah as mi,ai as pi,B as Lt,C as _r,z as gi,aj as yi,ak as ds,al as _i,am as bi,n as fs,j as hs,k as ce,an as ve,Q as we,K as Me,ao as zt,ap as Qe,V as Jt,aq as vi,a0 as wi,J as Ft,ar as on,as as Nn,at as Pn,a3 as br,au as xi}from"./index-n2uzPz1m.js";import{u as Si}from"./useFormControl-CqseSUcQ.js";import{c as Ci,s as $i,_ as Mn}from"./Select-BGmYKGn0.js";import{_ as Ii,a as Ln,b as Ai,s as vr}from"./speechSynthesis-XSP859qT.js";import{_ as Ei,a as Ri,b as Oi,c as ms,d as ps,e as ki,f as Ti,g as Ni,h as wr}from"./Modal-BTCxmFEl.js";import{_ as Fn}from"./Separator-BkItDrEE.js";import{_ as xr,a as Sr,b as Pi,c as Mi,u as Li}from"./LexicalUnitCard.vue_vue_type_script_setup_true_lang-Bw7r-Gnq.js";import{_ as Cr}from"./Card-DxZRJeNk.js";import{_ as Fi}from"./VoiceSettings.vue_vue_type_script_setup_true_lang-DHLc5Jpx.js";import{_ as Ui}from"./Input-ItNT_LdA.js";import{_ as Di,u as Bi,s as qi}from"./shuffleArray-Uj-kJPMM.js";import"./utils-CpTagOUq.js";function ji(s){const e=ii({locale:J("en")});return F(()=>{var t;return(s==null?void 0:s.value)||((t=e.locale)==null?void 0:t.value)||"en"})}let ln=new Map,vn=!1;try{vn=new Intl.NumberFormat("de-DE",{signDisplay:"exceptZero"}).resolvedOptions().signDisplay==="exceptZero"}catch{}let Ut=!1;try{Ut=new Intl.NumberFormat("de-DE",{style:"unit",unit:"degree"}).resolvedOptions().style==="unit"}catch{}const $r={degree:{narrow:{default:"°","ja-JP":" 度","zh-TW":"度","sl-SI":" °"}}};class Ir{format(e){let t="";if(!vn&&this.options.signDisplay!=null?t=Gi(this.numberFormatter,this.options.signDisplay,e):t=this.numberFormatter.format(e),this.options.style==="unit"&&!Ut){var n;let{unit:r,unitDisplay:a="short",locale:i}=this.resolvedOptions();if(!r)return t;let o=(n=$r[r])===null||n===void 0?void 0:n[a];t+=o[i]||o.default}return t}formatToParts(e){return this.numberFormatter.formatToParts(e)}formatRange(e,t){if(typeof this.numberFormatter.formatRange=="function")return this.numberFormatter.formatRange(e,t);if(t<e)throw new RangeError("End date must be >= start date");return`${this.format(e)} – ${this.format(t)}`}formatRangeToParts(e,t){if(typeof this.numberFormatter.formatRangeToParts=="function")return this.numberFormatter.formatRangeToParts(e,t);if(t<e)throw new RangeError("End date must be >= start date");let n=this.numberFormatter.formatToParts(e),r=this.numberFormatter.formatToParts(t);return[...n.map(a=>({...a,source:"startRange"})),{type:"literal",value:" – ",source:"shared"},...r.map(a=>({...a,source:"endRange"}))]}resolvedOptions(){let e=this.numberFormatter.resolvedOptions();return!vn&&this.options.signDisplay!=null&&(e={...e,signDisplay:this.options.signDisplay}),!Ut&&this.options.style==="unit"&&(e={...e,style:"unit",unit:this.options.unit,unitDisplay:this.options.unitDisplay}),e}constructor(e,t={}){this.numberFormatter=Vi(e,t),this.options=t}}function Vi(s,e={}){let{numberingSystem:t}=e;if(t&&s.includes("-nu-")&&(s.includes("-u-")||(s+="-u-"),s+=`-nu-${t}`),e.style==="unit"&&!Ut){var n;let{unit:i,unitDisplay:o="short"}=e;if(!i)throw new Error('unit option must be provided with style: "unit"');if(!(!((n=$r[i])===null||n===void 0)&&n[o]))throw new Error(`Unsupported unit ${i} with unitDisplay = ${o}`);e={...e,style:"decimal"}}let r=s+(e?Object.entries(e).sort((i,o)=>i[0]<o[0]?-1:1).join():"");if(ln.has(r))return ln.get(r);let a=new Intl.NumberFormat(s,e);return ln.set(r,a),a}function Gi(s,e,t){if(e==="auto")return s.format(t);if(e==="never")return s.format(Math.abs(t));{let n=!1;if(e==="always"?n=t>0||Object.is(t,0):e==="exceptZero"&&(Object.is(t,-0)||Object.is(t,0)?t=Math.abs(t):n=t>0),n){let r=s.format(-t),a=s.format(t),i=r.replace(a,"").replace(/\u200e|\u061C/,"");return[...i].length!==1&&console.warn("@react-aria/i18n polyfill for NumberFormat signDisplay: Unsupported case"),r.replace(a,"!!!").replace(i,"+").replace("!!!",a)}else return s.format(t)}}const Wi=new RegExp("^.*\\(.*\\).*$"),Hi=["latn","arab","hanidec","deva","beng"];class Ar{parse(e){return cn(this.locale,this.options,e).parse(e)}isValidPartialNumber(e,t,n){return cn(this.locale,this.options,e).isValidPartialNumber(e,t,n)}getNumberingSystem(e){return cn(this.locale,this.options,e).options.numberingSystem}constructor(e,t={}){this.locale=e,this.options=t}}const gs=new Map;function cn(s,e,t){let n=ys(s,e);if(!s.includes("-nu-")&&!n.isValidPartialNumber(t)){for(let r of Hi)if(r!==n.options.numberingSystem){let a=ys(s+(s.includes("-u-")?"-nu-":"-u-nu-")+r,e);if(a.isValidPartialNumber(t))return a}}return n}function ys(s,e){let t=s+(e?Object.entries(e).sort((r,a)=>r[0]<a[0]?-1:1).join():""),n=gs.get(t);return n||(n=new Ki(s,e),gs.set(t,n)),n}class Ki{parse(e){let t=this.sanitize(e);if(this.symbols.group&&(t=Je(t,this.symbols.group,"")),this.symbols.decimal&&(t=t.replace(this.symbols.decimal,".")),this.symbols.minusSign&&(t=t.replace(this.symbols.minusSign,"-")),t=t.replace(this.symbols.numeral,this.symbols.index),this.options.style==="percent"){let i=t.indexOf("-");t=t.replace("-","");let o=t.indexOf(".");o===-1&&(o=t.length),t=t.replace(".",""),o-2===0?t=`0.${t}`:o-2===-1?t=`0.0${t}`:o-2===-2?t="0.00":t=`${t.slice(0,o-2)}.${t.slice(o-2)}`,i>-1&&(t=`-${t}`)}let n=t?+t:NaN;if(isNaN(n))return NaN;if(this.options.style==="percent"){var r,a;let i={...this.options,style:"decimal",minimumFractionDigits:Math.min(((r=this.options.minimumFractionDigits)!==null&&r!==void 0?r:0)+2,20),maximumFractionDigits:Math.min(((a=this.options.maximumFractionDigits)!==null&&a!==void 0?a:0)+2,20)};return new Ar(this.locale,i).parse(new Ir(this.locale,i).format(n))}return this.options.currencySign==="accounting"&&Wi.test(e)&&(n=-1*n),n}sanitize(e){return e=e.replace(this.symbols.literals,""),this.symbols.minusSign&&(e=e.replace("-",this.symbols.minusSign)),this.options.numberingSystem==="arab"&&(this.symbols.decimal&&(e=e.replace(",",this.symbols.decimal),e=e.replace("،",this.symbols.decimal)),this.symbols.group&&(e=Je(e,".",this.symbols.group))),this.options.locale==="fr-FR"&&this.symbols.group&&(e=Je(e," ",this.symbols.group),e=Je(e,/\u00A0/g,this.symbols.group)),e}isValidPartialNumber(e,t=-1/0,n=1/0){return e=this.sanitize(e),this.symbols.minusSign&&e.startsWith(this.symbols.minusSign)&&t<0?e=e.slice(this.symbols.minusSign.length):this.symbols.plusSign&&e.startsWith(this.symbols.plusSign)&&n>0&&(e=e.slice(this.symbols.plusSign.length)),this.symbols.group&&e.startsWith(this.symbols.group)||this.symbols.decimal&&e.indexOf(this.symbols.decimal)>-1&&this.options.maximumFractionDigits===0?!1:(this.symbols.group&&(e=Je(e,this.symbols.group,"")),e=e.replace(this.symbols.numeral,""),this.symbols.decimal&&(e=e.replace(this.symbols.decimal,"")),e.length===0)}constructor(e,t={}){this.locale=e,t.roundingIncrement!==1&&t.roundingIncrement!=null&&(t.maximumFractionDigits==null&&t.minimumFractionDigits==null?(t.maximumFractionDigits=0,t.minimumFractionDigits=0):t.maximumFractionDigits==null?t.maximumFractionDigits=t.minimumFractionDigits:t.minimumFractionDigits==null&&(t.minimumFractionDigits=t.maximumFractionDigits)),this.formatter=new Intl.NumberFormat(e,t),this.options=this.formatter.resolvedOptions(),this.symbols=Ji(e,this.formatter,this.options,t);var n,r;this.options.style==="percent"&&(((n=this.options.minimumFractionDigits)!==null&&n!==void 0?n:0)>18||((r=this.options.maximumFractionDigits)!==null&&r!==void 0?r:0)>18)&&console.warn("NumberParser cannot handle percentages with greater than 18 decimal places, please reduce the number in your options.")}}const _s=new Set(["decimal","fraction","integer","minusSign","plusSign","group"]),zi=[0,4,2,1,11,20,3,7,100,21,.1,1.1];function Ji(s,e,t,n){var r,a,i,o;let l=new Intl.NumberFormat(s,{...t,minimumSignificantDigits:1,maximumSignificantDigits:21,roundingIncrement:1,roundingPriority:"auto",roundingMode:"halfExpand"}),c=l.formatToParts(-10000.111),f=l.formatToParts(10000.111),d=zi.map($=>l.formatToParts($));var h;let u=(h=(r=c.find($=>$.type==="minusSign"))===null||r===void 0?void 0:r.value)!==null&&h!==void 0?h:"-",m=(a=f.find($=>$.type==="plusSign"))===null||a===void 0?void 0:a.value;!m&&((n==null?void 0:n.signDisplay)==="exceptZero"||(n==null?void 0:n.signDisplay)==="always")&&(m="+");let _=(i=new Intl.NumberFormat(s,{...t,minimumFractionDigits:2,maximumFractionDigits:2}).formatToParts(.001).find($=>$.type==="decimal"))===null||i===void 0?void 0:i.value,P=(o=c.find($=>$.type==="group"))===null||o===void 0?void 0:o.value,v=c.filter($=>!_s.has($.type)).map($=>bs($.value)),S=d.flatMap($=>$.filter(k=>!_s.has(k.type)).map(k=>bs(k.value))),C=[...new Set([...v,...S])].sort(($,k)=>k.length-$.length),O=C.length===0?new RegExp("[\\p{White_Space}]","gu"):new RegExp(`${C.join("|")}|[\\p{White_Space}]`,"gu"),L=[...new Intl.NumberFormat(t.locale,{useGrouping:!1}).format(9876543210)].reverse(),w=new Map(L.map(($,k)=>[$,k])),R=new RegExp(`[${L.join("")}]`,"g");return{minusSign:u,plusSign:m,decimal:_,group:P,literals:O,numeral:R,index:$=>String(w.get($))}}function Je(s,e,t){return s.replaceAll?s.replaceAll(e,t):s.split(e).join(t)}function bs(s){return s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Er(s){const{disabled:e}=s,t=J(),n=ci(),r=()=>window.clearTimeout(t.value),a=h=>{r(),!e.value&&(n.trigger(),t.value=window.setTimeout(()=>{a(60)},h))},i=()=>{a(400)},o=()=>{r()},l=J(!1),c=F(()=>oi(s.target)),f=h=>{h.button!==0||l.value||(h.preventDefault(),l.value=!0,i())},d=()=>{l.value=!1,o()};return li&&(rn(c||window,"pointerdown",f),rn(window,"pointerup",d),rn(window,"pointercancel",d)),{isPressed:l,onTrigger:n.on}}function vs(s,e=J({})){return hr(()=>new Ir(s.value,e.value))}function Xi(s,e=J({})){return hr(()=>new Ar(s.value,e.value))}function ws(s,e,t){let n=s==="+"?e+t:e-t;if(e%1!==0||t%1!==0){const r=e.toString().split("."),a=t.toString().split("."),i=r[1]&&r[1].length||0,o=a[1]&&a[1].length||0,l=10**Math.max(i,o);e=Math.round(e*l),t=Math.round(t*l),n=s==="+"?e+t:e-t,n/=l}return n}const[Un,Yi]=ui("NumberFieldRoot"),Qi=te({inheritAttrs:!1,__name:"NumberFieldRoot",props:{defaultValue:{default:void 0},modelValue:{},min:{},max:{},step:{default:1},stepSnapping:{type:Boolean,default:!0},formatOptions:{},locale:{},disabled:{type:Boolean},disableWheelChange:{type:Boolean},invertWheelChange:{type:Boolean},id:{},asChild:{type:Boolean},as:{default:"div"},name:{},required:{type:Boolean}},emits:["update:modelValue"],setup(s,{emit:e}){const t=s,n=e,{disabled:r,disableWheelChange:a,invertWheelChange:i,min:o,max:l,step:c,stepSnapping:f,formatOptions:d,id:h,locale:u}=di(t),m=fi(t,"modelValue",n,{defaultValue:t.defaultValue,passive:t.modelValue===void 0}),{primitiveElement:g,currentElement:_}=Ht(),P=ji(u),v=Si(_),S=J(),C=F(()=>!an(m.value)&&(H(m.value)===o.value||o.value&&!isNaN(m.value)?ws("-",m.value,c.value)<o.value:!1)),O=F(()=>!an(m.value)&&(H(m.value)===l.value||l.value&&!isNaN(m.value)?ws("+",m.value,c.value)>l.value:!1));function L(G,re=1){var cs,us;(cs=S.value)==null||cs.focus();const sn=k.parse(((us=S.value)==null?void 0:us.value)??"");t.disabled||(isNaN(sn)?m.value=o.value??0:G==="increase"?m.value=H(sn+(c.value??1)*re):m.value=H(sn-(c.value??1)*re))}function w(G=1){L("increase",G)}function R(G=1){L("decrease",G)}function A(G){G==="min"&&o.value!==void 0?m.value=H(o.value):G==="max"&&l.value!==void 0&&(m.value=H(l.value))}const $=vs(P,d),k=Xi(P,d),z=F(()=>$.resolvedOptions().maximumFractionDigits>0?"decimal":"numeric"),W=vs(P,d),j=F(()=>an(m.value)||isNaN(m.value)?"":W.format(m.value));function X(G){return k.isValidPartialNumber(G,o.value,l.value)}function ue(G){S.value&&(S.value.value=G)}function H(G){let re;return c.value===void 0||isNaN(c.value)||!f.value?re=Ci(G,o.value,l.value):re=$i(G,o.value,l.value,c.value),re=k.parse($.format(re)),re}function bt(G){const re=k.parse(G);return m.value=isNaN(re)?void 0:H(re),G.length?(isNaN(re),ue(j.value)):ue(G)}return Yi({modelValue:m,handleDecrease:R,handleIncrease:w,handleMinMaxValue:A,inputMode:z,inputEl:S,onInputElement:G=>S.value=G,textValue:j,validate:X,applyInputValue:bt,disabled:r,disableWheelChange:a,invertWheelChange:i,max:l,min:o,isDecreaseDisabled:C,isIncreaseDisabled:O,id:h}),(G,re)=>(x(),K(y(Kt),Ce(G.$attrs,{ref_key:"primitiveElement",ref:g,role:"group",as:G.as,"as-child":G.asChild,"data-disabled":y(r)?"":void 0}),{default:E(()=>[ie(G.$slots,"default",{modelValue:y(m),textValue:j.value}),y(v)&&G.name?(x(),K(y(Ii),{key:0,type:"text",value:y(m),name:G.name,disabled:y(r),required:G.required},null,8,["value","name","disabled","required"])):q("",!0)]),_:3},16,["as","as-child","data-disabled"]))}}),Zi=te({__name:"NumberFieldDecrement",props:{disabled:{type:Boolean},asChild:{type:Boolean},as:{default:"button"}},setup(s){const e=s,t=Un(),n=F(()=>{var l;return((l=t.disabled)==null?void 0:l.value)||e.disabled||t.isDecreaseDisabled.value}),{primitiveElement:r,currentElement:a}=Ht(),{isPressed:i,onTrigger:o}=Er({target:a,disabled:n});return o(()=>{t.handleDecrease()}),(l,c)=>(x(),K(y(Kt),Ce(e,{ref_key:"primitiveElement",ref:r,tabindex:"-1","aria-label":"Decrease",type:l.as==="button"?"button":void 0,style:{userSelect:y(i)?"none":void 0},disabled:n.value?"":void 0,"data-disabled":n.value?"":void 0,"data-pressed":y(i)?"true":void 0,onContextmenu:c[0]||(c[0]=be(()=>{},["prevent"]))}),{default:E(()=>[ie(l.$slots,"default")]),_:3},16,["type","style","disabled","data-disabled","data-pressed"]))}}),eo=te({__name:"NumberFieldIncrement",props:{disabled:{type:Boolean},asChild:{type:Boolean},as:{default:"button"}},setup(s){const e=s,t=Un(),n=F(()=>{var l;return((l=t.disabled)==null?void 0:l.value)||e.disabled||t.isIncreaseDisabled.value}),{primitiveElement:r,currentElement:a}=Ht(),{isPressed:i,onTrigger:o}=Er({target:a,disabled:n});return o(()=>{t.handleIncrease()}),(l,c)=>(x(),K(y(Kt),Ce(e,{ref_key:"primitiveElement",ref:r,tabindex:"-1","aria-label":"Increase",type:l.as==="button"?"button":void 0,style:{userSelect:y(i)?"none":void 0},disabled:n.value?"":void 0,"data-disabled":n.value?"":void 0,"data-pressed":y(i)?"true":void 0,onContextmenu:c[0]||(c[0]=be(()=>{},["prevent"]))}),{default:E(()=>[ie(l.$slots,"default")]),_:3},16,["type","style","disabled","data-disabled","data-pressed"]))}}),to=te({__name:"NumberFieldInput",props:{asChild:{type:Boolean},as:{default:"input"}},setup(s){const e=s,{primitiveElement:t,currentElement:n}=Ht(),r=Un();function a(l){r.disableWheelChange.value||l.target===hi()&&(Math.abs(l.deltaY)<=Math.abs(l.deltaX)||(l.preventDefault(),l.deltaY>0?r.invertWheelChange.value?r.handleDecrease():r.handleIncrease():l.deltaY<0&&(r.invertWheelChange.value?r.handleIncrease():r.handleDecrease())))}Ue(()=>{r.onInputElement(n.value)});const i=J(r.textValue.value);Ke(()=>r.textValue.value,()=>{i.value=r.textValue.value},{immediate:!0,deep:!0});function o(){requestAnimationFrame(()=>{i.value=r.textValue.value})}return(l,c)=>(x(),K(y(Kt),Ce(e,{id:y(r).id.value,ref_key:"primitiveElement",ref:t,value:i.value,role:"spinbutton",type:"text",tabindex:"0",inputmode:y(r).inputMode.value,disabled:y(r).disabled.value?"":void 0,"data-disabled":y(r).disabled.value?"":void 0,autocomplete:"off",autocorrect:"off",spellcheck:"false","aria-roledescription":"Number field","aria-valuenow":y(r).modelValue.value,"aria-valuemin":y(r).min.value,"aria-valuemax":y(r).max.value,onKeydown:[c[0]||(c[0]=Te(be(f=>y(r).handleIncrease(),["prevent"]),["up"])),c[1]||(c[1]=Te(be(f=>y(r).handleDecrease(),["prevent"]),["down"])),c[2]||(c[2]=Te(be(f=>y(r).handleIncrease(10),["prevent"]),["page-up"])),c[3]||(c[3]=Te(be(f=>y(r).handleDecrease(10),["prevent"]),["page-down"])),c[4]||(c[4]=Te(be(f=>y(r).handleMinMaxValue("min"),["prevent"]),["home"])),c[5]||(c[5]=Te(be(f=>y(r).handleMinMaxValue("max"),["prevent"]),["end"])),c[8]||(c[8]=Te(f=>{var d;return y(r).applyInputValue((d=f.target)==null?void 0:d.value)},["enter"]))],onWheel:a,onBeforeinput:c[6]||(c[6]=f=>{const d=f.target;let h=d.value.slice(0,d.selectionStart??void 0)+(f.data??"")+d.value.slice(d.selectionEnd??void 0);y(r).validate(h)||f.preventDefault()}),onInput:c[7]||(c[7]=f=>{const d=f.target;i.value=d.value}),onChange:o,onBlur:c[9]||(c[9]=f=>{var d;return y(r).applyInputValue((d=f.target)==null?void 0:d.value)})}),{default:E(()=>[ie(l.$slots,"default")]),_:3},16,["id","value","inputmode","disabled","data-disabled","aria-valuenow","aria-valuemin","aria-valuemax"]))}}),Dn=mr("textMaterials",{state:()=>({currentMaterial:null,isLoading:!1}),actions:{async loadMaterialFromFile(s){this.isLoading=!0,this.currentMaterial=null;try{const e=await s.text();let t;if(s.name.endsWith(".json")){const n=JSON.parse(e);if(typeof n=="object"&&!Array.isArray(n)&&n.content){const r=n;t={info:{title:r.title||s.name,description:r.description,imageUrl:r.img},text:r.content,note:r.note}}else if(Array.isArray(n))t={info:{title:s.name},text:n};else throw new Error('Invalid JSON structure. Expected an object with a "content" key or an array of segments.')}else if(s.name.endsWith(".txt")){const r=e.split(`
`).filter(a=>a.trim()!=="").map(a=>({text:a}));t={info:{title:s.name},text:r}}else throw new Error("Unsupported file type. Please use .json or .txt");this.currentMaterial=t}catch(e){console.error("Failed to load text material:",e),this.currentMaterial=null}finally{this.isLoading=!1}},clearMaterial(){this.currentMaterial=null}},getters:{isMaterialLoaded(){return this.currentMaterial!==null}}}),no={class:"w-full max-w-2xl mx-auto text-center"},so={key:0,class:"mt-4"},ro=te({__name:"TextMaterialLoader",setup(s){const e=Dn(),t=J(!1),n=J(null);async function r(l){l&&await e.loadMaterialFromFile(l)}function a(){var l;(l=n.value)==null||l.click()}async function i(l){const c=l.target;c.files&&c.files.length>0&&(await r(c.files[0]),c.value="")}async function o(l){if(t.value=!1,l.dataTransfer&&l.dataTransfer.files&&l.dataTransfer.files.length>0){const c=l.dataTransfer.files[0];await r(c)}}return(l,c)=>{const f=ye;return x(),T("div",no,[N("input",{ref_key:"fileInput",ref:n,type:"file",onChange:i,accept:".json,.txt",class:"hidden"},null,544),N("div",{onDragover:c[0]||(c[0]=be(d=>t.value=!0,["prevent"])),onDragleave:c[1]||(c[1]=be(d=>t.value=!1,["prevent"])),onDrop:be(o,["prevent"]),class:pe(["border-2 border-dashed rounded-lg p-10 cursor-pointer transition-colors",{"border-primary-500 dark:border-primary-400 bg-primary-50 dark:bg-primary-900/10":t.value,"border-gray-300 dark:border-gray-600 hover:border-gray-400 dark:hover:border-gray-500":!t.value}])},[c[3]||(c[3]=N("p",{class:"text-gray-500 dark:text-gray-400"},"Drag & Drop your Text file here",-1)),c[4]||(c[4]=N("p",{class:"mt-2 text-sm text-gray-400 dark:text-gray-500"},"(.txt or .json)",-1)),c[5]||(c[5]=N("p",{class:"mt-2 text-sm text-gray-400 dark:text-gray-500"},"or",-1)),b(f,{onClick:a,class:"mt-2"},{default:E(()=>c[2]||(c[2]=[Ye("Select File")])),_:1,__:[2]})],34),y(e).isLoading?(x(),T("div",so,c[6]||(c[6]=[N("p",{class:"text-lg animate-pulse text-gray-700 dark:text-gray-300"},"Loading Text...",-1)]))):q("",!0)])}}}),ao={slots:{root:"relative inline-flex items-center",base:["w-full rounded-md border-0 placeholder:text-dimmed focus:outline-none disabled:cursor-not-allowed disabled:opacity-75","transition-colors"],increment:"absolute flex items-center",decrement:"absolute flex items-center"},variants:{buttonGroup:{horizontal:{root:"group has-focus-visible:z-[1]",base:"group-not-only:group-first:rounded-e-none group-not-only:group-last:rounded-s-none group-not-last:group-not-first:rounded-none"},vertical:{root:"group has-focus-visible:z-[1]",base:"group-not-only:group-first:rounded-b-none group-not-only:group-last:rounded-t-none group-not-last:group-not-first:rounded-none"}},color:{primary:"",secondary:"",success:"",info:"",warning:"",error:"",neutral:""},size:{xs:"px-2 py-1 text-xs gap-1",sm:"px-2.5 py-1.5 text-xs gap-1.5",md:"px-2.5 py-1.5 text-sm gap-1.5",lg:"px-3 py-2 text-sm gap-2",xl:"px-3 py-2 text-base gap-2"},variant:{outline:"text-highlighted bg-default ring ring-inset ring-accented",soft:"text-highlighted bg-elevated/50 hover:bg-elevated focus:bg-elevated disabled:bg-elevated/50",subtle:"text-highlighted bg-elevated ring ring-inset ring-accented",ghost:"text-highlighted bg-transparent hover:bg-elevated focus:bg-elevated disabled:bg-transparent dark:disabled:bg-transparent",none:"text-highlighted bg-transparent"},disabled:{true:{increment:"opacity-75 cursor-not-allowed",decrement:"opacity-75 cursor-not-allowed"}},orientation:{horizontal:{base:"text-center",increment:"inset-y-0 end-0 pe-1",decrement:"inset-y-0 start-0 ps-1"},vertical:{increment:"top-0 end-0 pe-1 [&>button]:py-0 scale-80",decrement:"bottom-0 end-0 pe-1 [&>button]:py-0 scale-80"}},highlight:{true:""}},compoundVariants:[{color:"primary",variant:["outline","subtle"],class:"focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-primary"},{color:"secondary",variant:["outline","subtle"],class:"focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-secondary"},{color:"success",variant:["outline","subtle"],class:"focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-success"},{color:"info",variant:["outline","subtle"],class:"focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-info"},{color:"warning",variant:["outline","subtle"],class:"focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-warning"},{color:"error",variant:["outline","subtle"],class:"focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-error"},{color:"primary",highlight:!0,class:"ring ring-inset ring-primary"},{color:"secondary",highlight:!0,class:"ring ring-inset ring-secondary"},{color:"success",highlight:!0,class:"ring ring-inset ring-success"},{color:"info",highlight:!0,class:"ring ring-inset ring-info"},{color:"warning",highlight:!0,class:"ring ring-inset ring-warning"},{color:"error",highlight:!0,class:"ring ring-inset ring-error"},{color:"neutral",variant:["outline","subtle"],class:"focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-inverted"},{color:"neutral",highlight:!0,class:"ring ring-inset ring-inverted"},{orientation:"horizontal",size:"xs",class:"px-7"},{orientation:"horizontal",size:"sm",class:"px-8"},{orientation:"horizontal",size:"md",class:"px-9"},{orientation:"horizontal",size:"lg",class:"px-10"},{orientation:"horizontal",size:"xl",class:"px-11"},{orientation:"vertical",size:"xs",class:"pe-7"},{orientation:"vertical",size:"sm",class:"pe-8"},{orientation:"vertical",size:"md",class:"pe-9"},{orientation:"vertical",size:"lg",class:"pe-10"},{orientation:"vertical",size:"xl",class:"pe-11"}],defaultVariants:{size:"md",color:"primary",variant:"outline"}},Rr=Object.assign({inheritAttrs:!1},{__name:"InputNumber",props:{as:{type:null,required:!1},placeholder:{type:String,required:!1},color:{type:null,required:!1},variant:{type:null,required:!1},size:{type:null,required:!1},highlight:{type:Boolean,required:!1},orientation:{type:String,required:!1,default:"horizontal"},increment:{type:Object,required:!1},incrementIcon:{type:String,required:!1},incrementDisabled:{type:Boolean,required:!1},decrement:{type:Object,required:!1},decrementIcon:{type:String,required:!1},decrementDisabled:{type:Boolean,required:!1},autofocus:{type:Boolean,required:!1},autofocusDelay:{type:Number,required:!1},locale:{type:String,required:!1},class:{type:null,required:!1},ui:{type:null,required:!1},modelValue:{type:[Number,null],required:!1},defaultValue:{type:Number,required:!1},min:{type:Number,required:!1},max:{type:Number,required:!1},step:{type:Number,required:!1},stepSnapping:{type:Boolean,required:!1},disabled:{type:Boolean,required:!1},required:{type:Boolean,required:!1},id:{type:String,required:!1},name:{type:String,required:!1},formatOptions:{type:null,required:!1},disableWheelChange:{type:Boolean,required:!1}},emits:["update:modelValue","blur","change"],setup(s,{expose:e,emit:t}){const n=s,r=t,{t:a,code:i}=pr(),o=_r(),l=gr(yr(n,"as","modelValue","defaultValue","min","max","step","stepSnapping","formatOptions","disableWheelChange"),r),{emitFormBlur:c,emitFormFocus:f,emitFormChange:d,emitFormInput:h,id:u,color:m,size:g,name:_,highlight:P,disabled:v,ariaAttrs:S}=mi(n),{orientation:C,size:O}=pi(n),L=F(()=>n.locale||i.value),w=F(()=>O.value||g.value),R=F(()=>{var X;return Lt({extend:Lt(ao),...((X=o.ui)==null?void 0:X.inputNumber)||{}})({color:m.value,variant:n.variant,size:w.value,highlight:P.value,orientation:n.orientation,buttonGroup:C.value})}),A=F(()=>n.incrementIcon||(n.orientation==="horizontal"?o.ui.icons.plus:o.ui.icons.chevronUp)),$=F(()=>n.decrementIcon||(n.orientation==="horizontal"?o.ui.icons.minus:o.ui.icons.chevronDown)),k=J(null);function z(X){const ue=new Event("change",{target:{value:X}});r("change",ue),d(),h()}function W(X){c(),r("blur",X)}function j(){var X,ue;n.autofocus&&((ue=(X=k.value)==null?void 0:X.$el)==null||ue.focus())}return Ue(()=>{setTimeout(()=>{j()},n.autofocusDelay)}),e({inputRef:k}),(X,ue)=>{var H;return x(),K(y(Qi),Ce(y(l),{id:y(u),class:R.value.root({class:[(H=n.ui)==null?void 0:H.root,n.class]}),name:y(_),disabled:y(v),locale:L.value,"onUpdate:modelValue":z}),{default:E(()=>{var bt,G,re;return[b(y(to),Ce({...X.$attrs,...y(S)},{ref_key:"inputRef",ref:k,placeholder:s.placeholder,required:s.required,class:R.value.base({class:(bt=n.ui)==null?void 0:bt.base}),onBlur:W,onFocus:y(f)}),null,16,["placeholder","required","class","onFocus"]),N("div",{class:pe(R.value.increment({class:(G=n.ui)==null?void 0:G.increment}))},[b(y(eo),{"as-child":"",disabled:y(v)||s.incrementDisabled},{default:E(()=>[ie(X.$slots,"increment",{},()=>[b(ye,Ce({icon:A.value,color:y(m),size:s.size,variant:"link","aria-label":y(a)("inputNumber.increment")},typeof s.increment=="object"?s.increment:void 0),null,16,["icon","color","size","aria-label"])])]),_:3},8,["disabled"])],2),N("div",{class:pe(R.value.decrement({class:(re=n.ui)==null?void 0:re.decrement}))},[b(y(Zi),{"as-child":"",disabled:y(v)||s.decrementDisabled},{default:E(()=>[ie(X.$slots,"decrement",{},()=>[b(ye,Ce({icon:$.value,color:y(m),size:s.size,variant:"link","aria-label":y(a)("inputNumber.decrement")},typeof s.decrement=="object"?s.decrement:void 0),null,16,["icon","color","size","aria-label"])])]),_:3},8,["disabled"])],2)]}),_:3},16,["id","class","name","disabled","locale"])}}}),io={slots:{overlay:"fixed inset-0 bg-elevated/75",content:"fixed bg-default divide-y divide-default sm:ring ring-default sm:shadow-lg flex flex-col focus:outline-none",header:"flex items-center gap-1.5 p-4 sm:px-6 min-h-16",wrapper:"",body:"flex-1 overflow-y-auto p-4 sm:p-6",footer:"flex items-center gap-1.5 p-4 sm:px-6",title:"text-highlighted font-semibold",description:"mt-1 text-muted text-sm",close:"absolute top-4 end-4"},variants:{side:{top:{content:"inset-x-0 top-0 max-h-full"},right:{content:"right-0 inset-y-0 w-full max-w-md"},bottom:{content:"inset-x-0 bottom-0 max-h-full"},left:{content:"left-0 inset-y-0 w-full max-w-md"}},transition:{true:{overlay:"data-[state=open]:animate-[fade-in_200ms_ease-out] data-[state=closed]:animate-[fade-out_200ms_ease-in]"}}},compoundVariants:[{transition:!0,side:"top",class:{content:"data-[state=open]:animate-[slide-in-from-top_200ms_ease-in-out] data-[state=closed]:animate-[slide-out-to-top_200ms_ease-in-out]"}},{transition:!0,side:"right",class:{content:"data-[state=open]:animate-[slide-in-from-right_200ms_ease-in-out] data-[state=closed]:animate-[slide-out-to-right_200ms_ease-in-out]"}},{transition:!0,side:"bottom",class:{content:"data-[state=open]:animate-[slide-in-from-bottom_200ms_ease-in-out] data-[state=closed]:animate-[slide-out-to-bottom_200ms_ease-in-out]"}},{transition:!0,side:"left",class:{content:"data-[state=open]:animate-[slide-in-from-left_200ms_ease-in-out] data-[state=closed]:animate-[slide-out-to-left_200ms_ease-in-out]"}}]},oo={__name:"Slideover",props:{title:{type:String,required:!1},description:{type:String,required:!1},content:{type:Object,required:!1},overlay:{type:Boolean,required:!1,default:!0},transition:{type:Boolean,required:!1,default:!0},side:{type:null,required:!1,default:"right"},portal:{type:[Boolean,String],required:!1,skipCheck:!0,default:!0},close:{type:[Boolean,Object],required:!1,default:!0},closeIcon:{type:String,required:!1},dismissible:{type:Boolean,required:!1,default:!0},class:{type:null,required:!1},ui:{type:null,required:!1},open:{type:Boolean,required:!1},defaultOpen:{type:Boolean,required:!1},modal:{type:Boolean,required:!1,default:!0}},emits:["after:leave","after:enter","close:prevent","update:open"],setup(s,{emit:e}){const t=s,n=e,r=gi(),{t:a}=pr(),i=_r(),o=gr(yr(t,"open","defaultOpen","modal"),n),l=yi(ds(()=>t.portal)),c=ds(()=>t.content),f=F(()=>{const h={closeAutoFocus:u=>u.preventDefault()};return t.dismissible?h:["pointerDownOutside","interactOutside","escapeKeyDown","closeAutoFocus"].reduce((m,g)=>(m[g]=_=>{_.preventDefault(),n("close:prevent")},m),{})}),d=F(()=>{var h;return Lt({extend:Lt(io),...((h=i.ui)==null?void 0:h.slideover)||{}})({transition:t.transition,side:t.side})});return(h,u)=>(x(),K(y(Ti),fs(hs(y(o))),{default:E(({open:m})=>[r.default?(x(),K(y(Ei),{key:0,"as-child":"",class:pe(t.class)},{default:E(()=>[ie(h.$slots,"default",{open:m})]),_:2},1032,["class"])):q("",!0),b(y(ki),fs(hs(y(l))),{default:E(()=>{var g,_;return[s.overlay?(x(),K(y(Ri),{key:0,class:pe(d.value.overlay({class:(g=t.ui)==null?void 0:g.overlay}))},null,8,["class"])):q("",!0),b(y(Oi),Ce({"data-side":s.side,class:d.value.content({class:[!r.default&&t.class,(_=t.ui)==null?void 0:_.content]})},c.value,{onAfterEnter:u[0]||(u[0]=P=>n("after:enter")),onAfterLeave:u[1]||(u[1]=P=>n("after:leave"))},_i(f.value)),{default:E(()=>[r.content&&(s.title||r.title||s.description||r.description)?(x(),K(y(bi),{key:0},{default:E(()=>[s.title||r.title?(x(),K(y(ms),{key:0},{default:E(()=>[ie(h.$slots,"title",{},()=>[Ye(ce(s.title),1)])]),_:3})):q("",!0),s.description||r.description?(x(),K(y(ps),{key:1},{default:E(()=>[ie(h.$slots,"description",{},()=>[Ye(ce(s.description),1)])]),_:3})):q("",!0)]),_:3})):q("",!0),ie(h.$slots,"content",{},()=>{var P,v,S;return[r.header||s.title||r.title||s.description||r.description||s.close||r.close?(x(),T("div",{key:0,class:pe(d.value.header({class:(P=t.ui)==null?void 0:P.header}))},[ie(h.$slots,"header",{},()=>{var C,O,L;return[N("div",{class:pe(d.value.wrapper({class:(C=t.ui)==null?void 0:C.wrapper}))},[s.title||r.title?(x(),K(y(ms),{key:0,class:pe(d.value.title({class:(O=t.ui)==null?void 0:O.title}))},{default:E(()=>[ie(h.$slots,"title",{},()=>[Ye(ce(s.title),1)])]),_:3},8,["class"])):q("",!0),s.description||r.description?(x(),K(y(ps),{key:1,class:pe(d.value.description({class:(L=t.ui)==null?void 0:L.description}))},{default:E(()=>[ie(h.$slots,"description",{},()=>[Ye(ce(s.description),1)])]),_:3},8,["class"])):q("",!0)],2),s.close||r.close?(x(),K(y(Ni),{key:0,"as-child":""},{default:E(()=>[ie(h.$slots,"close",{ui:d.value},()=>{var w;return[s.close?(x(),K(ye,Ce({key:0,icon:s.closeIcon||y(i).ui.icons.close,size:"md",color:"neutral",variant:"ghost","aria-label":y(a)("slideover.close")},typeof s.close=="object"?s.close:{},{class:d.value.close({class:(w=t.ui)==null?void 0:w.close})}),null,16,["icon","aria-label","class"])):q("",!0)]})]),_:3})):q("",!0)]})],2)):q("",!0),N("div",{class:pe(d.value.body({class:(v=t.ui)==null?void 0:v.body}))},[ie(h.$slots,"body")],2),r.footer?(x(),T("div",{key:1,class:pe(d.value.footer({class:(S=t.ui)==null?void 0:S.footer}))},[ie(h.$slots,"footer")],2)):q("",!0)]})]),_:3},16,["data-side","class"])]}),_:3},16)]),_:3},16))}},lo={class:"space-y-4"},co={key:0},uo={key:0,class:"mt-3"},fo={key:1,class:"mt-3 text-sm text-gray-500 dark:text-gray-400"},ho={key:2,class:"mt-3 text-sm text-red-600 dark:text-red-400"},mo={key:1},po={key:0,class:"mt-3"},go={key:1,class:"mt-3 text-sm text-gray-500 dark:text-gray-400"},yo={key:2,class:"mt-3 text-sm text-red-600 dark:text-red-400"},_o={key:1,class:"text-sm text-gray-500 dark:text-gray-400"},bo={key:2,class:"text-sm text-yellow-600 dark:text-yellow-400"},vo={key:3,class:"text-sm text-gray-500 dark:text-gray-400"},wo={key:4,class:"text-sm text-gray-500 dark:text-gray-400"},Or=te({__name:"TranslationServiceSettings",setup(s){const e=ve(),t=we(),n=F({get:()=>e.settings.translationServices.generateNote,set:u=>e.setGenerateNote(u)}),r=F({get:()=>e.settings.translationServices.chosenServiceName,set:u=>e.setChosenTranslationServiceName(u)}),a=F(()=>e.settings.translationServices.services.map(u=>({label:u.name,value:u.name}))),i=F(()=>{const u=e.settings.translationServices.chosenServiceName;return u&&e.settings.translationServices.services.find(m=>m.name===u)||null}),o=F(()=>i.value&&i.value.serviceType==="ai"&&i.value.models?i.value.models.map(u=>({label:u,value:u})):[]),l=F({get:()=>{var u;return((u=i.value)==null?void 0:u.chosenModel)||""},set:u=>{i.value&&e.setServiceModel(i.value.name,u)}}),c=F(()=>t.availableGeminiApiKeys?t.availableGeminiApiKeys.map((u,m)=>({label:`API KEY ${m+1}`,value:u})):[]),f=F(()=>t.availableOpenRouterApiKeys?t.availableOpenRouterApiKeys.map((u,m)=>({label:`API KEY ${m+1}`,value:u})):[]),d=F({get:()=>t.selectedGeminiApiKey,set:u=>{t.setSelectedGeminiApiKey(u)}}),h=F({get:()=>t.selectedOpenRouterApiKey,set:u=>{t.setSelectedOpenRouterApiKey(u)}});return(u,m)=>{const g=Mn,_=Ln,P=xr,v=Cr;return x(),K(v,{ui:{header:{padding:"px-0 py-3"},body:{padding:"px-0 py-0"}}},{header:E(()=>m[5]||(m[5]=[N("h4",{class:"font-medium text-gray-900 dark:text-white"},"Translation Services",-1)])),default:E(()=>[N("div",lo,[b(_,{label:"Active Translation Service",ui:{label:{base:"font-medium"}}},{default:E(()=>[b(g,{modelValue:r.value,"onUpdate:modelValue":m[0]||(m[0]=S=>r.value=S),items:a.value,"option-attribute":"label","value-attribute":"value",placeholder:"Select a service",class:"w-full"},null,8,["modelValue","items"])]),_:1}),i.value&&i.value.serviceType==="ai"&&i.value.models&&i.value.models.length>0?(x(),T(Me,{key:0},[b(_,{label:`Model for ${i.value.name}`,ui:{label:{base:"font-medium"}}},{default:E(()=>[b(g,{modelValue:l.value,"onUpdate:modelValue":m[1]||(m[1]=S=>l.value=S),items:o.value,"option-attribute":"label","value-attribute":"value",class:"w-full"},null,8,["modelValue","items"])]),_:1},8,["label"]),i.value.name==="Gemini"?(x(),T("div",co,[y(t).availableGeminiApiKeys&&y(t).availableGeminiApiKeys.length>1?(x(),T("div",uo,[b(_,{label:"Active Gemini API Key",ui:{label:{base:"font-medium"}}},{default:E(()=>[b(g,{modelValue:d.value,"onUpdate:modelValue":m[2]||(m[2]=S=>d.value=S),items:c.value,"option-attribute":"label","value-attribute":"value"},null,8,["modelValue","items"])]),_:1})])):y(t).availableGeminiApiKeys&&y(t).availableGeminiApiKeys.length===1?(x(),T("div",fo," Using API Key 1 (auto-selected for Gemini). ")):(x(),T("div",ho," API keys for Gemini are not set. Please configure them "))])):q("",!0),i.value.name==="OpenRouter"?(x(),T("div",mo,[y(t).availableOpenRouterApiKeys&&y(t).availableOpenRouterApiKeys.length>1?(x(),T("div",po,[b(_,{label:"Active OpenRouter API Key",ui:{label:{base:"font-medium"}}},{default:E(()=>[b(g,{modelValue:h.value,"onUpdate:modelValue":m[3]||(m[3]=S=>h.value=S),items:f.value,"option-attribute":"label","value-attribute":"value"},null,8,["modelValue","items"])]),_:1})])):y(t).availableOpenRouterApiKeys&&y(t).availableOpenRouterApiKeys.length===1?(x(),T("div",go," Using API Key 1 (auto-selected for OpenRouter). ")):(x(),T("div",yo," API keys for OpenRouter are not set. Please configure them "))])):q("",!0),i.value&&i.value.serviceType==="ai"?(x(),K(_,{key:2,label:"Generate Note",ui:{container:"flex items-center justify-between",label:{base:"font-medium"}}},{default:E(()=>[b(P,{modelValue:n.value,"onUpdate:modelValue":m[4]||(m[4]=S=>n.value=S)},null,8,["modelValue"])]),_:1})):q("",!0)],64)):i.value&&i.value.serviceType==="standard"?(x(),T("p",_o," Using standard translation for "+ce(i.value.name)+". ",1)):!i.value&&y(e).settings.translationServices.chosenServiceName?(x(),T("p",bo," Warning: Active service '"+ce(y(e).settings.translationServices.chosenServiceName)+"' is not found in configured services. ",1)):y(e).settings.translationServices.services.length===0?(x(),T("p",vo," No translation services configured. ")):!y(e).settings.translationServices.chosenServiceName&&y(e).settings.translationServices.services.length>0?(x(),T("p",wo," No translation service selected. ")):q("",!0)])]),_:1})}}}),xo={class:"space-y-6"},So={class:"space-y-3"},Co={class:"space-y-3"},$o={class:"flex justify-end pt-2 border-gray-200 dark:border-gray-700"},Io={class:"pt-4 space-y-4"},Ao={class:"space-y-4 flex flex-col items-center"},Eo={class:"space-y-4 flex flex-col items-center"},Ro={class:"space-y-4 flex flex-col items-center"},xs="_UNKNOWN_WORDS_",un="all_in_text",Oo=te({__name:"TextRendererSettings",setup(s){const e=ve(),t=we(),n=zt(),r=[{label:"Left",value:"left"},{label:"Center",value:"center"},{label:"Right",value:"right"}],a=J(null),i=J(null),o=J(null),l=J(null),c=J(!1),f=J(!1),d=J(!1),h=F(()=>a.value?Qe.filter(w=>w.value!==a.value):[]);Ke(a,()=>{i.value=null});const u=F({get:()=>e.settings.fontSize,set:w=>e.updateSettings({fontSize:Number(w)||e.settings.fontSize})}),m=F({get:()=>e.settings.alignment,set:w=>e.updateSettings({alignment:w})}),g=F({get:()=>e.settings.pagination.pageSize,set:w=>e.updatePaginationSettings({pageSize:Number(w)||e.settings.pagination.pageSize})}),_=F({get:()=>e.settings.note.height,set:w=>e.updateNoteSettings({height:Number(w)||e.settings.note.height})}),P=F({get:()=>e.settings.note.show,set:w=>e.updateNoteSettings({show:w})}),v=async()=>{const w=a.value,R=i.value;if(!w||!R){n.add({title:"Selection Required",description:"Please select both a source and a target status.",color:"warning",icon:"i-heroicons-exclamation-triangle"});return}const A=new Set;e.processedLines.forEach(k=>{k.tokens.forEach(z=>{z.isWord&&z.lexicalUnit&&z.status===w&&A.add(z.lexicalUnit.id)})});const $=Array.from(A);if($.length===0){n.add({title:"No Units to Update",description:`No units with status '${w}' found in the current text.`,color:"info",icon:"i-heroicons-information-circle"});return}c.value=!0;try{await t.bulkUpdateStatusForIds($,R),n.add({title:"Status Updated",description:`${$.length} unit(s) in this text updated from '${w}' to '${R}'.`,color:"success",icon:"i-heroicons-check-circle"}),a.value=null,i.value=null}catch(k){console.error("Failed to bulk update LU status:",k),n.add({title:"Update Failed",description:"Could not update statuses. See console for details.",color:"error",icon:"i-heroicons-x-circle"})}finally{c.value=!1}},S=F(()=>[...Qe,{label:"Unknown Words",value:xs}]),C=async()=>{var R;const w=o.value;if(!w){n.add({title:"Selection Required",description:"Please select a status or type to copy.",color:"warning",icon:"i-heroicons-exclamation-triangle"});return}f.value=!0,await new Promise(A=>setTimeout(A,0));try{const A=new Set;let $="";w===xs?($="Unknown word(s)",e.processedLines.forEach(W=>{W.tokens.forEach(j=>{j.isWord&&!j.lexicalUnit&&A.add(j.text.toLowerCase())})})):($=`word(s) with status '${w}'`,e.processedLines.forEach(W=>{W.tokens.forEach(j=>{j.isWord&&j.status===w&&A.add(j.text.toLowerCase())})}));const k=Array.from(A);if(k.length===0){const W=((R=S.value.find(j=>j.value===w))==null?void 0:R.label)||"items";n.add({title:"No Items Found",description:`No '${W.toLowerCase()}' were found in the current text.`,color:"info",icon:"i-heroicons-information-circle"});return}const z=JSON.stringify(k);await navigator.clipboard.writeText(z),n.add({title:"Copied to Clipboard",description:`${k.length} unique ${$} copied as a JSON array.`,color:"success",icon:"i-heroicons-check-circle"})}catch(A){console.error("Failed to copy items:",A),n.add({title:"Copy Failed",description:"Could not copy items to clipboard. See console for details.",color:"error",icon:"i-heroicons-x-circle"})}finally{f.value=!1}},O=F(()=>[{label:"All in Text",value:un},...Qe]),L=async()=>{var R;const w=l.value;if(!w){n.add({title:"Selection Required",description:"Please select a status to copy.",color:"warning",icon:"i-heroicons-exclamation-triangle"});return}d.value=!0,await new Promise(A=>setTimeout(A,0));try{const A=new Map;let $="";e.processedLines.forEach(W=>{W.tokens.forEach(j=>{j.isWord&&j.lexicalUnit&&!A.has(j.lexicalUnit.id)&&(w===un||j.status===w)&&A.set(j.lexicalUnit.id,j.lexicalUnit)})}),w===un?$="lexical unit(s) in this text":$=`lexical unit(s) with status '${w}'`;const k=Array.from(A.values());if(k.length===0){const W=((R=O.value.find(j=>j.value===w))==null?void 0:R.label)||"items";n.add({title:"No Units Found",description:`No '${W.toLowerCase()}' were found in the current text.`,color:"info",icon:"i-heroicons-information-circle"});return}const z=JSON.stringify(k,null,2);await navigator.clipboard.writeText(z),n.add({title:"Copied to Clipboard",description:`${k.length} unique ${$} copied as a JSON array.`,color:"success",icon:"i-heroicons-check-circle"})}catch(A){console.error("Failed to copy lexical units:",A),n.add({title:"Copy Failed",description:"Could not copy units to clipboard. See console for details.",color:"error",icon:"i-heroicons-x-circle"})}finally{d.value=!1}};return(w,R)=>{const A=Rr,$=Ln,k=Ai,z=Cr,W=xr,j=ye,X=Fn,ue=Mn;return x(),T("div",xo,[b($,{label:"Font Size (px)",ui:{label:{base:"font-medium"}}},{default:E(()=>[b(A,{modelValue:u.value,"onUpdate:modelValue":R[0]||(R[0]=H=>u.value=H),placeholder:"e.g., 16"},null,8,["modelValue"])]),_:1}),b($,{label:"Text Alignment",ui:{label:{base:"font-medium"}}},{default:E(()=>[b(k,{modelValue:m.value,"onUpdate:modelValue":R[1]||(R[1]=H=>m.value=H),items:r},null,8,["modelValue"])]),_:1}),b(z,{ui:{header:{padding:"px-0 py-3"},body:{padding:"px-0 py-0"}}},{header:E(()=>R[10]||(R[10]=[N("h4",{class:"font-medium text-gray-900 dark:text-white"},"Pagination",-1)])),default:E(()=>[N("div",So,[y(e).settings.pagination.show?(x(),K($,{key:0,label:"Lines Per Page",ui:{label:{base:"font-normal"}}},{default:E(()=>[b(A,{modelValue:g.value,"onUpdate:modelValue":R[2]||(R[2]=H=>g.value=H),placeholder:"e.g., 20"},null,8,["modelValue"])]),_:1})):q("",!0)])]),_:1}),b(z,{ui:{header:{padding:"px-0 py-3"},body:{padding:"px-0 py-0"}}},{header:E(()=>R[11]||(R[11]=[N("h4",{class:"font-medium text-gray-900 dark:text-white"},"Note Display",-1)])),default:E(()=>[N("div",Co,[b($,{label:"Show Note",ui:{container:"flex items-center justify-between",label:{base:"font-normal"}}},{default:E(()=>[b(W,{modelValue:P.value,"onUpdate:modelValue":R[3]||(R[3]=H=>P.value=H)},null,8,["modelValue"])]),_:1}),y(e).settings.note.show?(x(),K($,{key:0,label:"Note Height (px)",ui:{label:{base:"font-normal"}}},{default:E(()=>[b(A,{modelValue:_.value,"onUpdate:modelValue":R[4]||(R[4]=H=>_.value=H),placeholder:"e.g., 200",min:10,step:10},null,8,["modelValue"])]),_:1})):q("",!0)])]),_:1}),N("div",$o,[b(j,{label:"Reset to Defaults",color:"gray",variant:"outline",onClick:R[5]||(R[5]=H=>y(e).resetSettings()),icon:"i-heroicons-arrow-uturn-left"})]),b(X),N("div",Io,[b(z,{ui:{header:{padding:"px-0 py-3"},body:{padding:"px-4 py-4 sm:p-6"}}},{header:E(()=>R[12]||(R[12]=[N("h4",{class:"font-medium text-gray-900 dark:text-white"},"Bulk Status Update",-1)])),default:E(()=>[N("div",Ao,[b($,{label:"From Status",class:"w-full max-w-sm"},{default:E(()=>[b(ue,{modelValue:a.value,"onUpdate:modelValue":R[6]||(R[6]=H=>a.value=H),items:y(Qe),"option-attribute":"label","value-attribute":"value",placeholder:"Select source status",class:"w-full"},null,8,["modelValue","items"])]),_:1}),b($,{label:"To Status",class:"w-full max-w-sm"},{default:E(()=>[b(ue,{modelValue:i.value,"onUpdate:modelValue":R[7]||(R[7]=H=>i.value=H),items:h.value,"option-attribute":"label","value-attribute":"value",placeholder:"Select target status",class:"w-full",disabled:!a.value},null,8,["modelValue","items","disabled"])]),_:1}),b(j,{label:"Update Statuses",color:"teal",variant:"solid",onClick:v,icon:"i-heroicons-arrow-path-rounded-square",class:"w-full max-w-sm cursor-pointer",loading:c.value,disabled:!a.value||!i.value||c.value},null,8,["loading","disabled"])])]),_:1}),b(z,{ui:{header:{padding:"px-0 py-3"},body:{padding:"px-4 py-4 sm:p-6"}}},{header:E(()=>R[13]||(R[13]=[N("h4",{class:"font-medium text-gray-900 dark:text-white"},"Copy Words by Status",-1)])),default:E(()=>[N("div",Eo,[b($,{label:"Select Status",class:"w-full max-w-sm"},{default:E(()=>[b(ue,{modelValue:o.value,"onUpdate:modelValue":R[8]||(R[8]=H=>o.value=H),items:S.value,"option-attribute":"label","value-attribute":"value",placeholder:"Select status to copy",class:"w-full"},null,8,["modelValue","items"])]),_:1}),b(j,{label:"Copy Words",color:"cyan",variant:"solid",onClick:C,icon:"i-heroicons-clipboard-document-list",class:"w-full max-w-sm cursor-pointer",loading:f.value,disabled:!o.value||f.value},null,8,["loading","disabled"])])]),_:1}),b(z,{ui:{header:{padding:"px-0 py-3"},body:{padding:"px-4 py-4 sm:p-6"}}},{header:E(()=>R[14]||(R[14]=[N("h4",{class:"font-medium text-gray-900 dark:text-white"},"Copy Lexical Units by Status",-1)])),default:E(()=>[N("div",Ro,[b($,{label:"Select Status",class:"w-full max-w-sm"},{default:E(()=>[b(ue,{modelValue:l.value,"onUpdate:modelValue":R[9]||(R[9]=H=>l.value=H),items:O.value,"option-attribute":"label","value-attribute":"value",placeholder:"Select status to copy",class:"w-full"},null,8,["modelValue","items"])]),_:1}),b(j,{label:"Copy Lexical Units",color:"blue",variant:"solid",onClick:L,icon:"i-heroicons-document-duplicate",class:"w-full max-w-sm cursor-pointer",loading:d.value,disabled:!l.value||d.value},null,8,["loading","disabled"])])]),_:1})]),b(X),b(Or),b(X),b(Fi)])}}}),ko={class:"flex justify-center items-center"},To={class:"text-xl font-bold text-center text-gray-800 dark:text-gray-200"},kr=te({__name:"PopoverTerm",props:{term:{}},setup(s){const e=s,t=async()=>{try{await vr(e.term,"target")}catch(n){console.error(`Failed to speak "${e.term}" with target voice:`,n)}};return(n,r)=>{const a=Jt,i=ye;return x(),T("div",ko,[N("p",To,ce(n.term),1),b(i,{variant:"primary",class:"cursor-pointer",onClick:t},{default:E(()=>[b(a,{name:"i-heroicons-speaker-wave",class:"size-4"})]),_:1})])}}});var Ss;(function(s){s.STRING="string",s.NUMBER="number",s.INTEGER="integer",s.BOOLEAN="boolean",s.ARRAY="array",s.OBJECT="object"})(Ss||(Ss={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Cs;(function(s){s.LANGUAGE_UNSPECIFIED="language_unspecified",s.PYTHON="python"})(Cs||(Cs={}));var $s;(function(s){s.OUTCOME_UNSPECIFIED="outcome_unspecified",s.OUTCOME_OK="outcome_ok",s.OUTCOME_FAILED="outcome_failed",s.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})($s||($s={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Is=["user","model","function","system"];var As;(function(s){s.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",s.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",s.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",s.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",s.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",s.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(As||(As={}));var Es;(function(s){s.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",s.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",s.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",s.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",s.BLOCK_NONE="BLOCK_NONE"})(Es||(Es={}));var Rs;(function(s){s.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",s.NEGLIGIBLE="NEGLIGIBLE",s.LOW="LOW",s.MEDIUM="MEDIUM",s.HIGH="HIGH"})(Rs||(Rs={}));var Os;(function(s){s.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",s.SAFETY="SAFETY",s.OTHER="OTHER"})(Os||(Os={}));var ot;(function(s){s.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",s.STOP="STOP",s.MAX_TOKENS="MAX_TOKENS",s.SAFETY="SAFETY",s.RECITATION="RECITATION",s.LANGUAGE="LANGUAGE",s.BLOCKLIST="BLOCKLIST",s.PROHIBITED_CONTENT="PROHIBITED_CONTENT",s.SPII="SPII",s.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",s.OTHER="OTHER"})(ot||(ot={}));var ks;(function(s){s.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",s.RETRIEVAL_QUERY="RETRIEVAL_QUERY",s.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",s.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",s.CLASSIFICATION="CLASSIFICATION",s.CLUSTERING="CLUSTERING"})(ks||(ks={}));var Ts;(function(s){s.MODE_UNSPECIFIED="MODE_UNSPECIFIED",s.AUTO="AUTO",s.ANY="ANY",s.NONE="NONE"})(Ts||(Ts={}));var Ns;(function(s){s.MODE_UNSPECIFIED="MODE_UNSPECIFIED",s.MODE_DYNAMIC="MODE_DYNAMIC"})(Ns||(Ns={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oe extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class qe extends oe{constructor(e,t){super(e),this.response=t}}class Tr extends oe{constructor(e,t,n,r){super(e),this.status=t,this.statusText=n,this.errorDetails=r}}class ke extends oe{}class Nr extends oe{}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const No="https://generativelanguage.googleapis.com",Po="v1beta",Mo="0.24.1",Lo="genai-js";var De;(function(s){s.GENERATE_CONTENT="generateContent",s.STREAM_GENERATE_CONTENT="streamGenerateContent",s.COUNT_TOKENS="countTokens",s.EMBED_CONTENT="embedContent",s.BATCH_EMBED_CONTENTS="batchEmbedContents"})(De||(De={}));class Fo{constructor(e,t,n,r,a){this.model=e,this.task=t,this.apiKey=n,this.stream=r,this.requestOptions=a}toString(){var e,t;const n=((e=this.requestOptions)===null||e===void 0?void 0:e.apiVersion)||Po;let a=`${((t=this.requestOptions)===null||t===void 0?void 0:t.baseUrl)||No}/${n}/${this.model}:${this.task}`;return this.stream&&(a+="?alt=sse"),a}}function Uo(s){const e=[];return s!=null&&s.apiClient&&e.push(s.apiClient),e.push(`${Lo}/${Mo}`),e.join(" ")}async function Do(s){var e;const t=new Headers;t.append("Content-Type","application/json"),t.append("x-goog-api-client",Uo(s.requestOptions)),t.append("x-goog-api-key",s.apiKey);let n=(e=s.requestOptions)===null||e===void 0?void 0:e.customHeaders;if(n){if(!(n instanceof Headers))try{n=new Headers(n)}catch(r){throw new ke(`unable to convert customHeaders value ${JSON.stringify(n)} to Headers: ${r.message}`)}for(const[r,a]of n.entries()){if(r==="x-goog-api-key")throw new ke(`Cannot set reserved header name ${r}`);if(r==="x-goog-api-client")throw new ke(`Header name ${r} can only be set using the apiClient field`);t.append(r,a)}}return t}async function Bo(s,e,t,n,r,a){const i=new Fo(s,e,t,n,a);return{url:i.toString(),fetchOptions:Object.assign(Object.assign({},Go(a)),{method:"POST",headers:await Do(i),body:r})}}async function mt(s,e,t,n,r,a={},i=fetch){const{url:o,fetchOptions:l}=await Bo(s,e,t,n,r,a);return qo(o,l,i)}async function qo(s,e,t=fetch){let n;try{n=await t(s,e)}catch(r){jo(r,s)}return n.ok||await Vo(n,s),n}function jo(s,e){let t=s;throw t.name==="AbortError"?(t=new Nr(`Request aborted when fetching ${e.toString()}: ${s.message}`),t.stack=s.stack):s instanceof Tr||s instanceof ke||(t=new oe(`Error fetching from ${e.toString()}: ${s.message}`),t.stack=s.stack),t}async function Vo(s,e){let t="",n;try{const r=await s.json();t=r.error.message,r.error.details&&(t+=` ${JSON.stringify(r.error.details)}`,n=r.error.details)}catch{}throw new Tr(`Error fetching from ${e.toString()}: [${s.status} ${s.statusText}] ${t}`,s.status,s.statusText,n)}function Go(s){const e={};if((s==null?void 0:s.signal)!==void 0||(s==null?void 0:s.timeout)>=0){const t=new AbortController;(s==null?void 0:s.timeout)>=0&&setTimeout(()=>t.abort(),s.timeout),s!=null&&s.signal&&s.signal.addEventListener("abort",()=>{t.abort()}),e.signal=t.signal}return e}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bn(s){return s.text=()=>{if(s.candidates&&s.candidates.length>0){if(s.candidates.length>1&&console.warn(`This response had ${s.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),At(s.candidates[0]))throw new qe(`${Oe(s)}`,s);return Wo(s)}else if(s.promptFeedback)throw new qe(`Text not available. ${Oe(s)}`,s);return""},s.functionCall=()=>{if(s.candidates&&s.candidates.length>0){if(s.candidates.length>1&&console.warn(`This response had ${s.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),At(s.candidates[0]))throw new qe(`${Oe(s)}`,s);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),Ps(s)[0]}else if(s.promptFeedback)throw new qe(`Function call not available. ${Oe(s)}`,s)},s.functionCalls=()=>{if(s.candidates&&s.candidates.length>0){if(s.candidates.length>1&&console.warn(`This response had ${s.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),At(s.candidates[0]))throw new qe(`${Oe(s)}`,s);return Ps(s)}else if(s.promptFeedback)throw new qe(`Function call not available. ${Oe(s)}`,s)},s}function Wo(s){var e,t,n,r;const a=[];if(!((t=(e=s.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0)&&t.parts)for(const i of(r=(n=s.candidates)===null||n===void 0?void 0:n[0].content)===null||r===void 0?void 0:r.parts)i.text&&a.push(i.text),i.executableCode&&a.push("\n```"+i.executableCode.language+`
`+i.executableCode.code+"\n```\n"),i.codeExecutionResult&&a.push("\n```\n"+i.codeExecutionResult.output+"\n```\n");return a.length>0?a.join(""):""}function Ps(s){var e,t,n,r;const a=[];if(!((t=(e=s.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0)&&t.parts)for(const i of(r=(n=s.candidates)===null||n===void 0?void 0:n[0].content)===null||r===void 0?void 0:r.parts)i.functionCall&&a.push(i.functionCall);if(a.length>0)return a}const Ho=[ot.RECITATION,ot.SAFETY,ot.LANGUAGE];function At(s){return!!s.finishReason&&Ho.includes(s.finishReason)}function Oe(s){var e,t,n;let r="";if((!s.candidates||s.candidates.length===0)&&s.promptFeedback)r+="Response was blocked",!((e=s.promptFeedback)===null||e===void 0)&&e.blockReason&&(r+=` due to ${s.promptFeedback.blockReason}`),!((t=s.promptFeedback)===null||t===void 0)&&t.blockReasonMessage&&(r+=`: ${s.promptFeedback.blockReasonMessage}`);else if(!((n=s.candidates)===null||n===void 0)&&n[0]){const a=s.candidates[0];At(a)&&(r+=`Candidate was blocked due to ${a.finishReason}`,a.finishMessage&&(r+=`: ${a.finishMessage}`))}return r}function dt(s){return this instanceof dt?(this.v=s,this):new dt(s)}function Ko(s,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(s,e||[]),r,a=[];return r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r;function i(h){n[h]&&(r[h]=function(u){return new Promise(function(m,g){a.push([h,u,m,g])>1||o(h,u)})})}function o(h,u){try{l(n[h](u))}catch(m){d(a[0][3],m)}}function l(h){h.value instanceof dt?Promise.resolve(h.value.v).then(c,f):d(a[0][2],h)}function c(h){o("next",h)}function f(h){o("throw",h)}function d(h,u){h(u),a.shift(),a.length&&o(a[0][0],a[0][1])}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ms=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function zo(s){const e=s.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),t=Yo(e),[n,r]=t.tee();return{stream:Xo(n),response:Jo(r)}}async function Jo(s){const e=[],t=s.getReader();for(;;){const{done:n,value:r}=await t.read();if(n)return Bn(Qo(e));e.push(r)}}function Xo(s){return Ko(this,arguments,function*(){const t=s.getReader();for(;;){const{value:n,done:r}=yield dt(t.read());if(r)break;yield yield dt(Bn(n))}})}function Yo(s){const e=s.getReader();return new ReadableStream({start(n){let r="";return a();function a(){return e.read().then(({value:i,done:o})=>{if(o){if(r.trim()){n.error(new oe("Failed to parse stream"));return}n.close();return}r+=i;let l=r.match(Ms),c;for(;l;){try{c=JSON.parse(l[1])}catch{n.error(new oe(`Error parsing JSON response: "${l[1]}"`));return}n.enqueue(c),r=r.substring(l[0].length),l=r.match(Ms)}return a()}).catch(i=>{let o=i;throw o.stack=i.stack,o.name==="AbortError"?o=new Nr("Request aborted when reading from the stream"):o=new oe("Error reading from the stream"),o})}}})}function Qo(s){const e=s[s.length-1],t={promptFeedback:e==null?void 0:e.promptFeedback};for(const n of s){if(n.candidates){let r=0;for(const a of n.candidates)if(t.candidates||(t.candidates=[]),t.candidates[r]||(t.candidates[r]={index:r}),t.candidates[r].citationMetadata=a.citationMetadata,t.candidates[r].groundingMetadata=a.groundingMetadata,t.candidates[r].finishReason=a.finishReason,t.candidates[r].finishMessage=a.finishMessage,t.candidates[r].safetyRatings=a.safetyRatings,a.content&&a.content.parts){t.candidates[r].content||(t.candidates[r].content={role:a.content.role||"user",parts:[]});const i={};for(const o of a.content.parts)o.text&&(i.text=o.text),o.functionCall&&(i.functionCall=o.functionCall),o.executableCode&&(i.executableCode=o.executableCode),o.codeExecutionResult&&(i.codeExecutionResult=o.codeExecutionResult),Object.keys(i).length===0&&(i.text=""),t.candidates[r].content.parts.push(i)}r++}n.usageMetadata&&(t.usageMetadata=n.usageMetadata)}return t}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Pr(s,e,t,n){const r=await mt(e,De.STREAM_GENERATE_CONTENT,s,!0,JSON.stringify(t),n);return zo(r)}async function Mr(s,e,t,n){const a=await(await mt(e,De.GENERATE_CONTENT,s,!1,JSON.stringify(t),n)).json();return{response:Bn(a)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lr(s){if(s!=null){if(typeof s=="string")return{role:"system",parts:[{text:s}]};if(s.text)return{role:"system",parts:[s]};if(s.parts)return s.role?s:{role:"system",parts:s.parts}}}function ft(s){let e=[];if(typeof s=="string")e=[{text:s}];else for(const t of s)typeof t=="string"?e.push({text:t}):e.push(t);return Zo(e)}function Zo(s){const e={role:"user",parts:[]},t={role:"function",parts:[]};let n=!1,r=!1;for(const a of s)"functionResponse"in a?(t.parts.push(a),r=!0):(e.parts.push(a),n=!0);if(n&&r)throw new oe("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!n&&!r)throw new oe("No content is provided for sending chat message.");return n?e:t}function el(s,e){var t;let n={model:e==null?void 0:e.model,generationConfig:e==null?void 0:e.generationConfig,safetySettings:e==null?void 0:e.safetySettings,tools:e==null?void 0:e.tools,toolConfig:e==null?void 0:e.toolConfig,systemInstruction:e==null?void 0:e.systemInstruction,cachedContent:(t=e==null?void 0:e.cachedContent)===null||t===void 0?void 0:t.name,contents:[]};const r=s.generateContentRequest!=null;if(s.contents){if(r)throw new ke("CountTokensRequest must have one of contents or generateContentRequest, not both.");n.contents=s.contents}else if(r)n=Object.assign(Object.assign({},n),s.generateContentRequest);else{const a=ft(s);n.contents=[a]}return{generateContentRequest:n}}function Ls(s){let e;return s.contents?e=s:e={contents:[ft(s)]},s.systemInstruction&&(e.systemInstruction=Lr(s.systemInstruction)),e}function tl(s){return typeof s=="string"||Array.isArray(s)?{content:ft(s)}:s}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fs=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],nl={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function sl(s){let e=!1;for(const t of s){const{role:n,parts:r}=t;if(!e&&n!=="user")throw new oe(`First content should be with role 'user', got ${n}`);if(!Is.includes(n))throw new oe(`Each item should include role field. Got ${n} but valid roles are: ${JSON.stringify(Is)}`);if(!Array.isArray(r))throw new oe("Content should have 'parts' property with an array of Parts");if(r.length===0)throw new oe("Each Content should have at least one part");const a={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const o of r)for(const l of Fs)l in o&&(a[l]+=1);const i=nl[n];for(const o of Fs)if(!i.includes(o)&&a[o]>0)throw new oe(`Content with role '${n}' can't contain '${o}' part`);e=!0}}function Us(s){var e;if(s.candidates===void 0||s.candidates.length===0)return!1;const t=(e=s.candidates[0])===null||e===void 0?void 0:e.content;if(t===void 0||t.parts===void 0||t.parts.length===0)return!1;for(const n of t.parts)if(n===void 0||Object.keys(n).length===0||n.text!==void 0&&n.text==="")return!1;return!0}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ds="SILENT_ERROR";class rl{constructor(e,t,n,r={}){this.model=t,this.params=n,this._requestOptions=r,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,n!=null&&n.history&&(sl(n.history),this._history=n.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e,t={}){var n,r,a,i,o,l;await this._sendPromise;const c=ft(e),f={safetySettings:(n=this.params)===null||n===void 0?void 0:n.safetySettings,generationConfig:(r=this.params)===null||r===void 0?void 0:r.generationConfig,tools:(a=this.params)===null||a===void 0?void 0:a.tools,toolConfig:(i=this.params)===null||i===void 0?void 0:i.toolConfig,systemInstruction:(o=this.params)===null||o===void 0?void 0:o.systemInstruction,cachedContent:(l=this.params)===null||l===void 0?void 0:l.cachedContent,contents:[...this._history,c]},d=Object.assign(Object.assign({},this._requestOptions),t);let h;return this._sendPromise=this._sendPromise.then(()=>Mr(this._apiKey,this.model,f,d)).then(u=>{var m;if(Us(u.response)){this._history.push(c);const g=Object.assign({parts:[],role:"model"},(m=u.response.candidates)===null||m===void 0?void 0:m[0].content);this._history.push(g)}else{const g=Oe(u.response);g&&console.warn(`sendMessage() was unsuccessful. ${g}. Inspect response object for details.`)}h=u}).catch(u=>{throw this._sendPromise=Promise.resolve(),u}),await this._sendPromise,h}async sendMessageStream(e,t={}){var n,r,a,i,o,l;await this._sendPromise;const c=ft(e),f={safetySettings:(n=this.params)===null||n===void 0?void 0:n.safetySettings,generationConfig:(r=this.params)===null||r===void 0?void 0:r.generationConfig,tools:(a=this.params)===null||a===void 0?void 0:a.tools,toolConfig:(i=this.params)===null||i===void 0?void 0:i.toolConfig,systemInstruction:(o=this.params)===null||o===void 0?void 0:o.systemInstruction,cachedContent:(l=this.params)===null||l===void 0?void 0:l.cachedContent,contents:[...this._history,c]},d=Object.assign(Object.assign({},this._requestOptions),t),h=Pr(this._apiKey,this.model,f,d);return this._sendPromise=this._sendPromise.then(()=>h).catch(u=>{throw new Error(Ds)}).then(u=>u.response).then(u=>{if(Us(u)){this._history.push(c);const m=Object.assign({},u.candidates[0].content);m.role||(m.role="model"),this._history.push(m)}else{const m=Oe(u);m&&console.warn(`sendMessageStream() was unsuccessful. ${m}. Inspect response object for details.`)}}).catch(u=>{u.message!==Ds&&console.error(u)}),h}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function al(s,e,t,n){return(await mt(e,De.COUNT_TOKENS,s,!1,JSON.stringify(t),n)).json()}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function il(s,e,t,n){return(await mt(e,De.EMBED_CONTENT,s,!1,JSON.stringify(t),n)).json()}async function ol(s,e,t,n){const r=t.requests.map(i=>Object.assign(Object.assign({},i),{model:e}));return(await mt(e,De.BATCH_EMBED_CONTENTS,s,!1,JSON.stringify({requests:r}),n)).json()}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bs{constructor(e,t,n={}){this.apiKey=e,this._requestOptions=n,t.model.includes("/")?this.model=t.model:this.model=`models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.tools=t.tools,this.toolConfig=t.toolConfig,this.systemInstruction=Lr(t.systemInstruction),this.cachedContent=t.cachedContent}async generateContent(e,t={}){var n;const r=Ls(e),a=Object.assign(Object.assign({},this._requestOptions),t);return Mr(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(n=this.cachedContent)===null||n===void 0?void 0:n.name},r),a)}async generateContentStream(e,t={}){var n;const r=Ls(e),a=Object.assign(Object.assign({},this._requestOptions),t);return Pr(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(n=this.cachedContent)===null||n===void 0?void 0:n.name},r),a)}startChat(e){var t;return new rl(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(t=this.cachedContent)===null||t===void 0?void 0:t.name},e),this._requestOptions)}async countTokens(e,t={}){const n=el(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),r=Object.assign(Object.assign({},this._requestOptions),t);return al(this.apiKey,this.model,n,r)}async embedContent(e,t={}){const n=tl(e),r=Object.assign(Object.assign({},this._requestOptions),t);return il(this.apiKey,this.model,n,r)}async batchEmbedContents(e,t={}){const n=Object.assign(Object.assign({},this._requestOptions),t);return ol(this.apiKey,this.model,e,n)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ll{constructor(e){this.apiKey=e}getGenerativeModel(e,t){if(!e.model)throw new oe("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new Bs(this.apiKey,e,t)}getGenerativeModelFromCachedContent(e,t,n){if(!e.name)throw new ke("Cached content must contain a `name` field.");if(!e.model)throw new ke("Cached content must contain a `model` field.");const r=["model","systemInstruction"];for(const i of r)if(t!=null&&t[i]&&e[i]&&(t==null?void 0:t[i])!==e[i]){if(i==="model"){const o=t.model.startsWith("models/")?t.model.replace("models/",""):t.model,l=e.model.startsWith("models/")?e.model.replace("models/",""):e.model;if(o===l)continue}throw new ke(`Different value for "${i}" specified in modelParams (${t[i]}) and cachedContent (${e[i]})`)}const a=Object.assign(Object.assign({},t),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new Bs(this.apiKey,a,n)}}async function cl(s,e,t,n){var _,P,v,S,C;const r=we(),a=ve(),i=r.selectedGeminiApiKey,o=a.settings.translationServices.services.find(O=>O.name==="Gemini"&&O.serviceType==="ai");if(!i)return console.error("Gemini API Key is not selected or available."),null;if(!o)return console.error("Gemini service configuration not found in text render settings."),null;const l=o.chosenModel;if(!l)return console.error("No Gemini model selected in settings."),null;const c=r.info,f=(_=r.settings)==null?void 0:_.aiPrompt;if(!c)return console.error("Study pack info not loaded."),null;if(!f)return console.error("AI prompt settings not loaded from study pack settings.json."),null;const d=c.languages.targetLanguage,h=c.languages.sourceLanguage;let u,m;e==="term"?(u=(P=f.term)==null?void 0:P.translation,m=(v=f.term)==null?void 0:v.note):(u=(S=f.line)==null?void 0:S.translation,m=(C=f.line)==null?void 0:C.note),u||(console.warn(`AI prompt setting for ${e} translation instruction is missing.`),(e="term")?u=`Provide the most accurate and common translation for the term from ${d} to ${h}. The translation should consist of the most popular translations of the given text (no more than five) and be separated by commas.`:u=`Translate the sentence(s) from ${d} to ${h}. The translation must be grammatically correct and sound natural, while preserving the original tone and meaning.`),m||(console.warn(`AI prompt setting for ${e} note instruction is missing, but note generation was requested. Note will not be generated.`),(e="term")?m=`Briefly explain the choice of translation. If there are other common alternative translations for this term, mention them. The note should be written in ${h}.`:m=`In one or two sentences, explain any interesting cultural nuances, idioms, or non-obvious translation choices. If the translation is straightforward, state that. The note should be written in ${d}.`);const g=`
Context: You are an expert translator.

Text to translate: "${s}"

Instructions:
1. Translate the text according to this rule: ${u}.
${t?`2. Generate a concise note based on this rule: ${m}.`:""}

Your response must be a valid JSON object.
It must contain a "translation" key with the translated text as a string.
${t?'It must also contain a "note" key with the generated note as a string.':'It must not contain a "note" key.'}

${n?`Here's another extra prompt for you: ${n}`:""}
`;console.log("Sending prompt to Gemini:",g);try{const R=(await new ll(i).getGenerativeModel({model:l,generationConfig:{responseMimeType:"application/json"}}).generateContent(g)).response.text();console.log("Received raw response from Gemini:",R);let A;try{const $=R.match(/\{[\s\S]*\}/);if(!$)throw new Error("No valid JSON object found in the response.");A=JSON.parse($[0])}catch($){return console.error("Failed to parse Gemini response as JSON:",$.message),console.error("Raw response text:",R),null}return typeof A!="object"||A===null?(console.error("Gemini response is not a valid JSON object."),null):typeof A.translation!="string"?(console.error('Gemini response JSON is missing the required "translation" string.'),null):(t&&typeof A.note!="string"?(console.warn('Gemini response JSON is missing the required "note" string, but note generation was requested.'),delete A.note):!t&&A.note!==void 0&&delete A.note,A)}catch(O){return console.error("Error calling Gemini API:",O),O.response&&O.response.candidates?console.error("Gemini API Error Details:",JSON.stringify(O.response.candidates,null,2)):O.message&&console.error("Gemini API Error Message:",O.message),null}}const ul=mr("translationStorage",{state:()=>({translations:new Map}),actions:{addTranslation(s,e){this.translations.set(s,e)},getTranslation(s){return this.translations.get(s)},hasTranslation(s){return this.translations.has(s)},clearTranslations(){this.translations.clear()}},getters:{}});async function dl(s,e,t){if(e===t&&e!=="auto")return{translation:s};const n=`https://clients5.google.com/translate_a/t?client=dict-chrome-ex&sl=${e}&tl=${t}&q=${encodeURIComponent(s)}`;try{const r=await fetch(n);if(!r.ok)return console.error(`Google Mirror API error: ${r.status} ${r.statusText}`),null;const a=await r.text();try{const i=JSON.parse(a);if(Array.isArray(i)&&i.length>0&&typeof i[0]=="string")return{translation:i[0]}}catch{if(a&&!a.trim().startsWith("<"))return{translation:a}}return console.warn("Google Mirror: Failed to parse or understand the response:",a),null}catch(r){return console.error("Error during Google Mirror translation request:",r.message),null}}async function fl(s,e,t){var a,i;if(e===t&&e!=="auto")return{translation:s};const n=s.replace(/(\r\n|\r|\n)/g," "),r=`https://translate.googleapis.com/translate_a/single?client=gtx&dt=t&sl=${e}&tl=${t}&q=${encodeURIComponent(n)}`;try{const o=await fetch(r);if(!o.ok)return console.error(`Google Mirror 2 API error: ${o.status} ${o.statusText}`),null;const l=await o.json(),c=(i=(a=l==null?void 0:l[0])==null?void 0:a[0])==null?void 0:i[0];return typeof c=="string"&&c?{translation:c}:(console.warn("Google Mirror 2: Translation not found or API response format changed:",l),null)}catch(o){return console.error("Error during Google Mirror 2 translation request:",o.message),null}}async function hl(s,e,t){var r,a,i;if(e===t&&e!=="auto")return{translation:s};const n=`https://api.mymemory.translated.net/get?q=${encodeURIComponent(s)}&langpair=${e}|${t}`;try{const o=await fetch(n);if(!o.ok)return console.error(`MyMemory API error: ${o.status} ${o.statusText}`),null;const l=await o.json(),c=((r=l==null?void 0:l.responseData)==null?void 0:r.translatedText)||((i=(a=l==null?void 0:l.matches)==null?void 0:a[0])==null?void 0:i.translation);return typeof c=="string"&&c?{translation:c}:(console.warn("MyMemory: Translation not found or API response format changed:",l),null)}catch(o){return console.error("Error during MyMemory translation request:",o.message),null}}function D(s,e,t,n,r){if(typeof e=="function"?s!==e||!0:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(s,t),t}function p(s,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(s):n?n.value:e.get(s)}let Fr=function(){const{crypto:s}=globalThis;if(s!=null&&s.randomUUID)return Fr=s.randomUUID.bind(s),s.randomUUID();const e=new Uint8Array(1),t=s?()=>s.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,n=>(+n^t()&15>>+n/4).toString(16))};function wn(s){return typeof s=="object"&&s!==null&&("name"in s&&s.name==="AbortError"||"message"in s&&String(s.message).includes("FetchRequestCanceledException"))}const xn=s=>{if(s instanceof Error)return s;if(typeof s=="object"&&s!==null){try{if(Object.prototype.toString.call(s)==="[object Error]"){const e=new Error(s.message,s.cause?{cause:s.cause}:{});return s.stack&&(e.stack=s.stack),s.cause&&!e.cause&&(e.cause=s.cause),s.name&&(e.name=s.name),e}}catch{}try{return new Error(JSON.stringify(s))}catch{}}return new Error(s)};class U extends Error{}class se extends U{constructor(e,t,n,r){super(`${se.makeMessage(e,t,n)}`),this.status=e,this.headers=r,this.requestID=r==null?void 0:r.get("x-request-id"),this.error=t;const a=t;this.code=a==null?void 0:a.code,this.param=a==null?void 0:a.param,this.type=a==null?void 0:a.type}static makeMessage(e,t,n){const r=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||"(no status code or body)"}static generate(e,t,n,r){if(!e||!r)return new Xt({message:n,cause:xn(t)});const a=t==null?void 0:t.error;return e===400?new Ur(e,a,n,r):e===401?new Dr(e,a,n,r):e===403?new Br(e,a,n,r):e===404?new qr(e,a,n,r):e===409?new jr(e,a,n,r):e===422?new Vr(e,a,n,r):e===429?new Gr(e,a,n,r):e>=500?new Wr(e,a,n,r):new se(e,a,n,r)}}class ge extends se{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class Xt extends se{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class qn extends Xt{constructor({message:e}={}){super({message:e??"Request timed out."})}}class Ur extends se{}class Dr extends se{}class Br extends se{}class qr extends se{}class jr extends se{}class Vr extends se{}class Gr extends se{}class Wr extends se{}class Hr extends U{constructor(){super("Could not parse response content as the length limit was reached")}}class Kr extends U{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}const ml=/^[a-z][a-z0-9+.-]*:/i,pl=s=>ml.test(s);let de=s=>(de=Array.isArray,de(s)),qs=de;function gl(s){return typeof s!="object"?{}:s??{}}function yl(s){if(!s)return!0;for(const e in s)return!1;return!0}function _l(s,e){return Object.prototype.hasOwnProperty.call(s,e)}function dn(s){return s!=null&&typeof s=="object"&&!Array.isArray(s)}const bl=(s,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new U(`${s} must be an integer`);if(e<0)throw new U(`${s} must be a positive integer`);return e},vl=s=>{try{return JSON.parse(s)}catch{return}},pt=s=>new Promise(e=>setTimeout(e,s)),Ge="5.5.1",wl=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";function xl(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const Sl=()=>{var t;const s=xl();if(s==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ge,"X-Stainless-OS":Vs(Deno.build.os),"X-Stainless-Arch":js(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((t=Deno.version)==null?void 0:t.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ge,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(s==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ge,"X-Stainless-OS":Vs(globalThis.process.platform??"unknown"),"X-Stainless-Arch":js(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};const e=Cl();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ge,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ge,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Cl(){if(typeof navigator>"u"||!navigator)return null;const s=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of s){const n=t.exec(navigator.userAgent);if(n){const r=n[1]||0,a=n[2]||0,i=n[3]||0;return{browser:e,version:`${r}.${a}.${i}`}}}return null}const js=s=>s==="x32"?"x32":s==="x86_64"||s==="x64"?"x64":s==="arm"?"arm":s==="aarch64"||s==="arm64"?"arm64":s?`other:${s}`:"unknown",Vs=s=>(s=s.toLowerCase(),s.includes("ios")?"iOS":s==="android"?"Android":s==="darwin"?"MacOS":s==="win32"?"Windows":s==="freebsd"?"FreeBSD":s==="openbsd"?"OpenBSD":s==="linux"?"Linux":s?`Other:${s}`:"Unknown");let Gs;const $l=()=>Gs??(Gs=Sl());function Il(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function zr(...s){const e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...s)}function Jr(s){let e=Symbol.asyncIterator in s?s[Symbol.asyncIterator]():s[Symbol.iterator]();return zr({start(){},async pull(t){const{done:n,value:r}=await e.next();n?t.close():t.enqueue(r)},async cancel(){var t;await((t=e.return)==null?void 0:t.call(e))}})}function Xr(s){if(s[Symbol.asyncIterator])return s;const e=s.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function Al(s){var n,r;if(s===null||typeof s!="object")return;if(s[Symbol.asyncIterator]){await((r=(n=s[Symbol.asyncIterator]()).return)==null?void 0:r.call(n));return}const e=s.getReader(),t=e.cancel();e.releaseLock(),await t}const El=({headers:s,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)}),Yr="RFC3986",Qr=s=>String(s),Ws={RFC1738:s=>String(s).replace(/%20/g,"+"),RFC3986:Qr},Rl="RFC1738";let Sn=(s,e)=>(Sn=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty),Sn(s,e));const xe=(()=>{const s=[];for(let e=0;e<256;++e)s.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return s})(),fn=1024,Ol=(s,e,t,n,r)=>{if(s.length===0)return s;let a=s;if(typeof s=="symbol"?a=Symbol.prototype.toString.call(s):typeof s!="string"&&(a=String(s)),t==="iso-8859-1")return escape(a).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let i="";for(let o=0;o<a.length;o+=fn){const l=a.length>=fn?a.slice(o,o+fn):a,c=[];for(let f=0;f<l.length;++f){let d=l.charCodeAt(f);if(d===45||d===46||d===95||d===126||d>=48&&d<=57||d>=65&&d<=90||d>=97&&d<=122||r===Rl&&(d===40||d===41)){c[c.length]=l.charAt(f);continue}if(d<128){c[c.length]=xe[d];continue}if(d<2048){c[c.length]=xe[192|d>>6]+xe[128|d&63];continue}if(d<55296||d>=57344){c[c.length]=xe[224|d>>12]+xe[128|d>>6&63]+xe[128|d&63];continue}f+=1,d=65536+((d&1023)<<10|l.charCodeAt(f)&1023),c[c.length]=xe[240|d>>18]+xe[128|d>>12&63]+xe[128|d>>6&63]+xe[128|d&63]}i+=c.join("")}return i};function kl(s){return!s||typeof s!="object"?!1:!!(s.constructor&&s.constructor.isBuffer&&s.constructor.isBuffer(s))}function Hs(s,e){if(de(s)){const t=[];for(let n=0;n<s.length;n+=1)t.push(e(s[n]));return t}return e(s)}const Zr={brackets(s){return String(s)+"[]"},comma:"comma",indices(s,e){return String(s)+"["+e+"]"},repeat(s){return String(s)}},ea=function(s,e){Array.prototype.push.apply(s,de(e)?e:[e])};let Ks;const Z={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:Ol,encodeValuesOnly:!1,format:Yr,formatter:Qr,indices:!1,serializeDate(s){return(Ks??(Ks=Function.prototype.call.bind(Date.prototype.toISOString)))(s)},skipNulls:!1,strictNullHandling:!1};function Tl(s){return typeof s=="string"||typeof s=="number"||typeof s=="boolean"||typeof s=="symbol"||typeof s=="bigint"}const hn={};function ta(s,e,t,n,r,a,i,o,l,c,f,d,h,u,m,g,_,P){let v=s,S=P,C=0,O=!1;for(;(S=S.get(hn))!==void 0&&!O;){const $=S.get(s);if(C+=1,typeof $<"u"){if($===C)throw new RangeError("Cyclic object value");O=!0}typeof S.get(hn)>"u"&&(C=0)}if(typeof c=="function"?v=c(e,v):v instanceof Date?v=h==null?void 0:h(v):t==="comma"&&de(v)&&(v=Hs(v,function($){return $ instanceof Date?h==null?void 0:h($):$})),v===null){if(a)return l&&!g?l(e,Z.encoder,_,"key",u):e;v=""}if(Tl(v)||kl(v)){if(l){const $=g?e:l(e,Z.encoder,_,"key",u);return[(m==null?void 0:m($))+"="+(m==null?void 0:m(l(v,Z.encoder,_,"value",u)))]}return[(m==null?void 0:m(e))+"="+(m==null?void 0:m(String(v)))]}const L=[];if(typeof v>"u")return L;let w;if(t==="comma"&&de(v))g&&l&&(v=Hs(v,l)),w=[{value:v.length>0?v.join(",")||null:void 0}];else if(de(c))w=c;else{const $=Object.keys(v);w=f?$.sort(f):$}const R=o?String(e).replace(/\./g,"%2E"):String(e),A=n&&de(v)&&v.length===1?R+"[]":R;if(r&&de(v)&&v.length===0)return A+"[]";for(let $=0;$<w.length;++$){const k=w[$],z=typeof k=="object"&&typeof k.value<"u"?k.value:v[k];if(i&&z===null)continue;const W=d&&o?k.replace(/\./g,"%2E"):k,j=de(v)?typeof t=="function"?t(A,W):A:A+(d?"."+W:"["+W+"]");P.set(s,C);const X=new WeakMap;X.set(hn,P),ea(L,ta(z,j,t,n,r,a,i,o,t==="comma"&&g&&de(v)?null:l,c,f,d,h,u,m,g,_,X))}return L}function Nl(s=Z){if(typeof s.allowEmptyArrays<"u"&&typeof s.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof s.encodeDotInKeys<"u"&&typeof s.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(s.encoder!==null&&typeof s.encoder<"u"&&typeof s.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=s.charset||Z.charset;if(typeof s.charset<"u"&&s.charset!=="utf-8"&&s.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=Yr;if(typeof s.format<"u"){if(!Sn(Ws,s.format))throw new TypeError("Unknown format option provided.");t=s.format}const n=Ws[t];let r=Z.filter;(typeof s.filter=="function"||de(s.filter))&&(r=s.filter);let a;if(s.arrayFormat&&s.arrayFormat in Zr?a=s.arrayFormat:"indices"in s?a=s.indices?"indices":"repeat":a=Z.arrayFormat,"commaRoundTrip"in s&&typeof s.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const i=typeof s.allowDots>"u"?s.encodeDotInKeys?!0:Z.allowDots:!!s.allowDots;return{addQueryPrefix:typeof s.addQueryPrefix=="boolean"?s.addQueryPrefix:Z.addQueryPrefix,allowDots:i,allowEmptyArrays:typeof s.allowEmptyArrays=="boolean"?!!s.allowEmptyArrays:Z.allowEmptyArrays,arrayFormat:a,charset:e,charsetSentinel:typeof s.charsetSentinel=="boolean"?s.charsetSentinel:Z.charsetSentinel,commaRoundTrip:!!s.commaRoundTrip,delimiter:typeof s.delimiter>"u"?Z.delimiter:s.delimiter,encode:typeof s.encode=="boolean"?s.encode:Z.encode,encodeDotInKeys:typeof s.encodeDotInKeys=="boolean"?s.encodeDotInKeys:Z.encodeDotInKeys,encoder:typeof s.encoder=="function"?s.encoder:Z.encoder,encodeValuesOnly:typeof s.encodeValuesOnly=="boolean"?s.encodeValuesOnly:Z.encodeValuesOnly,filter:r,format:t,formatter:n,serializeDate:typeof s.serializeDate=="function"?s.serializeDate:Z.serializeDate,skipNulls:typeof s.skipNulls=="boolean"?s.skipNulls:Z.skipNulls,sort:typeof s.sort=="function"?s.sort:null,strictNullHandling:typeof s.strictNullHandling=="boolean"?s.strictNullHandling:Z.strictNullHandling}}function Pl(s,e={}){let t=s;const n=Nl(e);let r,a;typeof n.filter=="function"?(a=n.filter,t=a("",t)):de(n.filter)&&(a=n.filter,r=a);const i=[];if(typeof t!="object"||t===null)return"";const o=Zr[n.arrayFormat],l=o==="comma"&&n.commaRoundTrip;r||(r=Object.keys(t)),n.sort&&r.sort(n.sort);const c=new WeakMap;for(let h=0;h<r.length;++h){const u=r[h];n.skipNulls&&t[u]===null||ea(i,ta(t[u],u,o,l,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,c))}const f=i.join(n.delimiter);let d=n.addQueryPrefix===!0?"?":"";return n.charsetSentinel&&(n.charset==="iso-8859-1"?d+="utf8=%26%2310003%3B&":d+="utf8=%E2%9C%93&"),f.length>0?d+f:""}function Ml(s){let e=0;for(const r of s)e+=r.length;const t=new Uint8Array(e);let n=0;for(const r of s)t.set(r,n),n+=r.length;return t}let zs;function jn(s){let e;return(zs??(e=new globalThis.TextEncoder,zs=e.encode.bind(e)))(s)}let Js;function Xs(s){let e;return(Js??(e=new globalThis.TextDecoder,Js=e.decode.bind(e)))(s)}var fe,he;class Yt{constructor(){fe.set(this,void 0),he.set(this,void 0),D(this,fe,new Uint8Array),D(this,he,null)}decode(e){if(e==null)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?jn(e):e;D(this,fe,Ml([p(this,fe,"f"),t]));const n=[];let r;for(;(r=Ll(p(this,fe,"f"),p(this,he,"f")))!=null;){if(r.carriage&&p(this,he,"f")==null){D(this,he,r.index);continue}if(p(this,he,"f")!=null&&(r.index!==p(this,he,"f")+1||r.carriage)){n.push(Xs(p(this,fe,"f").subarray(0,p(this,he,"f")-1))),D(this,fe,p(this,fe,"f").subarray(p(this,he,"f"))),D(this,he,null);continue}const a=p(this,he,"f")!==null?r.preceding-1:r.preceding,i=Xs(p(this,fe,"f").subarray(0,a));n.push(i),D(this,fe,p(this,fe,"f").subarray(r.index)),D(this,he,null)}return n}flush(){return p(this,fe,"f").length?this.decode(`
`):[]}}fe=new WeakMap,he=new WeakMap;Yt.NEWLINE_CHARS=new Set([`
`,"\r"]);Yt.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function Ll(s,e){for(let r=e??0;r<s.length;r++){if(s[r]===10)return{preceding:r,index:r+1,carriage:!1};if(s[r]===13)return{preceding:r,index:r+1,carriage:!0}}return null}function Fl(s){for(let n=0;n<s.length-1;n++){if(s[n]===10&&s[n+1]===10||s[n]===13&&s[n+1]===13)return n+2;if(s[n]===13&&s[n+1]===10&&n+3<s.length&&s[n+2]===13&&s[n+3]===10)return n+4}return-1}class $e{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let n=!1;async function*r(){if(n)throw new U("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let a=!1;try{for await(const i of Ul(e,t))if(!a){if(i.data.startsWith("[DONE]")){a=!0;continue}if(i.event===null||i.event.startsWith("response.")||i.event.startsWith("transcript.")){let o;try{o=JSON.parse(i.data)}catch(l){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),l}if(o&&o.error)throw new se(void 0,o.error,void 0,e.headers);yield o}else{let o;try{o=JSON.parse(i.data)}catch(l){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),l}if(i.event=="error")throw new se(void 0,o.error,o.message,void 0);yield{event:i.event,data:o}}}a=!0}catch(i){if(wn(i))return;throw i}finally{a||t.abort()}}return new $e(r,t)}static fromReadableStream(e,t){let n=!1;async function*r(){const i=new Yt,o=Xr(e);for await(const l of o)for(const c of i.decode(l))yield c;for(const l of i.flush())yield l}async function*a(){if(n)throw new U("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let i=!1;try{for await(const o of r())i||o&&(yield JSON.parse(o));i=!0}catch(o){if(wn(o))return;throw o}finally{i||t.abort()}}return new $e(a,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),r=a=>({next:()=>{if(a.length===0){const i=n.next();e.push(i),t.push(i)}return a.shift()}});return[new $e(()=>r(e),this.controller),new $e(()=>r(t),this.controller)]}toReadableStream(){const e=this;let t;return zr({async start(){t=e[Symbol.asyncIterator]()},async pull(n){try{const{value:r,done:a}=await t.next();if(a)return n.close();const i=jn(JSON.stringify(r)+`
`);n.enqueue(i)}catch(r){n.error(r)}},async cancel(){var n;await((n=t.return)==null?void 0:n.call(t))}})}}async function*Ul(s,e){if(!s.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new U("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new U("Attempted to iterate over a response with no body");const t=new Bl,n=new Yt,r=Xr(s.body);for await(const a of Dl(r))for(const i of n.decode(a)){const o=t.decode(i);o&&(yield o)}for(const a of n.flush()){const i=t.decode(a);i&&(yield i)}}async function*Dl(s){let e=new Uint8Array;for await(const t of s){if(t==null)continue;const n=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?jn(t):t;let r=new Uint8Array(e.length+n.length);r.set(e),r.set(n,e.length),e=r;let a;for(;(a=Fl(e))!==-1;)yield e.slice(0,a),e=e.slice(a)}e.length>0&&(yield e)}class Bl{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const a={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,r]=ql(e,":");return r.startsWith(" ")&&(r=r.substring(1)),t==="event"?this.event=r:t==="data"&&this.data.push(r),null}}function ql(s,e){const t=s.indexOf(e);return t!==-1?[s.substring(0,t),e,s.substring(t+e.length)]:[s,"",""]}const Dt={off:0,error:200,warn:300,info:400,debug:500},Ys=(s,e,t)=>{if(s){if(_l(Dt,s))return s;ae(t).warn(`${e} was set to ${JSON.stringify(s)}, expected one of ${JSON.stringify(Object.keys(Dt))}`)}};function Ze(){}function vt(s,e,t){return!e||Dt[s]>Dt[t]?Ze:e[s].bind(e)}const jl={error:Ze,warn:Ze,info:Ze,debug:Ze};let Qs=new WeakMap;function ae(s){const e=s.logger,t=s.logLevel??"off";if(!e)return jl;const n=Qs.get(e);if(n&&n[0]===t)return n[1];const r={error:vt("error",e,t),warn:vt("warn",e,t),info:vt("info",e,t),debug:vt("debug",e,t)};return Qs.set(e,[t,r]),r}const Ne=s=>(s.options&&(s.options={...s.options},delete s.options.headers),s.headers&&(s.headers=Object.fromEntries((s.headers instanceof Headers?[...s.headers]:Object.entries(s.headers)).map(([e,t])=>[e,e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t]))),"retryOfRequestLogID"in s&&(s.retryOfRequestLogID&&(s.retryOf=s.retryOfRequestLogID),delete s.retryOfRequestLogID),s);async function na(s,e){const{response:t,requestLogID:n,retryOfRequestLogID:r,startTime:a}=e,i=await(async()=>{var d;if(e.options.stream)return ae(s).debug("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller):$e.fromSSEResponse(t,e.controller);if(t.status===204)return null;if(e.options.__binaryResponse)return t;const o=t.headers.get("content-type"),l=(d=o==null?void 0:o.split(";")[0])==null?void 0:d.trim();if((l==null?void 0:l.includes("application/json"))||(l==null?void 0:l.endsWith("+json"))){const h=await t.json();return sa(h,t)}return await t.text()})();return ae(s).debug(`[${n}] response parsed`,Ne({retryOfRequestLogID:r,url:t.url,status:t.status,body:i,durationMs:Date.now()-a})),i}function sa(s,e){return!s||typeof s!="object"||Array.isArray(s)?s:Object.defineProperty(s,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}var et;class Qt extends Promise{constructor(e,t,n=na){super(r=>{r(null)}),this.responsePromise=t,this.parseResponse=n,et.set(this,void 0),D(this,et,e)}_thenUnwrap(e){return new Qt(p(this,et,"f"),this.responsePromise,async(t,n)=>sa(e(await this.parseResponse(t,n),n),n.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(p(this,et,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}et=new WeakMap;var wt;class ra{constructor(e,t,n,r){wt.set(this,void 0),D(this,wt,e),this.options=r,this.response=t,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageRequestOptions()!=null:!1}async getNextPage(){const e=this.nextPageRequestOptions();if(!e)throw new U("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await p(this,wt,"f").requestAPIList(this.constructor,e)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(wt=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class Vl extends Qt{constructor(e,t,n){super(e,t,async(r,a)=>new n(r,a.response,await na(r,a),a.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}class Zt extends ra{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}}class Y extends ra{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.has_more=n.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){var n;const e=this.getPaginatedItems(),t=(n=e[e.length-1])==null?void 0:n.id;return t?{...this.options,query:{...gl(this.options.query),after:t}}:null}}const aa=()=>{var s;if(typeof File>"u"){const{process:e}=globalThis,t=typeof((s=e==null?void 0:e.versions)==null?void 0:s.node)=="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function lt(s,e,t){return aa(),new File(s,e??"unknown_file",t)}function Et(s){return(typeof s=="object"&&s!==null&&("name"in s&&s.name&&String(s.name)||"url"in s&&s.url&&String(s.url)||"filename"in s&&s.filename&&String(s.filename)||"path"in s&&s.path&&String(s.path))||"").split(/[\\/]/).pop()||void 0}const ia=s=>s!=null&&typeof s=="object"&&typeof s[Symbol.asyncIterator]=="function",Be=async(s,e)=>({...s,body:await Wl(s.body,e)}),Zs=new WeakMap;function Gl(s){const e=typeof s=="function"?s:s.fetch,t=Zs.get(e);if(t)return t;const n=(async()=>{try{const r="Response"in e?e.Response:(await e("data:,")).constructor,a=new FormData;return a.toString()!==await new r(a).text()}catch{return!0}})();return Zs.set(e,n),n}const Wl=async(s,e)=>{if(!await Gl(e))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");const t=new FormData;return await Promise.all(Object.entries(s||{}).map(([n,r])=>Cn(t,n,r))),t},Hl=s=>s instanceof Blob&&"name"in s,Cn=async(s,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")s.append(e,String(t));else if(t instanceof Response)s.append(e,lt([await t.blob()],Et(t)));else if(ia(t))s.append(e,lt([await new Response(Jr(t)).blob()],Et(t)));else if(Hl(t))s.append(e,t,Et(t));else if(Array.isArray(t))await Promise.all(t.map(n=>Cn(s,e+"[]",n)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([n,r])=>Cn(s,`${e}[${n}]`,r)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}},oa=s=>s!=null&&typeof s=="object"&&typeof s.size=="number"&&typeof s.type=="string"&&typeof s.text=="function"&&typeof s.slice=="function"&&typeof s.arrayBuffer=="function",Kl=s=>s!=null&&typeof s=="object"&&typeof s.name=="string"&&typeof s.lastModified=="number"&&oa(s),zl=s=>s!=null&&typeof s=="object"&&typeof s.url=="string"&&typeof s.blob=="function";async function Jl(s,e,t){if(aa(),s=await s,Kl(s))return s instanceof File?s:lt([await s.arrayBuffer()],s.name);if(zl(s)){const r=await s.blob();return e||(e=new URL(s.url).pathname.split(/[\\/]/).pop()),lt(await $n(r),e,t)}const n=await $n(s);if(e||(e=Et(s)),!(t!=null&&t.type)){const r=n.find(a=>typeof a=="object"&&"type"in a&&a.type);typeof r=="string"&&(t={...t,type:r})}return lt(n,e,t)}async function $n(s){var t;let e=[];if(typeof s=="string"||ArrayBuffer.isView(s)||s instanceof ArrayBuffer)e.push(s);else if(oa(s))e.push(s instanceof Blob?s:await s.arrayBuffer());else if(ia(s))for await(const n of s)e.push(...await $n(n));else{const n=(t=s==null?void 0:s.constructor)==null?void 0:t.name;throw new Error(`Unexpected data type: ${typeof s}${n?`; constructor: ${n}`:""}${Xl(s)}`)}return e}function Xl(s){return typeof s!="object"||s===null?"":`; props: [${Object.getOwnPropertyNames(s).map(t=>`"${t}"`).join(", ")}]`}class B{constructor(e){this._client=e}}function la(s){return s.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const Yl=(s=la)=>function(t,...n){if(t.length===1)return t[0];let r=!1;const a=t.reduce((f,d,h)=>(/[?#]/.test(d)&&(r=!0),f+d+(h===n.length?"":(r?encodeURIComponent:s)(String(n[h])))),""),i=a.split(/[?#]/,1)[0],o=[],l=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let c;for(;(c=l.exec(i))!==null;)o.push({start:c.index,length:c[0].length});if(o.length>0){let f=0;const d=o.reduce((h,u)=>{const m=" ".repeat(u.start-f),g="^".repeat(u.length);return f=u.start+u.length,h+m+g},"");throw new U(`Path parameters result in path with invalid segments:
${a}
${d}`)}return a},I=Yl(la);let ca=class extends B{list(e,t={},n){return this._client.getAPIList(I`/chat/completions/${e}/messages`,Y,{query:t,...n})}};function Ql(s){return typeof s.parse=="function"}const Bt=s=>(s==null?void 0:s.role)==="assistant",ua=s=>(s==null?void 0:s.role)==="tool";var In,Rt,Ot,tt,nt,kt,st,Ae,rt,qt,jt,We,da;class Vn{constructor(){In.add(this),this.controller=new AbortController,Rt.set(this,void 0),Ot.set(this,()=>{}),tt.set(this,()=>{}),nt.set(this,void 0),kt.set(this,()=>{}),st.set(this,()=>{}),Ae.set(this,{}),rt.set(this,!1),qt.set(this,!1),jt.set(this,!1),We.set(this,!1),D(this,Rt,new Promise((e,t)=>{D(this,Ot,e,"f"),D(this,tt,t,"f")})),D(this,nt,new Promise((e,t)=>{D(this,kt,e,"f"),D(this,st,t,"f")})),p(this,Rt,"f").catch(()=>{}),p(this,nt,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},p(this,In,"m",da).bind(this))},0)}_connected(){this.ended||(p(this,Ot,"f").call(this),this._emit("connect"))}get ended(){return p(this,rt,"f")}get errored(){return p(this,qt,"f")}get aborted(){return p(this,jt,"f")}abort(){this.controller.abort()}on(e,t){return(p(this,Ae,"f")[e]||(p(this,Ae,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=p(this,Ae,"f")[e];if(!n)return this;const r=n.findIndex(a=>a.listener===t);return r>=0&&n.splice(r,1),this}once(e,t){return(p(this,Ae,"f")[e]||(p(this,Ae,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{D(this,We,!0),e!=="error"&&this.once("error",n),this.once(e,t)})}async done(){D(this,We,!0),await p(this,nt,"f")}_emit(e,...t){if(p(this,rt,"f"))return;e==="end"&&(D(this,rt,!0),p(this,kt,"f").call(this));const n=p(this,Ae,"f")[e];if(n&&(p(this,Ae,"f")[e]=n.filter(r=>!r.once),n.forEach(({listener:r})=>r(...t))),e==="abort"){const r=t[0];!p(this,We,"f")&&!(n!=null&&n.length)&&Promise.reject(r),p(this,tt,"f").call(this,r),p(this,st,"f").call(this,r),this._emit("end");return}if(e==="error"){const r=t[0];!p(this,We,"f")&&!(n!=null&&n.length)&&Promise.reject(r),p(this,tt,"f").call(this,r),p(this,st,"f").call(this,r),this._emit("end")}}_emitFinal(){}}Rt=new WeakMap,Ot=new WeakMap,tt=new WeakMap,nt=new WeakMap,kt=new WeakMap,st=new WeakMap,Ae=new WeakMap,rt=new WeakMap,qt=new WeakMap,jt=new WeakMap,We=new WeakMap,In=new WeakSet,da=function(e){if(D(this,qt,!0),e instanceof Error&&e.name==="AbortError"&&(e=new ge),e instanceof ge)return D(this,jt,!0),this._emit("abort",e);if(e instanceof U)return this._emit("error",e);if(e instanceof Error){const t=new U(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new U(String(e)))};function Gn(s){return(s==null?void 0:s.$brand)==="auto-parseable-response-format"}function gt(s){return(s==null?void 0:s.$brand)==="auto-parseable-tool"}function Zl(s,e){return!e||!fa(e)?{...s,choices:s.choices.map(t=>({...t,message:{...t.message,parsed:null,...t.message.tool_calls?{tool_calls:t.message.tool_calls}:void 0}}))}:Wn(s,e)}function Wn(s,e){const t=s.choices.map(n=>{var r;if(n.finish_reason==="length")throw new Hr;if(n.finish_reason==="content_filter")throw new Kr;return{...n,message:{...n.message,...n.message.tool_calls?{tool_calls:((r=n.message.tool_calls)==null?void 0:r.map(a=>tc(e,a)))??void 0}:void 0,parsed:n.message.content&&!n.message.refusal?ec(e,n.message.content):null}}});return{...s,choices:t}}function ec(s,e){var t,n;return((t=s.response_format)==null?void 0:t.type)!=="json_schema"?null:((n=s.response_format)==null?void 0:n.type)==="json_schema"?"$parseRaw"in s.response_format?s.response_format.$parseRaw(e):JSON.parse(e):null}function tc(s,e){var n;const t=(n=s.tools)==null?void 0:n.find(r=>{var a;return((a=r.function)==null?void 0:a.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:gt(t)?t.$parseRaw(e.function.arguments):t!=null&&t.function.strict?JSON.parse(e.function.arguments):null}}}function nc(s,e){var n;if(!s)return!1;const t=(n=s.tools)==null?void 0:n.find(r=>{var a;return((a=r.function)==null?void 0:a.name)===e.function.name});return gt(t)||(t==null?void 0:t.function.strict)||!1}function fa(s){var e;return Gn(s.response_format)?!0:((e=s.tools)==null?void 0:e.some(t=>gt(t)||t.type==="function"&&t.function.strict===!0))??!1}function sc(s){for(const e of s??[]){if(e.type!=="function")throw new U(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new U(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var le,An,Vt,En,Rn,On,ha,ma;const rc=10;class pa extends Vn{constructor(){super(...arguments),le.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var n;this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=(n=e.choices[0])==null?void 0:n.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),ua(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(Bt(e)&&e.tool_calls)for(const n of e.tool_calls)n.type==="function"&&this._emit("functionToolCall",n.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new U("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),p(this,le,"m",An).call(this)}async finalMessage(){return await this.done(),p(this,le,"m",Vt).call(this)}async finalFunctionToolCall(){return await this.done(),p(this,le,"m",En).call(this)}async finalFunctionToolCallResult(){return await this.done(),p(this,le,"m",Rn).call(this)}async totalUsage(){return await this.done(),p(this,le,"m",On).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=p(this,le,"m",Vt).call(this);t&&this._emit("finalMessage",t);const n=p(this,le,"m",An).call(this);n&&this._emit("finalContent",n);const r=p(this,le,"m",En).call(this);r&&this._emit("finalFunctionToolCall",r);const a=p(this,le,"m",Rn).call(this);a!=null&&this._emit("finalFunctionToolCallResult",a),this._chatCompletions.some(i=>i.usage)&&this._emit("totalUsage",p(this,le,"m",On).call(this))}async _createChatCompletion(e,t,n){const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),p(this,le,"m",ha).call(this,t);const a=await e.chat.completions.create({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(Wn(a,t))}async _runChatCompletion(e,t,n){for(const r of t.messages)this._addMessage(r,!1);return await this._createChatCompletion(e,t,n)}async _runTools(e,t,n){var u,m,g;const r="tool",{tool_choice:a="auto",stream:i,...o}=t,l=typeof a!="string"&&((u=a==null?void 0:a.function)==null?void 0:u.name),{maxChatCompletions:c=rc}=n||{},f=t.tools.map(_=>{if(gt(_)){if(!_.$callback)throw new U("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:_.$callback,name:_.function.name,description:_.function.description||"",parameters:_.function.parameters,parse:_.$parseRaw,strict:!0}}}return _}),d={};for(const _ of f)_.type==="function"&&(d[_.function.name||_.function.function.name]=_.function);const h="tools"in t?f.map(_=>_.type==="function"?{type:"function",function:{name:_.function.name||_.function.function.name,parameters:_.function.parameters,description:_.function.description,strict:_.function.strict}}:_):void 0;for(const _ of t.messages)this._addMessage(_,!1);for(let _=0;_<c;++_){const v=(m=(await this._createChatCompletion(e,{...o,tool_choice:a,tools:h,messages:[...this.messages]},n)).choices[0])==null?void 0:m.message;if(!v)throw new U("missing message in ChatCompletion response");if(!((g=v.tool_calls)!=null&&g.length))return;for(const S of v.tool_calls){if(S.type!=="function")continue;const C=S.id,{name:O,arguments:L}=S.function,w=d[O];if(w){if(l&&l!==O){const k=`Invalid tool_call: ${JSON.stringify(O)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:r,tool_call_id:C,content:k});continue}}else{const k=`Invalid tool_call: ${JSON.stringify(O)}. Available options are: ${Object.keys(d).map(z=>JSON.stringify(z)).join(", ")}. Please try again`;this._addMessage({role:r,tool_call_id:C,content:k});continue}let R;try{R=Ql(w)?await w.parse(L):L}catch(k){const z=k instanceof Error?k.message:String(k);this._addMessage({role:r,tool_call_id:C,content:z});continue}const A=await w.function(R,this),$=p(this,le,"m",ma).call(this,A);if(this._addMessage({role:r,tool_call_id:C,content:$}),l)return}}}}le=new WeakSet,An=function(){return p(this,le,"m",Vt).call(this).content??null},Vt=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(Bt(t))return{...t,content:t.content??null,refusal:t.refusal??null}}throw new U("stream ended without producing a ChatCompletionMessage with role=assistant")},En=function(){var e,t;for(let n=this.messages.length-1;n>=0;n--){const r=this.messages[n];if(Bt(r)&&((e=r==null?void 0:r.tool_calls)!=null&&e.length))return(t=r.tool_calls.at(-1))==null?void 0:t.function}},Rn=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(ua(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(n=>{var r;return n.role==="assistant"&&((r=n.tool_calls)==null?void 0:r.some(a=>a.type==="function"&&a.id===t.tool_call_id))}))return t.content}},On=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},ha=function(e){if(e.n!=null&&e.n>1)throw new U("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},ma=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class Hn extends pa{static runTools(e,t,n){const r=new Hn,a={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(e,t,a)),r}_addMessage(e,t=!0){super._addMessage(e,t),Bt(e)&&e.content&&this._emit("content",e.content)}}const ga=1,ya=2,_a=4,ba=8,va=16,wa=32,xa=64,Sa=128,Ca=256,$a=Sa|Ca,Ia=va|wa|$a|xa,Aa=ga|ya|Ia,Ea=_a|ba,ac=Aa|Ea,ee={STR:ga,NUM:ya,ARR:_a,OBJ:ba,NULL:va,BOOL:wa,NAN:xa,INFINITY:Sa,MINUS_INFINITY:Ca,INF:$a,SPECIAL:Ia,ATOM:Aa,COLLECTION:Ea,ALL:ac};class ic extends Error{}class oc extends Error{}function lc(s,e=ee.ALL){if(typeof s!="string")throw new TypeError(`expecting str, got ${typeof s}`);if(!s.trim())throw new Error(`${s} is empty`);return cc(s.trim(),e)}const cc=(s,e)=>{const t=s.length;let n=0;const r=h=>{throw new ic(`${h} at position ${n}`)},a=h=>{throw new oc(`${h} at position ${n}`)},i=()=>(d(),n>=t&&r("Unexpected end of input"),s[n]==='"'?o():s[n]==="{"?l():s[n]==="["?c():s.substring(n,n+4)==="null"||ee.NULL&e&&t-n<4&&"null".startsWith(s.substring(n))?(n+=4,null):s.substring(n,n+4)==="true"||ee.BOOL&e&&t-n<4&&"true".startsWith(s.substring(n))?(n+=4,!0):s.substring(n,n+5)==="false"||ee.BOOL&e&&t-n<5&&"false".startsWith(s.substring(n))?(n+=5,!1):s.substring(n,n+8)==="Infinity"||ee.INFINITY&e&&t-n<8&&"Infinity".startsWith(s.substring(n))?(n+=8,1/0):s.substring(n,n+9)==="-Infinity"||ee.MINUS_INFINITY&e&&1<t-n&&t-n<9&&"-Infinity".startsWith(s.substring(n))?(n+=9,-1/0):s.substring(n,n+3)==="NaN"||ee.NAN&e&&t-n<3&&"NaN".startsWith(s.substring(n))?(n+=3,NaN):f()),o=()=>{const h=n;let u=!1;for(n++;n<t&&(s[n]!=='"'||u&&s[n-1]==="\\");)u=s[n]==="\\"?!u:!1,n++;if(s.charAt(n)=='"')try{return JSON.parse(s.substring(h,++n-Number(u)))}catch(m){a(String(m))}else if(ee.STR&e)try{return JSON.parse(s.substring(h,n-Number(u))+'"')}catch{return JSON.parse(s.substring(h,s.lastIndexOf("\\"))+'"')}r("Unterminated string literal")},l=()=>{n++,d();const h={};try{for(;s[n]!=="}";){if(d(),n>=t&&ee.OBJ&e)return h;const u=o();d(),n++;try{const m=i();Object.defineProperty(h,u,{value:m,writable:!0,enumerable:!0,configurable:!0})}catch(m){if(ee.OBJ&e)return h;throw m}d(),s[n]===","&&n++}}catch{if(ee.OBJ&e)return h;r("Expected '}' at end of object")}return n++,h},c=()=>{n++;const h=[];try{for(;s[n]!=="]";)h.push(i()),d(),s[n]===","&&n++}catch{if(ee.ARR&e)return h;r("Expected ']' at end of array")}return n++,h},f=()=>{if(n===0){s==="-"&&ee.NUM&e&&r("Not sure what '-' is");try{return JSON.parse(s)}catch(u){if(ee.NUM&e)try{return s[s.length-1]==="."?JSON.parse(s.substring(0,s.lastIndexOf("."))):JSON.parse(s.substring(0,s.lastIndexOf("e")))}catch{}a(String(u))}}const h=n;for(s[n]==="-"&&n++;s[n]&&!",]}".includes(s[n]);)n++;n==t&&!(ee.NUM&e)&&r("Unterminated number literal");try{return JSON.parse(s.substring(h,n))}catch{s.substring(h,n)==="-"&&ee.NUM&e&&r("Not sure what '-' is");try{return JSON.parse(s.substring(h,s.lastIndexOf("e")))}catch(m){a(String(m))}}},d=()=>{for(;n<t&&` 
\r	`.includes(s[n]);)n++};return i()},er=s=>lc(s,ee.ALL^ee.NUM);var Q,Ie,je,Ee,mn,xt,pn,gn,yn,St,_n,tr;class ht extends pa{constructor(e){super(),Q.add(this),Ie.set(this,void 0),je.set(this,void 0),Ee.set(this,void 0),D(this,Ie,e),D(this,je,[])}get currentChatCompletionSnapshot(){return p(this,Ee,"f")}static fromReadableStream(e){const t=new ht(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,n){const r=new ht(t);return r._run(()=>r._runChatCompletion(e,{...t,stream:!0},{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createChatCompletion(e,t,n){var i;super._createChatCompletion;const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),p(this,Q,"m",mn).call(this);const a=await e.chat.completions.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const o of a)p(this,Q,"m",pn).call(this,o);if((i=a.controller.signal)!=null&&i.aborted)throw new ge;return this._addChatCompletion(p(this,Q,"m",St).call(this))}async _fromReadableStream(e,t){var i;const n=t==null?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),p(this,Q,"m",mn).call(this),this._connected();const r=$e.fromReadableStream(e,this.controller);let a;for await(const o of r)a&&a!==o.id&&this._addChatCompletion(p(this,Q,"m",St).call(this)),p(this,Q,"m",pn).call(this,o),a=o.id;if((i=r.controller.signal)!=null&&i.aborted)throw new ge;return this._addChatCompletion(p(this,Q,"m",St).call(this))}[(Ie=new WeakMap,je=new WeakMap,Ee=new WeakMap,Q=new WeakSet,mn=function(){this.ended||D(this,Ee,void 0)},xt=function(t){let n=p(this,je,"f")[t.index];return n||(n={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},p(this,je,"f")[t.index]=n,n)},pn=function(t){var r,a,i,o,l,c,f,d,h,u,m,g,_,P,v;if(this.ended)return;const n=p(this,Q,"m",tr).call(this,t);this._emit("chunk",t,n);for(const S of t.choices){const C=n.choices[S.index];S.delta.content!=null&&((r=C.message)==null?void 0:r.role)==="assistant"&&((a=C.message)!=null&&a.content)&&(this._emit("content",S.delta.content,C.message.content),this._emit("content.delta",{delta:S.delta.content,snapshot:C.message.content,parsed:C.message.parsed})),S.delta.refusal!=null&&((i=C.message)==null?void 0:i.role)==="assistant"&&((o=C.message)!=null&&o.refusal)&&this._emit("refusal.delta",{delta:S.delta.refusal,snapshot:C.message.refusal}),((l=S.logprobs)==null?void 0:l.content)!=null&&((c=C.message)==null?void 0:c.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(f=S.logprobs)==null?void 0:f.content,snapshot:((d=C.logprobs)==null?void 0:d.content)??[]}),((h=S.logprobs)==null?void 0:h.refusal)!=null&&((u=C.message)==null?void 0:u.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(m=S.logprobs)==null?void 0:m.refusal,snapshot:((g=C.logprobs)==null?void 0:g.refusal)??[]});const O=p(this,Q,"m",xt).call(this,C);C.finish_reason&&(p(this,Q,"m",yn).call(this,C),O.current_tool_call_index!=null&&p(this,Q,"m",gn).call(this,C,O.current_tool_call_index));for(const L of S.delta.tool_calls??[])O.current_tool_call_index!==L.index&&(p(this,Q,"m",yn).call(this,C),O.current_tool_call_index!=null&&p(this,Q,"m",gn).call(this,C,O.current_tool_call_index)),O.current_tool_call_index=L.index;for(const L of S.delta.tool_calls??[]){const w=(_=C.message.tool_calls)==null?void 0:_[L.index];w!=null&&w.type&&((w==null?void 0:w.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(P=w.function)==null?void 0:P.name,index:L.index,arguments:w.function.arguments,parsed_arguments:w.function.parsed_arguments,arguments_delta:((v=L.function)==null?void 0:v.arguments)??""}):(w==null||w.type,void 0))}}},gn=function(t,n){var i,o,l;if(p(this,Q,"m",xt).call(this,t).done_tool_calls.has(n))return;const a=(i=t.message.tool_calls)==null?void 0:i[n];if(!a)throw new Error("no tool call snapshot");if(!a.type)throw new Error("tool call snapshot missing `type`");if(a.type==="function"){const c=(l=(o=p(this,Ie,"f"))==null?void 0:o.tools)==null?void 0:l.find(f=>f.type==="function"&&f.function.name===a.function.name);this._emit("tool_calls.function.arguments.done",{name:a.function.name,index:n,arguments:a.function.arguments,parsed_arguments:gt(c)?c.$parseRaw(a.function.arguments):c!=null&&c.function.strict?JSON.parse(a.function.arguments):null})}else a.type},yn=function(t){var r,a;const n=p(this,Q,"m",xt).call(this,t);if(t.message.content&&!n.content_done){n.content_done=!0;const i=p(this,Q,"m",_n).call(this);this._emit("content.done",{content:t.message.content,parsed:i?i.$parseRaw(t.message.content):null})}t.message.refusal&&!n.refusal_done&&(n.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),(r=t.logprobs)!=null&&r.content&&!n.logprobs_content_done&&(n.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),(a=t.logprobs)!=null&&a.refusal&&!n.logprobs_refusal_done&&(n.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},St=function(){if(this.ended)throw new U("stream has ended, this shouldn't happen");const t=p(this,Ee,"f");if(!t)throw new U("request ended without sending any chunks");return D(this,Ee,void 0),D(this,je,[]),uc(t,p(this,Ie,"f"))},_n=function(){var n;const t=(n=p(this,Ie,"f"))==null?void 0:n.response_format;return Gn(t)?t:null},tr=function(t){var n,r,a,i;let o=p(this,Ee,"f");const{choices:l,...c}=t;o?Object.assign(o,c):o=D(this,Ee,{...c,choices:[]});for(const{delta:f,finish_reason:d,index:h,logprobs:u=null,...m}of t.choices){let g=o.choices[h];if(g||(g=o.choices[h]={finish_reason:d,index:h,message:{},logprobs:u,...m}),u)if(!g.logprobs)g.logprobs=Object.assign({},u);else{const{content:L,refusal:w,...R}=u;Object.assign(g.logprobs,R),L&&((n=g.logprobs).content??(n.content=[]),g.logprobs.content.push(...L)),w&&((r=g.logprobs).refusal??(r.refusal=[]),g.logprobs.refusal.push(...w))}if(d&&(g.finish_reason=d,p(this,Ie,"f")&&fa(p(this,Ie,"f")))){if(d==="length")throw new Hr;if(d==="content_filter")throw new Kr}if(Object.assign(g,m),!f)continue;const{content:_,refusal:P,function_call:v,role:S,tool_calls:C,...O}=f;if(Object.assign(g.message,O),P&&(g.message.refusal=(g.message.refusal||"")+P),S&&(g.message.role=S),v&&(g.message.function_call?(v.name&&(g.message.function_call.name=v.name),v.arguments&&((a=g.message.function_call).arguments??(a.arguments=""),g.message.function_call.arguments+=v.arguments)):g.message.function_call=v),_&&(g.message.content=(g.message.content||"")+_,!g.message.refusal&&p(this,Q,"m",_n).call(this)&&(g.message.parsed=er(g.message.content))),C){g.message.tool_calls||(g.message.tool_calls=[]);for(const{index:L,id:w,type:R,function:A,...$}of C){const k=(i=g.message.tool_calls)[L]??(i[L]={});Object.assign(k,$),w&&(k.id=w),R&&(k.type=R),A&&(k.function??(k.function={name:A.name??"",arguments:""})),A!=null&&A.name&&(k.function.name=A.name),A!=null&&A.arguments&&(k.function.arguments+=A.arguments,nc(p(this,Ie,"f"),k)&&(k.function.parsed_arguments=er(k.function.arguments)))}}}return o},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("chunk",r=>{const a=t.shift();a?a.resolve(r):e.push(r)}),this.on("end",()=>{n=!0;for(const r of t)r.resolve(void 0);t.length=0}),this.on("abort",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),this.on("error",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new $e(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function uc(s,e){const{id:t,choices:n,created:r,model:a,system_fingerprint:i,...o}=s,l={...o,id:t,choices:n.map(({message:c,finish_reason:f,index:d,logprobs:h,...u})=>{if(!f)throw new U(`missing finish_reason for choice ${d}`);const{content:m=null,function_call:g,tool_calls:_,...P}=c,v=c.role;if(!v)throw new U(`missing role for choice ${d}`);if(g){const{arguments:S,name:C}=g;if(S==null)throw new U(`missing function_call.arguments for choice ${d}`);if(!C)throw new U(`missing function_call.name for choice ${d}`);return{...u,message:{content:m,function_call:{arguments:S,name:C},role:v,refusal:c.refusal??null},finish_reason:f,index:d,logprobs:h}}return _?{...u,index:d,finish_reason:f,logprobs:h,message:{...P,role:v,content:m,refusal:c.refusal??null,tool_calls:_.map((S,C)=>{const{function:O,type:L,id:w,...R}=S,{arguments:A,name:$,...k}=O||{};if(w==null)throw new U(`missing choices[${d}].tool_calls[${C}].id
${Ct(s)}`);if(L==null)throw new U(`missing choices[${d}].tool_calls[${C}].type
${Ct(s)}`);if($==null)throw new U(`missing choices[${d}].tool_calls[${C}].function.name
${Ct(s)}`);if(A==null)throw new U(`missing choices[${d}].tool_calls[${C}].function.arguments
${Ct(s)}`);return{...R,id:w,type:L,function:{...k,name:$,arguments:A}}})}}:{...u,message:{...P,content:m,role:v,refusal:c.refusal??null},finish_reason:f,index:d,logprobs:h}}),created:r,model:a,object:"chat.completion",...i?{system_fingerprint:i}:{}};return Zl(l,e)}function Ct(s){return JSON.stringify(s)}class Gt extends ht{static fromReadableStream(e){const t=new Gt(null);return t._run(()=>t._fromReadableStream(e)),t}static runTools(e,t,n){const r=new Gt(t),a={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(e,t,a)),r}}let Kn=class extends B{constructor(){super(...arguments),this.messages=new ca(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(I`/chat/completions/${e}`,t)}update(e,t,n){return this._client.post(I`/chat/completions/${e}`,{body:t,...n})}list(e={},t){return this._client.getAPIList("/chat/completions",Y,{query:e,...t})}delete(e,t){return this._client.delete(I`/chat/completions/${e}`,t)}parse(e,t){return sc(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t==null?void 0:t.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(n=>Wn(n,e))}runTools(e,t){return e.stream?Gt.runTools(this._client,e,t):Hn.runTools(this._client,e,t)}stream(e,t){return ht.createChatCompletion(this._client,e,t)}};Kn.Messages=ca;class zn extends B{constructor(){super(...arguments),this.completions=new Kn(this._client)}}zn.Completions=Kn;const Ra=Symbol("brand.privateNullableHeaders");function*dc(s){if(!s)return;if(Ra in s){const{values:n,nulls:r}=s;yield*n.entries();for(const a of r)yield[a,null];return}let e=!1,t;s instanceof Headers?t=s.entries():qs(s)?t=s:(e=!0,t=Object.entries(s??{}));for(let n of t){const r=n[0];if(typeof r!="string")throw new TypeError("expected header name to be a string");const a=qs(n[1])?n[1]:[n[1]];let i=!1;for(const o of a)o!==void 0&&(e&&!i&&(i=!0,yield[r,null]),yield[r,o])}}const M=s=>{const e=new Headers,t=new Set;for(const n of s){const r=new Set;for(const[a,i]of dc(n)){const o=a.toLowerCase();r.has(o)||(e.delete(a),r.add(o)),i===null?(e.delete(a),t.add(o)):(e.append(a,i),t.delete(o))}}return{[Ra]:!0,values:e,nulls:t}};class Oa extends B{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:M([{Accept:"application/octet-stream"},t==null?void 0:t.headers]),__binaryResponse:!0})}}class ka extends B{create(e,t){return this._client.post("/audio/transcriptions",Be({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}}class Ta extends B{create(e,t){return this._client.post("/audio/translations",Be({body:e,...t,__metadata:{model:e.model}},this._client))}}class yt extends B{constructor(){super(...arguments),this.transcriptions=new ka(this._client),this.translations=new Ta(this._client),this.speech=new Oa(this._client)}}yt.Transcriptions=ka;yt.Translations=Ta;yt.Speech=Oa;class Na extends B{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(I`/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/batches",Y,{query:e,...t})}cancel(e,t){return this._client.post(I`/batches/${e}/cancel`,t)}}class Pa extends B{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:M([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}retrieve(e,t){return this._client.get(I`/assistants/${e}`,{...t,headers:M([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}update(e,t,n){return this._client.post(I`/assistants/${e}`,{body:t,...n,headers:M([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}list(e={},t){return this._client.getAPIList("/assistants",Y,{query:e,...t,headers:M([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}delete(e,t){return this._client.delete(I`/assistants/${e}`,{...t,headers:M([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}}class Ma extends B{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:M([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}}class La extends B{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:M([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}}class en extends B{constructor(){super(...arguments),this.sessions=new Ma(this._client),this.transcriptionSessions=new La(this._client)}}en.Sessions=Ma;en.TranscriptionSessions=La;class Fa extends B{create(e,t,n){return this._client.post(I`/threads/${e}/messages`,{body:t,...n,headers:M([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}retrieve(e,t,n){const{thread_id:r}=t;return this._client.get(I`/threads/${r}/messages/${e}`,{...n,headers:M([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}update(e,t,n){const{thread_id:r,...a}=t;return this._client.post(I`/threads/${r}/messages/${e}`,{body:a,...n,headers:M([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}list(e,t={},n){return this._client.getAPIList(I`/threads/${e}/messages`,Y,{query:t,...n,headers:M([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}delete(e,t,n){const{thread_id:r}=t;return this._client.delete(I`/threads/${r}/messages/${e}`,{...n,headers:M([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}}class Ua extends B{retrieve(e,t,n){const{thread_id:r,run_id:a,...i}=t;return this._client.get(I`/threads/${r}/runs/${a}/steps/${e}`,{query:i,...n,headers:M([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}list(e,t,n){const{thread_id:r,...a}=t;return this._client.getAPIList(I`/threads/${r}/runs/${e}/steps`,Y,{query:a,...n,headers:M([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}}const fc=s=>{if(typeof Buffer<"u"){const e=Buffer.from(s,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{const e=atob(s),t=e.length,n=new Uint8Array(t);for(let r=0;r<t;r++)n[r]=e.charCodeAt(r);return Array.from(new Float32Array(n.buffer))}};var bn={};const Xe=s=>{var e,t,n,r;if(typeof globalThis.process<"u")return((e=bn==null?void 0:bn[s])==null?void 0:e.trim())??void 0;if(typeof globalThis.Deno<"u")return(r=(n=(t=globalThis.Deno.env)==null?void 0:t.get)==null?void 0:n.call(t,s))==null?void 0:r.trim()};var ne,Le,kn,Se,Tt,_e,Fe,He,Pe,Wt,me,Nt,Pt,ct,at,it,nr,sr,rr,ar,ir,or,lr;class ut extends Vn{constructor(){super(...arguments),ne.add(this),kn.set(this,[]),Se.set(this,{}),Tt.set(this,{}),_e.set(this,void 0),Fe.set(this,void 0),He.set(this,void 0),Pe.set(this,void 0),Wt.set(this,void 0),me.set(this,void 0),Nt.set(this,void 0),Pt.set(this,void 0),ct.set(this,void 0)}[(kn=new WeakMap,Se=new WeakMap,Tt=new WeakMap,_e=new WeakMap,Fe=new WeakMap,He=new WeakMap,Pe=new WeakMap,Wt=new WeakMap,me=new WeakMap,Nt=new WeakMap,Pt=new WeakMap,ct=new WeakMap,ne=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",r=>{const a=t.shift();a?a.resolve(r):e.push(r)}),this.on("end",()=>{n=!0;for(const r of t)r.resolve(void 0);t.length=0}),this.on("abort",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),this.on("error",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new Le;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){var a;const n=t==null?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();const r=$e.fromReadableStream(e,this.controller);for await(const i of r)p(this,ne,"m",at).call(this,i);if((a=r.controller.signal)!=null&&a.aborted)throw new ge;return this._addRun(p(this,ne,"m",it).call(this))}toReadableStream(){return new $e(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,r){const a=new Le;return a._run(()=>a._runToolAssistantStream(e,t,n,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createToolAssistantStream(e,t,n,r){var l;const a=r==null?void 0:r.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const i={...n,stream:!0},o=await e.submitToolOutputs(t,i,{...r,signal:this.controller.signal});this._connected();for await(const c of o)p(this,ne,"m",at).call(this,c);if((l=o.controller.signal)!=null&&l.aborted)throw new ge;return this._addRun(p(this,ne,"m",it).call(this))}static createThreadAssistantStream(e,t,n){const r=new Le;return r._run(()=>r._threadAssistantStream(e,t,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),r}static createAssistantStream(e,t,n,r){const a=new Le;return a._run(()=>a._runAssistantStream(e,t,n,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),a}currentEvent(){return p(this,Nt,"f")}currentRun(){return p(this,Pt,"f")}currentMessageSnapshot(){return p(this,_e,"f")}currentRunStepSnapshot(){return p(this,ct,"f")}async finalRunSteps(){return await this.done(),Object.values(p(this,Se,"f"))}async finalMessages(){return await this.done(),Object.values(p(this,Tt,"f"))}async finalRun(){if(await this.done(),!p(this,Fe,"f"))throw Error("Final run was not received.");return p(this,Fe,"f")}async _createThreadAssistantStream(e,t,n){var o;const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));const a={...t,stream:!0},i=await e.createAndRun(a,{...n,signal:this.controller.signal});this._connected();for await(const l of i)p(this,ne,"m",at).call(this,l);if((o=i.controller.signal)!=null&&o.aborted)throw new ge;return this._addRun(p(this,ne,"m",it).call(this))}async _createAssistantStream(e,t,n,r){var l;const a=r==null?void 0:r.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const i={...n,stream:!0},o=await e.create(t,i,{...r,signal:this.controller.signal});this._connected();for await(const c of o)p(this,ne,"m",at).call(this,c);if((l=o.controller.signal)!=null&&l.aborted)throw new ge;return this._addRun(p(this,ne,"m",it).call(this))}static accumulateDelta(e,t){for(const[n,r]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=r;continue}let a=e[n];if(a==null){e[n]=r;continue}if(n==="index"||n==="type"){e[n]=r;continue}if(typeof a=="string"&&typeof r=="string")a+=r;else if(typeof a=="number"&&typeof r=="number")a+=r;else if(dn(a)&&dn(r))a=this.accumulateDelta(a,r);else if(Array.isArray(a)&&Array.isArray(r)){if(a.every(i=>typeof i=="string"||typeof i=="number")){a.push(...r);continue}for(const i of r){if(!dn(i))throw new Error(`Expected array delta entry to be an object but got: ${i}`);const o=i.index;if(o==null)throw console.error(i),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);const l=a[o];l==null?a.push(i):a[o]=this.accumulateDelta(l,i)}continue}else throw Error(`Unhandled record type: ${n}, deltaValue: ${r}, accValue: ${a}`);e[n]=a}return e}_addRun(e){return e}async _threadAssistantStream(e,t,n){return await this._createThreadAssistantStream(t,e,n)}async _runAssistantStream(e,t,n,r){return await this._createAssistantStream(t,e,n,r)}async _runToolAssistantStream(e,t,n,r){return await this._createToolAssistantStream(t,e,n,r)}}Le=ut,at=function(e){if(!this.ended)switch(D(this,Nt,e),p(this,ne,"m",rr).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":p(this,ne,"m",lr).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":p(this,ne,"m",sr).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":p(this,ne,"m",nr).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},it=function(){if(this.ended)throw new U("stream has ended, this shouldn't happen");if(!p(this,Fe,"f"))throw Error("Final run has not been received");return p(this,Fe,"f")},nr=function(e){const[t,n]=p(this,ne,"m",ir).call(this,e,p(this,_e,"f"));D(this,_e,t),p(this,Tt,"f")[t.id]=t;for(const r of n){const a=t.content[r.index];(a==null?void 0:a.type)=="text"&&this._emit("textCreated",a.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const r of e.data.delta.content){if(r.type=="text"&&r.text){let a=r.text,i=t.content[r.index];if(i&&i.type=="text")this._emit("textDelta",a,i.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(r.index!=p(this,He,"f")){if(p(this,Pe,"f"))switch(p(this,Pe,"f").type){case"text":this._emit("textDone",p(this,Pe,"f").text,p(this,_e,"f"));break;case"image_file":this._emit("imageFileDone",p(this,Pe,"f").image_file,p(this,_e,"f"));break}D(this,He,r.index)}D(this,Pe,t.content[r.index])}break;case"thread.message.completed":case"thread.message.incomplete":if(p(this,He,"f")!==void 0){const r=e.data.content[p(this,He,"f")];if(r)switch(r.type){case"image_file":this._emit("imageFileDone",r.image_file,p(this,_e,"f"));break;case"text":this._emit("textDone",r.text,p(this,_e,"f"));break}}p(this,_e,"f")&&this._emit("messageDone",e.data),D(this,_e,void 0)}},sr=function(e){const t=p(this,ne,"m",ar).call(this,e);switch(D(this,ct,t),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const n=e.data.delta;if(n.step_details&&n.step_details.type=="tool_calls"&&n.step_details.tool_calls&&t.step_details.type=="tool_calls")for(const a of n.step_details.tool_calls)a.index==p(this,Wt,"f")?this._emit("toolCallDelta",a,t.step_details.tool_calls[a.index]):(p(this,me,"f")&&this._emit("toolCallDone",p(this,me,"f")),D(this,Wt,a.index),D(this,me,t.step_details.tool_calls[a.index]),p(this,me,"f")&&this._emit("toolCallCreated",p(this,me,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":D(this,ct,void 0),e.data.step_details.type=="tool_calls"&&p(this,me,"f")&&(this._emit("toolCallDone",p(this,me,"f")),D(this,me,void 0)),this._emit("runStepDone",e.data,t);break}},rr=function(e){p(this,kn,"f").push(e),this._emit("event",e)},ar=function(e){switch(e.event){case"thread.run.step.created":return p(this,Se,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=p(this,Se,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){const r=Le.accumulateDelta(t,n.delta);p(this,Se,"f")[e.data.id]=r}return p(this,Se,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":p(this,Se,"f")[e.data.id]=e.data;break}if(p(this,Se,"f")[e.data.id])return p(this,Se,"f")[e.data.id];throw new Error("No snapshot available")},ir=function(e,t){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let r=e.data;if(r.delta.content)for(const a of r.delta.content)if(a.index in t.content){let i=t.content[a.index];t.content[a.index]=p(this,ne,"m",or).call(this,a,i)}else t.content[a.index]=a,n.push(a);return[t,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},or=function(e,t){return Le.accumulateDelta(t,e)},lr=function(e){switch(D(this,Pt,e.data),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":D(this,Fe,e.data),p(this,me,"f")&&(this._emit("toolCallDone",p(this,me,"f")),D(this,me,void 0));break}};let Jn=class extends B{constructor(){super(...arguments),this.steps=new Ua(this._client)}create(e,t,n){const{include:r,...a}=t;return this._client.post(I`/threads/${e}/runs`,{query:{include:r},body:a,...n,headers:M([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers]),stream:t.stream??!1})}retrieve(e,t,n){const{thread_id:r}=t;return this._client.get(I`/threads/${r}/runs/${e}`,{...n,headers:M([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}update(e,t,n){const{thread_id:r,...a}=t;return this._client.post(I`/threads/${r}/runs/${e}`,{body:a,...n,headers:M([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}list(e,t={},n){return this._client.getAPIList(I`/threads/${e}/runs`,Y,{query:t,...n,headers:M([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}cancel(e,t,n){const{thread_id:r}=t;return this._client.post(I`/threads/${r}/runs/${e}/cancel`,{...n,headers:M([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}async createAndPoll(e,t,n){const r=await this.create(e,t,n);return await this.poll(r.id,{thread_id:e},n)}createAndStream(e,t,n){return ut.createAssistantStream(e,this._client.beta.threads.runs,t,n)}async poll(e,t,n){var a;const r=M([n==null?void 0:n.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":((a=n==null?void 0:n.pollIntervalMs)==null?void 0:a.toString())??void 0}]);for(;;){const{data:i,response:o}=await this.retrieve(e,t,{...n,headers:{...n==null?void 0:n.headers,...r}}).withResponse();switch(i.status){case"queued":case"in_progress":case"cancelling":let l=5e3;if(n!=null&&n.pollIntervalMs)l=n.pollIntervalMs;else{const c=o.headers.get("openai-poll-after-ms");if(c){const f=parseInt(c);isNaN(f)||(l=f)}}await pt(l);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return i}}}stream(e,t,n){return ut.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n){const{thread_id:r,...a}=t;return this._client.post(I`/threads/${r}/runs/${e}/submit_tool_outputs`,{body:a,...n,headers:M([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers]),stream:t.stream??!1})}async submitToolOutputsAndPoll(e,t,n){const r=await this.submitToolOutputs(e,t,n);return await this.poll(r.id,t,n)}submitToolOutputsStream(e,t,n){return ut.createToolAssistantStream(e,this._client.beta.threads.runs,t,n)}};Jn.Steps=Ua;class tn extends B{constructor(){super(...arguments),this.runs=new Jn(this._client),this.messages=new Fa(this._client)}create(e={},t){return this._client.post("/threads",{body:e,...t,headers:M([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}retrieve(e,t){return this._client.get(I`/threads/${e}`,{...t,headers:M([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}update(e,t,n){return this._client.post(I`/threads/${e}`,{body:t,...n,headers:M([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}delete(e,t){return this._client.delete(I`/threads/${e}`,{...t,headers:M([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:M([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers]),stream:e.stream??!1})}async createAndRunPoll(e,t){const n=await this.createAndRun(e,t);return await this.runs.poll(n.id,{thread_id:n.thread_id},t)}createAndRunStream(e,t){return ut.createThreadAssistantStream(e,this._client.beta.threads,t)}}tn.Runs=Jn;tn.Messages=Fa;class _t extends B{constructor(){super(...arguments),this.realtime=new en(this._client),this.assistants=new Pa(this._client),this.threads=new tn(this._client)}}_t.Realtime=en;_t.Assistants=Pa;_t.Threads=tn;class Da extends B{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class Ba extends B{retrieve(e,t,n){const{container_id:r}=t;return this._client.get(I`/containers/${r}/files/${e}/content`,{...n,headers:M([{Accept:"application/binary"},n==null?void 0:n.headers]),__binaryResponse:!0})}}let Xn=class extends B{constructor(){super(...arguments),this.content=new Ba(this._client)}create(e,t,n){return this._client.post(I`/containers/${e}/files`,Be({body:t,...n},this._client))}retrieve(e,t,n){const{container_id:r}=t;return this._client.get(I`/containers/${r}/files/${e}`,n)}list(e,t={},n){return this._client.getAPIList(I`/containers/${e}/files`,Y,{query:t,...n})}delete(e,t,n){const{container_id:r}=t;return this._client.delete(I`/containers/${r}/files/${e}`,{...n,headers:M([{Accept:"*/*"},n==null?void 0:n.headers])})}};Xn.Content=Ba;class Yn extends B{constructor(){super(...arguments),this.files=new Xn(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(I`/containers/${e}`,t)}list(e={},t){return this._client.getAPIList("/containers",Y,{query:e,...t})}delete(e,t){return this._client.delete(I`/containers/${e}`,{...t,headers:M([{Accept:"*/*"},t==null?void 0:t.headers])})}}Yn.Files=Xn;class qa extends B{create(e,t){const n=!!e.encoding_format;let r=n?e.encoding_format:"base64";n&&ae(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);const a=this._client.post("/embeddings",{body:{...e,encoding_format:r},...t});return n?a:(ae(this._client).debug("embeddings/decoding base64 embeddings from base64"),a._thenUnwrap(i=>(i&&i.data&&i.data.forEach(o=>{const l=o.embedding;o.embedding=fc(l)}),i)))}}class ja extends B{retrieve(e,t,n){const{eval_id:r,run_id:a}=t;return this._client.get(I`/evals/${r}/runs/${a}/output_items/${e}`,n)}list(e,t,n){const{eval_id:r,...a}=t;return this._client.getAPIList(I`/evals/${r}/runs/${e}/output_items`,Y,{query:a,...n})}}class Qn extends B{constructor(){super(...arguments),this.outputItems=new ja(this._client)}create(e,t,n){return this._client.post(I`/evals/${e}/runs`,{body:t,...n})}retrieve(e,t,n){const{eval_id:r}=t;return this._client.get(I`/evals/${r}/runs/${e}`,n)}list(e,t={},n){return this._client.getAPIList(I`/evals/${e}/runs`,Y,{query:t,...n})}delete(e,t,n){const{eval_id:r}=t;return this._client.delete(I`/evals/${r}/runs/${e}`,n)}cancel(e,t,n){const{eval_id:r}=t;return this._client.post(I`/evals/${r}/runs/${e}`,n)}}Qn.OutputItems=ja;class Zn extends B{constructor(){super(...arguments),this.runs=new Qn(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(I`/evals/${e}`,t)}update(e,t,n){return this._client.post(I`/evals/${e}`,{body:t,...n})}list(e={},t){return this._client.getAPIList("/evals",Y,{query:e,...t})}delete(e,t){return this._client.delete(I`/evals/${e}`,t)}}Zn.Runs=Qn;let Va=class extends B{create(e,t){return this._client.post("/files",Be({body:e,...t},this._client))}retrieve(e,t){return this._client.get(I`/files/${e}`,t)}list(e={},t){return this._client.getAPIList("/files",Y,{query:e,...t})}delete(e,t){return this._client.delete(I`/files/${e}`,t)}content(e,t){return this._client.get(I`/files/${e}/content`,{...t,headers:M([{Accept:"application/binary"},t==null?void 0:t.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:n=30*60*1e3}={}){const r=new Set(["processed","error","deleted"]),a=Date.now();let i=await this.retrieve(e);for(;!i.status||!r.has(i.status);)if(await pt(t),i=await this.retrieve(e),Date.now()-a>n)throw new qn({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return i}};class Ga extends B{}let Wa=class extends B{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}};class es extends B{constructor(){super(...arguments),this.graders=new Wa(this._client)}}es.Graders=Wa;class Ha extends B{create(e,t,n){return this._client.getAPIList(I`/fine_tuning/checkpoints/${e}/permissions`,Zt,{body:t,method:"post",...n})}retrieve(e,t={},n){return this._client.getAPIList(I`/fine_tuning/checkpoints/${e}/permissions`,Y,{query:t,...n})}delete(e,t,n){const{fine_tuned_model_checkpoint:r}=t;return this._client.delete(I`/fine_tuning/checkpoints/${r}/permissions/${e}`,n)}}let ts=class extends B{constructor(){super(...arguments),this.permissions=new Ha(this._client)}};ts.Permissions=Ha;class Ka extends B{list(e,t={},n){return this._client.getAPIList(I`/fine_tuning/jobs/${e}/checkpoints`,Y,{query:t,...n})}}class ns extends B{constructor(){super(...arguments),this.checkpoints=new Ka(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(I`/fine_tuning/jobs/${e}`,t)}list(e={},t){return this._client.getAPIList("/fine_tuning/jobs",Y,{query:e,...t})}cancel(e,t){return this._client.post(I`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return this._client.getAPIList(I`/fine_tuning/jobs/${e}/events`,Y,{query:t,...n})}pause(e,t){return this._client.post(I`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(I`/fine_tuning/jobs/${e}/resume`,t)}}ns.Checkpoints=Ka;class ze extends B{constructor(){super(...arguments),this.methods=new Ga(this._client),this.jobs=new ns(this._client),this.checkpoints=new ts(this._client),this.alpha=new es(this._client)}}ze.Methods=Ga;ze.Jobs=ns;ze.Checkpoints=ts;ze.Alpha=es;class za extends B{}class ss extends B{constructor(){super(...arguments),this.graderModels=new za(this._client)}}ss.GraderModels=za;class Ja extends B{createVariation(e,t){return this._client.post("/images/variations",Be({body:e,...t},this._client))}edit(e,t){return this._client.post("/images/edits",Be({body:e,...t},this._client))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}class Xa extends B{retrieve(e,t){return this._client.get(I`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",Zt,e)}delete(e,t){return this._client.delete(I`/models/${e}`,t)}}class Ya extends B{create(e,t){return this._client.post("/moderations",{body:e,...t})}}function hc(s,e){return!e||!pc(e)?{...s,output_parsed:null,output:s.output.map(t=>t.type==="function_call"?{...t,parsed_arguments:null}:t.type==="message"?{...t,content:t.content.map(n=>({...n,parsed:null}))}:t)}:Qa(s,e)}function Qa(s,e){const t=s.output.map(r=>{if(r.type==="function_call")return{...r,parsed_arguments:_c(e,r)};if(r.type==="message"){const a=r.content.map(i=>i.type==="output_text"?{...i,parsed:mc(e,i.text)}:i);return{...r,content:a}}return r}),n=Object.assign({},s,{output:t});return Object.getOwnPropertyDescriptor(s,"output_text")||Za(n),Object.defineProperty(n,"output_parsed",{enumerable:!0,get(){for(const r of n.output)if(r.type==="message"){for(const a of r.content)if(a.type==="output_text"&&a.parsed!==null)return a.parsed}return null}}),n}function mc(s,e){var t,n,r,a;return((n=(t=s.text)==null?void 0:t.format)==null?void 0:n.type)!=="json_schema"?null:"$parseRaw"in((r=s.text)==null?void 0:r.format)?((a=s.text)==null?void 0:a.format).$parseRaw(e):JSON.parse(e)}function pc(s){var e;return!!Gn((e=s.text)==null?void 0:e.format)}function gc(s){return(s==null?void 0:s.$brand)==="auto-parseable-tool"}function yc(s,e){return s.find(t=>t.type==="function"&&t.name===e)}function _c(s,e){const t=yc(s.tools??[],e.name);return{...e,...e,parsed_arguments:gc(t)?t.$parseRaw(e.arguments):t!=null&&t.strict?JSON.parse(e.arguments):null}}function Za(s){const e=[];for(const t of s.output)if(t.type==="message")for(const n of t.content)n.type==="output_text"&&e.push(n.text);s.output_text=e.join("")}var Ve,$t,Re,It,cr,ur,dr,fr;class rs extends Vn{constructor(e){super(),Ve.add(this),$t.set(this,void 0),Re.set(this,void 0),It.set(this,void 0),D(this,$t,e)}static createResponse(e,t,n){const r=new rs(t);return r._run(()=>r._createOrRetrieveResponse(e,t,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createOrRetrieveResponse(e,t,n){var o;const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),p(this,Ve,"m",cr).call(this);let a,i=null;"response_id"in t?(a=await e.responses.retrieve(t.response_id,{stream:!0},{...n,signal:this.controller.signal,stream:!0}),i=t.starting_after??null):a=await e.responses.create({...t,stream:!0},{...n,signal:this.controller.signal}),this._connected();for await(const l of a)p(this,Ve,"m",ur).call(this,l,i);if((o=a.controller.signal)!=null&&o.aborted)throw new ge;return p(this,Ve,"m",dr).call(this)}[($t=new WeakMap,Re=new WeakMap,It=new WeakMap,Ve=new WeakSet,cr=function(){this.ended||D(this,Re,void 0)},ur=function(t,n){if(this.ended)return;const r=(i,o)=>{(n==null||o.sequence_number>n)&&this._emit(i,o)},a=p(this,Ve,"m",fr).call(this,t);switch(r("event",t),t.type){case"response.output_text.delta":{const i=a.output[t.output_index];if(!i)throw new U(`missing output at index ${t.output_index}`);if(i.type==="message"){const o=i.content[t.content_index];if(!o)throw new U(`missing content at index ${t.content_index}`);if(o.type!=="output_text")throw new U(`expected content to be 'output_text', got ${o.type}`);r("response.output_text.delta",{...t,snapshot:o.text})}break}case"response.function_call_arguments.delta":{const i=a.output[t.output_index];if(!i)throw new U(`missing output at index ${t.output_index}`);i.type==="function_call"&&r("response.function_call_arguments.delta",{...t,snapshot:i.arguments});break}default:r(t.type,t);break}},dr=function(){if(this.ended)throw new U("stream has ended, this shouldn't happen");const t=p(this,Re,"f");if(!t)throw new U("request ended without sending any events");D(this,Re,void 0);const n=bc(t,p(this,$t,"f"));return D(this,It,n),n},fr=function(t){let n=p(this,Re,"f");if(!n){if(t.type!=="response.created")throw new U(`When snapshot hasn't been set yet, expected 'response.created' event, got ${t.type}`);return n=D(this,Re,t.response),n}switch(t.type){case"response.output_item.added":{n.output.push(t.item);break}case"response.content_part.added":{const r=n.output[t.output_index];if(!r)throw new U(`missing output at index ${t.output_index}`);r.type==="message"&&r.content.push(t.part);break}case"response.output_text.delta":{const r=n.output[t.output_index];if(!r)throw new U(`missing output at index ${t.output_index}`);if(r.type==="message"){const a=r.content[t.content_index];if(!a)throw new U(`missing content at index ${t.content_index}`);if(a.type!=="output_text")throw new U(`expected content to be 'output_text', got ${a.type}`);a.text+=t.delta}break}case"response.function_call_arguments.delta":{const r=n.output[t.output_index];if(!r)throw new U(`missing output at index ${t.output_index}`);r.type==="function_call"&&(r.arguments+=t.delta);break}case"response.completed":{D(this,Re,t.response);break}}return n},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",r=>{const a=t.shift();a?a.resolve(r):e.push(r)}),this.on("end",()=>{n=!0;for(const r of t)r.resolve(void 0);t.length=0}),this.on("abort",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),this.on("error",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const e=p(this,It,"f");if(!e)throw new U("stream ended without producing a ChatCompletion");return e}}function bc(s,e){return hc(s,e)}class ei extends B{list(e,t={},n){return this._client.getAPIList(I`/responses/${e}/input_items`,Y,{query:t,...n})}}class as extends B{constructor(){super(...arguments),this.inputItems=new ei(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(n=>("object"in n&&n.object==="response"&&Za(n),n))}retrieve(e,t={},n){return this._client.get(I`/responses/${e}`,{query:t,...n,stream:(t==null?void 0:t.stream)??!1})}delete(e,t){return this._client.delete(I`/responses/${e}`,{...t,headers:M([{Accept:"*/*"},t==null?void 0:t.headers])})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(n=>Qa(n,e))}stream(e,t){return rs.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(I`/responses/${e}/cancel`,t)}}as.InputItems=ei;class ti extends B{create(e,t,n){return this._client.post(I`/uploads/${e}/parts`,Be({body:t,...n},this._client))}}class is extends B{constructor(){super(...arguments),this.parts=new ti(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(I`/uploads/${e}/cancel`,t)}complete(e,t,n){return this._client.post(I`/uploads/${e}/complete`,{body:t,...n})}}is.Parts=ti;const vc=async s=>{const e=await Promise.allSettled(s),t=e.filter(r=>r.status==="rejected");if(t.length){for(const r of t)console.error(r.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}const n=[];for(const r of e)r.status==="fulfilled"&&n.push(r.value);return n};class ni extends B{create(e,t,n){return this._client.post(I`/vector_stores/${e}/file_batches`,{body:t,...n,headers:M([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}retrieve(e,t,n){const{vector_store_id:r}=t;return this._client.get(I`/vector_stores/${r}/file_batches/${e}`,{...n,headers:M([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}cancel(e,t,n){const{vector_store_id:r}=t;return this._client.post(I`/vector_stores/${r}/file_batches/${e}/cancel`,{...n,headers:M([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}async createAndPoll(e,t,n){const r=await this.create(e,t);return await this.poll(e,r.id,n)}listFiles(e,t,n){const{vector_store_id:r,...a}=t;return this._client.getAPIList(I`/vector_stores/${r}/file_batches/${e}/files`,Y,{query:a,...n,headers:M([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}async poll(e,t,n){var a;const r=M([n==null?void 0:n.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":((a=n==null?void 0:n.pollIntervalMs)==null?void 0:a.toString())??void 0}]);for(;;){const{data:i,response:o}=await this.retrieve(t,{vector_store_id:e},{...n,headers:r}).withResponse();switch(i.status){case"in_progress":let l=5e3;if(n!=null&&n.pollIntervalMs)l=n.pollIntervalMs;else{const c=o.headers.get("openai-poll-after-ms");if(c){const f=parseInt(c);isNaN(f)||(l=f)}}await pt(l);break;case"failed":case"cancelled":case"completed":return i}}}async uploadAndPoll(e,{files:t,fileIds:n=[]},r){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const a=(r==null?void 0:r.maxConcurrency)??5,i=Math.min(a,t.length),o=this._client,l=t.values(),c=[...n];async function f(h){for(let u of h){const m=await o.files.create({file:u,purpose:"assistants"},r);c.push(m.id)}}const d=Array(i).fill(l).map(f);return await vc(d),await this.createAndPoll(e,{file_ids:c})}}class si extends B{create(e,t,n){return this._client.post(I`/vector_stores/${e}/files`,{body:t,...n,headers:M([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}retrieve(e,t,n){const{vector_store_id:r}=t;return this._client.get(I`/vector_stores/${r}/files/${e}`,{...n,headers:M([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}update(e,t,n){const{vector_store_id:r,...a}=t;return this._client.post(I`/vector_stores/${r}/files/${e}`,{body:a,...n,headers:M([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}list(e,t={},n){return this._client.getAPIList(I`/vector_stores/${e}/files`,Y,{query:t,...n,headers:M([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}delete(e,t,n){const{vector_store_id:r}=t;return this._client.delete(I`/vector_stores/${r}/files/${e}`,{...n,headers:M([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}async createAndPoll(e,t,n){const r=await this.create(e,t,n);return await this.poll(e,r.id,n)}async poll(e,t,n){var a;const r=M([n==null?void 0:n.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":((a=n==null?void 0:n.pollIntervalMs)==null?void 0:a.toString())??void 0}]);for(;;){const i=await this.retrieve(t,{vector_store_id:e},{...n,headers:r}).withResponse(),o=i.data;switch(o.status){case"in_progress":let l=5e3;if(n!=null&&n.pollIntervalMs)l=n.pollIntervalMs;else{const c=i.response.headers.get("openai-poll-after-ms");if(c){const f=parseInt(c);isNaN(f)||(l=f)}}await pt(l);break;case"failed":case"completed":return o}}}async upload(e,t,n){const r=await this._client.files.create({file:t,purpose:"assistants"},n);return this.create(e,{file_id:r.id},n)}async uploadAndPoll(e,t,n){const r=await this.upload(e,t,n);return await this.poll(e,r.id,n)}content(e,t,n){const{vector_store_id:r}=t;return this._client.getAPIList(I`/vector_stores/${r}/files/${e}/content`,Zt,{...n,headers:M([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}}class nn extends B{constructor(){super(...arguments),this.files=new si(this._client),this.fileBatches=new ni(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:M([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}retrieve(e,t){return this._client.get(I`/vector_stores/${e}`,{...t,headers:M([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}update(e,t,n){return this._client.post(I`/vector_stores/${e}`,{body:t,...n,headers:M([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}list(e={},t){return this._client.getAPIList("/vector_stores",Y,{query:e,...t,headers:M([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}delete(e,t){return this._client.delete(I`/vector_stores/${e}`,{...t,headers:M([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}search(e,t,n){return this._client.getAPIList(I`/vector_stores/${e}/search`,Zt,{body:t,method:"post",...n,headers:M([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}}nn.Files=si;nn.FileBatches=ni;var Tn,os,Mt,ri;class V{constructor({baseURL:e=Xe("OPENAI_BASE_URL"),apiKey:t=Xe("OPENAI_API_KEY"),organization:n=Xe("OPENAI_ORG_ID")??null,project:r=Xe("OPENAI_PROJECT_ID")??null,...a}={}){if(Tn.add(this),Mt.set(this,void 0),this.completions=new Da(this),this.chat=new zn(this),this.embeddings=new qa(this),this.files=new Va(this),this.images=new Ja(this),this.audio=new yt(this),this.moderations=new Ya(this),this.models=new Xa(this),this.fineTuning=new ze(this),this.graders=new ss(this),this.vectorStores=new nn(this),this.beta=new _t(this),this.batches=new Na(this),this.uploads=new is(this),this.responses=new as(this),this.evals=new Zn(this),this.containers=new Yn(this),t===void 0)throw new U("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const i={apiKey:t,organization:n,project:r,...a,baseURL:e||"https://api.openai.com/v1"};if(!i.dangerouslyAllowBrowser&&wl())throw new U(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);this.baseURL=i.baseURL,this.timeout=i.timeout??os.DEFAULT_TIMEOUT,this.logger=i.logger??console;const o="warn";this.logLevel=o,this.logLevel=Ys(i.logLevel,"ClientOptions.logLevel",this)??Ys(Xe("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??o,this.fetchOptions=i.fetchOptions,this.maxRetries=i.maxRetries??2,this.fetch=i.fetch??Il(),D(this,Mt,El),this._options=i,this.apiKey=t,this.organization=n,this.project=r}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){}authHeaders(e){return M([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return Pl(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${Ge}`}defaultIdempotencyKey(){return`stainless-node-retry-${Fr()}`}makeStatusError(e,t,n,r){return se.generate(e,t,n,r)}buildURL(e,t,n){const r=!p(this,Tn,"m",ri).call(this)&&n||this.baseURL,a=pl(e)?new URL(e):new URL(r+(r.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),i=this.defaultQuery();return yl(i)||(t={...i,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(a.search=this.stringifyQuery(t)),a.toString()}async prepareOptions(e){}async prepareRequest(e,{url:t,options:n}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(r=>({method:e,path:t,...r})))}request(e,t=null){return new Qt(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,n){var P,v;const r=await e,a=r.maxRetries??this.maxRetries;t==null&&(t=a),await this.prepareOptions(r);const{req:i,url:o,timeout:l}=this.buildRequest(r,{retryCount:a-t});await this.prepareRequest(i,{url:o,options:r});const c="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),f=n===void 0?"":`, retryOf: ${n}`,d=Date.now();if(ae(this).debug(`[${c}] sending request`,Ne({retryOfRequestLogID:n,method:r.method,url:o,options:r,headers:i.headers})),(P=r.signal)!=null&&P.aborted)throw new ge;const h=new AbortController,u=await this.fetchWithTimeout(o,i,l,h).catch(xn),m=Date.now();if(u instanceof Error){const S=`retrying, ${t} attempts remaining`;if((v=r.signal)!=null&&v.aborted)throw new ge;const C=wn(u)||/timed? ?out/i.test(String(u)+("cause"in u?String(u.cause):""));if(t)return ae(this).info(`[${c}] connection ${C?"timed out":"failed"} - ${S}`),ae(this).debug(`[${c}] connection ${C?"timed out":"failed"} (${S})`,Ne({retryOfRequestLogID:n,url:o,durationMs:m-d,message:u.message})),this.retryRequest(r,t,n??c);throw ae(this).info(`[${c}] connection ${C?"timed out":"failed"} - error; no more retries left`),ae(this).debug(`[${c}] connection ${C?"timed out":"failed"} (error; no more retries left)`,Ne({retryOfRequestLogID:n,url:o,durationMs:m-d,message:u.message})),C?new qn:new Xt({cause:u})}const g=[...u.headers.entries()].filter(([S])=>S==="x-request-id").map(([S,C])=>", "+S+": "+JSON.stringify(C)).join(""),_=`[${c}${f}${g}] ${i.method} ${o} ${u.ok?"succeeded":"failed"} with status ${u.status} in ${m-d}ms`;if(!u.ok){const S=this.shouldRetry(u);if(t&&S){const A=`retrying, ${t} attempts remaining`;return await Al(u.body),ae(this).info(`${_} - ${A}`),ae(this).debug(`[${c}] response error (${A})`,Ne({retryOfRequestLogID:n,url:u.url,status:u.status,headers:u.headers,durationMs:m-d})),this.retryRequest(r,t,n??c,u.headers)}const C=S?"error; no more retries left":"error; not retryable";ae(this).info(`${_} - ${C}`);const O=await u.text().catch(A=>xn(A).message),L=vl(O),w=L?void 0:O;throw ae(this).debug(`[${c}] response error (${C})`,Ne({retryOfRequestLogID:n,url:u.url,status:u.status,headers:u.headers,message:w,durationMs:Date.now()-d})),this.makeStatusError(u.status,L,w,u.headers)}return ae(this).info(_),ae(this).debug(`[${c}] response start`,Ne({retryOfRequestLogID:n,url:u.url,status:u.status,headers:u.headers,durationMs:m-d})),{response:u,options:r,controller:h,requestLogID:c,retryOfRequestLogID:n,startTime:d}}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}requestAPIList(e,t){const n=this.makeRequest(t,null,void 0);return new Vl(this,n,e)}async fetchWithTimeout(e,t,n,r){const{signal:a,method:i,...o}=t||{};a&&a.addEventListener("abort",()=>r.abort());const l=setTimeout(()=>r.abort(),n),c=globalThis.ReadableStream&&o.body instanceof globalThis.ReadableStream||typeof o.body=="object"&&o.body!==null&&Symbol.asyncIterator in o.body,f={signal:r.signal,...c?{duplex:"half"}:{},method:"GET",...o};i&&(f.method=i.toUpperCase());try{return await this.fetch.call(void 0,e,f)}finally{clearTimeout(l)}}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n,r){let a;const i=r==null?void 0:r.get("retry-after-ms");if(i){const l=parseFloat(i);Number.isNaN(l)||(a=l)}const o=r==null?void 0:r.get("retry-after");if(o&&!a){const l=parseFloat(o);Number.isNaN(l)?a=Date.parse(o)-Date.now():a=l*1e3}if(!(a&&0<=a&&a<60*1e3)){const l=e.maxRetries??this.maxRetries;a=this.calculateDefaultRetryTimeoutMillis(t,l)}return await pt(a),this.makeRequest(e,t-1,n)}calculateDefaultRetryTimeoutMillis(e,t){const a=t-e,i=Math.min(.5*Math.pow(2,a),8),o=1-Math.random()*.25;return i*o*1e3}buildRequest(e,{retryCount:t=0}={}){const n={...e},{method:r,path:a,query:i,defaultBaseURL:o}=n,l=this.buildURL(a,i,o);"timeout"in n&&bl("timeout",n.timeout),n.timeout=n.timeout??this.timeout;const{bodyHeaders:c,body:f}=this.buildBody({options:n}),d=this.buildHeaders({options:e,method:r,bodyHeaders:c,retryCount:t});return{req:{method:r,headers:d,...n.signal&&{signal:n.signal},...globalThis.ReadableStream&&f instanceof globalThis.ReadableStream&&{duplex:"half"},...f&&{body:f},...this.fetchOptions??{},...n.fetchOptions??{}},url:l,timeout:n.timeout}}buildHeaders({options:e,method:t,bodyHeaders:n,retryCount:r}){let a={};this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);const i=M([a,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(r),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...$l(),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},this.authHeaders(e),this._options.defaultHeaders,n,e.headers]);return this.validateHeaders(i),i.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};const n=M([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&n.values.has("content-type")||e instanceof Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:Jr(e)}:p(this,Mt,"f").call(this,{body:e,headers:n})}}os=V,Mt=new WeakMap,Tn=new WeakSet,ri=function(){return this.baseURL!=="https://api.openai.com/v1"};V.OpenAI=os;V.DEFAULT_TIMEOUT=6e5;V.OpenAIError=U;V.APIError=se;V.APIConnectionError=Xt;V.APIConnectionTimeoutError=qn;V.APIUserAbortError=ge;V.NotFoundError=qr;V.ConflictError=jr;V.RateLimitError=Gr;V.BadRequestError=Ur;V.AuthenticationError=Dr;V.InternalServerError=Wr;V.PermissionDeniedError=Br;V.UnprocessableEntityError=Vr;V.toFile=Jl;V.Completions=Da;V.Chat=zn;V.Embeddings=qa;V.Files=Va;V.Images=Ja;V.Audio=yt;V.Moderations=Ya;V.Models=Xa;V.FineTuning=ze;V.Graders=ss;V.VectorStores=nn;V.Beta=_t;V.Batches=Na;V.Uploads=is;V.Responses=as;V.Evals=Zn;V.Containers=Yn;async function wc(s,e,t,n){var _,P,v,S,C,O,L;const r=we(),a=ve(),i=r.selectedOpenRouterApiKey,o=a.settings.translationServices.services.find(w=>w.name==="OpenRouter"&&w.serviceType==="ai");if(!i)return console.error("OpenRouter API Key is not selected or available."),null;if(!o)return console.error("OpenRouter service configuration not found in text render settings."),null;const l=o.chosenModel;if(!l)return console.error("No OpenRouter model selected in settings."),null;const c=r.info,f=(_=r.settings)==null?void 0:_.aiPrompt;if(!c)return console.error("Study pack info not loaded."),null;if(!f)return console.error("AI prompt settings not loaded from study pack settings.json."),null;const d=c.languages.targetLanguage,h=c.languages.sourceLanguage;let u,m;e==="term"?(u=(P=f.term)==null?void 0:P.translation,m=(v=f.term)==null?void 0:v.note):(u=(S=f.line)==null?void 0:S.translation,m=(C=f.line)==null?void 0:C.note),u||(console.warn(`AI prompt setting for ${e} translation instruction is missing. Using default.`),u=e==="term"?`Provide the most accurate and common translation for the term from ${d} to ${h}. The translation should consist of the most popular translations of the given text (no more than five) and be separated by commas.`:`Translate the sentence(s) from ${d} to ${h}. The translation must be grammatically correct and sound natural, while preserving the original tone and meaning.`),t&&!m&&(console.warn(`AI prompt setting for ${e} note instruction is missing, but note generation was requested. Using default.`),m=e==="term"?`Briefly explain the choice of translation. If there are other common alternative translations for this term, mention them. The note should be written in ${h}.`:`In one or two sentences, explain any interesting cultural nuances, idioms, or non-obvious translation choices. If the translation is straightforward, state that. The note should be written in ${d}.`);const g=`
Context: You are an expert translator.

Text to translate: "${s}"

Instructions:
1. Translate the text according to this rule: ${u}.
${t&&m?`2. Generate a concise note based on this rule: ${m}.`:""}

Your response must be a valid JSON object.
It must contain a "translation" key with the translated text as a string.
${t?'It must also contain a "note" key with the generated note as a string.':'It must not contain a "note" key.'}

${n?`Here's another extra prompt for you: ${n}`:""}
`;console.log("Sending prompt to OpenRouter:",g);try{const A=(L=(O=(await new V({baseURL:"https://openrouter.ai/api/v1",apiKey:i,dangerouslyAllowBrowser:!0}).chat.completions.create({model:l,messages:[{role:"user",content:g}],response_format:{type:"json_object"}})).choices[0])==null?void 0:O.message)==null?void 0:L.content;if(!A)return console.error("OpenRouter API returned an empty or invalid response content."),null;console.log("Received raw response from OpenRouter:",A);let $=A.trim();const k=$.indexOf("{"),z=$.lastIndexOf("}");k!==-1&&z>k?($=$.substring(k,z+1),console.log("Cleaned string for parsing:",$)):console.warn("Could not find a valid JSON object within the response. Attempting to parse as is.");let W;try{W=JSON.parse($)}catch(j){return console.error("Failed to parse OpenRouter response as JSON:",j.message),console.error("Raw response text that failed parsing:",A),null}return typeof W!="object"||W===null?(console.error("OpenRouter response is not a valid JSON object."),null):typeof W.translation!="string"?(console.error('OpenRouter response JSON is missing the required "translation" string.'),null):(t&&typeof W.note!="string"?(console.warn('OpenRouter response JSON is missing the required "note" string, but note generation was requested.'),delete W.note):!t&&W.note!==void 0&&delete W.note,W)}catch(w){return console.error("Error calling OpenRouter API:",w.message||w),w.response&&console.error("OpenRouter API Error Details:",JSON.stringify(w.response.data,null,2)),null}}async function xc(s,e,t,n){var g,_,P,v,S,C;if(typeof puter>"u"||typeof((g=puter.ai)==null?void 0:g.chat)!="function")return console.error("Puter SDK is not available. Make sure it is loaded correctly."),null;const r=we(),i=ve().settings.translationServices.services.find(O=>O.name==="Puter"&&O.serviceType==="ai");if(!i)return console.error("Puter service configuration not found in text render settings."),null;const o=i.chosenModel;if(!o)return console.error("No Puter model selected in settings."),null;const l=r.info,c=(_=r.settings)==null?void 0:_.aiPrompt;if(!l)return console.error("Study pack info not loaded."),null;if(!c)return console.error("AI prompt settings not loaded from study pack settings.json."),null;const f=l.languages.targetLanguage,d=l.languages.sourceLanguage;let h,u;e==="term"?(h=(P=c.term)==null?void 0:P.translation,u=(v=c.term)==null?void 0:v.note):(h=(S=c.line)==null?void 0:S.translation,u=(C=c.line)==null?void 0:C.note),h||(console.warn(`AI prompt setting for ${e} translation instruction is missing. Using default.`),e==="term"?h=`Provide the most accurate and common translation for the term from ${f} to ${d}. The translation should consist of the most popular translations of the given text (no more than five) and be separated by commas.`:h=`Translate the sentence(s) from ${f} to ${d}. The translation must be grammatically correct and sound natural, while preserving the original tone and meaning.`),t&&!u&&(console.warn(`AI prompt setting for ${e} note instruction is missing, but note generation was requested. Using default.`),e==="term"?u=`Briefly explain the choice of translation. If there are other common alternative translations for this term, mention them. The note should be written in ${d}.`:u=`In one or two sentences, explain any interesting cultural nuances, idioms, or non-obvious translation choices. If the translation is straightforward, state that. The note should be written in ${f}.`);const m=`
Context: You are an expert translator.

Text to translate: "${s}"

Instructions:
1. Translate the text according to this rule: ${h}.
${t&&u?`2. Generate a concise note based on this rule: ${u}.`:""}

Your response must be a valid JSON object. It must not be wrapped in markdown code blocks or any other text.
It must contain a "translation" key with the translated text as a string.
${t&&u?'It must also contain a "note" key with the generated note as a string.':'It must not contain a "note" key.'}

${n?`Here's another extra prompt for you: ${n}`:""}
`;console.log("Sending prompt to Puter AI:",m);try{let O=await puter.ai.chat(m,{model:o});O=O.message.content,console.log("Received raw response from Puter AI:",O);let L;try{const w=O.match(/\{[\s\S]*\}/);if(!w)throw new Error("No valid JSON object found in the response.");L=JSON.parse(w[0])}catch(w){return console.error("Failed to parse Puter AI response as JSON:",w.message),console.error("Raw response text:",O),null}return typeof L!="object"||L===null?(console.error("Puter AI response is not a valid JSON object."),null):typeof L.translation!="string"?(console.error('Puter AI response JSON is missing the required "translation" string.'),null):(t&&typeof L.note!="string"?(console.warn('Puter AI response JSON is missing the required "note" string, but note generation was requested.'),delete L.note):!t&&L.note!==void 0&&delete L.note,L)}catch(O){return console.error("Error calling Puter AI:",O),O.message&&console.error("Puter AI Error Message:",O.message),null}}function Sc(){const s=ve(),e=we(),t=zt(),n=ul(),r=vi({status:"idle",result:null,error:null}),a=F(()=>{const f=s.settings.translationServices.chosenServiceName;return f&&s.settings.translationServices.services.find(d=>d.name===f)||null}),i=F(()=>{const f=a.value;return(f==null?void 0:f.serviceType)==="ai"&&s.settings.translationServices.generateNote});return{state:r,activeTranslationService:a,generateNote:i,checkCache:f=>{const d=n.getTranslation(f);return d?(r.status="success",r.result=d,r.error=null,!0):!1},translate:async(f,d,h)=>{var m,g,_,P,v,S;const u=a.value;if(!u){t.add({title:"Service Not Found",description:"No active translation service selected.",color:"error"});return}r.status="loading",r.result=null,r.error=null;try{let C=null;if(u.name==="Gemini"){if(!e.selectedGeminiApiKey)throw new Error("Gemini API key is not selected.");if(!u.chosenModel)throw new Error(`Model for ${u.name} is not selected.`);C=await cl(f,d,i.value??!1,h)}else if(u.name==="OpenRouter"){if(!e.selectedOpenRouterApiKey)throw new Error("OpenRouter API key is not selected.");if(!u.chosenModel)throw new Error(`Model for ${u.name} is not selected.`);C=await wc(f,d,i.value??!1,h)}else if(u.name==="Puter"){if(!u.chosenModel)throw new Error(`Model for ${u.name} is not selected.`);C=await xc(f,d,i.value??!1,h)}else if(u.name==="Google Mirror 1")C=await dl(f,(m=e.info)==null?void 0:m.languages.targetLanguage,(g=e.info)==null?void 0:g.languages.sourceLanguage);else if(u.name==="Google Mirror 2")C=await fl(f,(_=e.info)==null?void 0:_.languages.targetLanguage,(P=e.info)==null?void 0:P.languages.sourceLanguage);else if(u.name==="MyMemory")C=await hl(f,(v=e.info)==null?void 0:v.languages.targetLanguage,(S=e.info)==null?void 0:S.languages.sourceLanguage);else{if(console.warn(`Service ${u.name} is simulated.`),await new Promise(O=>setTimeout(O,1e3)),f.toLowerCase().includes("error"))throw new Error("Simulated API error");C={translation:`Simulated translation for "${f.substring(0,30)}..."`,note:u.serviceType==="ai"&&i.value?`Simulated note for ${d}...`:void 0}}if(!C)throw new Error("Translation service returned no result.");r.result=C,r.status="success",n.addTranslation(f,C)}catch(C){console.error("Translation failed:",C),r.error=C.message||"An unknown error occurred during translation.",r.status="error",t.add({title:"Translation Error",description:`${r.error}`,color:"error",icon:"i-heroicons-x-circle"})}},reset:()=>{r.status="idle",r.result=null,r.error=null}}}const Cc={class:"translation-and-note space-y-4"},$c={key:0,class:"input-section"},Ic={class:"flex items-center gap-2 mb-2"},Ac=["innerHTML"],Ec={class:"translation-section"},Rc={class:"flex items-center gap-2 mb-2"},Oc=["innerHTML"],kc={key:1,class:"note-section"},Tc={class:"flex items-center gap-2 mb-2"},Nc=["innerHTML"],ai=te({__name:"TranslationAndNote",props:{translation:{},note:{},input:{}},setup(s){const e=s;return(t,n)=>{const r=Jt;return x(),T("div",Cc,[e.input?(x(),T("div",$c,[N("div",Ic,[b(r,{name:"i-heroicons-arrow-right-circle",class:"w-5 h-5 text-primary-500"}),n[0]||(n[0]=N("h3",{class:"text-lg font-medium text-gray-900 dark:text-white"},"Input",-1))]),N("p",{class:"pl-7 text-gray-700 dark:text-gray-300",innerHTML:e.input},null,8,Ac)])):q("",!0),N("div",Ec,[N("div",Rc,[b(r,{name:"i-heroicons-language",class:"w-5 h-5 text-primary-500"}),n[1]||(n[1]=N("h3",{class:"text-lg font-medium text-gray-900 dark:text-white"},"Translation",-1))]),N("p",{class:"pl-7 text-gray-700 dark:text-gray-300",innerHTML:e.translation},null,8,Oc)]),e.note&&e.translation?(x(),T("div",kc,[N("div",Tc,[b(r,{name:"i-heroicons-pencil-square",class:"w-5 h-5 text-primary-500"}),n[2]||(n[2]=N("h3",{class:"text-lg font-medium text-gray-900 dark:text-white"},"Note",-1))]),N("div",{class:"pl-7 prose dark:prose-invert max-w-none",innerHTML:e.note},null,8,Nc)])):q("",!0)])}}}),Pc={class:"space-y-4"},Mc={key:0},Lc={key:1,class:"text-center"},Fc={key:3,class:"mt-4 text-sm text-red-500 dark:text-red-400 text-center"},Uc={key:4,class:"mt-4 text-sm text-gray-500 dark:text-gray-400 text-center"},ls=te({__name:"TranslationPanel",props:{textToTranslate:{},translationType:{},autoFetch:{type:Boolean},additionalPrompt:{}},setup(s){const e=s,{state:t,translate:n,checkCache:r,reset:a,activeTranslationService:i}=Sc(),o=J(!1),l=F(()=>!e.textToTranslate||!i.value),c=F(()=>t.result?"Retry Translation":"Request Translation");async function f(){l.value||(o.value=!0,await n(e.textToTranslate,e.translationType,e.additionalPrompt))}return Ke(()=>e.textToTranslate,d=>{o.value=!1,d&&r(d)||a()},{immediate:!0}),Ue(()=>{var d;e.autoFetch&&!((d=t==null?void 0:t.result)!=null&&d.translation)&&f()}),(d,h)=>{var m,g,_,P;const u=ye;return x(),T("div",Pc,[y(i)?q("",!0):(x(),T("div",Mc,h[0]||(h[0]=[N("p",{class:"text-sm text-yellow-500 dark:text-yellow-400"}," No translation service selected. Please select one in settings. ",-1)]))),b(u,{label:c.value,onClick:f,loading:y(t).status==="loading",disabled:l.value,icon:"i-heroicons-language-20-solid",class:"w-full justify-center cursor-pointer"},null,8,["label","loading","disabled"]),y(t).status==="loading"?(x(),T("div",Lc,h[1]||(h[1]=[N("p",{class:"text-sm animate-pulse text-gray-700 dark:text-gray-300"},"Translating...",-1)]))):q("",!0),y(t).status!=="loading"?(x(),K(ai,{key:2,translation:((g=(m=y(t))==null?void 0:m.result)==null?void 0:g.translation)??"",note:(P=(_=y(t))==null?void 0:_.result)==null?void 0:P.note},null,8,["translation","note"])):q("",!0),y(t).status==="error"?(x(),T("div",Fc,ce(y(t).error),1)):q("",!0),y(t).status==="idle"&&o.value?(x(),T("div",Uc," No translation available. ")):q("",!0)])}}});function Dc(s,e={}){const{pageSize:t=10,delay:n=200}=e,r=J(null),a=J([]),i=J(!1),o=F(()=>a.value.length>=s.value.length),l=async()=>{if(!(i.value||o.value)){i.value=!0;try{n>0&&await new Promise(h=>setTimeout(h,n));const f=a.value.length,d=s.value.slice(f,f+t);a.value.push(...d)}finally{i.value=!1}}};Ke(s,f=>{a.value=f.slice(0,t)},{immediate:!0});let c=null;return Ue(()=>{c=new IntersectionObserver(f=>{f[0].isIntersecting&&l()},{root:null,threshold:.1}),r.value&&c.observe(r.value)}),wi(()=>{c&&c.disconnect()}),{visibleItems:a,trigger:r,isLoading:i,isFinished:o}}const Bc={class:"mt-0"},qc={key:0},jc={class:"font-semibold mb-2 text-gray-800 dark:text-gray-200"},Vc={class:"bg-gray-100 dark:bg-gray-800 rounded-md p-3 text-sm overflow-x-auto space-y-3"},Gc={key:0,class:"text-gray-500"},Wc={key:1,class:"text-gray-400 text-sm"},Hc={key:1},Kc=te({__name:"LexicalUnitMatcher",props:{unit:{}},setup(s){const e=s,t=we(),n=c=>c.toLowerCase().replace(/[^\p{L}\p{N}\s-]/gu,"").trim(),r=F(()=>{const c=t.lexicalUnits;if(!c||!e.unit)return[];const f=[],d=new Set,h=n(e.unit.term);if(!h)return[];const u=(m,g)=>{d.has(m.id)||(f.push({...m,_matchPriority:g}),d.add(m.id))};for(const m of c){if(m.id===e.unit.id)continue;const g=n(m.term);if(!g)continue;if(g===h){u(m,1);continue}const _=3;let P="";for(let v=_;v<=Math.min(h.length,g.length)&&h.substring(0,v)===g.substring(0,v);v++)P=h.substring(0,v);if(P.length>=_){u(m,2);continue}if(h.startsWith(g)||g.startsWith(h)){u(m,3);continue}(h.includes(g)||g.includes(h))&&u(m,4)}return f.sort((m,g)=>m._matchPriority-g._matchPriority),f.map(({_matchPriority:m,...g})=>g)}),{visibleItems:a,trigger:i,isLoading:o,isFinished:l}=Dc(r,{pageSize:5});return(c,f)=>(x(),T("div",Bc,[r.value.length>0?(x(),T("div",qc,[N("h3",jc," Found "+ce(r.value.length)+" matching unit(s): ",1),N("div",Vc,[(x(!0),T(Me,null,Ft(y(a),d=>(x(),K(Sr,{key:d.id,unit:d,"show-all":""},null,8,["unit"]))),128))]),N("div",{ref_key:"trigger",ref:i,class:"h-10 text-center pt-4"},[y(o)?(x(),T("p",Gc,"Loading more...")):q("",!0),y(l)&&!y(o)?(x(),T("p",Wc,"- End of results -")):q("",!0)],512)])):(x(),T("div",Hc,f[0]||(f[0]=[N("p",{class:"text-gray-500 dark:text-gray-400"},"No other matching units found.",-1)])))]))}}),zc={key:0,class:"p-2 min-w-[180px] max-w-[200px]"},Jc={key:0,class:"mb-1"},Xc=["src"],Yc=["src"],Qc={key:1,class:"p-0 m-0 text-center text-gray-600 dark:text-gray-400"},Zc={class:"p-0 m-0 mt-1 text-center max-h-20 overflow-auto"},eu={class:"flex justify-center pt-2"},tu={class:"flex flex-row justify-between items-center mt-1"},nu={key:1,class:"p-4 min-w-[200px]"},su=te({__name:"LexicalUnitPopoverContent",props:{lexicalUnit:{}},emits:["statusChanged"],setup(s,{emit:e}){const t=s,n=e,r=F(()=>{var a;return(a=t.lexicalUnit)!=null&&a.img?Array.isArray(t.lexicalUnit.img)?t.lexicalUnit.img:[t.lexicalUnit.img]:[]});return(a,i)=>{const o=Pi,l=ye,c=wr;return a.lexicalUnit?(x(),T("div",zc,[r.value.length>0?(x(),T("div",Jc,[r.value.length>1?(x(),K(o,{key:0,"auto-height":"",arrows:"",loop:"",items:r.value,ui:{container:"transition-[height]",controls:"absolute top-3 inset-x-10.5",dots:"-bottom-50",dot:"w-6 h-1"},class:"w-full max-w-xs mx-auto"},{default:E(({item:f})=>[N("img",{src:f,class:"rounded-lg shadow-md w-full h-30 object-contain mx-auto"},null,8,Xc)]),_:1},8,["items"])):(x(),T("img",{key:1,src:r.value[0],alt:"Lexical unit image",class:"rounded-lg shadow-md w-full h-30 object-contain mx-auto"},null,8,Yc))])):q("",!0),b(kr,{term:a.lexicalUnit.term},null,8,["term"]),a.lexicalUnit.transcription?(x(),T("p",Qc," /"+ce(a.lexicalUnit.transcription)+"/ ",1)):q("",!0),N("p",Zc,ce(a.lexicalUnit.translation),1),N("div",eu,[b(Mi,{"lexical-unit-id":a.lexicalUnit.id,onStatusChanged:i[0]||(i[0]=f=>n("statusChanged",f))},null,8,["lexical-unit-id"])]),N("div",tu,[b(c,{description:"Find similiar terms"},{body:E(()=>[b(Kc,{unit:a.lexicalUnit},null,8,["unit"])]),default:E(()=>[b(l,{variant:"secondary",size:"xl",icon:"i-heroicons-magnifying-glass",class:"cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700"})]),_:1}),b(c,{ui:{width:"sm:max-w-lg md:max-w-xl"},description:"Translation online"},{body:E(()=>[b(ls,{"text-to-translate":a.lexicalUnit.term,"translation-type":"term","auto-fetch":!0},null,8,["text-to-translate"])]),default:E(()=>[b(l,{variant:"primary",size:"xl",icon:"i-heroicons-language",class:"cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 text-blue-500 font-bold"})]),_:1}),b(c,{description:"Lexical unit info"},{body:E(()=>[b(Sr,{unit:a.lexicalUnit,"show-all":""},null,8,["unit"])]),default:E(()=>[b(l,{variant:"secondary",size:"xl",icon:"i-heroicons-information-circle",class:"cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700"})]),_:1})])])):(x(),T("div",nu,i[1]||(i[1]=[N("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"No lexical unit data available.",-1)])))}}}),ru={key:1,class:"p-2 min-w-[180px] max-w-[200px] max-h-[300px] overflow-auto"},au=te({__name:"InteractiveToken",props:{token:{type:Object,required:!0}},setup(s){const e=s,t=ve(),n=we(),r=J(!1),a=F(()=>{var l,c,f,d,h,u;const i=e.token,o=n.settings;return i.isWord?i.lexicalUnit?i.status&&((c=(l=o==null?void 0:o.statusStyles)==null?void 0:l[i.status])!=null&&c.reading)?(d=(f=o.statusStyles)==null?void 0:f[i.status])==null?void 0:d.reading:(u=(h=o==null?void 0:o.statusStyles)==null?void 0:h.new)!=null&&u.reading?o.statusStyles.new.reading:on:o!=null&&o.unknownUnit?o.unknownUnit:on:on});return(i,o)=>{const l=ye,c=Nn;return x(),K(c,{mode:"click",arrow:"","open-delay":5,"close-delay":5,open:r.value,"onUpdate:open":o[1]||(o[1]=f=>r.value=f)},{content:E(()=>[s.token.lexicalUnit?(x(),K(su,{key:0,"lexical-unit":s.token.lexicalUnit,onStatusChanged:o[0]||(o[0]=f=>r.value=!1)},null,8,["lexical-unit"])):(x(),T("div",ru,[b(kr,{term:s.token.text,class:"mb-1"},null,8,["term"]),b(ls,{"text-to-translate":s.token.text,"translation-type":"term","auto-fetch":!0},null,8,["text-to-translate"])]))]),default:E(()=>[b(l,{variant:"primary",padded:!1,label:s.token.text,style:Pn({fontSize:`${y(t).settings.fontSize}px`}),class:pe([a.value,"text-left cursor-pointer"])},null,8,["label","style","class"])]),_:1},8,["open"])}}}),iu={class:"space-y-4"},ou={class:"max-h-30 w-full overflow-y-auto space-y-1 border p-2 rounded-md bg-gray-50 dark:bg-gray-700/30"},lu=20,cu=20,uu=te({__name:"LineTranslation",props:{initialLineAbsoluteIndex:{}},setup(s){const e=s,t=ve(),n=J(new Set),r=J(null),a=J("");Ue(async()=>{e.initialLineAbsoluteIndex!==void 0&&n.value.add(e.initialLineAbsoluteIndex),await br(),r.value&&r.value.scrollIntoView({block:"center",behavior:"auto"})});const i=F(()=>{const f=t.processedLines;if(!f.length)return[];const d=Math.max(0,e.initialLineAbsoluteIndex-lu),h=Math.min(f.length,e.initialLineAbsoluteIndex+cu+1);return f.slice(d,h).map((u,m)=>{const g=d+m;return{originalIndex:g,text:u.originalText,isSelected:n.value.has(g),isInitial:g===e.initialLineAbsoluteIndex}})}),o=F(()=>Array.from(n.value).sort((d,h)=>d-h).map(d=>{var h;return((h=t.processedLines[d])==null?void 0:h.originalText)||""}).join(`
`));function l(f,d){return f.length<=d?f:f.substring(0,d)+"..."}function c(f,d){d?n.value.add(f):n.value.delete(f)}return Ke(()=>e.initialLineAbsoluteIndex,f=>{n.value.clear(),n.value.add(f)},{immediate:!0}),Ue(()=>{e.initialLineAbsoluteIndex!==void 0&&n.value.add(e.initialLineAbsoluteIndex)}),(f,d)=>{const h=Di,u=Ui,m=Fn;return x(),T("div",iu,[d[1]||(d[1]=N("h4",{class:"text-md font-medium text-gray-800 dark:text-gray-100"}," Select lines for translation: ",-1)),N("div",ou,[(x(!0),T(Me,null,Ft(i.value,g=>(x(),T("div",{key:g.originalIndex,class:"flex items-center",ref_for:!0,ref:_=>{g.isInitial&&_&&(r.value=_)}},[b(h,{modelValue:g.isSelected,"onUpdate:modelValue":[_=>g.isSelected=_,_=>c(g.originalIndex,_)],label:l(g.text,70),ui:{label:"text-sm truncate"},"container-class":g.isInitial?"font-semibold text-primary-500 dark:text-primary-400":""},null,8,["modelValue","onUpdate:modelValue","label","container-class"])]))),128))]),b(u,{class:"w-full",size:"xl",placeholder:"Additional prompt...",modelValue:a.value,"onUpdate:modelValue":d[0]||(d[0]=g=>a.value=g)},null,8,["modelValue"]),o.value?(x(),K(ls,{key:0,"text-to-translate":o.value,"translation-type":"line","additional-prompt":a.value},null,8,["text-to-translate","additional-prompt"])):q("",!0),b(m),b(Or)])}}}),du={class:"flex items-center"},fu={class:"flex flex-col"},hu={key:1},mu={key:0,class:"text-gray-500 dark:text-gray-400"},pu=te({__name:"LineRenderer",props:{},setup(s){const e=J(!1),t=J(null),n=ve();we();const r=c=>{const{currentPage:f,pageSize:d}=n.settings.pagination,h=(f-1)*d+c;h>=0&&h<n.processedLines.length?(t.value=h,e.value=!0):console.error("Calculated absolute index is out of bounds:",h)},a=F(()=>({fontSize:`${n.settings.fontSize}px`,margin:`${n.settings.fontSize*.7}px 0`,textAlign:n.settings.alignment})),i=zt(),o=c=>{navigator.clipboard.writeText(c).then(()=>{console.log("Line text copied to clipboard:",c),i.add({title:"Copied to Clipboard",description:"Line text copied successfully!",color:"success",duration:1e3,progress:!1,ui:{title:"text-success"}})}).catch(f=>{console.error("Failed to copy line text:",f),i.add({title:"Copy Failed",description:"Unable to copy line text to clipboard!",color:"error",duration:1e3,progress:!1,ui:{title:"text-error"}})})},l=async c=>{const f="target";try{await vr(c,f),console.log(`Speaking line: "${c}"`)}catch(d){console.error("Failed to speak line:",d),i.add({title:"Speech Failed",description:"Unable to speak the line.",color:"error",duration:2e3})}};return(c,f)=>{const d=Jt,h=ye,u=wr,m=Fn,g=Nn;return x(),T(Me,null,[(x(!0),T(Me,null,Ft(y(n).paginatedLines,(_,P)=>(x(),T("div",{key:_.id,class:"flex items-center"},[N("div",du,[b(g,{mode:"click",arrow:"",content:{align:"center",side:"top",sideOffset:0}},{content:E(()=>[N("div",fu,[b(h,{variant:"primary",size:"xl",icon:"i-heroicons-clipboard-document",class:"cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700",onClick:v=>o(_.originalText)},null,8,["onClick"]),b(h,{variant:"primary",size:"xl",icon:"i-heroicons-speaker-wave",class:"cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700",onClick:v=>l(_.originalText)},null,8,["onClick"]),_.translation||_.translation?(x(),K(u,{key:0,description:"Translation and note"},{body:E(()=>[b(ai,{note:_.note,translation:_.translation,input:_.originalText},null,8,["note","translation","input"])]),default:E(()=>[b(h,{variant:"secondary",size:"xl",icon:"i-heroicons-language",class:"cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700"})]),_:2},1024)):q("",!0),b(m),b(u,{modelValue:e.value,"onUpdate:modelValue":f[0]||(f[0]=v=>e.value=v),ui:{width:"sm:max-w-lg md:max-w-xl"},description:"Translation online"},{body:E(()=>[t.value!==null?(x(),K(uu,{key:0,"initial-line-absolute-index":t.value},null,8,["initial-line-absolute-index"])):q("",!0)]),default:E(()=>[b(h,{variant:"primary",size:"xl",icon:"i-heroicons-language",class:"cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 text-blue-500 font-bold",onClick:v=>r(P)},null,8,["onClick"])]),_:2},1032,["modelValue"])])]),default:E(()=>[b(h,{color:"gray","aria-label":"Line options",class:"cursor-pointer"},{default:E(()=>[b(d,{name:"i-heroicons-ellipsis-horizontal-circle",class:"size-8"})]),_:1})]),_:2},1024)]),N("p",{class:"flex-1 leading-relaxed pe-1",style:Pn(a.value)},[(x(!0),T(Me,null,Ft(_.tokens,(v,S)=>(x(),T(Me,{key:`token-${P}-${S}`},[v.isWord?(x(),K(au,{key:0,token:v},null,8,["token"])):(x(),T("span",hu,ce(v.text),1))],64))),128))],4)]))),128)),y(n).processedLines.length===0&&!y(n).isLoading?(x(),T("div",mu," No text content to display. ")):q("",!0)],64)}}}),gu={class:"flex flex-col items-center space-y-7"},yu=te({__name:"LexicalUnitsMiniFilter",setup(s){const e=Bi(),t=Li(),n=ve(),r=zt(),a=F(()=>{const c=new Set;return n.processedLines&&n.processedLines.forEach(f=>{f.tokens.forEach(d=>{d.isWord&&d.lexicalUnit&&c.add(d.lexicalUnit.id)})}),c}),i=()=>{e.resetFilterOptions()},o=async()=>{await e.applyFilters()},l=async()=>{await o();const c=e.filteredLexicalUnits.filter(f=>a.value.has(f.id));c.length<1?r.add({title:"No Cards Found",description:"No lexical units matching the selected filters were found in the current text.",color:"error",icon:"i-heroicons-information-circle"}):(t.endSession(),t.startSession(qi(c)),xi.push({name:"flash_cards"}))};return Ue(()=>{i()}),(c,f)=>{const d=Mn,h=Ln,u=ye;return x(),T("div",gu,[b(h,{label:"Select Statuses",ui:{label:"text-sm font-medium text-gray-700 dark:text-gray-300"},class:"mt-2"},{default:E(()=>[b(d,{modelValue:y(e).options.status.chosen,"onUpdate:modelValue":[f[0]||(f[0]=m=>y(e).options.status.chosen=m),f[1]||(f[1]=m=>y(e).updateStatusChosen(m))],items:y(Qe),multiple:"",placeholder:"Select statuses...","value-attribute":"value","option-attribute":"label",searchable:"",ui:{default:{option:{active:"bg-gray-100 dark:bg-gray-700"}}}},null,8,["modelValue","items"])]),_:1}),b(u,{onClick:l,label:"Start Flash Cards",size:"xl",icon:"i-heroicons-bolt-solid",color:"error",variant:"outline",ui:{rounded:"rounded-full",font:"font-bold"},class:"cursor-pointer animate-bounce"})])}}}),_u={class:"text-renderer space-y-2"},bu={class:"flex justify-between items-center"},vu={class:"flex items-center gap-x-2"},wu={key:0,class:"text-center py-5"},xu={key:1,class:"px-4 pt-2"},Su=["src","alt"],Cu={key:1,class:"text-2xl font-bold mb-1 text-gray-900 dark:text-white"},$u={key:2,class:"text-md text-gray-700 dark:text-gray-300 mb-3"},Iu=["innerHTML"],Au={key:3,class:"flex justify-between items-center p-4 z-20 space-x-2"},Eu={class:"flex items-center space-x-1"},Ru={class:"text-sm text-gray-500 dark:text-gray-400"},Ou=te({__name:"TextRenderer",props:{material:{type:Object,required:!0}},setup(s){const e=s,t=we(),n=ve(),r=J(!1),a=Dn(),i=F(()=>e.material.text);F(()=>t.lexicalUnits?t.lexicalUnits.map(h=>({id:h.id,term:h.term})):[]),Ke([i,()=>t.lexicalUnits],([h],[u])=>{n.processText(h,t.lexicalUnits,t.status,t.settings),h!==u&&n.settings.pagination.currentPage!==1&&n.updatePaginationSettings({currentPage:1})},{immediate:!0,deep:!0});const o=F(()=>!n.settings.pagination.show||n.settings.pagination.pageSize<=0||n.processedLines.length===0?1:Math.ceil(n.processedLines.length/n.settings.pagination.pageSize)),l=(h,u=!0)=>{let m=Number(h);isNaN(m)&&(m=n.settings.pagination.currentPage);const g=o.value;m<1?m=1:m>g&&(m=g),m!==n.settings.pagination.currentPage&&(n.updatePaginationSettings({currentPage:m}),u&&br(()=>{window.scrollTo({top:0,behavior:"smooth"})}))},c=()=>{const h=o.value;let u=n.settings.pagination.currentPage-1;u<1&&(u=h),l(u)},f=()=>{const h=o.value;let u=n.settings.pagination.currentPage+1;u>h&&(u=1),l(u)},d=F({get:()=>n.settings.pagination.currentPage,set:h=>{const u=Number(h);l(u,!1)}});return(h,u)=>{const m=Jt,g=ye,_=Nn,P=oo,v=Rr;return x(),T("div",_u,[N("div",bu,[b(g,{onClick:u[0]||(u[0]=S=>y(a).clearMaterial()),color:"gray",class:"cursor-pointer"},{default:E(()=>[b(m,{name:"i-heroicons-arrow-left",class:"size-7"})]),_:1}),N("div",vu,[b(_,null,{content:E(()=>[b(yu)]),default:E(()=>[b(g,{color:"gray","aria-label":"Open mini filter for flash cards",class:"cursor-pointer"},{default:E(()=>[b(m,{name:"i-heroicons-rectangle-stack",class:"size-7"})]),_:1})]),_:1}),b(P,{title:"Settings",open:r.value,"onUpdate:open":u[1]||(u[1]=S=>r.value=S)},{body:E(()=>[b(Oo)]),default:E(()=>[b(g,{color:"gray","aria-label":"Open settings",class:"cursor-pointer"},{default:E(()=>[b(m,{name:"i-heroicons-cog-6-tooth-20-solid",class:"size-7"})]),_:1})]),_:1},8,["open"])])]),y(n).isLoading?(x(),T("div",wu,u[4]||(u[4]=[N("p",{class:"text-gray-500 dark:text-gray-400"},"Processing text...",-1)]))):q("",!0),!y(n).isLoading&&e.material&&d.value===1?(x(),T("div",xu,[e.material.info.imageUrl?(x(),T("img",{key:0,src:e.material.info.imageUrl,alt:e.material.info.title||"Material image",class:"w-full h-auto object-cover rounded-md mb-4 max-h-72 max-w-[400px]",onError:u[2]||(u[2]=S=>S.target.style.display="none")},null,40,Su)):q("",!0),e.material.info.title?(x(),T("h1",Cu,ce(e.material.info.title),1)):q("",!0),e.material.info.description?(x(),T("p",$u,ce(e.material.info.description),1)):q("",!0)])):q("",!0),e.material&&e.material.note&&y(n).settings.note.show?(x(),T("div",{key:2,class:pe(["w-full overflow-y-auto border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 p-3 z-10",y(n).settings.note.isSticky&&!r.value?"sticky top-0":""]),style:Pn({height:`${y(n).settings.note.height}px`}),innerHTML:e.material.note},null,14,Iu)):q("",!0),b(pu),!y(n).isLoading&&y(n).settings.pagination.show&&o.value>1?(x(),T("div",Au,[b(g,{icon:"i-heroicons-chevron-left-20-solid",onClick:c,"aria-label":"Previous page",size:"xl",ui:{padding:{xl:"p-3 md:p-4"},icon:{size:{xl:"h-7 w-7 md:h-8 md:w-8"}}},class:"cursor-pointer"}),N("div",Eu,[b(v,{modelValue:d.value,"onUpdate:modelValue":u[3]||(u[3]=S=>d.value=S),modelModifiers:{number:!0},size:"lg",min:1,max:o.value>0?o.value:1,class:"w-full",inputClass:"text-center","aria-label":"Current page number"},null,8,["modelValue","max"]),N("span",Ru,"of "+ce(o.value),1)]),b(g,{icon:"i-heroicons-chevron-right-20-solid",onClick:f,"aria-label":"Next page",size:"xl",ui:{padding:{xl:"p-3 md:p-4"},icon:{size:{xl:"h-7 w-7 md:h-8 md:w-8"}}},class:"cursor-pointer"})])):q("",!0)])}}}),ku={class:"container mx-auto p-4 pt-0"},Tu={key:0},Nu={key:1},Zu=te({__name:"TextMaterialPage",setup(s){we();const e=Dn();return(t,n)=>(x(),T("div",ku,[N("div",null,[y(e).isMaterialLoaded?(x(),T("div",Nu,[b(Ou,{material:y(e).currentMaterial},null,8,["material"])])):(x(),T("div",Tu,[n[0]||(n[0]=N("h2",{class:"text-2xl font-bold text-center mb-6 mt-3"},"Load a Text to Start Reading",-1)),b(ro)]))])]))}});export{Zu as default};
